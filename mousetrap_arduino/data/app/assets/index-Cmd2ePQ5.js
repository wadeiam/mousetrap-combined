var ks=Object.defineProperty;var ws=(l,e,t)=>e in l?ks(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var gt=(l,e,t)=>ws(l,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function Q(){}function Cs(l,e){for(const t in e)l[t]=e[t];return l}function ys(l){return!!l&&(typeof l=="object"||typeof l=="function")&&typeof l.then=="function"}function os(l){return l()}function Ut(){return Object.create(null)}function _e(l){l.forEach(os)}function _t(l){return typeof l=="function"}function Se(l,e){return l!=l?e==e:l!==e||l&&typeof l=="object"||typeof l=="function"}let ct;function lt(l,e){return l===e?!0:(ct||(ct=document.createElement("a")),ct.href=e,l===ct.href)}function Ss(l){return Object.keys(l).length===0}function is(l,...e){if(l==null){for(const n of e)n(void 0);return Q}const t=l.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function dt(l,e,t){l.$$.on_destroy.push(is(e,t))}function yt(l,e,t,n){if(l){const s=as(l,e,t,n);return l[0](s)}}function as(l,e,t,n){return l[1]&&n?Cs(t.ctx.slice(),l[1](n(e))):t.ctx}function St(l,e,t,n){if(l[2]&&n){const s=l[2](n(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const r=[],o=Math.max(e.dirty.length,s.length);for(let a=0;a<o;a+=1)r[a]=e.dirty[a]|s[a];return r}return e.dirty|s}return e.dirty}function Tt(l,e,t,n,s,r){if(s){const o=as(e,t,n,r);l.p(o,s)}}function Lt(l){if(l.ctx.length>32){const e=[],t=l.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function Ue(l){return l&&_t(l.destroy)?l.destroy:Q}const cs=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function i(l,e){l.appendChild(e)}function w(l,e,t){l.insertBefore(e,t||null)}function k(l){l.parentNode&&l.parentNode.removeChild(l)}function Ye(l,e){for(let t=0;t<l.length;t+=1)l[t]&&l[t].d(e)}function d(l){return document.createElement(l)}function A(l){return document.createTextNode(l)}function b(){return A(" ")}function Le(){return A("")}function M(l,e,t,n){return l.addEventListener(e,t,n),()=>l.removeEventListener(e,t,n)}function kt(l){return function(e){return e.preventDefault(),l.call(this,e)}}function us(l){return function(e){return e.stopPropagation(),l.call(this,e)}}function c(l,e,t){t==null?l.removeAttribute(e):l.getAttribute(e)!==t&&l.setAttribute(e,t)}function Ts(l){let e;return{p(...t){e=t,e.forEach(n=>l.push(n))},r(){e.forEach(t=>l.splice(l.indexOf(t),1))}}}function De(l){return l===""?null:+l}function Ls(l){return Array.from(l.childNodes)}function j(l,e){e=""+e,l.data!==e&&(l.data=e)}function le(l,e){l.value=e??""}function Ge(l,e,t,n){t==null?l.style.removeProperty(e):l.style.setProperty(e,t,"")}function z(l,e,t){l.classList.toggle(e,!!t)}function pt(l,e){return new l(e)}let nt;function He(l){nt=l}function qt(){if(!nt)throw new Error("Function called outside component initialization");return nt}function ze(l){qt().$$.on_mount.push(l)}function ot(l){qt().$$.on_destroy.push(l)}function Dt(l,e){const t=l.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const xe=[],et=[];let tt=[];const jt=[],Es=Promise.resolve();let Et=!1;function As(){Et||(Et=!0,Es.then(Ft))}function At(l){tt.push(l)}const wt=new Set;let Xe=0;function Ft(){if(Xe!==0)return;const l=nt;do{try{for(;Xe<xe.length;){const e=xe[Xe];Xe++,He(e),qs(e.$$)}}catch(e){throw xe.length=0,Xe=0,e}for(He(null),xe.length=0,Xe=0;et.length;)et.pop()();for(let e=0;e<tt.length;e+=1){const t=tt[e];wt.has(t)||(wt.add(t),t())}tt.length=0}while(xe.length);for(;jt.length;)jt.pop()();Et=!1,wt.clear(),He(l)}function qs(l){if(l.fragment!==null){l.update(),_e(l.before_update);const e=l.dirty;l.dirty=[-1],l.fragment&&l.fragment.p(l.ctx,e),l.after_update.forEach(At)}}function Fs(l){const e=[],t=[];tt.forEach(n=>l.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),tt=e}const ft=new Set;let Ke;function we(){Ke={r:0,c:[],p:Ke}}function Ce(){Ke.r||_e(Ke.c),Ke=Ke.p}function J(l,e){l&&l.i&&(ft.delete(l),l.i(e))}function K(l,e,t,n){if(l&&l.o){if(ft.has(l))return;ft.add(l),Ke.c.push(()=>{ft.delete(l),n&&(t&&l.d(1),n())}),l.o(e)}else n&&n()}function mt(l,e){const t=e.token={};function n(s,r,o,a){if(e.token!==t)return;e.resolved=a;let u=e.ctx;o!==void 0&&(u=u.slice(),u[o]=a);const f=s&&(e.current=s)(u);let p=!1;e.block&&(e.blocks?e.blocks.forEach((m,v)=>{v!==r&&m&&(we(),K(m,1,1,()=>{e.blocks[v]===m&&(e.blocks[v]=null)}),Ce())}):e.block.d(1),f.c(),J(f,1),f.m(e.mount(),e.anchor),p=!0),e.block=f,e.blocks&&(e.blocks[r]=f),p&&Ft()}if(ys(l)){const s=qt();if(l.then(r=>{He(s),n(e.then,1,e.value,r),He(null)},r=>{if(He(s),n(e.catch,2,e.error,r),He(null),!e.hasCatch)throw r}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,l),!0;e.resolved=l}}function fs(l,e,t){const n=e.slice(),{resolved:s}=l;l.current===l.then&&(n[l.value]=s),l.current===l.catch&&(n[l.error]=s),l.block.p(n,t)}function Re(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function de(l){l&&l.c()}function ce(l,e,t){const{fragment:n,after_update:s}=l.$$;n&&n.m(e,t),At(()=>{const r=l.$$.on_mount.map(os).filter(_t);l.$$.on_destroy?l.$$.on_destroy.push(...r):_e(r),l.$$.on_mount=[]}),s.forEach(At)}function ue(l,e){const t=l.$$;t.fragment!==null&&(Fs(t.after_update),_e(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Os(l,e){l.$$.dirty[0]===-1&&(xe.push(l),As(),l.$$.dirty.fill(0)),l.$$.dirty[e/31|0]|=1<<e%31}function Ee(l,e,t,n,s,r,o=null,a=[-1]){const u=nt;He(l);const f=l.$$={fragment:null,ctx:[],props:r,update:Q,not_equal:s,bound:Ut(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Ut(),dirty:a,skip_bound:!1,root:e.target||u.$$.root};o&&o(f.root);let p=!1;if(f.ctx=t?t(l,e.props||{},(m,v,..._)=>{const g=_.length?_[0]:v;return f.ctx&&s(f.ctx[m],f.ctx[m]=g)&&(!f.skip_bound&&f.bound[m]&&f.bound[m](g),p&&Os(l,m)),v}):[],f.update(),p=!0,_e(f.before_update),f.fragment=n?n(f.ctx):!1,e.target){if(e.hydrate){const m=Ls(e.target);f.fragment&&f.fragment.l(m),m.forEach(k)}else f.fragment&&f.fragment.c();e.intro&&J(l.$$.fragment),ce(l,e.target,e.anchor),Ft()}He(u)}class Ae{constructor(){gt(this,"$$");gt(this,"$$set")}$destroy(){ue(this,1),this.$destroy=Q}$on(e,t){if(!_t(t))return Q;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const s=n.indexOf(t);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!Ss(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Is="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Is);const $e=[];function Ps(l,e){return{subscribe:it(l,e).subscribe}}function it(l,e=Q){let t;const n=new Set;function s(a){if(Se(l,a)&&(l=a,t)){const u=!$e.length;for(const f of n)f[1](),$e.push(f,l);if(u){for(let f=0;f<$e.length;f+=2)$e[f][0]($e[f+1]);$e.length=0}}}function r(a){s(a(l))}function o(a,u=Q){const f=[a,u];return n.add(f),n.size===1&&(t=e(s,r)||Q),a(l),()=>{n.delete(f),n.size===0&&t&&(t(),t=null)}}return{set:s,update:r,subscribe:o}}function ds(l,e,t){const n=!Array.isArray(l),s=n?[l]:l;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return Ps(t,(o,a)=>{let u=!1;const f=[];let p=0,m=Q;const v=()=>{if(p)return;m();const g=e(n?f[0]:f,o,a);r?o(g):m=_t(g)?g:Q},_=s.map((g,y)=>is(g,h=>{f[y]=h,p&=~(1<<y),u&&v()},()=>{p|=1<<y}));return u=!0,v(),function(){_e(_),m(),u=!1}})}const ps=it({threshold:0,sensorReading:0,detectionState:!1,uptime:"",wifiRSSI:0,heap:0,psram:0,lastUpdate:null}),st=it(!1);function Ns(l,e){const t=localStorage.getItem(l),n=t?JSON.parse(t):e,{subscribe:s,set:r,update:o}=it(n);return{subscribe:s,set:a=>{localStorage.setItem(l,JSON.stringify(a)),r(a)},update:a=>{o(u=>{const f=a(u);return localStorage.setItem(l,JSON.stringify(f)),f})}}}Ns("mousetrap-prefs",{theme:"dark",refreshInterval:5e3});ds(ps,l=>l.detectionState);ds(ps,l=>l.lastUpdate?l.detectionState?"red":"green":"gray");const Ot=it(window.location.hash.slice(1)||"/");window.addEventListener("hashchange",()=>{const l=window.location.hash.slice(1)||"/";Ot.set(l)});function Rs(l){window.location.hash=l}function je(l){function e(t){const n=l.getAttribute("href");n&&n.startsWith("#/")&&(t.preventDefault(),Rs(n.slice(1)))}return l.addEventListener("click",e),{destroy(){l.removeEventListener("click",e)}}}function Ht(l){let e,t,n,s,r,o,a,u;return{c(){e=d("div"),t=d("a"),t.textContent="Servo Settings",n=b(),s=d("a"),s.textContent="Calibration",r=b(),o=d("a"),o.textContent="Options & Access",c(t,"href","#/servo"),c(t,"class","svelte-1n65rh9"),z(t,"active",l[0]==="/servo"),c(s,"href","#/calibration"),c(s,"class","svelte-1n65rh9"),z(s,"active",l[0]==="/calibration"),c(o,"href","#/settings"),c(o,"class","svelte-1n65rh9"),z(o,"active",l[0]==="/settings"),c(e,"class","submenu svelte-1n65rh9")},m(f,p){w(f,e,p),i(e,t),i(e,n),i(e,s),i(e,r),i(e,o),a||(u=[Ue(je.call(null,t)),M(t,"click",l[5]),Ue(je.call(null,s)),M(s,"click",l[5]),Ue(je.call(null,o)),M(o,"click",l[5])],a=!0)},p(f,p){p&1&&z(t,"active",f[0]==="/servo"),p&1&&z(s,"active",f[0]==="/calibration"),p&1&&z(o,"active",f[0]==="/settings")},d(f){f&&k(e),a=!1,_e(u)}}}function zt(l){let e,t,n,s,r,o,a,u;return{c(){e=d("div"),t=d("a"),t.textContent="Status",n=b(),s=d("a"),s.textContent="System Logs",r=b(),o=d("a"),o.textContent="Gallery",c(t,"href","#/status"),c(t,"class","svelte-1n65rh9"),z(t,"active",l[0]==="/status"),c(s,"href","#/logs"),c(s,"class","svelte-1n65rh9"),z(s,"active",l[0]==="/logs"),c(o,"href","#/gallery"),c(o,"class","svelte-1n65rh9"),z(o,"active",l[0]==="/gallery"),c(e,"class","submenu svelte-1n65rh9")},m(f,p){w(f,e,p),i(e,t),i(e,n),i(e,s),i(e,r),i(e,o),a||(u=[Ue(je.call(null,t)),M(t,"click",l[5]),Ue(je.call(null,s)),M(s,"click",l[5]),Ue(je.call(null,o)),M(o,"click",l[5])],a=!0)},p(f,p){p&1&&z(t,"active",f[0]==="/status"),p&1&&z(s,"active",f[0]==="/logs"),p&1&&z(o,"active",f[0]==="/gallery")},d(f){f&&k(e),a=!1,_e(u)}}}function Vt(l){let e,t,n,s,r,o,a,u,f,p;return{c(){e=d("div"),t=d("a"),t.textContent="Claim",n=b(),s=d("a"),s.textContent="Test Alert",r=b(),o=d("a"),o.textContent="Firmware / OTA",a=b(),u=d("a"),u.textContent="Reboot",c(t,"href","/claim"),c(t,"class","svelte-1n65rh9"),c(s,"href","#/test"),c(s,"class","svelte-1n65rh9"),z(s,"active",l[0]==="/test"),c(o,"href","#/firmware"),c(o,"class","svelte-1n65rh9"),z(o,"active",l[0]==="/firmware"),c(u,"href","#/reboot"),c(u,"class","svelte-1n65rh9"),z(u,"active",l[0].startsWith("/reboot")),c(e,"class","submenu svelte-1n65rh9")},m(m,v){w(m,e,v),i(e,t),i(e,n),i(e,s),i(e,r),i(e,o),i(e,a),i(e,u),f||(p=[M(t,"click",l[5]),Ue(je.call(null,s)),M(s,"click",l[5]),Ue(je.call(null,o)),M(o,"click",l[5]),Ue(je.call(null,u)),M(u,"click",l[5])],f=!0)},p(m,v){v&1&&z(s,"active",m[0]==="/test"),v&1&&z(o,"active",m[0]==="/firmware"),v&1&&z(u,"active",m[0].startsWith("/reboot"))},d(m){m&&k(e),f=!1,_e(p)}}}function Bt(l){let e,t,n;return{c(){e=d("div"),c(e,"class","backdrop svelte-1n65rh9")},m(s,r){w(s,e,r),t||(n=M(e,"click",l[5]),t=!0)},p:Q,d(s){s&&k(e),t=!1,n()}}}function Ms(l){let e,t,n,s,r,o,a,u,f,p,m,v,_,g,y,h,L,E,C,S,I,P=l[1]&&Ht(l),q=l[2]&&zt(l),T=l[3]&&Vt(l),F=l[4]&&Bt(l);return{c(){e=d("div"),t=d("a"),t.textContent="Home",n=b(),s=d("a"),r=A(`Settings
    `),o=d("span"),o.textContent="â–¸",a=b(),P&&P.c(),u=b(),f=d("a"),p=A(`Logs & Diagnostics
    `),m=d("span"),m.textContent="â–¸",v=b(),q&&q.c(),_=b(),g=d("a"),y=A(`Maintenance
    `),h=d("span"),h.textContent="â–¸",L=b(),T&&T.c(),E=b(),F&&F.c(),C=Le(),c(t,"href","#/"),c(t,"class","svelte-1n65rh9"),z(t,"active",l[0]==="/"),c(o,"class","arrow svelte-1n65rh9"),z(o,"expanded",l[1]),c(s,"href","#"),c(s,"class","parent svelte-1n65rh9"),c(m,"class","arrow svelte-1n65rh9"),z(m,"expanded",l[2]),c(f,"href","#"),c(f,"class","parent svelte-1n65rh9"),c(h,"class","arrow svelte-1n65rh9"),z(h,"expanded",l[3]),c(g,"href","#"),c(g,"class","parent svelte-1n65rh9"),c(e,"class","menu svelte-1n65rh9"),z(e,"open",l[4])},m(R,O){w(R,e,O),i(e,t),i(e,n),i(e,s),i(s,r),i(s,o),i(e,a),P&&P.m(e,null),i(e,u),i(e,f),i(f,p),i(f,m),i(e,v),q&&q.m(e,null),i(e,_),i(e,g),i(g,y),i(g,h),i(e,L),T&&T.m(e,null),w(R,E,O),F&&F.m(R,O),w(R,C,O),S||(I=[Ue(je.call(null,t)),M(t,"click",l[5]),M(s,"click",kt(l[7])),M(f,"click",kt(l[8])),M(g,"click",kt(l[9]))],S=!0)},p(R,[O]){O&1&&z(t,"active",R[0]==="/"),O&2&&z(o,"expanded",R[1]),R[1]?P?P.p(R,O):(P=Ht(R),P.c(),P.m(e,u)):P&&(P.d(1),P=null),O&4&&z(m,"expanded",R[2]),R[2]?q?q.p(R,O):(q=zt(R),q.c(),q.m(e,_)):q&&(q.d(1),q=null),O&8&&z(h,"expanded",R[3]),R[3]?T?T.p(R,O):(T=Vt(R),T.c(),T.m(e,null)):T&&(T.d(1),T=null),O&16&&z(e,"open",R[4]),R[4]?F?F.p(R,O):(F=Bt(R),F.c(),F.m(C.parentNode,C)):F&&(F.d(1),F=null)},i:Q,o:Q,d(R){R&&(k(e),k(E),k(C)),P&&P.d(),q&&q.d(),T&&T.d(),F&&F.d(R),S=!1,_e(I)}}}function Us(l,e,t){let n,s;dt(l,Ot,_=>t(0,n=_)),dt(l,st,_=>t(4,s=_));let r=!1,o=!1,a=!1;function u(){st.set(!1)}function f(_){_==="settings"&&t(1,r=!r),_==="logs"&&t(2,o=!o),_==="maintenance"&&t(3,a=!a)}const p=()=>f("settings"),m=()=>f("logs"),v=()=>f("maintenance");return l.$$.update=()=>{if(l.$$.dirty&1){const _=n;t(1,r=_.startsWith("/servo")||_.startsWith("/calibration")||_.startsWith("/settings")),t(2,o=_.startsWith("/logs")||_.startsWith("/status")||_.startsWith("/gallery")),t(3,a=_.startsWith("/claim")||_.startsWith("/test")||_.startsWith("/firmware")||_.startsWith("/reboot"))}},[n,r,o,a,s,u,f,p,m,v]}class Ds extends Ae{constructor(e){super(),Ee(this,e,Us,Ms,Se,{})}}function js(l){let e,t,n,s,r,o,a,u,f;s=new Ds({});const p=l[3].default,m=yt(p,l,l[2],null);return{c(){e=d("div"),t=d("div"),t.innerHTML='<div class="bar svelte-1stvkey"></div> <div class="bar svelte-1stvkey"></div> <div class="bar svelte-1stvkey"></div>',n=b(),de(s.$$.fragment),r=b(),o=d("main"),m&&m.c(),c(t,"class","hamburger svelte-1stvkey"),c(t,"role","button"),c(t,"tabindex","0"),c(t,"aria-label","Toggle navigation menu"),c(o,"class","content svelte-1stvkey"),c(e,"class","layout svelte-1stvkey")},m(v,_){w(v,e,_),i(e,t),i(e,n),ce(s,e,null),i(e,r),i(e,o),m&&m.m(o,null),a=!0,u||(f=[M(window,"keydown",l[1]),M(t,"click",l[0]),M(t,"keydown",l[4])],u=!0)},p(v,[_]){m&&m.p&&(!a||_&4)&&Tt(m,p,v,v[2],a?St(p,v[2],_,null):Lt(v[2]),null)},i(v){a||(J(s.$$.fragment,v),J(m,v),a=!0)},o(v){K(s.$$.fragment,v),K(m,v),a=!1},d(v){v&&k(e),ue(s),m&&m.d(v),u=!1,_e(f)}}}function Hs(l,e,t){let n;dt(l,st,f=>t(5,n=f));let{$$slots:s={},$$scope:r}=e;function o(){st.update(f=>!f)}function a(f){f.key==="Escape"&&n&&st.set(!1)}const u=f=>f.key==="Enter"&&o();return l.$$set=f=>{"$$scope"in f&&t(2,r=f.$$scope)},[o,a,r,s,u]}class zs extends Ae{constructor(e){super(),Ee(this,e,Hs,js,Se,{})}}const Vs=l=>({}),Wt=l=>({});function Gt(l){let e,t;return{c(){e=d("h3"),t=A(l[0]),c(e,"class","card-title svelte-q6oxq0")},m(n,s){w(n,e,s),i(e,t)},p(n,s){s&1&&j(t,n[0])},d(n){n&&k(e)}}}function Bs(l){let e,t,n,s,r,o,a,u=l[0]&&Gt(l);const f=l[2].actions,p=yt(f,l,l[1],Wt),m=l[2].default,v=yt(m,l,l[1],null);return{c(){e=d("div"),t=d("div"),u&&u.c(),n=b(),s=d("div"),p&&p.c(),r=b(),o=d("div"),v&&v.c(),c(s,"class","card-actions svelte-q6oxq0"),c(t,"class","card-header svelte-q6oxq0"),c(o,"class","card-content svelte-q6oxq0"),c(e,"class","card svelte-q6oxq0")},m(_,g){w(_,e,g),i(e,t),u&&u.m(t,null),i(t,n),i(t,s),p&&p.m(s,null),i(e,r),i(e,o),v&&v.m(o,null),a=!0},p(_,[g]){_[0]?u?u.p(_,g):(u=Gt(_),u.c(),u.m(t,n)):u&&(u.d(1),u=null),p&&p.p&&(!a||g&2)&&Tt(p,f,_,_[1],a?St(f,_[1],g,Vs):Lt(_[1]),Wt),v&&v.p&&(!a||g&2)&&Tt(v,m,_,_[1],a?St(m,_[1],g,null):Lt(_[1]),null)},i(_){a||(J(p,_),J(v,_),a=!0)},o(_){K(p,_),K(v,_),a=!1},d(_){_&&k(e),u&&u.d(),p&&p.d(_),v&&v.d(_)}}}function Ws(l,e,t){let{$$slots:n={},$$scope:s}=e,{title:r=""}=e;return l.$$set=o=>{"title"in o&&t(0,r=o.title),"$$scope"in o&&t(1,s=o.$$scope)},[r,s,n]}class Te extends Ae{constructor(e){super(),Ee(this,e,Ws,Bs,Se,{title:0})}}function Gs(){const l=window.location.origin;return l.includes("192.168.")||l.includes("localhost")||l.includes("mousetrap.local")?l:(console.log("[API] Captive portal detected, using 192.168.4.1 instead of:",l),"http://192.168.4.1")}const ms=Gs();async function me(l,e={}){try{const t=`${ms}${l}`;console.log(`[API] Fetching: ${t}`);const n={Accept:"application/json",...e.headers};e.body&&["POST","PUT","PATCH"].includes((e.method||"GET").toUpperCase())&&(n["Content-Type"]="application/json");const s=await fetch(t,{...e,headers:n});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=s.headers.get("content-type");return r&&r.includes("application/json")?await s.json():r&&r.includes("image/")?await s.blob():await s.text()}catch(t){throw console.error(`API Error [${l}]:`,t),t}}async function It(){try{const[l,e]=await Promise.all([me("/data"),me("/systemStatus").catch(()=>null)]);return{threshold:l.threshold||0,sensorReading:l.currentHourAverage||0,detectionState:l.triggered||!1,uptime:(e==null?void 0:e.uptime)||"",heap:(e==null?void 0:e.heapFree)||0,anomalies:l.anomalies||[],calibrationOffset:l.calibrationOffset||0,falseAlarmOffset:l.falseAlarmOffset||0,overrideThreshold:l.overrideThreshold||0}}catch{const e=await me("/data");return{threshold:e.threshold||0,sensorReading:e.currentHourAverage||0,detectionState:e.triggered||!1,uptime:"",heap:0,anomalies:e.anomalies||[],calibrationOffset:e.calibrationOffset||0,falseAlarmOffset:e.falseAlarmOffset||0,overrideThreshold:e.overrideThreshold||0}}}async function Js(){return me("/toggleLED")}async function Qs(){return me("/api/captures")}function Jt(l){return`${ms}/captures/${l}`}async function Ks(l){return me(`/captures/${l}`,{method:"DELETE"})}async function Ys(l){return me(`/setCalib?calib=${l}`)}async function Zs(l){return me(`/setCalib?overrideTh=${l}`)}async function Xs(){return me("/setCalib?overrideTh=0")}async function $s(){return me("/recalib")}async function xs(){return me("/falseAlarm")}async function en(){return Promise.resolve({startUS:1500,endUS:1100,disabled:!1})}async function tn(l){const e=new FormData;return e.append("start",l.startUS),e.append("end",l.endUS),l.disabled&&e.append("disableServo","on"),fetch("/setServoSettings",{method:"POST",body:e,headers:{Authorization:"Basic "+btoa("ops:changeme")}}).then(async t=>{if(!t.ok){const n=await t.text();throw new Error(n||`HTTP ${t.status}`)}return t.text()})}async function vs(){return me("/servo")}async function _s(){return await me("/testAlert")}async function ln(){return me("/api/ip-filters")}async function sn(l){return me("/api/ip-filters",{method:"POST",body:JSON.stringify(l)})}async function nn(){return me("/api/mqtt-config")}async function rn(l){return me("/api/mqtt-config",{method:"POST",body:JSON.stringify(l)})}async function on(){return me("/api/video-mode")}async function an(l){return me("/api/video-mode",{method:"POST",body:JSON.stringify(l)})}async function cn(){return me("/api/system-logs")}async function un(){return me("/api/previous-logs")}async function fn(){return me("/api/older-logs")}async function dn(){return me("/api/system-info")}async function pn(){return me("/reboot",{headers:{Authorization:"Basic "+btoa("ops:changeme")}})}async function mn(){return me("/sendHeartbeat")}async function bs(){return me("/reset")}async function vn(){return me("/api/device/claim-status")}async function _n(l=!1){const e=l?"/api/wifi/scan?rescan=1":"/api/wifi/scan";console.log(`[WIFI-SCAN] Calling ${e}...`);try{const t=await me(e);return console.log("[WIFI-SCAN] Got result:",JSON.stringify(t)),t}catch(t){throw console.error("[WIFI-SCAN] Error:",t),t}}async function bn(l){return me("/api/setup/connect",{method:"POST",body:JSON.stringify(l)})}async function hn(l){return me("/api/setup/standalone",{method:"POST",body:JSON.stringify(l)})}const{document:Qt}=cs;function Kt(l,e,t){const n=l.slice();return n[27]=e[t],n}function Yt(l){let e;return{c(){e=d("div"),e.textContent="TRAP TRIGGERED!",c(e,"class","trap-alert svelte-1kjtmub")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function gn(l){let e,t,n,s,r,o,a,u,f,p=l[2]?"On":"Off",m,v,_,g,y,h,L;return{c(){e=d("div"),t=d("img"),s=b(),r=d("div"),o=d("button"),o.textContent="Refresh",a=b(),u=d("button"),f=A("Live "),m=A(p),v=b(),_=d("button"),_.textContent="Toggle LED",g=b(),y=d("button"),y.textContent="Capture",lt(t.src,n=l[0])||c(t,"src",n),c(t,"alt","Camera Feed"),c(t,"class","svelte-1kjtmub"),z(t,"error",l[1]),z(t,"zoomed",l[3]),c(o,"class","btn svelte-1kjtmub"),c(u,"class","btn svelte-1kjtmub"),z(u,"active",l[2]),c(_,"class","btn svelte-1kjtmub"),c(y,"class","btn svelte-1kjtmub"),c(r,"class","camera-controls svelte-1kjtmub"),c(e,"class","camera-container svelte-1kjtmub"),z(e,"zoomed",l[3])},m(E,C){w(E,e,C),i(e,t),i(e,s),i(e,r),i(r,o),i(r,a),i(r,u),i(u,f),i(u,m),i(r,v),i(r,_),i(r,g),i(r,y),h||(L=[M(t,"error",l[14]),M(t,"click",l[15]),M(o,"click",l[7]),M(u,"click",l[8]),M(_,"click",l[9]),M(y,"click",l[13])],h=!0)},p(E,C){C&1&&!lt(t.src,n=E[0])&&c(t,"src",n),C&2&&z(t,"error",E[1]),C&8&&z(t,"zoomed",E[3]),C&4&&p!==(p=E[2]?"On":"Off")&&j(m,p),C&4&&z(u,"active",E[2]),C&8&&z(e,"zoomed",E[3])},d(E){E&&k(e),h=!1,_e(L)}}}function kn(l){let e,t,n,s,r,o,a,u=l[4].sensorReading+"",f,p,m,v,_,g=l[4].threshold+"",y;return{c(){e=d("div"),t=d("canvas"),n=b(),s=d("div"),r=d("div"),o=A("Current: "),a=d("strong"),f=A(u),p=b(),m=d("div"),v=A("Threshold: "),_=d("strong"),y=A(g),c(e,"class","chart-container svelte-1kjtmub"),c(a,"class","svelte-1kjtmub"),c(_,"class","svelte-1kjtmub"),c(s,"class","sensor-info svelte-1kjtmub")},m(h,L){w(h,e,L),i(e,t),l[16](t),w(h,n,L),w(h,s,L),i(s,r),i(r,o),i(r,a),i(a,f),i(s,p),i(s,m),i(m,v),i(m,_),i(_,y)},p(h,L){L&16&&u!==(u=h[4].sensorReading+"")&&j(f,u),L&16&&g!==(g=h[4].threshold+"")&&j(y,g)},d(h){h&&(k(e),k(n),k(s)),l[16](null)}}}function wn(l){let e,t,n,s,r,o=l[4].uptime+"",a,u,f,p,m,v,_=l[4].heap+"",g,y,h,L,E,C,S,I=l[5].message+"",P,q,T,F,R,O,U,B,N,V;return{c(){e=d("div"),t=d("div"),n=d("span"),n.textContent="Uptime:",s=b(),r=d("span"),a=A(o),u=b(),f=d("div"),p=d("span"),p.textContent="Free Heap:",m=b(),v=d("span"),g=A(_),y=A(" bytes"),h=b(),L=d("div"),E=d("span"),E.textContent="Claim Status:",C=b(),S=d("span"),P=A(I),q=b(),T=d("div"),F=d("button"),F.textContent="Reset Alarm",R=b(),O=d("button"),O.textContent="False Alarm",U=b(),B=d("button"),B.textContent="Send Heartbeat",c(t,"class","status-row svelte-1kjtmub"),c(f,"class","status-row svelte-1kjtmub"),c(S,"class","claimed-status"),z(S,"unclaimed",!l[5].claimed),c(L,"class","status-row svelte-1kjtmub"),c(e,"class","status-info svelte-1kjtmub"),c(F,"class","btn svelte-1kjtmub"),c(O,"class","btn svelte-1kjtmub"),c(B,"class","btn svelte-1kjtmub"),c(T,"class","action-buttons svelte-1kjtmub")},m(D,G){w(D,e,G),i(e,t),i(t,n),i(t,s),i(t,r),i(r,a),i(e,u),i(e,f),i(f,p),i(f,m),i(f,v),i(v,g),i(v,y),i(e,h),i(e,L),i(L,E),i(L,C),i(L,S),i(S,P),w(D,q,G),w(D,T,G),i(T,F),i(T,R),i(T,O),i(T,U),i(T,B),N||(V=[M(F,"click",l[10]),M(O,"click",l[11]),M(B,"click",l[12])],N=!0)},p(D,G){G&16&&o!==(o=D[4].uptime+"")&&j(a,o),G&16&&_!==(_=D[4].heap+"")&&j(g,_),G&32&&I!==(I=D[5].message+"")&&j(P,I),G&32&&z(S,"unclaimed",!D[5].claimed)},d(D){D&&(k(e),k(q),k(T)),N=!1,_e(V)}}}function Cn(l){let e;return{c(){e=d("p"),e.textContent="No anomalies detected",c(e,"class","no-data svelte-1kjtmub")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function yn(l){let e,t=Re(l[4].anomalies),n=[];for(let s=0;s<t.length;s+=1)n[s]=Zt(Kt(l,t,s));return{c(){e=d("div");for(let s=0;s<n.length;s+=1)n[s].c();c(e,"class","anomalies-list svelte-1kjtmub")},m(s,r){w(s,e,r);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(e,null)},p(s,r){if(r&16){t=Re(s[4].anomalies);let o;for(o=0;o<t.length;o+=1){const a=Kt(s,t,o);n[o]?n[o].p(a,r):(n[o]=Zt(a),n[o].c(),n[o].m(e,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=t.length}},d(s){s&&k(e),Ye(n,s)}}}function Zt(l){let e,t,n=l[27].timestamp+"",s,r,o,a=l[27].distance+"",u,f,p;return{c(){e=d("div"),t=d("span"),s=A(n),r=b(),o=d("span"),u=A(a),f=A(" cm"),p=b(),c(t,"class","timestamp svelte-1kjtmub"),c(o,"class","distance svelte-1kjtmub"),c(e,"class","anomaly-item svelte-1kjtmub")},m(m,v){w(m,e,v),i(e,t),i(t,s),i(e,r),i(e,o),i(o,u),i(o,f),i(e,p)},p(m,v){v&16&&n!==(n=m[27].timestamp+"")&&j(s,n),v&16&&a!==(a=m[27].distance+"")&&j(u,a)},d(m){m&&k(e)}}}function Sn(l){let e;function t(r,o){return r[4].anomalies&&r[4].anomalies.length>0?yn:Cn}let n=t(l),s=n(l);return{c(){s.c(),e=Le()},m(r,o){s.m(r,o),w(r,e,o)},p(r,o){n===(n=t(r))&&s?s.p(r,o):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},d(r){r&&k(e),s.d(r)}}}function Tn(l){let e,t,n,s,r=(l[5].deviceName||"MouseTrap")+"",o,a,u,f,p,m,v,_,g,y,h,L,E;Qt.title=e="Dashboard - "+(l[5].deviceName||"MouseTrap");let C=l[4].detectionState&&Yt();return p=new Te({props:{title:"Live Camera Feed",$$slots:{default:[gn]},$$scope:{ctx:l}}}),_=new Te({props:{title:"Sensor Range",$$slots:{default:[kn]},$$scope:{ctx:l}}}),y=new Te({props:{title:"System Status",$$slots:{default:[wn]},$$scope:{ctx:l}}}),L=new Te({props:{title:"Anomalous Events",$$slots:{default:[Sn]},$$scope:{ctx:l}}}),{c(){t=b(),n=d("div"),s=d("h1"),o=A(r),a=b(),C&&C.c(),u=b(),f=d("div"),de(p.$$.fragment),m=b(),v=d("div"),de(_.$$.fragment),g=b(),de(y.$$.fragment),h=b(),de(L.$$.fragment),c(s,"class","svelte-1kjtmub"),c(f,"class","camera-card-wrapper svelte-1kjtmub"),c(v,"class","grid svelte-1kjtmub"),c(n,"class","dashboard svelte-1kjtmub")},m(S,I){w(S,t,I),w(S,n,I),i(n,s),i(s,o),i(n,a),C&&C.m(n,null),i(n,u),i(n,f),ce(p,f,null),i(n,m),i(n,v),ce(_,v,null),i(v,g),ce(y,v,null),i(v,h),ce(L,v,null),E=!0},p(S,[I]){(!E||I&32)&&e!==(e="Dashboard - "+(S[5].deviceName||"MouseTrap"))&&(Qt.title=e),(!E||I&32)&&r!==(r=(S[5].deviceName||"MouseTrap")+"")&&j(o,r),S[4].detectionState?C||(C=Yt(),C.c(),C.m(n,u)):C&&(C.d(1),C=null);const P={};I&1073741839&&(P.$$scope={dirty:I,ctx:S}),p.$set(P);const q={};I&1073741904&&(q.$$scope={dirty:I,ctx:S}),_.$set(q);const T={};I&1073741872&&(T.$$scope={dirty:I,ctx:S}),y.$set(T);const F={};I&1073741840&&(F.$$scope={dirty:I,ctx:S}),L.$set(F)},i(S){E||(J(p.$$.fragment,S),J(_.$$.fragment,S),J(y.$$.fragment,S),J(L.$$.fragment,S),E=!0)},o(S){K(p.$$.fragment,S),K(_.$$.fragment,S),K(y.$$.fragment,S),K(L.$$.fragment,S),E=!1},d(S){S&&(k(t),k(n)),C&&C.d(),ue(p),ue(_),ue(y),ue(L)}}}const Xt=20;function Ln(l,e,t){let n="/auto.jpg",s=!1,r=!1,o=!1,a=null,u=null,f={threshold:0,sensorReading:0,detectionState:!1,uptime:"",heap:0,anomalies:[]},p={claimed:!1,message:"Checking...",deviceName:""},m=null,v=null,_=[];async function g(){try{t(0,n=`/auto.jpg?t=${Date.now()}`),t(1,s=!1)}catch(N){console.error("Camera refresh error:",N),t(1,s=!0)}}function y(){try{t(0,n=`/camera?t=${Date.now()}`),t(1,s=!1)}catch(N){console.error("Live frame error:",N),t(1,s=!0)}}function h(){t(2,r=!r),r?(y(),a=setInterval(()=>{y()},100)):(a&&(clearInterval(a),a=null),g())}async function L(){try{await Js()}catch(N){console.error("Toggle LED error:",N)}}async function E(){try{await bs(),await P()}catch(N){console.error("Reset alarm error:",N)}}async function C(){try{const N=await xs();N&&N.newThreshold!==void 0&&t(4,f.threshold=N.newThreshold,f),await P()}catch(N){console.error("False alarm error:",N)}}async function S(){try{await mn()}catch(N){console.error("Send heartbeat error:",N)}}async function I(){try{await _s(),await g()}catch(N){console.error("Capture screenshot error:",N)}}async function P(){try{const N=await It();t(4,f=N),_.push({time:new Date().toLocaleTimeString(),value:N.sensorReading}),_.length>Xt&&(_=_.slice(-Xt)),T()}catch(N){console.error("Status fetch error:",N)}}function q(){if(!v)return;const N=v.getContext("2d");m=new Chart(N,{type:"line",data:{labels:[],datasets:[{label:"Sensor Reading",data:[],borderColor:"#4CAF50",backgroundColor:"rgba(76, 175, 80, 0.1)",tension:.4},{label:"Threshold",data:[],borderColor:"#f44336",backgroundColor:"transparent",borderDash:[5,5],pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{color:"#ddd"},grid:{color:"#333"}},x:{ticks:{color:"#ddd"},grid:{color:"#333"}}},plugins:{legend:{labels:{color:"#ddd"}}}}})}function T(){m&&(m.data.labels=_.map(N=>N.time),m.data.datasets[0].data=_.map(N=>N.value),m.data.datasets[1].data=_.map(()=>f.threshold),m.update())}function F(){t(1,s=!0),setTimeout(()=>{r?y():g()},1e3)}async function R(){if(o)try{(document.fullscreenElement||document.webkitFullscreenElement)&&(document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen&&await document.webkitExitFullscreen()),t(3,o=!1)}catch(N){console.error("Error exiting fullscreen:",N),t(3,o=!1)}else try{const N=document.documentElement;N.requestFullscreen?await N.requestFullscreen():N.webkitRequestFullscreen&&await N.webkitRequestFullscreen(),t(3,o=!0)}catch(N){console.error("Error entering fullscreen:",N),t(3,o=!0)}}function O(){!document.fullscreenElement&&!document.webkitFullscreenElement&&t(3,o=!1)}async function U(){try{const N=await vn();t(5,p={claimed:N.claimed||!1,deviceName:N.deviceName||"",message:N.claimed?`Claimed to ${N.deviceName||"tenant"}`:N.message||"Device not claimed"})}catch(N){console.error("Claim status fetch error:",N),t(5,p={claimed:!1,deviceName:"",message:"Error loading claim status"})}}ze(()=>{if(typeof Chart<"u")q();else{const N=document.createElement("script");N.src="https://cdn.jsdelivr.net/npm/chart.js",N.onload=()=>q(),document.head.appendChild(N)}P(),U(),u=setInterval(P,5e3),document.addEventListener("fullscreenchange",O),document.addEventListener("webkitfullscreenchange",O)}),ot(()=>{a&&clearInterval(a),u&&clearInterval(u),m&&m.destroy(),document.removeEventListener("fullscreenchange",O),document.removeEventListener("webkitfullscreenchange",O)});function B(N){et[N?"unshift":"push"](()=>{v=N,t(6,v)})}return[n,s,r,o,f,p,v,g,h,L,E,C,S,I,F,R,B]}class $t extends Ae{constructor(e){super(),Ee(this,e,Ln,Tn,Se,{})}}function En(l){let e,t;return{c(){e=d("div"),t=d("div"),c(t,"class","spinner svelte-1cznhkh"),Ge(t,"width",l[0]+"px"),Ge(t,"height",l[0]+"px"),Ge(t,"border-color",l[1]+" transparent transparent transparent"),c(e,"class","spinner-container svelte-1cznhkh")},m(n,s){w(n,e,s),i(e,t)},p(n,[s]){s&1&&Ge(t,"width",n[0]+"px"),s&1&&Ge(t,"height",n[0]+"px"),s&2&&Ge(t,"border-color",n[1]+" transparent transparent transparent")},i:Q,o:Q,d(n){n&&k(e)}}}function An(l,e,t){let{size:n=40}=e,{color:s="#9fdcff"}=e;return l.$$set=r=>{"size"in r&&t(0,n=r.size),"color"in r&&t(1,s=r.color)},[n,s]}class Ve extends Ae{constructor(e){super(),Ee(this,e,An,En,Se,{size:0,color:1})}}function xt(l){let e,t,n,s,r=l[0].message+"",o,a,u,f,p,m,v=l[0].details&&el(l);return{c(){e=d("div"),t=d("div"),n=d("strong"),n.textContent="âš ï¸ Error:",s=b(),o=A(r),a=b(),v&&v.c(),u=b(),f=d("button"),f.textContent="âœ•",c(t,"class","error-content svelte-1gxsq9q"),c(f,"class","dismiss-btn svelte-1gxsq9q"),c(e,"class","error-banner svelte-1gxsq9q")},m(_,g){w(_,e,g),i(e,t),i(t,n),i(t,s),i(t,o),i(t,a),v&&v.m(t,null),i(e,u),i(e,f),p||(m=M(f,"click",l[1]),p=!0)},p(_,g){g&1&&r!==(r=_[0].message+"")&&j(o,r),_[0].details?v?v.p(_,g):(v=el(_),v.c(),v.m(t,null)):v&&(v.d(1),v=null)},d(_){_&&k(e),v&&v.d(),p=!1,m()}}}function el(l){let e,t=JSON.stringify(l[0].details)+"",n;return{c(){e=d("div"),n=A(t),c(e,"class","error-details svelte-1gxsq9q")},m(s,r){w(s,e,r),i(e,n)},p(s,r){r&1&&t!==(t=JSON.stringify(s[0].details)+"")&&j(n,t)},d(s){s&&k(e)}}}function qn(l){let e,t=l[0]&&xt(l);return{c(){t&&t.c(),e=Le()},m(n,s){t&&t.m(n,s),w(n,e,s)},p(n,[s]){n[0]?t?t.p(n,s):(t=xt(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Q,o:Q,d(n){n&&k(e),t&&t.d(n)}}}function Fn(l,e,t){let{error:n=null}=e;function s(){t(0,n=null)}return l.$$set=r=>{"error"in r&&t(0,n=r.error)},[n,s]}class hs extends Ae{constructor(e){super(),Ee(this,e,Fn,qn,Se,{error:0})}}function tl(l,e,t){const n=l.slice();return n[25]=e[t],n[27]=t,n}function ll(l){let e,t;return e=new hs({props:{message:l[2]}}),{c(){de(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p(n,s){const r={};s&4&&(r.message=n[2]),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function On(l){let e,t,n=Re(l[0]),s=[];for(let o=0;o<n.length;o+=1)s[o]=sl(tl(l,n,o));const r=o=>K(s[o],1,1,()=>{s[o]=null});return{c(){e=d("div");for(let o=0;o<s.length;o+=1)s[o].c();c(e,"class","image-grid svelte-1chdln3")},m(o,a){w(o,e,a);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);t=!0},p(o,a){if(a&769){n=Re(o[0]);let u;for(u=0;u<n.length;u+=1){const f=tl(o,n,u);s[u]?(s[u].p(f,a),J(s[u],1)):(s[u]=sl(f),s[u].c(),J(s[u],1),s[u].m(e,null))}for(we(),u=n.length;u<s.length;u+=1)r(u);Ce()}},i(o){if(!t){for(let a=0;a<n.length;a+=1)J(s[a]);t=!0}},o(o){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)K(s[a]);t=!1},d(o){o&&k(e),Ye(s,o)}}}function In(l){let e,t;return e=new Te({props:{$$slots:{default:[jn]},$$scope:{ctx:l}}}),{c(){de(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p(n,s){const r={};s&268435456&&(r.$$scope={dirty:s,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Pn(l){let e,t,n;return t=new Ve({}),{c(){e=d("div"),de(t.$$.fragment),c(e,"class","loading-container svelte-1chdln3")},m(s,r){w(s,e,r),ce(t,e,null),n=!0},p:Q,i(s){n||(J(t.$$.fragment,s),n=!0)},o(s){K(t.$$.fragment,s),n=!1},d(s){s&&k(e),ue(t)}}}function Nn(l){return{c:Q,m:Q,p:Q,i:Q,o:Q,d:Q}}function Rn(l){let e;function t(r,o){return r[24]?Un:Mn}let n=t(l),s=n(l);return{c(){s.c(),e=Le()},m(r,o){s.m(r,o),w(r,e,o)},p(r,o){n===(n=t(r))&&s?s.p(r,o):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},i:Q,o:Q,d(r){r&&k(e),s.d(r)}}}function Mn(l){let e;return{c(){e=d("div"),e.textContent="Failed to load",c(e,"class","thumbnail-error svelte-1chdln3")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function Un(l){let e,t,n;return{c(){e=d("img"),lt(e.src,t=l[24])||c(e,"src",t),c(e,"alt",n=l[25].name),c(e,"class","thumbnail-image svelte-1chdln3")},m(s,r){w(s,e,r)},p(s,r){r&1&&!lt(e.src,t=s[24])&&c(e,"src",t),r&1&&n!==(n=s[25].name)&&c(e,"alt",n)},d(s){s&&k(e)}}}function Dn(l){let e,t,n;return t=new Ve({}),{c(){e=d("div"),de(t.$$.fragment),c(e,"class","thumbnail-loading svelte-1chdln3")},m(s,r){w(s,e,r),ce(t,e,null),n=!0},p:Q,i(s){n||(J(t.$$.fragment,s),n=!0)},o(s){K(t.$$.fragment,s),n=!1},d(s){s&&k(e),ue(t)}}}function sl(l){let e,t,n,s,r,o=l[25].name+"",a,u,f,p=il(l[25].size)+"",m,v,_,g,y,h={ctx:l,current:null,token:null,hasCatch:!1,pending:Dn,then:Rn,catch:Nn,value:24,blocks:[,,,]};mt(t=l[8](l[25].name),h);function L(){return l[19](l[25],l[27])}return{c(){e=d("div"),h.block.c(),n=b(),s=d("div"),r=d("div"),a=A(o),u=b(),f=d("div"),m=A(p),v=b(),c(r,"class","thumbnail-filename svelte-1chdln3"),c(f,"class","thumbnail-meta svelte-1chdln3"),c(s,"class","thumbnail-info svelte-1chdln3"),c(e,"class","thumbnail-card svelte-1chdln3")},m(E,C){w(E,e,C),h.block.m(e,h.anchor=null),h.mount=()=>e,h.anchor=n,i(e,n),i(e,s),i(s,r),i(r,a),i(s,u),i(s,f),i(f,m),i(e,v),_=!0,g||(y=M(e,"click",L),g=!0)},p(E,C){l=E,h.ctx=l,C&1&&t!==(t=l[8](l[25].name))&&mt(t,h)||fs(h,l,C),(!_||C&1)&&o!==(o=l[25].name+"")&&j(a,o),(!_||C&1)&&p!==(p=il(l[25].size)+"")&&j(m,p)},i(E){_||(J(h.block),_=!0)},o(E){for(let C=0;C<3;C+=1){const S=h.blocks[C];K(S)}_=!1},d(E){E&&k(e),h.block.d(),h.token=null,h=null,g=!1,y()}}}function jn(l){let e;return{c(){e=d("div"),e.innerHTML='<p class="svelte-1chdln3">No captures yet</p> <p class="empty-hint svelte-1chdln3">Captured images will appear here</p>',c(e,"class","empty-state svelte-1chdln3")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function nl(l){let e,t,n,s,r,o=l[3].name+"",a,u,f,p=ol(l[3].timestamp)+"",m,v,_,g,y,h,L,E,C,S,I,P,q,T,F=l[4]+1+"",R,O,U=l[0].length+"",B,N,V,D,G,Y,$,ie,ve,ne,re,pe,ee,H={ctx:l,current:null,token:null,hasCatch:!1,pending:Wn,then:zn,catch:Hn,value:24,blocks:[,,,]};return mt(h=l[8](l[3].name),H),{c(){e=d("div"),t=d("div"),n=d("div"),s=d("div"),r=d("div"),a=A(o),u=b(),f=d("div"),m=A(p),v=b(),_=d("button"),_.textContent="Ã—",g=b(),y=d("div"),H.block.c(),L=b(),E=d("div"),C=d("div"),S=d("button"),I=A("â† Previous"),q=b(),T=d("span"),R=A(F),O=A(" / "),B=A(U),N=b(),V=d("button"),D=A("Next â†’"),Y=b(),$=d("div"),ie=d("button"),ie.textContent="Download",ve=b(),ne=d("button"),ne.textContent="Delete",c(r,"class","modal-filename svelte-1chdln3"),c(f,"class","modal-timestamp svelte-1chdln3"),c(s,"class","modal-title svelte-1chdln3"),c(_,"class","modal-close svelte-1chdln3"),c(n,"class","modal-header svelte-1chdln3"),c(y,"class","modal-body svelte-1chdln3"),c(S,"class","nav-btn svelte-1chdln3"),S.disabled=P=l[4]===0,c(T,"class","image-counter svelte-1chdln3"),c(V,"class","nav-btn svelte-1chdln3"),V.disabled=G=l[4]===l[0].length-1,c(C,"class","modal-nav svelte-1chdln3"),c(ie,"class","action-btn svelte-1chdln3"),c(ne,"class","action-btn delete-btn svelte-1chdln3"),c($,"class","modal-actions svelte-1chdln3"),c(E,"class","modal-footer svelte-1chdln3"),c(t,"class","modal-content svelte-1chdln3"),c(e,"class","modal-backdrop svelte-1chdln3")},m(Z,x){w(Z,e,x),i(e,t),i(t,n),i(n,s),i(s,r),i(r,a),i(s,u),i(s,f),i(f,m),i(n,v),i(n,_),i(t,g),i(t,y),H.block.m(y,H.anchor=null),H.mount=()=>y,H.anchor=null,i(t,L),i(t,E),i(E,C),i(C,S),i(S,I),i(C,q),i(C,T),i(T,R),i(T,O),i(T,B),i(C,N),i(C,V),i(V,D),i(E,Y),i(E,$),i($,ie),i($,ve),i($,ne),re=!0,pe||(ee=[M(_,"click",l[10]),M(S,"click",l[11]),M(V,"click",l[12]),M(ie,"click",l[20]),M(ne,"click",l[21]),M(t,"click",us(l[18])),M(e,"click",l[10])],pe=!0)},p(Z,x){l=Z,(!re||x&8)&&o!==(o=l[3].name+"")&&j(a,o),(!re||x&8)&&p!==(p=ol(l[3].timestamp)+"")&&j(m,p),H.ctx=l,x&8&&h!==(h=l[8](l[3].name))&&mt(h,H)||fs(H,l,x),(!re||x&16&&P!==(P=l[4]===0))&&(S.disabled=P),(!re||x&16)&&F!==(F=l[4]+1+"")&&j(R,F),(!re||x&1)&&U!==(U=l[0].length+"")&&j(B,U),(!re||x&17&&G!==(G=l[4]===l[0].length-1))&&(V.disabled=G)},i(Z){re||(J(H.block),re=!0)},o(Z){for(let x=0;x<3;x+=1){const ae=H.blocks[x];K(ae)}re=!1},d(Z){Z&&k(e),H.block.d(),H.token=null,H=null,pe=!1,_e(ee)}}}function Hn(l){return{c:Q,m:Q,p:Q,i:Q,o:Q,d:Q}}function zn(l){let e;function t(r,o){return r[24]?Bn:Vn}let n=t(l),s=n(l);return{c(){s.c(),e=Le()},m(r,o){s.m(r,o),w(r,e,o)},p(r,o){n===(n=t(r))&&s?s.p(r,o):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},i:Q,o:Q,d(r){r&&k(e),s.d(r)}}}function Vn(l){let e;return{c(){e=d("div"),e.textContent="Failed to load image",c(e,"class","modal-error svelte-1chdln3")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function Bn(l){let e,t,n;return{c(){e=d("img"),lt(e.src,t=l[24])||c(e,"src",t),c(e,"alt",n=l[3].name),c(e,"class","modal-image svelte-1chdln3")},m(s,r){w(s,e,r)},p(s,r){r&8&&!lt(e.src,t=s[24])&&c(e,"src",t),r&8&&n!==(n=s[3].name)&&c(e,"alt",n)},d(s){s&&k(e)}}}function Wn(l){let e,t;return e=new Ve({}),{c(){de(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p:Q,i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function rl(l){let e,t,n,s,r,o,a,u,f,p,m,v,_,g,y;return{c(){e=d("div"),t=d("div"),n=d("h3"),n.textContent="Confirm Delete",s=b(),r=d("p"),o=A("Are you sure you want to delete "),a=A(l[6]),u=A("?"),f=b(),p=d("div"),m=d("button"),m.textContent="Cancel",v=b(),_=d("button"),_.textContent="Delete",c(n,"class","svelte-1chdln3"),c(r,"class","svelte-1chdln3"),c(m,"class","confirm-btn cancel-btn svelte-1chdln3"),c(_,"class","confirm-btn delete-confirm-btn svelte-1chdln3"),c(p,"class","confirm-actions svelte-1chdln3"),c(t,"class","confirm-dialog svelte-1chdln3"),c(e,"class","confirm-backdrop svelte-1chdln3")},m(h,L){w(h,e,L),i(e,t),i(t,n),i(t,s),i(t,r),i(r,o),i(r,a),i(r,u),i(t,f),i(t,p),i(p,m),i(p,v),i(p,_),g||(y=[M(m,"click",l[16]),M(_,"click",l[15]),M(t,"click",us(l[17])),M(e,"click",l[16])],g=!0)},p(h,L){L&64&&j(a,h[6])},d(h){h&&k(e),g=!1,_e(y)}}}function Gn(l){let e,t,n,s,r,o=l[1]?"Loading...":"Refresh",a,u,f,p,m,v,_,g,y,h,L,E=l[2]&&ll(l);const C=[Pn,In,On],S=[];function I(T,F){return T[1]?0:T[0].length===0?1:2}p=I(l),m=S[p]=C[p](l);let P=l[3]&&nl(l),q=l[5]&&rl(l);return{c(){e=d("div"),t=d("div"),n=d("h1"),n.textContent="Image Gallery",s=b(),r=d("button"),a=A(o),u=b(),E&&E.c(),f=b(),m.c(),v=b(),P&&P.c(),_=b(),q&&q.c(),g=Le(),c(n,"class","svelte-1chdln3"),c(r,"class","refresh-btn svelte-1chdln3"),r.disabled=l[1],c(t,"class","header svelte-1chdln3"),c(e,"class","gallery-container svelte-1chdln3")},m(T,F){w(T,e,F),i(e,t),i(t,n),i(t,s),i(t,r),i(r,a),i(e,u),E&&E.m(e,null),i(e,f),S[p].m(e,null),w(T,v,F),P&&P.m(T,F),w(T,_,F),q&&q.m(T,F),w(T,g,F),y=!0,h||(L=M(r,"click",l[7]),h=!0)},p(T,[F]){(!y||F&2)&&o!==(o=T[1]?"Loading...":"Refresh")&&j(a,o),(!y||F&2)&&(r.disabled=T[1]),T[2]?E?(E.p(T,F),F&4&&J(E,1)):(E=ll(T),E.c(),J(E,1),E.m(e,f)):E&&(we(),K(E,1,1,()=>{E=null}),Ce());let R=p;p=I(T),p===R?S[p].p(T,F):(we(),K(S[R],1,1,()=>{S[R]=null}),Ce(),m=S[p],m?m.p(T,F):(m=S[p]=C[p](T),m.c()),J(m,1),m.m(e,null)),T[3]?P?(P.p(T,F),F&8&&J(P,1)):(P=nl(T),P.c(),J(P,1),P.m(_.parentNode,_)):P&&(we(),K(P,1,1,()=>{P=null}),Ce()),T[5]?q?q.p(T,F):(q=rl(T),q.c(),q.m(g.parentNode,g)):q&&(q.d(1),q=null)},i(T){y||(J(E),J(m),J(P),y=!0)},o(T){K(E),K(m),K(P),y=!1},d(T){T&&(k(e),k(v),k(_),k(g)),E&&E.d(),S[p].d(),P&&P.d(T),q&&q.d(T),h=!1,L()}}}function ol(l){return new Date(l).toLocaleString()}function il(l){return l<1024?l+" B":l<1024*1024?(l/1024).toFixed(1)+" KB":(l/(1024*1024)).toFixed(1)+" MB"}function Jn(l,e,t){let n=[],s=!0,r=null,o=null,a=-1,u={},f=!1,p=null;ze(()=>{m(),document.addEventListener("keydown",y)}),ot(()=>{document.removeEventListener("keydown",y),Object.values(u).forEach(O=>URL.revokeObjectURL(O))});async function m(){t(1,s=!0),t(2,r=null);try{const O=await Qs();t(0,n=O.files||[]),n.sort((U,B)=>B.name.localeCompare(U.name))}catch(O){t(2,r=O.message||"Failed to load gallery")}finally{t(1,s=!1)}}async function v(O){if(u[O])return u[O];try{const U=Jt(O);return u[O]=U,U}catch(U){return console.error("Failed to load image:",U),null}}async function _(O,U){t(3,o=O),t(4,a=U),await v(O.name)}function g(){t(3,o=null),t(4,a=-1),t(5,f=!1),t(6,p=null)}function y(O){o&&(O.key==="Escape"?g():O.key==="ArrowLeft"?h():O.key==="ArrowRight"&&L())}function h(){a>0&&(t(4,a--,a),t(3,o=n[a]),v(o.name))}function L(){a<n.length-1&&(t(4,a++,a),t(3,o=n[a]),v(o.name))}async function E(O){try{const U=Jt(O),N=await(await fetch(U)).blob(),V=URL.createObjectURL(N),D=document.createElement("a");D.href=V,D.download=O,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(V)}catch(U){console.error("Failed to download image:",U),alert("Failed to download image")}}function C(O){t(6,p=O),t(5,f=!0)}async function S(){if(p)try{await Ks(p),u[p]&&(URL.revokeObjectURL(u[p]),delete u[p]),t(0,n=n.filter(O=>O.name!==p)),o&&o.name===p&&g(),t(5,f=!1),t(6,p=null)}catch(O){console.error("Failed to delete image:",O),alert("Failed to delete image")}}function I(){t(5,f=!1),t(6,p=null)}function P(O){Dt.call(this,l,O)}function q(O){Dt.call(this,l,O)}return[n,s,r,o,a,f,p,m,v,_,g,h,L,E,C,S,I,P,q,(O,U)=>_(O,U),()=>E(o.name),()=>C(o.name)]}class Qn extends Ae{constructor(e){super(),Ee(this,e,Jn,Gn,Se,{})}}function al(l){let e,t;return{c(){e=d("div"),t=A(l[5]),c(e,"class","message svelte-1iken05"),z(e,"success",l[6]==="success"),z(e,"error",l[6]==="error")},m(n,s){w(n,e,s),i(e,t)},p(n,s){s&32&&j(t,n[5]),s&64&&z(e,"success",n[6]==="success"),s&64&&z(e,"error",n[6]==="error")},d(n){n&&k(e)}}}function Kn(l){let e,t,n,s,r,o,a,u,f,p,m,v,_,g,y,h,L,E,C,S,I,P,q,T,F,R,O,U,B,N,V,D,G,Y,$,ie,ve,ne,re,pe,ee;return{c(){e=d("div"),t=d("div"),n=d("label"),n.textContent="False-Alarm Offset:",s=b(),r=d("span"),o=A(l[0]),a=A(" mm"),u=b(),f=d("div"),p=d("label"),p.textContent="Current Threshold:",m=b(),v=d("span"),_=A(l[1]),g=A(" mm"),y=b(),h=d("div"),L=d("label"),L.textContent="Calibration Offset:",E=b(),C=d("div"),S=d("input"),I=b(),P=d("span"),q=A(l[2]),T=A(" mm"),F=b(),R=d("div"),O=d("label"),O.textContent="Override Threshold (mm):",U=b(),B=d("input"),N=b(),V=d("div"),D=d("button"),G=A("ðŸ’¾ Save"),Y=b(),$=d("button"),ie=A("ðŸ—‘ï¸ Clear Override"),ve=b(),ne=d("button"),re=A("ðŸ”„ Recalibrate"),c(n,"class","svelte-1iken05"),c(r,"class","value svelte-1iken05"),c(t,"class","info-row svelte-1iken05"),c(p,"class","svelte-1iken05"),c(v,"class","value svelte-1iken05"),c(f,"class","info-row svelte-1iken05"),c(L,"for","calib-offset"),c(L,"class","svelte-1iken05"),c(S,"id","calib-offset"),c(S,"type","range"),c(S,"min","-100"),c(S,"max","100"),c(S,"step","1"),c(S,"class","slider svelte-1iken05"),S.disabled=l[4],c(P,"class","slider-value svelte-1iken05"),c(C,"class","slider-row svelte-1iken05"),c(h,"class","control-group svelte-1iken05"),c(O,"for","override-th"),c(O,"class","svelte-1iken05"),c(B,"id","override-th"),c(B,"type","number"),c(B,"placeholder",""),c(B,"min","0"),c(B,"class","input-field svelte-1iken05"),B.disabled=l[4],c(R,"class","control-group svelte-1iken05"),c(D,"class","btn btn-save svelte-1iken05"),D.disabled=l[4],c($,"class","btn btn-clear svelte-1iken05"),$.disabled=l[4],c(ne,"class","btn btn-recal svelte-1iken05"),ne.disabled=l[4],c(V,"class","button-group svelte-1iken05"),c(e,"class","content svelte-1iken05")},m(H,Z){w(H,e,Z),i(e,t),i(t,n),i(t,s),i(t,r),i(r,o),i(r,a),i(e,u),i(e,f),i(f,p),i(f,m),i(f,v),i(v,_),i(v,g),i(e,y),i(e,h),i(h,L),i(h,E),i(h,C),i(C,S),le(S,l[2]),i(C,I),i(C,P),i(P,q),i(P,T),i(e,F),i(e,R),i(R,O),i(R,U),i(R,B),le(B,l[3]),i(e,N),i(e,V),i(V,D),i(D,G),i(V,Y),i(V,$),i($,ie),i(V,ve),i(V,ne),i(ne,re),pe||(ee=[M(S,"change",l[10]),M(S,"input",l[10]),M(B,"input",l[11]),M(D,"click",l[7]),M($,"click",l[8]),M(ne,"click",l[9])],pe=!0)},p(H,Z){Z&1&&j(o,H[0]),Z&2&&j(_,H[1]),Z&16&&(S.disabled=H[4]),Z&4&&le(S,H[2]),Z&4&&j(q,H[2]),Z&16&&(B.disabled=H[4]),Z&8&&De(B.value)!==H[3]&&le(B,H[3]),Z&16&&(D.disabled=H[4]),Z&16&&($.disabled=H[4]),Z&16&&(ne.disabled=H[4])},d(H){H&&k(e),pe=!1,_e(ee)}}}function Yn(l){let e,t,n,s,r,o,a=l[5]&&al(l);return r=new Te({props:{title:"",$$slots:{default:[Kn]},$$scope:{ctx:l}}}),{c(){e=d("div"),t=d("h1"),t.textContent="Calibration Settings",n=b(),a&&a.c(),s=b(),de(r.$$.fragment),c(t,"class","svelte-1iken05"),c(e,"class","page svelte-1iken05")},m(u,f){w(u,e,f),i(e,t),i(e,n),a&&a.m(e,null),i(e,s),ce(r,e,null),o=!0},p(u,[f]){u[5]?a?a.p(u,f):(a=al(u),a.c(),a.m(e,s)):a&&(a.d(1),a=null);const p={};f&16415&&(p.$$scope={dirty:f,ctx:u}),r.$set(p)},i(u){o||(J(r.$$.fragment,u),o=!0)},o(u){K(r.$$.fragment,u),o=!1},d(u){u&&k(e),a&&a.d(),ue(r)}}}function Zn(l,e,t){let n=0,s=0,r=0,o="",a=!1,u="",f="";ze(()=>{p();const h=localStorage.getItem("calibrationOffset");h!==null&&t(2,r=parseInt(h))});async function p(){try{const h=await It();t(1,s=h.threshold||0),t(0,n=h.falseAlarmOffset||0),h.calibrationOffset!==void 0&&(t(2,r=h.calibrationOffset),localStorage.setItem("calibrationOffset",r.toString())),h.overrideThreshold!==void 0&&h.overrideThreshold>0?t(3,o=h.overrideThreshold.toString()):t(3,o="")}catch(h){console.warn("Failed to load status:",h)}}async function m(){t(4,a=!0),t(5,u="");try{await Ys(r),localStorage.setItem("calibrationOffset",r.toString()),o&&parseInt(o)>0?(await Zs(parseInt(o)),t(5,u="Calibration offset and override threshold saved")):t(5,u="Calibration offset saved"),t(6,f="success"),setTimeout(()=>{t(5,u=""),p()},2e3)}catch(h){t(5,u=`Failed to save: ${h.message||h}`),t(6,f="error"),setTimeout(()=>{t(5,u="")},3e3)}finally{t(4,a=!1)}}async function v(){t(4,a=!0),t(5,u="");try{await Xs(),t(3,o=""),t(5,u="Override cleared"),t(6,f="success"),setTimeout(()=>{t(5,u=""),p()},2e3)}catch(h){t(5,u=`Failed to clear override: ${h.message||h}`),t(6,f="error"),setTimeout(()=>{t(5,u="")},3e3)}finally{t(4,a=!1)}}async function _(){t(4,a=!0),t(5,u="");try{await $s(),t(5,u="Re-calibration started"),t(6,f="success"),setTimeout(()=>{t(5,u=""),p()},2e3)}catch(h){t(5,u=`Failed to recalibrate: ${h.message||h}`),t(6,f="error"),setTimeout(()=>{t(5,u="")},3e3)}finally{t(4,a=!1)}}function g(){r=De(this.value),t(2,r)}function y(){o=De(this.value),t(3,o)}return[n,s,r,o,a,u,f,m,v,_,g,y]}class Xn extends Ae{constructor(e){super(),Ee(this,e,Zn,Yn,Se,{})}}function cl(l){let e,t;return{c(){e=d("div"),t=A(l[6]),c(e,"class","message svelte-1lrtwwl"),z(e,"success",l[7]==="success"),z(e,"error",l[7]==="error")},m(n,s){w(n,e,s),i(e,t)},p(n,s){s&64&&j(t,n[6]),s&128&&z(e,"success",n[7]==="success"),s&128&&z(e,"error",n[7]==="error")},d(n){n&&k(e)}}}function $n(l){let e,t,n,s,r,o,a,u,f,p,m,v,_,g,y,h,L,E,C,S,I,P,q,T,F,R,O,U,B,N,V,D,G,Y,$=l[4]?"Saving...":"Save",ie,ve,ne,re=l[5]?"Testing...":"Test Servo",pe,ee,H,Z;return{c(){e=d("div"),t=d("div"),n=d("label"),n.textContent="Start Position (Âµs):",s=b(),r=d("input"),o=b(),a=d("button"),u=A("Set"),f=b(),p=d("div"),m=d("label"),m.textContent="End Position (Âµs):",v=b(),_=d("input"),g=b(),y=d("button"),h=A("Set"),L=b(),E=d("div"),C=d("input"),S=b(),I=d("label"),I.textContent="Disable Servo",P=b(),q=d("div"),T=d("h3"),T.textContent="Live Control",F=b(),R=d("div"),O=d("input"),U=b(),B=d("div"),N=A(l[3]),V=A(" Âµs"),D=b(),G=d("div"),Y=d("button"),ie=A($),ve=b(),ne=d("button"),pe=A(re),c(n,"for","start-pos"),c(n,"class","svelte-1lrtwwl"),c(r,"id","start-pos"),c(r,"type","number"),c(r,"min","500"),c(r,"max","2500"),c(r,"step","10"),c(r,"class","svelte-1lrtwwl"),c(a,"class","btn btn-set svelte-1lrtwwl"),a.disabled=l[2],c(t,"class","position-row svelte-1lrtwwl"),c(m,"for","end-pos"),c(m,"class","svelte-1lrtwwl"),c(_,"id","end-pos"),c(_,"type","number"),c(_,"min","500"),c(_,"max","2500"),c(_,"step","10"),c(_,"class","svelte-1lrtwwl"),c(y,"class","btn btn-set svelte-1lrtwwl"),y.disabled=l[2],c(p,"class","position-row svelte-1lrtwwl"),c(C,"id","disable-servo"),c(C,"type","checkbox"),c(C,"class","svelte-1lrtwwl"),c(I,"for","disable-servo"),c(I,"class","svelte-1lrtwwl"),c(E,"class","checkbox-row svelte-1lrtwwl"),c(T,"class","svelte-1lrtwwl"),c(O,"type","range"),c(O,"min","500"),c(O,"max","2500"),c(O,"step","10"),O.disabled=l[2],c(O,"class","position-slider svelte-1lrtwwl"),c(B,"class","slider-value svelte-1lrtwwl"),c(R,"class","slider-container svelte-1lrtwwl"),c(q,"class","live-control svelte-1lrtwwl"),c(Y,"class","btn btn-save svelte-1lrtwwl"),Y.disabled=l[4],c(ne,"class","btn btn-test svelte-1lrtwwl"),ne.disabled=ee=l[5]||l[2],c(G,"class","button-group svelte-1lrtwwl"),c(e,"class","settings-content svelte-1lrtwwl")},m(x,ae){w(x,e,ae),i(e,t),i(t,n),i(t,s),i(t,r),le(r,l[0]),i(t,o),i(t,a),i(a,u),i(e,f),i(e,p),i(p,m),i(p,v),i(p,_),le(_,l[1]),i(p,g),i(p,y),i(y,h),i(e,L),i(e,E),i(E,C),C.checked=l[2],i(E,S),i(E,I),i(e,P),i(e,q),i(q,T),i(q,F),i(q,R),i(R,O),le(O,l[3]),i(R,U),i(R,B),i(B,N),i(B,V),i(e,D),i(e,G),i(G,Y),i(Y,ie),i(G,ve),i(G,ne),i(ne,pe),H||(Z=[M(r,"input",l[12]),M(a,"click",l[13]),M(_,"input",l[14]),M(y,"click",l[15]),M(C,"change",l[16]),M(O,"change",l[17]),M(O,"input",l[17]),M(O,"input",l[11]),M(Y,"click",l[9]),M(ne,"click",l[10])],H=!0)},p(x,ae){ae&1&&De(r.value)!==x[0]&&le(r,x[0]),ae&4&&(a.disabled=x[2]),ae&2&&De(_.value)!==x[1]&&le(_,x[1]),ae&4&&(y.disabled=x[2]),ae&4&&(C.checked=x[2]),ae&4&&(O.disabled=x[2]),ae&8&&le(O,x[3]),ae&8&&j(N,x[3]),ae&16&&$!==($=x[4]?"Saving...":"Save")&&j(ie,$),ae&16&&(Y.disabled=x[4]),ae&32&&re!==(re=x[5]?"Testing...":"Test Servo")&&j(pe,re),ae&36&&ee!==(ee=x[5]||x[2])&&(ne.disabled=ee)},d(x){x&&k(e),H=!1,_e(Z)}}}function xn(l){let e,t,n,s,r,o,a=l[6]&&cl(l);return r=new Te({props:{title:"",$$slots:{default:[$n]},$$scope:{ctx:l}}}),{c(){e=d("div"),t=d("h1"),t.textContent="Servo Settings",n=b(),a&&a.c(),s=b(),de(r.$$.fragment),c(t,"class","svelte-1lrtwwl"),c(e,"class","page svelte-1lrtwwl")},m(u,f){w(u,e,f),i(e,t),i(e,n),a&&a.m(e,null),i(e,s),ce(r,e,null),o=!0},p(u,[f]){u[6]?a?a.p(u,f):(a=cl(u),a.c(),a.m(e,s)):a&&(a.d(1),a=null);const p={};f&524351&&(p.$$scope={dirty:f,ctx:u}),r.$set(p)},i(u){o||(J(r.$$.fragment,u),o=!0)},o(u){K(r.$$.fragment,u),o=!1},d(u){u&&k(e),a&&a.d(),ue(r)}}}function er(l,e,t){let n=1500,s=1100,r=!1,o=1500,a=!1,u=!1,f="",p="";async function m(){try{const P=await en();P.startUS!==void 0&&t(0,n=P.startUS),P.endUS!==void 0&&t(1,s=P.endUS);const q=localStorage.getItem("disableServo");q!==null?t(2,r=q==="true"):P.disabled!==void 0&&t(2,r=P.disabled),t(3,o=n)}catch(P){console.warn("Failed to load servo settings:",P)}}async function v(P,q){if(r){t(6,f="Servo is disabled"),t(7,p="error"),setTimeout(()=>{t(6,f="")},2e3);return}try{await fetch(`/servoSet?val=${P}`),t(6,f=`${q} set to ${P}Âµs`),t(7,p="success"),setTimeout(()=>{t(6,f="")},2e3)}catch{t(6,f=`Failed to set ${q}`),t(7,p="error"),setTimeout(()=>{t(6,f="")},3e3)}}async function _(){t(4,a=!0),t(6,f="");try{await tn({startUS:n,endUS:s,disabled:r}),localStorage.setItem("disableServo",r.toString()),t(6,f="Settings saved successfully"),t(7,p="success"),setTimeout(()=>{t(6,f="")},3e3)}catch(P){t(6,f=`Failed to save: ${P.message}`),t(7,p="error"),setTimeout(()=>{t(6,f="")},3e3)}finally{t(4,a=!1)}}async function g(){if(r){t(6,f="Servo is disabled"),t(7,p="error"),setTimeout(()=>{t(6,f="")},2e3);return}t(5,u=!0),t(6,f="");try{await vs(),t(6,f="Servo triggered"),t(7,p="success"),setTimeout(()=>{t(6,f="")},2e3)}catch(P){t(6,f=`Failed to trigger servo: ${P.message}`),t(7,p="error"),setTimeout(()=>{t(6,f="")},3e3)}finally{t(5,u=!1)}}function y(){if(r){t(6,f="Servo is disabled"),t(7,p="error"),setTimeout(()=>{t(6,f="")},2e3);return}try{fetch(`/servoSet?val=${o}`)}catch(P){console.error("Failed to update live position:",P)}}ze(()=>{m()});function h(){n=De(this.value),t(0,n)}const L=()=>v(n,"Start position");function E(){s=De(this.value),t(1,s)}const C=()=>v(s,"End position");function S(){r=this.checked,t(2,r)}function I(){o=De(this.value),t(3,o)}return[n,s,r,o,a,u,f,p,v,_,g,y,h,L,E,C,S,I]}class tr extends Ae{constructor(e){super(),Ee(this,e,er,xn,Se,{})}}function lr(l){let e,t,n,s,r,o,a;return t=new Te({props:{title:"IP Filtering",$$slots:{default:[rr]},$$scope:{ctx:l}}}),s=new Te({props:{title:"MQTT Configuration",$$slots:{default:[or]},$$scope:{ctx:l}}}),o=new Te({props:{title:"Video Mode",$$slots:{default:[ir]},$$scope:{ctx:l}}}),{c(){e=d("div"),de(t.$$.fragment),n=b(),de(s.$$.fragment),r=b(),de(o.$$.fragment),c(e,"class","settings-grid svelte-dlnskf")},m(u,f){w(u,e,f),ce(t,e,null),i(e,n),ce(s,e,null),i(e,r),ce(o,e,null),a=!0},p(u,f){const p={};f[0]&124|f[1]&128&&(p.$$scope={dirty:f,ctx:u}),t.$set(p);const m={};f[0]&130944|f[1]&128&&(m.$$scope={dirty:f,ctx:u}),s.$set(m);const v={};f[0]&917504|f[1]&128&&(v.$$scope={dirty:f,ctx:u}),o.$set(v)},i(u){a||(J(t.$$.fragment,u),J(s.$$.fragment,u),J(o.$$.fragment,u),a=!0)},o(u){K(t.$$.fragment,u),K(s.$$.fragment,u),K(o.$$.fragment,u),a=!1},d(u){u&&k(e),ue(t),ue(s),ue(o)}}}function sr(l){let e,t;return e=new hs({props:{message:l[1],onRetry:l[20]}}),{c(){de(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p(n,s){const r={};s[0]&2&&(r.message=n[1]),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function nr(l){let e,t,n;return t=new Ve({}),{c(){e=d("div"),de(t.$$.fragment),c(e,"class","loading-container svelte-dlnskf")},m(s,r){w(s,e,r),ce(t,e,null),n=!0},p:Q,i(s){n||(J(t.$$.fragment,s),n=!0)},o(s){K(t.$$.fragment,s),n=!1},d(s){s&&k(e),ue(t)}}}function ul(l){let e,t,n,s;return{c(){e=d("div"),t=A("Your IP: "),n=d("span"),s=A(l[4]),c(n,"class","client-ip svelte-dlnskf"),c(e,"class","info-text svelte-dlnskf")},m(r,o){w(r,e,o),i(e,t),i(e,n),i(n,s)},p(r,o){o[0]&16&&j(s,r[4])},d(r){r&&k(e)}}}function fl(l){let e,t;return{c(){e=d("div"),t=A(l[5]),c(e,"class","error-text svelte-dlnskf")},m(n,s){w(n,e,s),i(e,t)},p(n,s){s[0]&32&&j(t,n[5])},d(n){n&&k(e)}}}function rr(l){let e,t,n,s,r,o,a,u,f,p,m,v,_,g,y,h,L,E,C=l[6]?"Saving...":"Save IP Filters",S,I,P,q=l[4]&&ul(l),T=l[5]&&fl(l);return{c(){e=d("div"),q&&q.c(),t=b(),n=d("div"),s=d("label"),s.textContent="Whitelist (comma-separated CIDRs)",r=b(),o=d("input"),a=b(),u=d("div"),u.textContent="Leave empty to allow all IPs",f=b(),p=d("div"),m=d("label"),m.textContent="Blacklist (comma-separated CIDRs)",v=b(),_=d("input"),g=b(),y=d("div"),y.textContent="Blocked IPs take precedence over whitelist",h=b(),T&&T.c(),L=b(),E=d("button"),S=A(C),c(s,"for","whitelist"),c(s,"class","svelte-dlnskf"),c(o,"id","whitelist"),c(o,"type","text"),c(o,"placeholder","192.168.1.0/24, 10.0.0.1"),o.disabled=l[6],c(o,"class","svelte-dlnskf"),c(u,"class","help-text svelte-dlnskf"),c(n,"class","form-group svelte-dlnskf"),c(m,"for","blacklist"),c(m,"class","svelte-dlnskf"),c(_,"id","blacklist"),c(_,"type","text"),c(_,"placeholder","192.168.99.0/24, 172.16.0.1"),_.disabled=l[6],c(_,"class","svelte-dlnskf"),c(y,"class","help-text svelte-dlnskf"),c(p,"class","form-group svelte-dlnskf"),c(E,"class","btn-primary svelte-dlnskf"),E.disabled=l[6],c(e,"class","form-section svelte-dlnskf")},m(F,R){w(F,e,R),q&&q.m(e,null),i(e,t),i(e,n),i(n,s),i(n,r),i(n,o),le(o,l[2]),i(n,a),i(n,u),i(e,f),i(e,p),i(p,m),i(p,v),i(p,_),le(_,l[3]),i(p,g),i(p,y),i(e,h),T&&T.m(e,null),i(e,L),i(e,E),i(E,S),I||(P=[M(o,"input",l[25]),M(_,"input",l[26]),M(E,"click",l[21])],I=!0)},p(F,R){F[4]?q?q.p(F,R):(q=ul(F),q.c(),q.m(e,t)):q&&(q.d(1),q=null),R[0]&64&&(o.disabled=F[6]),R[0]&4&&o.value!==F[2]&&le(o,F[2]),R[0]&64&&(_.disabled=F[6]),R[0]&8&&_.value!==F[3]&&le(_,F[3]),F[5]?T?T.p(F,R):(T=fl(F),T.c(),T.m(e,L)):T&&(T.d(1),T=null),R[0]&64&&C!==(C=F[6]?"Saving...":"Save IP Filters")&&j(S,C),R[0]&64&&(E.disabled=F[6])},d(F){F&&k(e),q&&q.d(),T&&T.d(),I=!1,_e(P)}}}function dl(l){let e,t;return{c(){e=d("div"),t=A(l[14]),c(e,"class","error-text svelte-dlnskf")},m(n,s){w(n,e,s),i(e,t)},p(n,s){s[0]&16384&&j(t,n[14])},d(n){n&&k(e)}}}function or(l){let e,t,n,s,r,o,a,u,f,p,m,v,_,g,y,h,L,E,C,S,I,P,q,T,F,R,O,U,B,N,V,D,G,Y,$=l[13]?"Hide":"Show",ie,ve,ne,re,pe,ee,H,Z,x,ae,ye,be,se=l[15]?"Saving...":"Save MQTT Config",X,W,he,Me=l[16]?"Testing...":"Test Connection",Be,We,Ze,Je,ke=l[14]&&dl(l);return{c(){e=d("div"),t=d("div"),n=d("label"),s=d("input"),r=b(),o=d("span"),o.textContent="Enable MQTT",a=b(),u=d("div"),f=d("label"),f.textContent="Broker Address",p=b(),m=d("input"),_=b(),g=d("div"),y=d("label"),y.textContent="Port",h=b(),L=d("input"),C=b(),S=d("div"),I=d("label"),I.textContent="Username",P=b(),q=d("input"),F=b(),R=d("div"),O=d("label"),O.textContent="Password",U=b(),B=d("div"),N=d("input"),G=b(),Y=d("button"),ie=A($),ne=b(),re=d("div"),pe=d("label"),pe.textContent="Topic Prefix",ee=b(),H=d("input"),x=b(),ke&&ke.c(),ae=b(),ye=d("div"),be=d("button"),X=A(se),W=b(),he=d("button"),Be=A(Me),c(s,"type","checkbox"),s.disabled=l[15],c(s,"class","svelte-dlnskf"),c(o,"class","svelte-dlnskf"),c(n,"class","svelte-dlnskf"),c(t,"class","form-group checkbox-group svelte-dlnskf"),c(f,"for","mqtt-broker"),c(f,"class","svelte-dlnskf"),c(m,"id","mqtt-broker"),c(m,"type","text"),c(m,"placeholder","mqtt.example.com"),m.disabled=v=l[15]||!l[12],c(m,"class","svelte-dlnskf"),c(u,"class","form-group svelte-dlnskf"),c(y,"for","mqtt-port"),c(y,"class","svelte-dlnskf"),c(L,"id","mqtt-port"),c(L,"type","number"),c(L,"placeholder","1883"),c(L,"min","1"),c(L,"max","65535"),L.disabled=E=l[15]||!l[12],c(L,"class","svelte-dlnskf"),c(g,"class","form-group svelte-dlnskf"),c(I,"for","mqtt-user"),c(I,"class","svelte-dlnskf"),c(q,"id","mqtt-user"),c(q,"type","text"),c(q,"placeholder","Optional"),q.disabled=T=l[15]||!l[12],c(q,"class","svelte-dlnskf"),c(S,"class","form-group svelte-dlnskf"),c(O,"for","mqtt-password"),c(O,"class","svelte-dlnskf"),c(N,"id","mqtt-password"),c(N,"type",V=l[13]?"text":"password"),N.value=l[10],c(N,"placeholder","Optional"),N.disabled=D=l[15]||!l[12],c(N,"class","svelte-dlnskf"),c(Y,"type","button"),c(Y,"class","toggle-password svelte-dlnskf"),Y.disabled=ve=!l[12],c(B,"class","password-input-group svelte-dlnskf"),c(R,"class","form-group svelte-dlnskf"),c(pe,"for","mqtt-topic"),c(pe,"class","svelte-dlnskf"),c(H,"id","mqtt-topic"),c(H,"type","text"),c(H,"placeholder","mousetrap"),H.disabled=Z=l[15]||!l[12],c(H,"class","svelte-dlnskf"),c(re,"class","form-group svelte-dlnskf"),c(be,"class","btn-primary svelte-dlnskf"),be.disabled=l[15],c(he,"class","btn-secondary svelte-dlnskf"),he.disabled=We=l[16]||!l[12]||!l[7],c(ye,"class","button-group svelte-dlnskf"),c(e,"class","form-section svelte-dlnskf")},m(te,fe){w(te,e,fe),i(e,t),i(t,n),i(n,s),s.checked=l[12],i(n,r),i(n,o),i(e,a),i(e,u),i(u,f),i(u,p),i(u,m),le(m,l[7]),i(e,_),i(e,g),i(g,y),i(g,h),i(g,L),le(L,l[8]),i(e,C),i(e,S),i(S,I),i(S,P),i(S,q),le(q,l[9]),i(e,F),i(e,R),i(R,O),i(R,U),i(R,B),i(B,N),i(B,G),i(B,Y),i(Y,ie),i(e,ne),i(e,re),i(re,pe),i(re,ee),i(re,H),le(H,l[11]),i(e,x),ke&&ke.m(e,null),i(e,ae),i(e,ye),i(ye,be),i(be,X),i(ye,W),i(ye,he),i(he,Be),Ze||(Je=[M(s,"change",l[27]),M(m,"input",l[28]),M(L,"input",l[29]),M(q,"input",l[30]),M(N,"input",l[31]),M(Y,"click",l[32]),M(H,"input",l[33]),M(be,"click",l[22]),M(he,"click",l[23])],Ze=!0)},p(te,fe){fe[0]&32768&&(s.disabled=te[15]),fe[0]&4096&&(s.checked=te[12]),fe[0]&36864&&v!==(v=te[15]||!te[12])&&(m.disabled=v),fe[0]&128&&m.value!==te[7]&&le(m,te[7]),fe[0]&36864&&E!==(E=te[15]||!te[12])&&(L.disabled=E),fe[0]&256&&De(L.value)!==te[8]&&le(L,te[8]),fe[0]&36864&&T!==(T=te[15]||!te[12])&&(q.disabled=T),fe[0]&512&&q.value!==te[9]&&le(q,te[9]),fe[0]&8192&&V!==(V=te[13]?"text":"password")&&c(N,"type",V),fe[0]&1024&&N.value!==te[10]&&(N.value=te[10]),fe[0]&36864&&D!==(D=te[15]||!te[12])&&(N.disabled=D),fe[0]&8192&&$!==($=te[13]?"Hide":"Show")&&j(ie,$),fe[0]&4096&&ve!==(ve=!te[12])&&(Y.disabled=ve),fe[0]&36864&&Z!==(Z=te[15]||!te[12])&&(H.disabled=Z),fe[0]&2048&&H.value!==te[11]&&le(H,te[11]),te[14]?ke?ke.p(te,fe):(ke=dl(te),ke.c(),ke.m(e,ae)):ke&&(ke.d(1),ke=null),fe[0]&32768&&se!==(se=te[15]?"Saving...":"Save MQTT Config")&&j(X,se),fe[0]&32768&&(be.disabled=te[15]),fe[0]&65536&&Me!==(Me=te[16]?"Testing...":"Test Connection")&&j(Be,Me),fe[0]&69760&&We!==(We=te[16]||!te[12]||!te[7])&&(he.disabled=We)},d(te){te&&k(e),ke&&ke.d(),Ze=!1,_e(Je)}}}function pl(l){let e,t;return{c(){e=d("div"),t=A(l[19]),c(e,"class","error-text svelte-dlnskf")},m(n,s){w(n,e,s),i(e,t)},p(n,s){s[0]&524288&&j(t,n[19])},d(n){n&&k(e)}}}function ir(l){let e,t,n,s,r,o,a,u,f,p,m,v,_,g,y,h,L,E,C,S,I,P,q,T,F=l[18]?"Applying...":"Apply Video Mode",R,O,U,B,N=l[19]&&pl(l);return O=Ts(l[35][0]),{c(){e=d("div"),t=d("div"),t.textContent="Changing video mode will restart the camera",n=b(),s=d("div"),r=d("label"),r.textContent="Resolution",o=b(),a=d("div"),u=d("label"),f=d("input"),p=b(),m=d("span"),m.textContent="SVGA (800x600)",v=b(),_=d("label"),g=d("input"),y=b(),h=d("span"),h.textContent="VGA (640x480)",L=b(),E=d("label"),C=d("input"),S=b(),I=d("span"),I.textContent="CIF (352x288)",P=b(),N&&N.c(),q=b(),T=d("button"),R=A(F),c(t,"class","warning-text svelte-dlnskf"),c(r,"class","svelte-dlnskf"),c(f,"type","radio"),f.__value="SVGA",le(f,f.__value),f.disabled=l[18],c(f,"class","svelte-dlnskf"),c(m,"class","svelte-dlnskf"),c(u,"class","radio-label svelte-dlnskf"),c(g,"type","radio"),g.__value="VGA",le(g,g.__value),g.disabled=l[18],c(g,"class","svelte-dlnskf"),c(h,"class","svelte-dlnskf"),c(_,"class","radio-label svelte-dlnskf"),c(C,"type","radio"),C.__value="CIF",le(C,C.__value),C.disabled=l[18],c(C,"class","svelte-dlnskf"),c(I,"class","svelte-dlnskf"),c(E,"class","radio-label svelte-dlnskf"),c(a,"class","radio-group svelte-dlnskf"),c(s,"class","form-group svelte-dlnskf"),c(T,"class","btn-primary svelte-dlnskf"),T.disabled=l[18],c(e,"class","form-section svelte-dlnskf"),O.p(f,g,C)},m(V,D){w(V,e,D),i(e,t),i(e,n),i(e,s),i(s,r),i(s,o),i(s,a),i(a,u),i(u,f),f.checked=f.__value===l[17],i(u,p),i(u,m),i(a,v),i(a,_),i(_,g),g.checked=g.__value===l[17],i(_,y),i(_,h),i(a,L),i(a,E),i(E,C),C.checked=C.__value===l[17],i(E,S),i(E,I),i(e,P),N&&N.m(e,null),i(e,q),i(e,T),i(T,R),U||(B=[M(f,"change",l[34]),M(g,"change",l[36]),M(C,"change",l[37]),M(T,"click",l[24])],U=!0)},p(V,D){D[0]&262144&&(f.disabled=V[18]),D[0]&131072&&(f.checked=f.__value===V[17]),D[0]&262144&&(g.disabled=V[18]),D[0]&131072&&(g.checked=g.__value===V[17]),D[0]&262144&&(C.disabled=V[18]),D[0]&131072&&(C.checked=C.__value===V[17]),V[19]?N?N.p(V,D):(N=pl(V),N.c(),N.m(e,q)):N&&(N.d(1),N=null),D[0]&262144&&F!==(F=V[18]?"Applying...":"Apply Video Mode")&&j(R,F),D[0]&262144&&(T.disabled=V[18])},d(V){V&&k(e),N&&N.d(),O.r(),U=!1,_e(B)}}}function ar(l){let e,t,n,s,r,o;const a=[nr,sr,lr],u=[];function f(p,m){return p[0]?0:p[1]?1:2}return s=f(l),r=u[s]=a[s](l),{c(){e=d("div"),t=d("div"),t.innerHTML='<h1 class="svelte-dlnskf">Settings</h1>',n=b(),r.c(),c(t,"class","header svelte-dlnskf"),c(e,"class","settings-container svelte-dlnskf")},m(p,m){w(p,e,m),i(e,t),i(e,n),u[s].m(e,null),o=!0},p(p,m){let v=s;s=f(p),s===v?u[s].p(p,m):(we(),K(u[v],1,1,()=>{u[v]=null}),Ce(),r=u[s],r?r.p(p,m):(r=u[s]=a[s](p),r.c()),J(r,1),r.m(e,null))},i(p){o||(J(r),o=!0)},o(p){K(r),o=!1},d(p){p&&k(e),u[s].d()}}}function ml(l){if(l=l.trim(),!l)return!0;if(!/^(\d{1,3}\.){3}\d{1,3}(\/\d{1,2})?$/.test(l))return!1;const t=l.split("/"),n=t[0].split(".");for(let s of n){const r=parseInt(s);if(r<0||r>255)return!1}if(t[1]){const s=parseInt(t[1]);if(s<0||s>32)return!1}return!0}function cr(l,e,t){let n=!0,s=null,r="",o="",a="",u="",f=!1,p="",m=1883,v="",_="",g="",y=!1,h=!1,L="",E=!1,C=!1,S="SVGA",I=!1,P="";ze(async()=>{await q()});async function q(){t(0,n=!0),t(1,s=null);try{const[ee,H,Z]=await Promise.all([ln(),nn(),on()]);t(2,r=ee.whitelist.join(", ")),t(3,o=ee.blacklist.join(", ")),t(4,a=ee.clientIP||""),t(7,p=H.broker||""),t(8,m=H.port||1883),t(9,v=H.user||""),t(10,_=H.password||""),t(11,g=H.topic||""),t(12,y=H.enabled||!1),t(17,S=Z.mode||"SVGA"),t(0,n=!1)}catch(ee){t(1,s=ee.message||"Failed to load settings"),t(0,n=!1)}}async function T(){t(5,u="");const ee=r.split(",").map(Z=>Z.trim()).filter(Z=>Z),H=o.split(",").map(Z=>Z.trim()).filter(Z=>Z);for(let Z of ee)if(!ml(Z)){t(5,u=`Invalid CIDR format in whitelist: ${Z}`);return}for(let Z of H)if(!ml(Z)){t(5,u=`Invalid CIDR format in blacklist: ${Z}`);return}t(6,f=!0);try{await sn({whitelist:ee,blacklist:H}),t(6,f=!1)}catch(Z){t(5,u=Z.message||"Failed to save IP filters"),t(6,f=!1)}}async function F(){if(t(14,L=""),y&&!p){t(14,L="Broker address is required when MQTT is enabled");return}if(m<1||m>65535){t(14,L="Port must be between 1 and 65535");return}t(15,E=!0);try{await rn({broker:p,port:m,user:v,password:_,topic:g,enabled:y}),t(15,E=!1)}catch(ee){t(14,L=ee.message||"Failed to save MQTT configuration"),t(15,E=!1)}}async function R(){if(t(14,L=""),!p){t(14,L="Broker address is required");return}t(16,C=!0);try{await new Promise(ee=>setTimeout(ee,1e3)),t(16,C=!1),alert("MQTT connection test successful")}catch(ee){t(14,L=ee.message||"Connection test failed"),t(16,C=!1)}}async function O(){if(t(19,P=""),!!confirm("Changing video mode will restart the camera. Continue?")){t(18,I=!0);try{await an({mode:S}),t(18,I=!1)}catch(H){t(19,P=H.message||"Failed to apply video mode"),t(18,I=!1)}}}const U=[[]];function B(){r=this.value,t(2,r)}function N(){o=this.value,t(3,o)}function V(){y=this.checked,t(12,y)}function D(){p=this.value,t(7,p)}function G(){m=De(this.value),t(8,m)}function Y(){v=this.value,t(9,v)}const $=ee=>t(10,_=ee.target.value),ie=()=>t(13,h=!h);function ve(){g=this.value,t(11,g)}function ne(){S=this.__value,t(17,S)}function re(){S=this.__value,t(17,S)}function pe(){S=this.__value,t(17,S)}return[n,s,r,o,a,u,f,p,m,v,_,g,y,h,L,E,C,S,I,P,q,T,F,R,O,B,N,V,D,G,Y,$,ie,ve,ne,U,re,pe]}class ur extends Ae{constructor(e){super(),Ee(this,e,cr,ar,Se,{},null,[-1,-1])}}const{document:fr}=cs;function vl(l,e,t){const n=l.slice();return n[45]=e[t],n}function _l(l,e,t){const n=l.slice();return n[45]=e[t],n}function bl(l,e,t){const n=l.slice();return n[45]=e[t],n}function hl(l){let e,t,n;return{c(){e=d("button"),e.textContent="Clear",c(e,"class","btn-small svelte-16e85dp")},m(s,r){w(s,e,r),t||(n=M(e,"click",l[26]),t=!0)},p:Q,d(s){s&&k(e),t=!1,n()}}}function gl(l){let e;function t(r,o){return r[6]?_r:r[9]?vr:r[21].length===0&&r[3]?mr:r[0].length===0?pr:dr}let n=t(l),s=n(l);return{c(){e=d("div"),s.c(),c(e,"class","log-content svelte-16e85dp"),z(e,"expanded",l[13])},m(r,o){w(r,e,o),s.m(e,null),l[35](e)},p(r,o){n===(n=t(r))&&s?s.p(r,o):(s.d(1),s=n(r),s&&(s.c(),s.m(e,null))),o[0]&8192&&z(e,"expanded",r[13])},d(r){r&&k(e),s.d(),l[35](null)}}}function dr(l){let e,t,n,s=Re(l[21]),r=[];for(let a=0;a<s.length;a+=1)r[a]=kl(bl(l,s,a));let o=l[3]&&l[21].length>0&&wl(l);return{c(){e=d("div");for(let a=0;a<r.length;a+=1)r[a].c();t=b(),o&&o.c(),n=Le(),c(e,"class","log-list svelte-16e85dp")},m(a,u){w(a,e,u);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(e,null);w(a,t,u),o&&o.m(a,u),w(a,n,u)},p(a,u){if(u[0]&2097152){s=Re(a[21]);let f;for(f=0;f<s.length;f+=1){const p=bl(a,s,f);r[f]?r[f].p(p,u):(r[f]=kl(p),r[f].c(),r[f].m(e,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}a[3]&&a[21].length>0?o?o.p(a,u):(o=wl(a),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(a){a&&(k(e),k(t),k(n)),Ye(r,a),o&&o.d(a)}}}function pr(l){let e;return{c(){e=d("div"),e.textContent="No system logs available",c(e,"class","no-data svelte-16e85dp")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function mr(l){let e,t,n,s;return{c(){e=d("div"),t=A('No logs match filter "'),n=A(l[3]),s=A('"'),c(e,"class","no-results svelte-16e85dp")},m(r,o){w(r,e,o),i(e,t),i(e,n),i(e,s)},p(r,o){o[0]&8&&j(n,r[3])},d(r){r&&k(e)}}}function vr(l){let e,t,n;return{c(){e=d("div"),t=A("Error: "),n=A(l[9]),c(e,"class","error svelte-16e85dp")},m(s,r){w(s,e,r),i(e,t),i(e,n)},p(s,r){r[0]&512&&j(n,s[9])},d(s){s&&k(e)}}}function _r(l){let e;return{c(){e=d("div"),e.textContent="Loading system logs...",c(e,"class","loading svelte-16e85dp")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function kl(l){let e,t=l[45]+"",n;return{c(){e=d("div"),n=A(t),c(e,"class","log-line svelte-16e85dp")},m(s,r){w(s,e,r),i(e,n)},p(s,r){r[0]&2097152&&t!==(t=s[45]+"")&&j(n,t)},d(s){s&&k(e)}}}function wl(l){let e,t,n=l[21].length+"",s,r,o=l[0].length+"",a,u;return{c(){e=d("div"),t=A("Showing "),s=A(n),r=A(" of "),a=A(o),u=A(" logs"),c(e,"class","filter-info svelte-16e85dp")},m(f,p){w(f,e,p),i(e,t),i(e,s),i(e,r),i(e,a),i(e,u)},p(f,p){p[0]&2097152&&n!==(n=f[21].length+"")&&j(s,n),p[0]&1&&o!==(o=f[0].length+"")&&j(a,o)},d(f){f&&k(e)}}}function Cl(l){let e,t,n;return{c(){e=d("button"),e.textContent="Clear",c(e,"class","btn-small svelte-16e85dp")},m(s,r){w(s,e,r),t||(n=M(e,"click",l[27]),t=!0)},p:Q,d(s){s&&k(e),t=!1,n()}}}function yl(l){let e;function t(r,o){return r[7]?wr:r[10]?kr:r[20].length===0&&r[4]?gr:r[1].length===0?hr:br}let n=t(l),s=n(l);return{c(){e=d("div"),s.c(),c(e,"class","log-content svelte-16e85dp"),z(e,"expanded",l[14])},m(r,o){w(r,e,o),s.m(e,null),l[38](e)},p(r,o){n===(n=t(r))&&s?s.p(r,o):(s.d(1),s=n(r),s&&(s.c(),s.m(e,null))),o[0]&16384&&z(e,"expanded",r[14])},d(r){r&&k(e),s.d(),l[38](null)}}}function br(l){let e,t,n,s=Re(l[20]),r=[];for(let a=0;a<s.length;a+=1)r[a]=Sl(_l(l,s,a));let o=l[4]&&l[20].length>0&&Tl(l);return{c(){e=d("div");for(let a=0;a<r.length;a+=1)r[a].c();t=b(),o&&o.c(),n=Le(),c(e,"class","log-list svelte-16e85dp")},m(a,u){w(a,e,u);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(e,null);w(a,t,u),o&&o.m(a,u),w(a,n,u)},p(a,u){if(u[0]&1048576){s=Re(a[20]);let f;for(f=0;f<s.length;f+=1){const p=_l(a,s,f);r[f]?r[f].p(p,u):(r[f]=Sl(p),r[f].c(),r[f].m(e,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}a[4]&&a[20].length>0?o?o.p(a,u):(o=Tl(a),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(a){a&&(k(e),k(t),k(n)),Ye(r,a),o&&o.d(a)}}}function hr(l){let e;return{c(){e=d("div"),e.textContent="No previous logs available",c(e,"class","no-data svelte-16e85dp")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function gr(l){let e,t,n,s;return{c(){e=d("div"),t=A('No logs match filter "'),n=A(l[4]),s=A('"'),c(e,"class","no-results svelte-16e85dp")},m(r,o){w(r,e,o),i(e,t),i(e,n),i(e,s)},p(r,o){o[0]&16&&j(n,r[4])},d(r){r&&k(e)}}}function kr(l){let e,t,n;return{c(){e=d("div"),t=A("Error: "),n=A(l[10]),c(e,"class","error svelte-16e85dp")},m(s,r){w(s,e,r),i(e,t),i(e,n)},p(s,r){r[0]&1024&&j(n,s[10])},d(s){s&&k(e)}}}function wr(l){let e;return{c(){e=d("div"),e.textContent="Loading previous logs...",c(e,"class","loading svelte-16e85dp")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function Sl(l){let e,t=l[45]+"",n;return{c(){e=d("div"),n=A(t),c(e,"class","log-line svelte-16e85dp")},m(s,r){w(s,e,r),i(e,n)},p(s,r){r[0]&1048576&&t!==(t=s[45]+"")&&j(n,t)},d(s){s&&k(e)}}}function Tl(l){let e,t,n=l[20].length+"",s,r,o=l[1].length+"",a,u;return{c(){e=d("div"),t=A("Showing "),s=A(n),r=A(" of "),a=A(o),u=A(" logs"),c(e,"class","filter-info svelte-16e85dp")},m(f,p){w(f,e,p),i(e,t),i(e,s),i(e,r),i(e,a),i(e,u)},p(f,p){p[0]&1048576&&n!==(n=f[20].length+"")&&j(s,n),p[0]&2&&o!==(o=f[1].length+"")&&j(a,o)},d(f){f&&k(e)}}}function Ll(l){let e,t,n;return{c(){e=d("button"),e.textContent="Clear",c(e,"class","btn-small svelte-16e85dp")},m(s,r){w(s,e,r),t||(n=M(e,"click",l[28]),t=!0)},p:Q,d(s){s&&k(e),t=!1,n()}}}function El(l){let e;function t(r,o){return r[8]?Lr:r[11]?Tr:r[19].length===0&&r[5]?Sr:r[2].length===0?yr:Cr}let n=t(l),s=n(l);return{c(){e=d("div"),s.c(),c(e,"class","log-content svelte-16e85dp"),z(e,"expanded",l[15])},m(r,o){w(r,e,o),s.m(e,null),l[41](e)},p(r,o){n===(n=t(r))&&s?s.p(r,o):(s.d(1),s=n(r),s&&(s.c(),s.m(e,null))),o[0]&32768&&z(e,"expanded",r[15])},d(r){r&&k(e),s.d(),l[41](null)}}}function Cr(l){let e,t,n,s=Re(l[19]),r=[];for(let a=0;a<s.length;a+=1)r[a]=Al(vl(l,s,a));let o=l[5]&&l[19].length>0&&ql(l);return{c(){e=d("div");for(let a=0;a<r.length;a+=1)r[a].c();t=b(),o&&o.c(),n=Le(),c(e,"class","log-list svelte-16e85dp")},m(a,u){w(a,e,u);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(e,null);w(a,t,u),o&&o.m(a,u),w(a,n,u)},p(a,u){if(u[0]&524288){s=Re(a[19]);let f;for(f=0;f<s.length;f+=1){const p=vl(a,s,f);r[f]?r[f].p(p,u):(r[f]=Al(p),r[f].c(),r[f].m(e,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}a[5]&&a[19].length>0?o?o.p(a,u):(o=ql(a),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(a){a&&(k(e),k(t),k(n)),Ye(r,a),o&&o.d(a)}}}function yr(l){let e;return{c(){e=d("div"),e.textContent="No older logs available (logs from 2 boots ago)",c(e,"class","no-data svelte-16e85dp")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function Sr(l){let e,t,n,s;return{c(){e=d("div"),t=A('No logs match filter "'),n=A(l[5]),s=A('"'),c(e,"class","no-results svelte-16e85dp")},m(r,o){w(r,e,o),i(e,t),i(e,n),i(e,s)},p(r,o){o[0]&32&&j(n,r[5])},d(r){r&&k(e)}}}function Tr(l){let e,t,n;return{c(){e=d("div"),t=A("Error: "),n=A(l[11]),c(e,"class","error svelte-16e85dp")},m(s,r){w(s,e,r),i(e,t),i(e,n)},p(s,r){r[0]&2048&&j(n,s[11])},d(s){s&&k(e)}}}function Lr(l){let e;return{c(){e=d("div"),e.textContent="Loading older logs...",c(e,"class","loading svelte-16e85dp")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function Al(l){let e,t=l[45]+"",n;return{c(){e=d("div"),n=A(t),c(e,"class","log-line svelte-16e85dp")},m(s,r){w(s,e,r),i(e,n)},p(s,r){r[0]&524288&&t!==(t=s[45]+"")&&j(n,t)},d(s){s&&k(e)}}}function ql(l){let e,t,n=l[19].length+"",s,r,o=l[2].length+"",a,u;return{c(){e=d("div"),t=A("Showing "),s=A(n),r=A(" of "),a=A(o),u=A(" logs"),c(e,"class","filter-info svelte-16e85dp")},m(f,p){w(f,e,p),i(e,t),i(e,s),i(e,r),i(e,a),i(e,u)},p(f,p){p[0]&524288&&n!==(n=f[19].length+"")&&j(s,n),p[0]&4&&o!==(o=f[2].length+"")&&j(a,o)},d(f){f&&k(e)}}}function Er(l){let e,t,n,s,r,o,a,u=l[12]?"Auto-refresh On":"Auto-refresh Off",f,p,m,v,_,g,y,h,L,E,C=l[13]?"â–¼":"â–¶",S,I,P,q,T,F,R,O,U,B,N,V,D,G,Y,$,ie=l[14]?"â–¼":"â–¶",ve,ne,re,pe,ee,H,Z,x,ae,ye,be,se,X,W,he,Me,Be=l[15]?"â–¼":"â–¶",We,Ze,Je,ke,te,fe,Pt,bt,Qe,Nt,at,Rt,ht,Mt,qe=l[3]&&hl(l),Fe=l[13]&&gl(l),Oe=l[4]&&Cl(l),Ie=l[14]&&yl(l),Pe=l[5]&&Ll(l),Ne=l[15]&&El(l);return{c(){e=b(),t=d("div"),n=d("div"),s=d("h1"),s.textContent="Logs & Diagnostics",r=b(),o=d("div"),a=d("button"),f=A(u),p=A(" ("),m=A(gs),v=A("s)"),_=b(),g=d("button"),g.textContent="Refresh Now",y=b(),h=d("div"),L=d("div"),E=d("button"),S=A(C),I=b(),P=d("h2"),P.textContent="System Logs",q=b(),T=d("div"),F=d("input"),R=b(),qe&&qe.c(),O=b(),U=d("button"),B=A("Export"),V=b(),Fe&&Fe.c(),D=b(),G=d("div"),Y=d("div"),$=d("button"),ve=A(ie),ne=b(),re=d("h2"),re.textContent="Previous System Logs",pe=b(),ee=d("div"),H=d("input"),Z=b(),Oe&&Oe.c(),x=b(),ae=d("button"),ye=A("Export"),se=b(),Ie&&Ie.c(),X=b(),W=d("div"),he=d("div"),Me=d("button"),We=A(Be),Ze=b(),Je=d("h2"),Je.textContent="Older Logs (2 boots ago)",ke=b(),te=d("div"),fe=d("input"),Pt=b(),Pe&&Pe.c(),bt=b(),Qe=d("button"),Nt=A("Export"),Rt=b(),Ne&&Ne.c(),fr.title="Logs & Diagnostics - MouseTrap",c(s,"class","svelte-16e85dp"),c(a,"class","btn svelte-16e85dp"),z(a,"active",l[12]),c(g,"class","btn svelte-16e85dp"),c(o,"class","header-controls svelte-16e85dp"),c(n,"class","header svelte-16e85dp"),c(E,"class","expand-btn svelte-16e85dp"),c(P,"class","svelte-16e85dp"),c(F,"type","text"),c(F,"class","filter-input svelte-16e85dp"),c(F,"placeholder","Filter logs..."),c(U,"class","btn-small svelte-16e85dp"),U.disabled=N=l[0].length===0,c(T,"class","log-controls svelte-16e85dp"),c(L,"class","log-header svelte-16e85dp"),c(h,"class","log-section svelte-16e85dp"),c($,"class","expand-btn svelte-16e85dp"),c(re,"class","svelte-16e85dp"),c(H,"type","text"),c(H,"class","filter-input svelte-16e85dp"),c(H,"placeholder","Filter logs..."),c(ae,"class","btn-small svelte-16e85dp"),ae.disabled=be=l[1].length===0,c(ee,"class","log-controls svelte-16e85dp"),c(Y,"class","log-header svelte-16e85dp"),c(G,"class","log-section svelte-16e85dp"),c(Me,"class","expand-btn svelte-16e85dp"),c(Je,"class","svelte-16e85dp"),c(fe,"type","text"),c(fe,"class","filter-input svelte-16e85dp"),c(fe,"placeholder","Filter logs..."),c(Qe,"class","btn-small svelte-16e85dp"),Qe.disabled=at=l[2].length===0,c(te,"class","log-controls svelte-16e85dp"),c(he,"class","log-header svelte-16e85dp"),c(W,"class","log-section svelte-16e85dp"),c(t,"class","logs-container svelte-16e85dp")},m(oe,ge){w(oe,e,ge),w(oe,t,ge),i(t,n),i(n,s),i(n,r),i(n,o),i(o,a),i(a,f),i(a,p),i(a,m),i(a,v),i(o,_),i(o,g),i(t,y),i(t,h),i(h,L),i(L,E),i(E,S),i(L,I),i(L,P),i(L,q),i(L,T),i(T,F),le(F,l[3]),i(T,R),qe&&qe.m(T,null),i(T,O),i(T,U),i(U,B),i(h,V),Fe&&Fe.m(h,null),i(t,D),i(t,G),i(G,Y),i(Y,$),i($,ve),i(Y,ne),i(Y,re),i(Y,pe),i(Y,ee),i(ee,H),le(H,l[4]),i(ee,Z),Oe&&Oe.m(ee,null),i(ee,x),i(ee,ae),i(ae,ye),i(G,se),Ie&&Ie.m(G,null),i(t,X),i(t,W),i(W,he),i(he,Me),i(Me,We),i(he,Ze),i(he,Je),i(he,ke),i(he,te),i(te,fe),le(fe,l[5]),i(te,Pt),Pe&&Pe.m(te,null),i(te,bt),i(te,Qe),i(Qe,Nt),i(W,Rt),Ne&&Ne.m(W,null),ht||(Mt=[M(a,"click",l[25]),M(g,"click",l[32]),M(E,"click",l[29]),M(F,"input",l[33]),M(U,"click",l[34]),M($,"click",l[30]),M(H,"input",l[36]),M(ae,"click",l[37]),M(Me,"click",l[31]),M(fe,"input",l[39]),M(Qe,"click",l[40])],ht=!0)},p(oe,ge){ge[0]&4096&&u!==(u=oe[12]?"Auto-refresh On":"Auto-refresh Off")&&j(f,u),ge[0]&4096&&z(a,"active",oe[12]),ge[0]&8192&&C!==(C=oe[13]?"â–¼":"â–¶")&&j(S,C),ge[0]&8&&F.value!==oe[3]&&le(F,oe[3]),oe[3]?qe?qe.p(oe,ge):(qe=hl(oe),qe.c(),qe.m(T,O)):qe&&(qe.d(1),qe=null),ge[0]&1&&N!==(N=oe[0].length===0)&&(U.disabled=N),oe[13]?Fe?Fe.p(oe,ge):(Fe=gl(oe),Fe.c(),Fe.m(h,null)):Fe&&(Fe.d(1),Fe=null),ge[0]&16384&&ie!==(ie=oe[14]?"â–¼":"â–¶")&&j(ve,ie),ge[0]&16&&H.value!==oe[4]&&le(H,oe[4]),oe[4]?Oe?Oe.p(oe,ge):(Oe=Cl(oe),Oe.c(),Oe.m(ee,x)):Oe&&(Oe.d(1),Oe=null),ge[0]&2&&be!==(be=oe[1].length===0)&&(ae.disabled=be),oe[14]?Ie?Ie.p(oe,ge):(Ie=yl(oe),Ie.c(),Ie.m(G,null)):Ie&&(Ie.d(1),Ie=null),ge[0]&32768&&Be!==(Be=oe[15]?"â–¼":"â–¶")&&j(We,Be),ge[0]&32&&fe.value!==oe[5]&&le(fe,oe[5]),oe[5]?Pe?Pe.p(oe,ge):(Pe=Ll(oe),Pe.c(),Pe.m(te,bt)):Pe&&(Pe.d(1),Pe=null),ge[0]&4&&at!==(at=oe[2].length===0)&&(Qe.disabled=at),oe[15]?Ne?Ne.p(oe,ge):(Ne=El(oe),Ne.c(),Ne.m(W,null)):Ne&&(Ne.d(1),Ne=null)},i:Q,o:Q,d(oe){oe&&(k(e),k(t)),qe&&qe.d(),Fe&&Fe.d(),Oe&&Oe.d(),Ie&&Ie.d(),Pe&&Pe.d(),Ne&&Ne.d(),ht=!1,_e(Mt)}}}let gs=5;function Ct(l,e){const t=l.join(`
`),n=new Blob([t],{type:"text/plain"}),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=e,r.click(),URL.revokeObjectURL(s)}function Ar(l,e,t){let n,s,r,o=[],a=[],u=[],f=!0,p=!0,m=!0,v=null,_=null,g=null,y=!1,h=null,L="",E="",C="",S=!0,I=!0,P=!1,q,T,F;async function R(se=!0){const X=(q==null?void 0:q.scrollTop)||0;se&&t(6,f=!0),t(9,v=null);try{t(0,o=await cn())}catch(W){console.error("Failed to fetch system logs:",W),t(9,v=W.message),t(0,o=[])}finally{se&&t(6,f=!1),q&&X>0&&requestAnimationFrame(()=>{t(16,q.scrollTop=X,q)})}}async function O(se=!0){const X=(T==null?void 0:T.scrollTop)||0;se&&t(7,p=!0),t(10,_=null);try{t(1,a=await un())}catch(W){console.error("Failed to fetch previous logs:",W),t(10,_=W.message),t(1,a=[])}finally{se&&t(7,p=!1),T&&X>0&&requestAnimationFrame(()=>{t(17,T.scrollTop=X,T)})}}async function U(se=!0){const X=(F==null?void 0:F.scrollTop)||0;se&&t(8,m=!0),t(11,g=null);try{t(2,u=await fn())}catch(W){console.error("Failed to fetch older logs:",W),t(11,g=W.message),t(2,u=[])}finally{se&&t(8,m=!1),F&&X>0&&requestAnimationFrame(()=>{t(18,F.scrollTop=X,F)})}}function B(){t(12,y=!y),y?N():V()}function N(){V(),h=setInterval(()=>{R(!1),O(!1),U(!1)},gs*1e3)}function V(){h&&(clearInterval(h),h=null)}function D(){t(3,L="")}function G(){t(4,E="")}function Y(){t(5,C="")}function $(){t(13,S=!S)}function ie(){t(14,I=!I)}function ve(){t(15,P=!P)}ze(()=>{R(),O(),U()}),ot(()=>{V()});const ne=()=>{R(!0),O(!0),U(!0)};function re(){L=this.value,t(3,L)}const pe=()=>Ct(o,"system-logs.txt");function ee(se){et[se?"unshift":"push"](()=>{q=se,t(16,q)})}function H(){E=this.value,t(4,E)}const Z=()=>Ct(a,"previous-logs.txt");function x(se){et[se?"unshift":"push"](()=>{T=se,t(17,T)})}function ae(){C=this.value,t(5,C)}const ye=()=>Ct(u,"older-logs.txt");function be(se){et[se?"unshift":"push"](()=>{F=se,t(18,F)})}return l.$$.update=()=>{l.$$.dirty[0]&9&&t(21,n=o.filter(se=>se.toLowerCase().includes(L.toLowerCase()))),l.$$.dirty[0]&18&&t(20,s=a.filter(se=>se.toLowerCase().includes(E.toLowerCase()))),l.$$.dirty[0]&36&&t(19,r=u.filter(se=>se.toLowerCase().includes(C.toLowerCase())))},[o,a,u,L,E,C,f,p,m,v,_,g,y,S,I,P,q,T,F,r,s,n,R,O,U,B,D,G,Y,$,ie,ve,ne,re,pe,ee,H,Z,x,ae,ye,be]}class Fl extends Ae{constructor(e){super(),Ee(this,e,Ar,Er,Se,{},null,[-1,-1])}}function qr(l){let e,t,n,s,r,o,a,u,f,p,m=l[6]&&Ol();return n=new Te({props:{$$slots:{default:[Or]},$$scope:{ctx:l}}}),r=new Te({props:{$$slots:{default:[Ir]},$$scope:{ctx:l}}}),a=new Te({props:{$$slots:{default:[Dr]},$$scope:{ctx:l}}}),f=new Te({props:{$$slots:{default:[zr]},$$scope:{ctx:l}}}),{c(){m&&m.c(),e=b(),t=d("div"),de(n.$$.fragment),s=b(),de(r.$$.fragment),o=b(),de(a.$$.fragment),u=b(),de(f.$$.fragment),c(t,"class","cards-grid svelte-qwtv9g")},m(v,_){m&&m.m(v,_),w(v,e,_),w(v,t,_),ce(n,t,null),i(t,s),ce(r,t,null),i(t,o),ce(a,t,null),i(t,u),ce(f,t,null),p=!0},p(v,_){v[6]?m||(m=Ol(),m.c(),m.m(e.parentNode,e)):m&&(m.d(1),m=null);const g={};_&65537&&(g.$$scope={dirty:_,ctx:v}),n.$set(g);const y={};_&65552&&(y.$$scope={dirty:_,ctx:v}),r.$set(y);const h={};_&65596&&(h.$$scope={dirty:_,ctx:v}),a.$set(h);const L={};_&65537&&(L.$$scope={dirty:_,ctx:v}),f.$set(L)},i(v){p||(J(n.$$.fragment,v),J(r.$$.fragment,v),J(a.$$.fragment,v),J(f.$$.fragment,v),p=!0)},o(v){K(n.$$.fragment,v),K(r.$$.fragment,v),K(a.$$.fragment,v),K(f.$$.fragment,v),p=!1},d(v){v&&(k(e),k(t)),m&&m.d(v),ue(n),ue(r),ue(a),ue(f)}}}function Fr(l){let e,t,n;return t=new Ve({}),{c(){e=d("div"),de(t.$$.fragment),c(e,"class","loading-container svelte-qwtv9g")},m(s,r){w(s,e,r),ce(t,e,null),n=!0},p:Q,i(s){n||(J(t.$$.fragment,s),n=!0)},o(s){K(t.$$.fragment,s),n=!1},d(s){s&&k(e),ue(t)}}}function Ol(l){let e;return{c(){e=d("div"),e.textContent="Device is back online!",c(e,"class","online-banner svelte-qwtv9g")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Il(l){let e,t,n=l[0].buildDate+"",s;return{c(){e=d("div"),t=A("Built: "),s=A(n),c(e,"class","build-date svelte-qwtv9g")},m(r,o){w(r,e,o),i(e,t),i(e,s)},p(r,o){o&1&&n!==(n=r[0].buildDate+"")&&j(s,n)},d(r){r&&k(e)}}}function Pl(l){let e,t,n,s,r=l[0].chipModel+"",o;return{c(){e=d("tr"),t=d("td"),t.textContent="Chip Model",n=b(),s=d("td"),o=A(r),c(t,"class","label svelte-qwtv9g"),c(s,"class","value svelte-qwtv9g"),c(e,"class","svelte-qwtv9g")},m(a,u){w(a,e,u),i(e,t),i(e,n),i(e,s),i(s,o)},p(a,u){u&1&&r!==(r=a[0].chipModel+"")&&j(o,r)},d(a){a&&k(e)}}}function Nl(l){let e,t,n,s,r=Hl(l[0].cpuFreq)+"",o;return{c(){e=d("tr"),t=d("td"),t.textContent="CPU Frequency",n=b(),s=d("td"),o=A(r),c(t,"class","label svelte-qwtv9g"),c(s,"class","value svelte-qwtv9g"),c(e,"class","svelte-qwtv9g")},m(a,u){w(a,e,u),i(e,t),i(e,n),i(e,s),i(s,o)},p(a,u){u&1&&r!==(r=Hl(a[0].cpuFreq)+"")&&j(o,r)},d(a){a&&k(e)}}}function Rl(l){let e,t,n,s,r=vt(l[0].flashSize)+"",o;return{c(){e=d("tr"),t=d("td"),t.textContent="Flash Size",n=b(),s=d("td"),o=A(r),c(t,"class","label svelte-qwtv9g"),c(s,"class","value svelte-qwtv9g"),c(e,"class","svelte-qwtv9g")},m(a,u){w(a,e,u),i(e,t),i(e,n),i(e,s),i(s,o)},p(a,u){u&1&&r!==(r=vt(a[0].flashSize)+"")&&j(o,r)},d(a){a&&k(e)}}}function Ml(l){let e,t,n,s,r=vt(l[0].psramSize)+"",o;return{c(){e=d("tr"),t=d("td"),t.textContent="PSRAM Size",n=b(),s=d("td"),o=A(r),c(t,"class","label svelte-qwtv9g"),c(s,"class","value svelte-qwtv9g"),c(e,"class","svelte-qwtv9g")},m(a,u){w(a,e,u),i(e,t),i(e,n),i(e,s),i(s,o)},p(a,u){u&1&&r!==(r=vt(a[0].psramSize)+"")&&j(o,r)},d(a){a&&k(e)}}}function Ul(l){let e,t,n,s,r=l[0].macAddress+"",o;return{c(){e=d("tr"),t=d("td"),t.textContent="MAC Address",n=b(),s=d("td"),o=A(r),c(t,"class","label svelte-qwtv9g"),c(s,"class","value svelte-qwtv9g"),c(e,"class","svelte-qwtv9g")},m(a,u){w(a,e,u),i(e,t),i(e,n),i(e,s),i(s,o)},p(a,u){u&1&&r!==(r=a[0].macAddress+"")&&j(o,r)},d(a){a&&k(e)}}}function Or(l){var I,P,q,T,F,R,O;let e,t,n,s=(((I=l[0])==null?void 0:I.firmwareVersion)||"Unknown")+"",r,o,a,u,f,p,m,v,_,g,y=((P=l[0])==null?void 0:P.buildDate)&&Il(l),h=((q=l[0])==null?void 0:q.chipModel)&&Pl(l),L=((T=l[0])==null?void 0:T.cpuFreq)&&Nl(l),E=((F=l[0])==null?void 0:F.flashSize)&&Rl(l),C=((R=l[0])==null?void 0:R.psramSize)&&Ml(l),S=((O=l[0])==null?void 0:O.macAddress)&&Ul(l);return{c(){e=d("h2"),e.textContent="ESP32 Sketch",t=b(),n=d("div"),r=A(s),o=b(),y&&y.c(),a=b(),u=d("div"),f=d("table"),p=d("tbody"),h&&h.c(),m=b(),L&&L.c(),v=b(),E&&E.c(),_=b(),C&&C.c(),g=b(),S&&S.c(),c(e,"class","svelte-qwtv9g"),c(n,"class","firmware-version svelte-qwtv9g"),c(f,"class","svelte-qwtv9g"),c(u,"class","device-info svelte-qwtv9g")},m(U,B){w(U,e,B),w(U,t,B),w(U,n,B),i(n,r),w(U,o,B),y&&y.m(U,B),w(U,a,B),w(U,u,B),i(u,f),i(f,p),h&&h.m(p,null),i(p,m),L&&L.m(p,null),i(p,v),E&&E.m(p,null),i(p,_),C&&C.m(p,null),i(p,g),S&&S.m(p,null)},p(U,B){var N,V,D,G,Y,$,ie;B&1&&s!==(s=(((N=U[0])==null?void 0:N.firmwareVersion)||"Unknown")+"")&&j(r,s),(V=U[0])!=null&&V.buildDate?y?y.p(U,B):(y=Il(U),y.c(),y.m(a.parentNode,a)):y&&(y.d(1),y=null),(D=U[0])!=null&&D.chipModel?h?h.p(U,B):(h=Pl(U),h.c(),h.m(p,m)):h&&(h.d(1),h=null),(G=U[0])!=null&&G.cpuFreq?L?L.p(U,B):(L=Nl(U),L.c(),L.m(p,v)):L&&(L.d(1),L=null),(Y=U[0])!=null&&Y.flashSize?E?E.p(U,B):(E=Rl(U),E.c(),E.m(p,_)):E&&(E.d(1),E=null),($=U[0])!=null&&$.psramSize?C?C.p(U,B):(C=Ml(U),C.c(),C.m(p,g)):C&&(C.d(1),C=null),(ie=U[0])!=null&&ie.macAddress?S?S.p(U,B):(S=Ul(U),S.c(),S.m(p,null)):S&&(S.d(1),S=null)},d(U){U&&(k(e),k(t),k(n),k(o),k(a),k(u)),y&&y.d(U),h&&h.d(),L&&L.d(),E&&E.d(),C&&C.d(),S&&S.d()}}}function Ir(l){let e,t,n,s,r,o,a,u,f,p;return{c(){e=d("h2"),e.textContent="OTA Update",t=b(),n=d("p"),n.textContent="Upload new firmware via the web-based OTA interface.",s=b(),r=d("button"),o=A("Open OTA Update Interface"),a=b(),u=d("div"),u.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 12H7V7h2v5zm0-6H7V4h2v2z"></path></svg>
          Device will reboot after update`,c(e,"class","svelte-qwtv9g"),c(n,"class","description svelte-qwtv9g"),c(r,"class","ota-button svelte-qwtv9g"),r.disabled=l[4],c(u,"class","warning-text svelte-qwtv9g")},m(m,v){w(m,e,v),w(m,t,v),w(m,n,v),w(m,s,v),w(m,r,v),i(r,o),w(m,a,v),w(m,u,v),f||(p=M(r,"click",Br),f=!0)},p(m,v){v&16&&(r.disabled=m[4])},d(m){m&&(k(e),k(t),k(n),k(s),k(r),k(a),k(u)),f=!1,p()}}}function Pr(l){let e,t,n,s,r,o,a;return{c(){e=d("p"),e.textContent="Restart the device to apply configuration changes or recover from errors.",t=b(),n=d("button"),n.textContent="Reboot Device",s=b(),r=d("div"),r.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 12H7V7h2v5zm0-6H7V4h2v2z"></path></svg>
            Device will be unavailable for approximately 30 seconds`,c(e,"class","description svelte-qwtv9g"),c(n,"class","reboot-button svelte-qwtv9g"),c(r,"class","warning-text svelte-qwtv9g")},m(u,f){w(u,e,f),w(u,t,f),w(u,n,f),w(u,s,f),w(u,r,f),o||(a=M(n,"click",l[7]),o=!0)},p:Q,i:Q,o:Q,d(u){u&&(k(e),k(t),k(n),k(s),k(r)),o=!1,a()}}}function Nr(l){let e,t,n,s,r,o,a,u=l[3]!==1?"s":"",f,p,m,v,_,g;return{c(){e=d("div"),t=d("p"),t.textContent="Are you sure you want to reboot the device?",n=b(),s=d("div"),r=A("Rebooting in "),o=A(l[3]),a=A(" second"),f=A(u),p=A("..."),m=b(),v=d("button"),v.textContent="Cancel",c(t,"class","confirm-text svelte-qwtv9g"),c(s,"class","countdown svelte-qwtv9g"),c(v,"class","cancel-button svelte-qwtv9g"),c(e,"class","confirm-container svelte-qwtv9g")},m(y,h){w(y,e,h),i(e,t),i(e,n),i(e,s),i(s,r),i(s,o),i(s,a),i(s,f),i(s,p),i(e,m),i(e,v),_||(g=M(v,"click",l[8]),_=!0)},p(y,h){h&8&&j(o,y[3]),h&8&&u!==(u=y[3]!==1?"s":"")&&j(f,u)},i:Q,o:Q,d(y){y&&k(e),_=!1,g()}}}function Rr(l){let e,t,n,s,r;t=new Ve({});function o(f,p){return f[5]?Ur:Mr}let a=o(l),u=a(l);return{c(){e=d("div"),de(t.$$.fragment),n=b(),s=d("div"),u.c(),c(s,"class","rebooting-text svelte-qwtv9g"),c(e,"class","rebooting-container svelte-qwtv9g")},m(f,p){w(f,e,p),ce(t,e,null),i(e,n),i(e,s),u.m(s,null),r=!0},p(f,p){a!==(a=o(f))&&(u.d(1),u=a(f),u&&(u.c(),u.m(s,null)))},i(f){r||(J(t.$$.fragment,f),r=!0)},o(f){K(t.$$.fragment,f),r=!1},d(f){f&&k(e),ue(t),u.d()}}}function Mr(l){let e;return{c(){e=A("Rebooting device...")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ur(l){let e;return{c(){e=A("Waiting for device to come back online...")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Dr(l){let e,t,n,s,r,o;const a=[Rr,Nr,Pr],u=[];function f(p,m){return p[4]?0:p[2]?1:2}return n=f(l),s=u[n]=a[n](l),{c(){e=d("h2"),e.textContent="Device Reboot",t=b(),s.c(),r=Le(),c(e,"class","svelte-qwtv9g")},m(p,m){w(p,e,m),w(p,t,m),u[n].m(p,m),w(p,r,m),o=!0},p(p,m){let v=n;n=f(p),n===v?u[n].p(p,m):(we(),K(u[v],1,1,()=>{u[v]=null}),Ce(),s=u[n],s?s.p(p,m):(s=u[n]=a[n](p),s.c()),J(s,1),s.m(r.parentNode,r))},i(p){o||(J(s),o=!0)},o(p){K(s),o=!1},d(p){p&&(k(e),k(t),k(r)),u[n].d(p)}}}function jr(l){let e;return{c(){e=d("p"),e.textContent="No version information available",c(e,"class","placeholder-text svelte-qwtv9g")},m(t,n){w(t,e,n)},p:Q,d(t){t&&k(e)}}}function Hr(l){let e,t,n,s,r,o=(l[0].firmwareVersion||"Unknown")+"",a,u,f,p,m,v,_=ut(l[0].firmwareUpdateTime)+"",g,y,h,L,E,C,S,I=ut(l[0].filesystemUpdateTime)+"",P,q,T=l[0].filesystemVersion&&Dl(l),F=l[0].sdkVersion&&jl(l);return{c(){e=d("div"),t=d("div"),n=d("div"),n.textContent="Sketch Version:",s=b(),r=d("div"),a=A(o),u=b(),f=d("div"),p=d("div"),p.textContent="Last Firmware Update:",m=b(),v=d("div"),g=A(_),y=b(),T&&T.c(),h=b(),L=d("div"),E=d("div"),E.textContent="Last Filesystem Update:",C=b(),S=d("div"),P=A(I),q=b(),F&&F.c(),c(n,"class","history-label svelte-qwtv9g"),c(r,"class","history-value svelte-qwtv9g"),c(t,"class","history-item svelte-qwtv9g"),c(p,"class","timestamp-label svelte-qwtv9g"),c(v,"class","timestamp-value svelte-qwtv9g"),c(f,"class","timestamp-item svelte-qwtv9g"),c(E,"class","timestamp-label svelte-qwtv9g"),c(S,"class","timestamp-value svelte-qwtv9g"),c(L,"class","timestamp-item svelte-qwtv9g"),c(e,"class","update-history svelte-qwtv9g")},m(R,O){w(R,e,O),i(e,t),i(t,n),i(t,s),i(t,r),i(r,a),i(e,u),i(e,f),i(f,p),i(f,m),i(f,v),i(v,g),i(e,y),T&&T.m(e,null),i(e,h),i(e,L),i(L,E),i(L,C),i(L,S),i(S,P),i(e,q),F&&F.m(e,null)},p(R,O){O&1&&o!==(o=(R[0].firmwareVersion||"Unknown")+"")&&j(a,o),O&1&&_!==(_=ut(R[0].firmwareUpdateTime)+"")&&j(g,_),R[0].filesystemVersion?T?T.p(R,O):(T=Dl(R),T.c(),T.m(e,h)):T&&(T.d(1),T=null),O&1&&I!==(I=ut(R[0].filesystemUpdateTime)+"")&&j(P,I),R[0].sdkVersion?F?F.p(R,O):(F=jl(R),F.c(),F.m(e,null)):F&&(F.d(1),F=null)},d(R){R&&k(e),T&&T.d(),F&&F.d()}}}function Dl(l){let e,t,n,s,r=l[0].filesystemVersion+"",o;return{c(){e=d("div"),t=d("div"),t.textContent="Svelte App Version:",n=b(),s=d("div"),o=A(r),c(t,"class","history-label svelte-qwtv9g"),c(s,"class","history-value svelte-qwtv9g"),c(e,"class","history-item svelte-qwtv9g")},m(a,u){w(a,e,u),i(e,t),i(e,n),i(e,s),i(s,o)},p(a,u){u&1&&r!==(r=a[0].filesystemVersion+"")&&j(o,r)},d(a){a&&k(e)}}}function jl(l){let e,t,n,s,r=l[0].sdkVersion+"",o;return{c(){e=d("div"),t=d("div"),t.textContent="ESP32 SDK:",n=b(),s=d("div"),o=A(r),c(t,"class","history-label svelte-qwtv9g"),c(s,"class","history-value svelte-qwtv9g"),c(e,"class","history-item svelte-qwtv9g")},m(a,u){w(a,e,u),i(e,t),i(e,n),i(e,s),i(s,o)},p(a,u){u&1&&r!==(r=a[0].sdkVersion+"")&&j(o,r)},d(a){a&&k(e)}}}function zr(l){let e,t,n;function s(a,u){return a[0]?Hr:jr}let r=s(l),o=r(l);return{c(){e=d("h2"),e.textContent="Version Information",t=b(),o.c(),n=Le(),c(e,"class","svelte-qwtv9g")},m(a,u){w(a,e,u),w(a,t,u),o.m(a,u),w(a,n,u)},p(a,u){r===(r=s(a))&&o?o.p(a,u):(o.d(1),o=r(a),o&&(o.c(),o.m(n.parentNode,n)))},d(a){a&&(k(e),k(t),k(n)),o.d(a)}}}function Vr(l){let e,t,n,s,r,o;const a=[Fr,qr],u=[];function f(p,m){return p[1]?0:1}return s=f(l),r=u[s]=a[s](l),{c(){e=d("div"),t=d("h1"),t.textContent="Firmware & Updates",n=b(),r.c(),c(t,"class","svelte-qwtv9g"),c(e,"class","firmware-container svelte-qwtv9g")},m(p,m){w(p,e,m),i(e,t),i(e,n),u[s].m(e,null),o=!0},p(p,[m]){let v=s;s=f(p),s===v?u[s].p(p,m):(we(),K(u[v],1,1,()=>{u[v]=null}),Ce(),r=u[s],r?r.p(p,m):(r=u[s]=a[s](p),r.c()),J(r,1),r.m(e,null))},i(p){o||(J(r),o=!0)},o(p){K(r),o=!1},d(p){p&&k(e),u[s].d()}}}function Br(){window.open("/update","_blank")}function vt(l){return l?`${(l/(1024*1024)).toFixed(2)} MB`:"N/A"}function Hl(l){return l?`${l} MHz`:"N/A"}function ut(l){return!l||l===0?"Never":new Date(l*1e3).toLocaleString()}function Wr(l,e,t){let n=null,s=!0,r=!1,o=0,a=!1,u=!1,f=!1,p=null,m=null,v=null;ze(async()=>{await _(),v=setInterval(async()=>{!a&&!r&&await _()},3e4)}),ot(()=>{p&&clearInterval(p),m&&clearInterval(m),v&&clearInterval(v)});async function _(){t(1,s=!0);try{t(0,n=await dn())}catch(E){console.warn("Failed to load system info:",E),t(0,n=null)}finally{t(1,s=!1)}}function g(){t(2,r=!0),t(3,o=3),p=setInterval(()=>{t(3,o--,o),o<=0&&(clearInterval(p),p=null,h())},1e3)}function y(){t(2,r=!1),p&&(clearInterval(p),p=null),t(3,o=0)}async function h(){t(2,r=!1),t(4,a=!0);try{await pn()}catch{}setTimeout(()=>{t(5,u=!0),L()},5e3)}function L(){m=setInterval(async()=>{try{(await fetch("/status",{method:"GET",cache:"no-cache"})).ok&&(clearInterval(m),m=null,t(5,u=!1),t(4,a=!1),t(6,f=!0),await _(),setTimeout(()=>{t(6,f=!1)},5e3))}catch{}},2e3)}return[n,s,r,o,a,u,f,g,y]}class zl extends Ae{constructor(e){super(),Ee(this,e,Wr,Vr,Se,{})}}function Vl(l){let e,t;return{c(){e=d("div"),t=A(l[2]),c(e,"class","message svelte-1gg1mca"),z(e,"success",l[3]==="success"),z(e,"error",l[3]==="error")},m(n,s){w(n,e,s),i(e,t)},p(n,s){s&4&&j(t,n[2]),s&8&&z(e,"success",n[3]==="success"),s&8&&z(e,"error",n[3]==="error")},d(n){n&&k(e)}}}function Gr(l){let e,t,n,s,r,o=l[0]?"â³":l[4]?"ðŸ”„":"ðŸ””",a,u,f=l[4]?"Reset Alert":"Test Alert",p,m,v,_=l[1]?"â³":"âš™ï¸",g,y,h,L,E,C=l[2]&&Vl(l);return{c(){e=d("div"),t=d("p"),t.textContent="Press a button to simulate an event or just fire the servo.",n=b(),s=d("div"),r=d("button"),a=A(o),u=b(),p=A(f),m=b(),v=d("button"),g=A(_),y=A(" Test Servo"),h=b(),C&&C.c(),c(t,"class","description svelte-1gg1mca"),c(r,"class","btn test-alert-btn svelte-1gg1mca"),r.disabled=l[0],z(r,"alert-active",l[4]),c(v,"class","btn test-servo-btn svelte-1gg1mca"),v.disabled=l[1],c(s,"class","button-group svelte-1gg1mca"),c(e,"class","content svelte-1gg1mca")},m(S,I){w(S,e,I),i(e,t),i(e,n),i(e,s),i(s,r),i(r,a),i(r,u),i(r,p),i(s,m),i(s,v),i(v,g),i(v,y),i(e,h),C&&C.m(e,null),L||(E=[M(r,"click",l[5]),M(v,"click",l[6])],L=!0)},p(S,I){I&17&&o!==(o=S[0]?"â³":S[4]?"ðŸ”„":"ðŸ””")&&j(a,o),I&16&&f!==(f=S[4]?"Reset Alert":"Test Alert")&&j(p,f),I&1&&(r.disabled=S[0]),I&16&&z(r,"alert-active",S[4]),I&2&&_!==(_=S[1]?"â³":"âš™ï¸")&&j(g,_),I&2&&(v.disabled=S[1]),S[2]?C?C.p(S,I):(C=Vl(S),C.c(),C.m(e,null)):C&&(C.d(1),C=null)},d(S){S&&k(e),C&&C.d(),L=!1,_e(E)}}}function Jr(l){let e,t,n,s,r;return s=new Te({props:{title:"",$$slots:{default:[Gr]},$$scope:{ctx:l}}}),{c(){e=d("div"),t=d("h1"),t.textContent="Test Alert",n=b(),de(s.$$.fragment),c(t,"class","svelte-1gg1mca"),c(e,"class","page svelte-1gg1mca")},m(o,a){w(o,e,a),i(e,t),i(e,n),ce(s,e,null),r=!0},p(o,[a]){const u={};a&543&&(u.$$scope={dirty:a,ctx:o}),s.$set(u)},i(o){r||(J(s.$$.fragment,o),r=!0)},o(o){K(s.$$.fragment,o),r=!1},d(o){o&&k(e),ue(s)}}}function Qr(l,e,t){let n=!1,s=!1,r="",o="",a=!1,u=null;async function f(){try{const v=await It();t(4,a=v.detectionState||!1)}catch(v){console.error("Failed to check alert status:",v)}}async function p(){t(0,n=!0),t(2,r=""),t(3,o="");try{if(a)await bs(),t(2,r="âœ… Alert reset successfully"),t(3,o="success"),t(4,a=!1);else{const v=await _s();t(2,r=v||"âœ… Test alert started â€“ check /gallery or /captures"),t(3,o="success"),t(4,a=!0)}}catch(v){t(2,r=`Error: ${v.message||(a?"Failed to reset alert":"Failed to trigger test alert")}`),t(3,o="error")}finally{t(0,n=!1),f()}}async function m(){t(1,s=!0),t(2,r=""),t(3,o="");try{await vs(),t(2,r="Servo triggered"),t(3,o="success")}catch(v){t(2,r=`Error: ${v.message||"Failed to trigger servo"}`),t(3,o="error")}finally{t(1,s=!1)}}return ze(()=>{f(),u=setInterval(f,2e3)}),ot(()=>{u&&clearInterval(u)}),[n,s,r,o,a,p,m]}class Kr extends Ae{constructor(e){super(),Ee(this,e,Qr,Jr,Se,{})}}function Bl(l,e,t){const n=l.slice();return n[46]=e[t],n}function Wl(l,e,t){const n=l.slice();return n[49]=e[t],n}function Gl(l){let e,t;return{c(){e=d("div"),t=d("div"),c(t,"class","progress-fill svelte-tcl4u7"),Ge(t,"width",l[7]/(ts-1)*100+"%"),c(e,"class","progress-bar svelte-tcl4u7")},m(n,s){w(n,e,s),i(e,t)},p(n,s){s[0]&128&&Ge(t,"width",n[7]/(ts-1)*100+"%")},d(n){n&&k(e)}}}function Jl(l){let e,t,n,s,r,o,a,u,f,p,m,v,_,g,y,h,L,E,C;const S=[Zr,Yr],I=[];function P(q,T){return q[8]?0:1}return f=P(l),p=I[f]=S[f](l),{c(){e=d("div"),t=d("div"),t.innerHTML='<span class="mouse-emoji svelte-tcl4u7" role="img" aria-label="mouse">ðŸ</span>',n=b(),s=d("h1"),s.textContent="MouseTrap Setup",r=b(),o=d("p"),o.textContent="Let's get your device connected and ready to protect your home.",a=b(),u=d("button"),p.c(),m=b(),v=d("div"),_=d("button"),g=A("Standalone Mode (Local Only)"),y=b(),h=d("p"),h.textContent="Connect to WiFi without cloud registration",c(t,"class","welcome-icon svelte-tcl4u7"),c(s,"class","svelte-tcl4u7"),c(o,"class","welcome-text svelte-tcl4u7"),c(u,"class","btn-primary btn-large svelte-tcl4u7"),u.disabled=l[8],c(_,"class","btn-link svelte-tcl4u7"),_.disabled=l[8],c(h,"class","standalone-hint svelte-tcl4u7"),c(v,"class","standalone-option svelte-tcl4u7"),c(e,"class","step welcome-step svelte-tcl4u7")},m(q,T){w(q,e,T),i(e,t),i(e,n),i(e,s),i(e,r),i(e,o),i(e,a),i(e,u),I[f].m(u,null),i(e,m),i(e,v),i(v,_),i(_,g),i(v,y),i(v,h),L=!0,E||(C=[M(u,"click",l[28]),M(_,"click",l[26])],E=!0)},p(q,T){let F=f;f=P(q),f!==F&&(we(),K(I[F],1,1,()=>{I[F]=null}),Ce(),p=I[f],p||(p=I[f]=S[f](q),p.c()),J(p,1),p.m(u,null)),(!L||T[0]&256)&&(u.disabled=q[8]),(!L||T[0]&256)&&(_.disabled=q[8])},i(q){L||(J(p),L=!0)},o(q){K(p),L=!1},d(q){q&&k(e),I[f].d(),E=!1,_e(C)}}}function Yr(l){let e,t;return{c(){e=A("Get Started "),t=d("span"),t.textContent="â†’",c(t,"class","arrow svelte-tcl4u7")},m(n,s){w(n,e,s),w(n,t,s)},i:Q,o:Q,d(n){n&&(k(e),k(t))}}}function Zr(l){let e,t,n;return e=new Ve({props:{size:"small"}}),{c(){de(e.$$.fragment),t=A(" Loading...")},m(s,r){ce(e,s,r),w(s,t,r),n=!0},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){K(e.$$.fragment,s),n=!1},d(s){s&&k(t),ue(e,s)}}}function Ql(l){let e,t,n,s,r,o,a,u,f,p,m,v,_,g;const y=[xr,$r,Xr],h=[];function L(I,P){return I[11]?0:I[10]||I[9].length===0?1:2}s=L(l),r=h[s]=y[s](l);const E=[so,lo],C=[];function S(I,P){return I[16]?0:1}return p=S(l),m=C[p]=E[p](l),{c(){e=d("div"),t=d("h2"),t.textContent="Select your WiFi network",n=b(),r.c(),o=b(),a=d("div"),u=d("button"),u.innerHTML='<span class="arrow svelte-tcl4u7">â†</span> Back',f=b(),m.c(),c(t,"class","svelte-tcl4u7"),c(u,"class","btn-secondary svelte-tcl4u7"),c(a,"class","button-row svelte-tcl4u7"),c(e,"class","step wifi-step svelte-tcl4u7")},m(I,P){w(I,e,P),i(e,t),i(e,n),h[s].m(e,null),i(e,o),i(e,a),i(a,u),i(a,f),C[p].m(a,null),v=!0,_||(g=M(u,"click",l[36]),_=!0)},p(I,P){let q=s;s=L(I),s===q?h[s].p(I,P):(we(),K(h[q],1,1,()=>{h[q]=null}),Ce(),r=h[s],r?r.p(I,P):(r=h[s]=y[s](I),r.c()),J(r,1),r.m(e,o));let T=p;p=S(I),p===T?C[p].p(I,P):(we(),K(C[T],1,1,()=>{C[T]=null}),Ce(),m=C[p],m?m.p(I,P):(m=C[p]=E[p](I),m.c()),J(m,1),m.m(a,null))},i(I){v||(J(r),J(m),v=!0)},o(I){K(r),K(m),v=!1},d(I){I&&k(e),h[s].d(),C[p].d(),_=!1,g()}}}function Xr(l){let e,t,n,s,r=l[0]==="manual"?"â—‰":"â—‹",o,a,u,f,p,m,v,_,g,y,h,L=l[12]?"Hide":"Show",E,C,S,I=l[2].length+"",P,q,T,F,R=Re(l[9]),O=[];for(let D=0;D<R.length;D+=1)O[D]=Kl(Wl(l,R,D));let U=l[0]==="manual"&&Yl(l);function B(D,G){return D[12]?to:eo}let N=B(l),V=N(l);return{c(){e=d("div");for(let D=0;D<O.length;D+=1)O[D].c();t=b(),n=d("button"),s=d("span"),o=A(r),a=b(),u=d("span"),u.textContent="Enter manually...",f=b(),U&&U.c(),p=b(),m=d("div"),v=d("label"),v.textContent="Password",_=b(),g=d("div"),V.c(),y=b(),h=d("button"),E=A(L),C=b(),S=d("p"),P=A(I),q=A("/8 characters minimum"),c(s,"class","network-radio svelte-tcl4u7"),c(u,"class","network-name svelte-tcl4u7"),c(n,"class","network-item manual-entry svelte-tcl4u7"),z(n,"selected",l[0]==="manual"),c(e,"class","network-list svelte-tcl4u7"),c(v,"for","wifi-password"),c(v,"class","svelte-tcl4u7"),c(h,"type","button"),c(h,"class","toggle-password svelte-tcl4u7"),c(g,"class","password-input-group svelte-tcl4u7"),c(S,"class","field-hint svelte-tcl4u7"),z(S,"valid",l[2].length>=8),c(m,"class","form-group svelte-tcl4u7")},m(D,G){w(D,e,G);for(let Y=0;Y<O.length;Y+=1)O[Y]&&O[Y].m(e,null);i(e,t),i(e,n),i(n,s),i(s,o),i(n,a),i(n,u),w(D,f,G),U&&U.m(D,G),w(D,p,G),w(D,m,G),i(m,v),i(m,_),i(m,g),V.m(g,null),i(g,y),i(g,h),i(h,E),i(m,C),i(m,S),i(S,P),i(S,q),T||(F=[M(n,"click",l[31]),M(h,"click",l[35])],T=!0)},p(D,G){if(G[0]&4194817){R=Re(D[9]);let Y;for(Y=0;Y<R.length;Y+=1){const $=Wl(D,R,Y);O[Y]?O[Y].p($,G):(O[Y]=Kl($),O[Y].c(),O[Y].m(e,t))}for(;Y<O.length;Y+=1)O[Y].d(1);O.length=R.length}G[0]&1&&r!==(r=D[0]==="manual"?"â—‰":"â—‹")&&j(o,r),G[0]&1&&z(n,"selected",D[0]==="manual"),D[0]==="manual"?U?U.p(D,G):(U=Yl(D),U.c(),U.m(p.parentNode,p)):U&&(U.d(1),U=null),N===(N=B(D))&&V?V.p(D,G):(V.d(1),V=N(D),V&&(V.c(),V.m(g,y))),G[0]&4096&&L!==(L=D[12]?"Hide":"Show")&&j(E,L),G[0]&4&&I!==(I=D[2].length+"")&&j(P,I),G[0]&4&&z(S,"valid",D[2].length>=8)},i:Q,o:Q,d(D){D&&(k(e),k(f),k(p),k(m)),Ye(O,D),U&&U.d(D),V.d(),T=!1,_e(F)}}}function $r(l){let e,t,n=(l[10]||"No networks found")+"",s,r,o,a,u,f,p;return{c(){e=d("div"),t=d("p"),s=A(n),r=b(),o=d("button"),o.textContent="Retry Scan",a=b(),u=d("p"),u.textContent="Tap Retry to scan again. This may take 10-15 seconds.",c(t,"class","svelte-tcl4u7"),c(o,"class","btn-primary svelte-tcl4u7"),c(u,"class","hint svelte-tcl4u7"),c(e,"class","error-box svelte-tcl4u7")},m(m,v){w(m,e,v),i(e,t),i(t,s),i(e,r),i(e,o),i(e,a),i(e,u),f||(p=M(o,"click",l[29]),f=!0)},p(m,v){v[0]&1024&&n!==(n=(m[10]||"No networks found")+"")&&j(s,n)},i:Q,o:Q,d(m){m&&k(e),f=!1,p()}}}function xr(l){let e,t,n,s,r;return t=new Ve({}),{c(){e=d("div"),de(t.$$.fragment),n=b(),s=d("p"),s.textContent="Scanning for networks...",c(e,"class","loading-container svelte-tcl4u7")},m(o,a){w(o,e,a),ce(t,e,null),i(e,n),i(e,s),r=!0},p:Q,i(o){r||(J(t.$$.fragment,o),r=!0)},o(o){K(t.$$.fragment,o),r=!1},d(o){o&&k(e),ue(t)}}}function Kl(l){let e,t,n=l[0]===l[49].ssid?"â—‰":"â—‹",s,r,o,a=l[49].ssid+"",u,f,p,m,v,_,g=ss(ls(l[49].rssi))+"",y,h,L;function E(){return l[30](l[49])}return{c(){e=d("button"),t=d("span"),s=A(n),r=b(),o=d("span"),u=A(a),f=b(),p=d("span"),m=d("span"),m.textContent="ðŸ“¶",v=b(),_=d("span"),y=A(g),c(t,"class","network-radio svelte-tcl4u7"),c(o,"class","network-name svelte-tcl4u7"),c(m,"class","signal-label svelte-tcl4u7"),c(_,"class","signal-bars svelte-tcl4u7"),c(p,"class","signal-icon svelte-tcl4u7"),c(p,"title","Signal strength"),c(e,"class","network-item svelte-tcl4u7"),z(e,"selected",l[0]===l[49].ssid)},m(C,S){w(C,e,S),i(e,t),i(t,s),i(e,r),i(e,o),i(o,u),i(e,f),i(e,p),i(p,m),i(p,v),i(p,_),i(_,y),h||(L=M(e,"click",E),h=!0)},p(C,S){l=C,S[0]&513&&n!==(n=l[0]===l[49].ssid?"â—‰":"â—‹")&&j(s,n),S[0]&512&&a!==(a=l[49].ssid+"")&&j(u,a),S[0]&512&&g!==(g=ss(ls(l[49].rssi))+"")&&j(y,g),S[0]&513&&z(e,"selected",l[0]===l[49].ssid)},d(C){C&&k(e),h=!1,L()}}}function Yl(l){let e,t,n,s,r,o;return{c(){e=d("div"),t=d("label"),t.textContent="Network Name (SSID)",n=b(),s=d("input"),c(t,"for","manual-ssid"),c(t,"class","svelte-tcl4u7"),c(s,"id","manual-ssid"),c(s,"type","text"),c(s,"placeholder","Enter network name"),c(s,"autocomplete","off"),c(s,"class","svelte-tcl4u7"),c(e,"class","form-group svelte-tcl4u7")},m(a,u){w(a,e,u),i(e,t),i(e,n),i(e,s),le(s,l[1]),r||(o=M(s,"input",l[32]),r=!0)},p(a,u){u[0]&2&&s.value!==a[1]&&le(s,a[1])},d(a){a&&k(e),r=!1,o()}}}function eo(l){let e,t,n;return{c(){e=d("input"),c(e,"id","wifi-password"),c(e,"type","password"),c(e,"placeholder","Enter WiFi password"),c(e,"autocomplete","off"),c(e,"class","svelte-tcl4u7")},m(s,r){w(s,e,r),le(e,l[2]),t||(n=M(e,"input",l[34]),t=!0)},p(s,r){r[0]&4&&e.value!==s[2]&&le(e,s[2])},d(s){s&&k(e),t=!1,n()}}}function to(l){let e,t,n;return{c(){e=d("input"),c(e,"id","wifi-password"),c(e,"type","text"),c(e,"placeholder","Enter WiFi password"),c(e,"autocomplete","off"),c(e,"class","svelte-tcl4u7")},m(s,r){w(s,e,r),le(e,l[2]),t||(n=M(e,"input",l[33]),t=!0)},p(s,r){r[0]&4&&e.value!==s[2]&&le(e,s[2])},d(s){s&&k(e),t=!1,n()}}}function lo(l){let e,t,n,s,r,o;return{c(){e=d("button"),t=A("Next "),n=d("span"),n.textContent="â†’",c(n,"class","arrow svelte-tcl4u7"),c(e,"class","btn-primary svelte-tcl4u7"),e.disabled=s=!l[20]},m(a,u){w(a,e,u),i(e,t),i(e,n),r||(o=M(e,"click",l[37]),r=!0)},p(a,u){u[0]&1048576&&s!==(s=!a[20])&&(e.disabled=s)},i:Q,o:Q,d(a){a&&k(e),r=!1,o()}}}function so(l){let e,t,n,s,r,o,a;const u=[ro,no],f=[];function p(m,v){return m[17]?0:1}return t=p(l),n=f[t]=u[t](l),{c(){e=d("button"),n.c(),c(e,"class","btn-primary svelte-tcl4u7"),e.disabled=s=!l[20]||l[17]},m(m,v){w(m,e,v),f[t].m(e,null),r=!0,o||(a=M(e,"click",l[27]),o=!0)},p(m,v){let _=t;t=p(m),t!==_&&(we(),K(f[_],1,1,()=>{f[_]=null}),Ce(),n=f[t],n||(n=f[t]=u[t](m),n.c()),J(n,1),n.m(e,null)),(!r||v[0]&1179648&&s!==(s=!m[20]||m[17]))&&(e.disabled=s)},i(m){r||(J(n),r=!0)},o(m){K(n),r=!1},d(m){m&&k(e),f[t].d(),o=!1,a()}}}function no(l){let e;return{c(){e=A("Enable Standalone Mode")},m(t,n){w(t,e,n)},i:Q,o:Q,d(t){t&&k(e)}}}function ro(l){let e,t,n;return e=new Ve({props:{size:"small"}}),{c(){de(e.$$.fragment),t=A(" Enabling...")},m(s,r){ce(e,s,r),w(s,t,r),n=!0},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){K(e.$$.fragment,s),n=!1},d(s){s&&k(t),ue(e,s)}}}function Zl(l){let e,t,n,s,r,o,a,u=l[3]?"Create your account":"Sign in",f,p,m,v,_,g,y,h,L,E,C,S,I,P=l[13]?"Hide":"Show",q,T,F,R=l[5].length+"",O,U,B,N,V,D,G,Y,$,ie,ve,ne,re=l[3]?"Create & Activate":"Sign In & Activate",pe,ee,H,Z,x,ae;function ye(X,W){return X[13]?io:oo}let be=ye(l),se=be(l);return{c(){e=d("div"),t=d("div"),n=d("button"),n.textContent="Sign In",s=b(),r=d("button"),r.textContent="Create Account",o=b(),a=d("h2"),f=A(u),p=b(),m=d("div"),v=d("label"),v.textContent="Email",_=b(),g=d("input"),y=b(),h=d("div"),L=d("label"),L.textContent="Password",E=b(),C=d("div"),se.c(),S=b(),I=d("button"),q=A(P),T=b(),F=d("p"),O=A(R),U=A("/8 characters minimum"),B=b(),N=d("div"),V=d("label"),V.textContent="Name this device",D=b(),G=d("input"),Y=b(),$=d("div"),ie=d("button"),ie.innerHTML='<span class="arrow svelte-tcl4u7">â†</span> Back',ve=b(),ne=d("button"),pe=A(re),ee=b(),H=d("span"),H.textContent="â†’",c(n,"class","tab-btn svelte-tcl4u7"),z(n,"active",!l[3]),c(r,"class","tab-btn svelte-tcl4u7"),z(r,"active",l[3]),c(t,"class","account-tabs svelte-tcl4u7"),c(a,"class","svelte-tcl4u7"),c(v,"for","email"),c(v,"class","svelte-tcl4u7"),c(g,"id","email"),c(g,"type","email"),c(g,"placeholder","you@example.com"),c(g,"autocomplete","email"),c(g,"class","svelte-tcl4u7"),c(m,"class","form-group svelte-tcl4u7"),c(L,"for","account-password"),c(L,"class","svelte-tcl4u7"),c(I,"type","button"),c(I,"class","toggle-password svelte-tcl4u7"),c(C,"class","password-input-group svelte-tcl4u7"),c(F,"class","field-hint svelte-tcl4u7"),z(F,"valid",l[5].length>=8),c(h,"class","form-group svelte-tcl4u7"),c(V,"for","device-name"),c(V,"class","svelte-tcl4u7"),c(G,"id","device-name"),c(G,"type","text"),c(G,"placeholder","Kitchen"),c(G,"autocomplete","off"),c(G,"class","svelte-tcl4u7"),c(N,"class","form-group svelte-tcl4u7"),c(ie,"class","btn-secondary svelte-tcl4u7"),c(H,"class","arrow svelte-tcl4u7"),c(ne,"class","btn-primary svelte-tcl4u7"),ne.disabled=Z=!l[19],c($,"class","button-row svelte-tcl4u7"),c(e,"class","step account-step svelte-tcl4u7")},m(X,W){w(X,e,W),i(e,t),i(t,n),i(t,s),i(t,r),i(e,o),i(e,a),i(a,f),i(e,p),i(e,m),i(m,v),i(m,_),i(m,g),le(g,l[4]),i(e,y),i(e,h),i(h,L),i(h,E),i(h,C),se.m(C,null),i(C,S),i(C,I),i(I,q),i(h,T),i(h,F),i(F,O),i(F,U),i(e,B),i(e,N),i(N,V),i(N,D),i(N,G),le(G,l[6]),i(e,Y),i(e,$),i($,ie),i($,ve),i($,ne),i(ne,pe),i(ne,ee),i(ne,H),x||(ae=[M(n,"click",l[38]),M(r,"click",l[39]),M(g,"input",l[40]),M(I,"click",l[43]),M(G,"input",l[44]),M(ie,"click",l[45]),M(ne,"click",l[24])],x=!0)},p(X,W){W[0]&8&&z(n,"active",!X[3]),W[0]&8&&z(r,"active",X[3]),W[0]&8&&u!==(u=X[3]?"Create your account":"Sign in")&&j(f,u),W[0]&16&&g.value!==X[4]&&le(g,X[4]),be===(be=ye(X))&&se?se.p(X,W):(se.d(1),se=be(X),se&&(se.c(),se.m(C,S))),W[0]&8192&&P!==(P=X[13]?"Hide":"Show")&&j(q,P),W[0]&32&&R!==(R=X[5].length+"")&&j(O,R),W[0]&32&&z(F,"valid",X[5].length>=8),W[0]&64&&G.value!==X[6]&&le(G,X[6]),W[0]&8&&re!==(re=X[3]?"Create & Activate":"Sign In & Activate")&&j(pe,re),W[0]&524288&&Z!==(Z=!X[19])&&(ne.disabled=Z)},d(X){X&&k(e),se.d(),x=!1,_e(ae)}}}function oo(l){let e,t,n,s,r;return{c(){e=d("input"),c(e,"id","account-password"),c(e,"type","password"),c(e,"placeholder",t=l[3]?"Create a password":"Enter your password"),c(e,"autocomplete",n=l[3]?"new-password":"current-password"),c(e,"class","svelte-tcl4u7")},m(o,a){w(o,e,a),le(e,l[5]),s||(r=M(e,"input",l[42]),s=!0)},p(o,a){a[0]&8&&t!==(t=o[3]?"Create a password":"Enter your password")&&c(e,"placeholder",t),a[0]&8&&n!==(n=o[3]?"new-password":"current-password")&&c(e,"autocomplete",n),a[0]&32&&e.value!==o[5]&&le(e,o[5])},d(o){o&&k(e),s=!1,r()}}}function io(l){let e,t,n,s,r;return{c(){e=d("input"),c(e,"id","account-password"),c(e,"type","text"),c(e,"placeholder",t=l[3]?"Create a password":"Enter your password"),c(e,"autocomplete",n=l[3]?"new-password":"current-password"),c(e,"class","svelte-tcl4u7")},m(o,a){w(o,e,a),le(e,l[5]),s||(r=M(e,"input",l[41]),s=!0)},p(o,a){a[0]&8&&t!==(t=o[3]?"Create a password":"Enter your password")&&c(e,"placeholder",t),a[0]&8&&n!==(n=o[3]?"new-password":"current-password")&&c(e,"autocomplete",n),a[0]&32&&e.value!==o[5]&&le(e,o[5])},d(o){o&&k(e),s=!1,r()}}}function Xl(l){let e,t,n,s,r=Re(l[18]),o=[];for(let a=0;a<r.length;a+=1)o[a]=xl(Bl(l,r,a));return{c(){e=d("div"),t=d("h2"),t.textContent="Setting up your device...",n=b(),s=d("div");for(let a=0;a<o.length;a+=1)o[a].c();c(t,"class","svelte-tcl4u7"),c(s,"class","progress-list svelte-tcl4u7"),c(e,"class","step progress-step svelte-tcl4u7")},m(a,u){w(a,e,u),i(e,t),i(e,n),i(e,s);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(s,null)},p(a,u){if(u[0]&262144){r=Re(a[18]);let f;for(f=0;f<r.length;f+=1){const p=Bl(a,r,f);o[f]?o[f].p(p,u):(o[f]=xl(p),o[f].c(),o[f].m(s,null))}for(;f<o.length;f+=1)o[f].d(1);o.length=r.length}},d(a){a&&k(e),Ye(o,a)}}}function $l(l){let e;return{c(){e=d("span"),c(e,"class","progress-spinner svelte-tcl4u7")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function xl(l){let e,t,n=ns(l[46].status)+"",s,r,o,a=l[46].label+"",u,f,p,m=l[46].status==="in_progress"&&$l();return{c(){e=d("div"),t=d("span"),s=A(n),r=b(),o=d("span"),u=A(a),f=b(),m&&m.c(),p=b(),c(t,"class","progress-icon svelte-tcl4u7"),c(o,"class","progress-label svelte-tcl4u7"),c(e,"class","progress-item svelte-tcl4u7"),z(e,"completed",l[46].status==="completed"),z(e,"in-progress",l[46].status==="in_progress"),z(e,"failed",l[46].status==="failed")},m(v,_){w(v,e,_),i(e,t),i(t,s),i(e,r),i(e,o),i(o,u),i(e,f),m&&m.m(e,null),i(e,p)},p(v,_){_[0]&262144&&n!==(n=ns(v[46].status)+"")&&j(s,n),_[0]&262144&&a!==(a=v[46].label+"")&&j(u,a),v[46].status==="in_progress"?m||(m=$l(),m.c(),m.m(e,p)):m&&(m.d(1),m=null),_[0]&262144&&z(e,"completed",v[46].status==="completed"),_[0]&262144&&z(e,"in-progress",v[46].status==="in_progress"),_[0]&262144&&z(e,"failed",v[46].status==="failed")},d(v){v&&k(e),m&&m.d()}}}function es(l){let e;function t(r,o){return r[14]?co:ao}let n=t(l),s=n(l);return{c(){s.c(),e=Le()},m(r,o){s.m(r,o),w(r,e,o)},p(r,o){n===(n=t(r))&&s?s.p(r,o):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},d(r){r&&k(e),s.d(r)}}}function ao(l){let e,t,n,s,r,o,a,u,f,p,m;return{c(){e=d("div"),t=d("div"),t.innerHTML='<span role="img" aria-label="error">âŒ</span>',n=b(),s=d("h2"),s.textContent="Setup Failed",r=b(),o=d("p"),a=A(l[15]),u=b(),f=d("button"),f.textContent="Try Again",c(t,"class","result-icon error svelte-tcl4u7"),c(s,"class","svelte-tcl4u7"),c(o,"class","error-message svelte-tcl4u7"),c(f,"class","btn-primary btn-large svelte-tcl4u7"),c(e,"class","step error-step svelte-tcl4u7")},m(v,_){w(v,e,_),i(e,t),i(e,n),i(e,s),i(e,r),i(e,o),i(o,a),i(e,u),i(e,f),p||(m=M(f,"click",l[25]),p=!0)},p(v,_){_[0]&32768&&j(a,v[15])},d(v){v&&k(e),p=!1,m()}}}function co(l){let e,t,n;function s(a,u){return a[16]?fo:uo}let r=s(l),o=r(l);return{c(){e=d("div"),t=d("div"),t.innerHTML='<span role="img" aria-label="success">âœ…</span>',n=b(),o.c(),c(t,"class","result-icon success svelte-tcl4u7"),c(e,"class","step success-step svelte-tcl4u7")},m(a,u){w(a,e,u),i(e,t),i(e,n),o.m(e,null)},p(a,u){r===(r=s(a))&&o?o.p(a,u):(o.d(1),o=r(a),o&&(o.c(),o.m(e,null)))},d(a){a&&k(e),o.d()}}}function uo(l){let e,t,n,s,r,o,a,u,f,p;return{c(){e=d("h2"),e.textContent="You're all set!",t=b(),n=d("p"),s=A('Your device "'),r=A(l[6]),o=A('" is now connected and monitoring.'),a=b(),u=d("div"),u.innerHTML='<p class="svelte-tcl4u7">Access your dashboard at:</p> <a href="https://dashboard.mousetrap.com" class="dashboard-link svelte-tcl4u7" target="_blank" rel="noopener noreferrer">https://dashboard.mousetrap.com</a>',f=b(),p=d("p"),p.innerHTML=`This page will close automatically.<br/>
              Your device is now connected to your home WiFi.`,c(e,"class","svelte-tcl4u7"),c(n,"class","result-text svelte-tcl4u7"),c(u,"class","dashboard-link-box svelte-tcl4u7"),c(p,"class","auto-close-text svelte-tcl4u7")},m(m,v){w(m,e,v),w(m,t,v),w(m,n,v),i(n,s),i(n,r),i(n,o),w(m,a,v),w(m,u,v),w(m,f,v),w(m,p,v)},p(m,v){v[0]&64&&j(r,m[6])},d(m){m&&(k(e),k(t),k(n),k(a),k(u),k(f),k(p))}}}function fo(l){let e,t,n,s,r,o,a;return{c(){e=d("h2"),e.textContent="Standalone Mode Enabled",t=b(),n=d("p"),n.textContent="Device will reboot and connect to WiFi without cloud registration.",s=b(),r=d("div"),r.innerHTML='<p class="svelte-tcl4u7">After reboot, access the device at:</p> <p class="dashboard-link svelte-tcl4u7">http://192.168.4.1</p> <p class="hint-text svelte-tcl4u7">(Connect to the MouseTrap WiFi network first)</p>',o=b(),a=d("p"),a.innerHTML=`Device is rebooting...<br/>
              You can view system logs at /app/#/logs`,c(e,"class","svelte-tcl4u7"),c(n,"class","result-text svelte-tcl4u7"),c(r,"class","dashboard-link-box svelte-tcl4u7"),c(a,"class","auto-close-text svelte-tcl4u7")},m(u,f){w(u,e,f),w(u,t,f),w(u,n,f),w(u,s,f),w(u,r,f),w(u,o,f),w(u,a,f)},p:Q,d(u){u&&(k(e),k(t),k(n),k(s),k(r),k(o),k(a))}}}function po(l){let e,t,n,s,r,o,a,u,f=l[7]<5&&Gl(l),p=l[7]===1&&Jl(l),m=l[7]===2&&Ql(l),v=l[7]===3&&Zl(l),_=l[7]===4&&Xl(l),g=l[7]===5&&es(l);return{c(){e=d("div"),t=d("div"),f&&f.c(),n=b(),p&&p.c(),s=b(),m&&m.c(),r=b(),v&&v.c(),o=b(),_&&_.c(),a=b(),g&&g.c(),c(t,"class","setup-card svelte-tcl4u7"),c(e,"class","setup-container svelte-tcl4u7")},m(y,h){w(y,e,h),i(e,t),f&&f.m(t,null),i(t,n),p&&p.m(t,null),i(t,s),m&&m.m(t,null),i(t,r),v&&v.m(t,null),i(t,o),_&&_.m(t,null),i(t,a),g&&g.m(t,null),u=!0},p(y,h){y[7]<5?f?f.p(y,h):(f=Gl(y),f.c(),f.m(t,n)):f&&(f.d(1),f=null),y[7]===1?p?(p.p(y,h),h[0]&128&&J(p,1)):(p=Jl(y),p.c(),J(p,1),p.m(t,s)):p&&(we(),K(p,1,1,()=>{p=null}),Ce()),y[7]===2?m?(m.p(y,h),h[0]&128&&J(m,1)):(m=Ql(y),m.c(),J(m,1),m.m(t,r)):m&&(we(),K(m,1,1,()=>{m=null}),Ce()),y[7]===3?v?v.p(y,h):(v=Zl(y),v.c(),v.m(t,o)):v&&(v.d(1),v=null),y[7]===4?_?_.p(y,h):(_=Xl(y),_.c(),_.m(t,a)):_&&(_.d(1),_=null),y[7]===5?g?g.p(y,h):(g=es(y),g.c(),g.m(t,null)):g&&(g.d(1),g=null)},i(y){u||(J(p),J(m),u=!0)},o(y){K(p),K(m),u=!1},d(y){y&&k(e),f&&f.d(),p&&p.d(),m&&m.d(),v&&v.d(),_&&_.d(),g&&g.d()}}}const ts=5;function ls(l){return l>=-50?4:l>=-60?3:l>=-70?2:1}function ss(l){const e="â–ˆ",t="â–‘";let n="";for(let s=0;s<4;s++)n+=s<l?e:t;return n}function ns(l){switch(l){case"completed":return"âœ“";case"in_progress":return"â³";case"failed":return"âœ—";default:return"â—‹"}}function mo(l,e,t){let n,s,r,o=1,a=!1,u=[],f=null,p=!1,m=null,v="",_="",g=!1,y=!1,h="",L="",E=!1,C="",S=!1,I=null,P=!1,q=!1;ze(()=>{});async function T(X=!1){console.log("[SETUP] loadNetworks called, forceRescan="+X),t(11,p=!0),t(10,f=null),t(9,u=[]);try{console.log("[SETUP] About to call scanWiFiNetworks...");const W=await _n(X);console.log("[SETUP] scanWiFiNetworks returned:",JSON.stringify(W)),t(9,u=W.networks||[]),console.log("[SETUP] Networks set to:",u.length,"items"),u.length===0&&t(10,f="No networks found. Tap Retry to scan again.")}catch(W){console.error("[SETUP] Scan error:",W),console.error("[SETUP] Error details:",W.message,W.stack),t(10,f="Scan failed: "+(W.message||"Unknown error")),t(9,u=[])}finally{console.log("[SETUP] loadNetworks finished, setting networkLoading=false"),t(11,p=!1)}}function F(X){t(0,m=X),X!=="manual"&&t(1,v="")}async function R(X){t(8,a=!0);try{X===2&&await T(),t(7,o=X)}finally{t(8,a=!1)}}async function O(){t(7,o=4),t(14,S=!1),t(15,I=null);const X=m==="manual"?v:m;t(18,n=n.map(W=>W.id==="wifi"?{...W,status:"in_progress"}:W));try{await bn({ssid:X,password:_,email:h,accountPassword:L,deviceName:C,isNewAccount:y}),t(18,n=n.map(W=>W.id==="wifi"?{...W,status:"completed"}:W)),t(18,n=n.map(W=>W.id==="account"?{...W,status:"in_progress"}:W)),await new Promise(W=>setTimeout(W,1500)),t(18,n=n.map(W=>W.id==="account"?{...W,status:"completed"}:W)),t(18,n=n.map(W=>W.id==="activate"?{...W,status:"in_progress"}:W)),await new Promise(W=>setTimeout(W,2e3)),t(18,n=n.map(W=>W.id==="activate"?{...W,status:"completed"}:W)),t(14,S=!0),t(7,o=5)}catch(W){t(15,I=W.message||"Setup failed. Please try again."),t(18,n=n.map(he=>he.status==="in_progress"?{...he,status:"failed"}:he)),t(7,o=5)}}function U(){t(7,o=1),t(0,m=null),t(1,v=""),t(2,_=""),t(4,h=""),t(5,L=""),t(6,C=""),t(14,S=!1),t(15,I=null),t(18,n=[{id:"wifi",label:"Connecting to WiFi",status:"pending"},{id:"account",label:"Creating your account",status:"pending"},{id:"activate",label:"Activating device",status:"pending"}])}async function B(){t(16,P=!0),await R(2)}async function N(){t(17,q=!0),t(15,I=null);const X=m==="manual"?v:m;try{await hn({ssid:X,password:_}),t(14,S=!0),t(7,o=5)}catch(W){t(15,I=W.message||"Failed to enable standalone mode"),t(7,o=5),t(14,S=!1)}finally{t(17,q=!1)}}const V=()=>{t(16,P=!1),R(2)},D=()=>{console.log("[SETUP] Retry clicked!"),T(!0)},G=X=>F(X.ssid),Y=()=>F("manual");function $(){v=this.value,t(1,v)}function ie(){_=this.value,t(2,_)}function ve(){_=this.value,t(2,_)}const ne=()=>t(12,g=!g),re=()=>{t(7,o=1),t(16,P=!1)},pe=()=>t(7,o=3),ee=()=>t(3,y=!1),H=()=>t(3,y=!0);function Z(){h=this.value,t(4,h)}function x(){L=this.value,t(5,L)}function ae(){L=this.value,t(5,L)}const ye=()=>t(13,E=!E);function be(){C=this.value,t(6,C)}const se=()=>t(7,o=2);return l.$$.update=()=>{l.$$.dirty[0]&8&&t(18,n=[{id:"wifi",label:"Connecting to WiFi",status:"pending"},{id:"account",label:y?"Creating account":"Signing in",status:"pending"},{id:"activate",label:"Activating device",status:"pending"}]),l.$$.dirty[0]&7&&t(20,s=(m||v.trim())&&(m!=="manual"||v.trim())&&_.length>=8),l.$$.dirty[0]&112&&t(19,r=h.trim()&&L.length>=8&&C.trim())},[m,v,_,y,h,L,C,o,a,u,f,p,g,E,S,I,P,q,n,r,s,T,F,R,O,U,B,N,V,D,G,Y,$,ie,ve,ne,re,pe,ee,H,Z,x,ae,ye,be,se]}class vo extends Ae{constructor(e){super(),Ee(this,e,mo,po,Se,{},null,[-1,-1])}}function _o(l){let e,t;return e=new zs({props:{$$slots:{default:[ho]},$$scope:{ctx:l}}}),{c(){de(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p(n,s){const r={};s&18&&(r.$$scope={dirty:s,ctx:n}),e.$set(r)},i(n){t||(J(e.$$.fragment,n),t=!0)},o(n){K(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function bo(l){let e,t,n;var s=l[1];function r(o,a){return{}}return s&&(e=pt(s,r())),{c(){e&&de(e.$$.fragment),t=Le()},m(o,a){e&&ce(e,o,a),w(o,t,a),n=!0},p(o,a){if(a&2&&s!==(s=o[1])){if(e){we();const u=e;K(u.$$.fragment,1,0,()=>{ue(u,1)}),Ce()}s?(e=pt(s,r()),de(e.$$.fragment),J(e.$$.fragment,1),ce(e,t.parentNode,t)):e=null}},i(o){n||(e&&J(e.$$.fragment,o),n=!0)},o(o){e&&K(e.$$.fragment,o),n=!1},d(o){o&&k(t),e&&ue(e,o)}}}function ho(l){let e,t,n;var s=l[1];function r(o,a){return{}}return s&&(e=pt(s,r())),{c(){e&&de(e.$$.fragment),t=Le()},m(o,a){e&&ce(e,o,a),w(o,t,a),n=!0},p(o,a){if(a&2&&s!==(s=o[1])){if(e){we();const u=e;K(u.$$.fragment,1,0,()=>{ue(u,1)}),Ce()}s?(e=pt(s,r()),de(e.$$.fragment),J(e.$$.fragment,1),ce(e,t.parentNode,t)):e=null}},i(o){n||(e&&J(e.$$.fragment,o),n=!0)},o(o){e&&K(e.$$.fragment,o),n=!1},d(o){o&&k(t),e&&ue(e,o)}}}function go(l){let e,t,n,s;const r=[bo,_o],o=[];function a(u,f){return u[0]?0:1}return e=a(l),t=o[e]=r[e](l),{c(){t.c(),n=Le()},m(u,f){o[e].m(u,f),w(u,n,f),s=!0},p(u,[f]){let p=e;e=a(u),e===p?o[e].p(u,f):(we(),K(o[p],1,1,()=>{o[p]=null}),Ce(),t=o[e],t?t.p(u,f):(t=o[e]=r[e](u),t.c()),J(t,1),t.m(n.parentNode,n))},i(u){s||(J(t),s=!0)},o(u){K(t),s=!1},d(u){u&&k(n),o[e].d(u)}}}function ko(l,e,t){let n,s,r;dt(l,Ot,a=>t(2,r=a));function o(a){const u=a.startsWith("/")?a:"/"+a;return u==="/"||u===""?$t:u==="/gallery"?Qn:u==="/calibration"?Xn:u==="/servo"?tr:u==="/settings"?ur:u==="/logs"||u==="/status"?Fl:u==="/firmware"||u.startsWith("/reboot")?zl:u==="/test"?Kr:u==="/setup"?vo:$t}return l.$$.update=()=>{l.$$.dirty&4&&t(1,n=o(r)),l.$$.dirty&4&&t(0,s=r==="/setup"||r==="setup")},[s,n,r]}class wo extends Ae{constructor(e){super(),Ee(this,e,ko,go,Se,{})}}const rt=(...l)=>console.log("[JS]",...l);function rs(l){rt("app-main: FATAL",l);const e=document.getElementById("app");e&&e.childElementCount===0&&(e.innerHTML=`
      <div style="font: 14px system-ui, sans-serif; color:#ddd; background:#111; padding:16px; line-height:1.35">
        <div style="font-weight:600; margin-bottom:8px; color:#ff6b6b">âš ï¸ App failed to load</div>
        <div style="opacity:.85; margin-bottom:8px">Check console for full stack. Error:</div>
        <pre style="white-space:pre-wrap; background:#181818; border:1px solid #ff6b6b; padding:12px; border-radius:6px; overflow:auto; color:#ffcccc">
${String(l&&(l.stack||l.message)||l)}
        </pre>
      </div>`)}window.addEventListener("error",l=>rt("global-error:",l.message||l.error));window.addEventListener("unhandledrejection",l=>rt("unhandled-rejection:",l.reason));(function(){rt("app-main: start");const e=document.getElementById("app");if(!e){rs("Missing #app container in HTML");return}try{const t=new wo({target:e});window.__MOUSETRAP_APP={ok:!0,mountedAt:Date.now(),app:t},rt("app-main: mounted OK")}catch(t){window.__MOUSETRAP_APP={ok:!1,error:t,when:Date.now()},rs(t)}})();
