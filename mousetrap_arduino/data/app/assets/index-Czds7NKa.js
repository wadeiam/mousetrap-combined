var Ls=Object.defineProperty;var Fs=(l,e,t)=>e in l?Ls(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var gt=(l,e,t)=>Fs(l,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function V(){}function Es(l,e){for(const t in e)l[t]=e[t];return l}function As(l){return!!l&&(typeof l=="object"||typeof l=="function")&&typeof l.then=="function"}function ds(l){return l()}function Ut(){return Object.create(null)}function he(l){l.forEach(ds)}function _t(l){return typeof l=="function"}function Te(l,e){return l!=l?e==e:l!==e||l&&typeof l=="object"||typeof l=="function"}let ct;function lt(l,e){return l===e?!0:(ct||(ct=document.createElement("a")),ct.href=e,l===ct.href)}function Is(l){return Object.keys(l).length===0}function ps(l,...e){if(l==null){for(const n of e)n(void 0);return V}const t=l.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function dt(l,e,t){l.$$.on_destroy.push(ps(e,t))}function St(l,e,t,n){if(l){const s=ms(l,e,t,n);return l[0](s)}}function ms(l,e,t,n){return l[1]&&n?Es(t.ctx.slice(),l[1](n(e))):t.ctx}function yt(l,e,t,n){if(l[2]&&n){const s=l[2](n(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const r=[],i=Math.max(e.dirty.length,s.length);for(let c=0;c<i;c+=1)r[c]=e.dirty[c]|s[c];return r}return e.dirty|s}return e.dirty}function qt(l,e,t,n,s,r){if(s){const i=ms(e,t,n,r);l.p(i,s)}}function Tt(l){if(l.ctx.length>32){const e=[],t=l.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function je(l){return l&&_t(l.destroy)?l.destroy:V}const vs=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function o(l,e){l.appendChild(e)}function w(l,e,t){l.insertBefore(e,t||null)}function k(l){l.parentNode&&l.parentNode.removeChild(l)}function Je(l,e){for(let t=0;t<l.length;t+=1)l[t]&&l[t].d(e)}function d(l){return document.createElement(l)}function F(l){return document.createTextNode(l)}function b(){return F(" ")}function Ee(){return F("")}function R(l,e,t,n){return l.addEventListener(e,t,n),()=>l.removeEventListener(e,t,n)}function kt(l){return function(e){return e.preventDefault(),l.call(this,e)}}function _s(l){return function(e){return e.stopPropagation(),l.call(this,e)}}function a(l,e,t){t==null?l.removeAttribute(e):l.getAttribute(e)!==t&&l.setAttribute(e,t)}function Ps(l){let e;return{p(...t){e=t,e.forEach(n=>l.push(n))},r(){e.forEach(t=>l.splice(l.indexOf(t),1))}}}function ze(l){return l===""?null:+l}function Os(l){return Array.from(l.childNodes)}function j(l,e){e=""+e,l.data!==e&&(l.data=e)}function x(l,e){l.value=e??""}function Ge(l,e,t,n){t==null?l.style.removeProperty(e):l.style.setProperty(e,t,"")}function z(l,e,t){l.classList.toggle(e,!!t)}function pt(l,e){return new l(e)}let nt;function Ve(l){nt=l}function Et(){if(!nt)throw new Error("Function called outside component initialization");return nt}function Be(l){Et().$$.on_mount.push(l)}function it(l){Et().$$.on_destroy.push(l)}function Dt(l,e){const t=l.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const xe=[],et=[];let tt=[];const jt=[],Ns=Promise.resolve();let Lt=!1;function Ms(){Lt||(Lt=!0,Ns.then(At))}function Ft(l){tt.push(l)}const wt=new Set;let Xe=0;function At(){if(Xe!==0)return;const l=nt;do{try{for(;Xe<xe.length;){const e=xe[Xe];Xe++,Ve(e),Rs(e.$$)}}catch(e){throw xe.length=0,Xe=0,e}for(Ve(null),xe.length=0,Xe=0;et.length;)et.pop()();for(let e=0;e<tt.length;e+=1){const t=tt[e];wt.has(t)||(wt.add(t),t())}tt.length=0}while(xe.length);for(;jt.length;)jt.pop()();Lt=!1,wt.clear(),Ve(l)}function Rs(l){if(l.fragment!==null){l.update(),he(l.before_update);const e=l.dirty;l.dirty=[-1],l.fragment&&l.fragment.p(l.ctx,e),l.after_update.forEach(Ft)}}function Us(l){const e=[],t=[];tt.forEach(n=>l.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),tt=e}const ft=new Set;let Ye;function we(){Ye={r:0,c:[],p:Ye}}function Ce(){Ye.r||he(Ye.c),Ye=Ye.p}function H(l,e){l&&l.i&&(ft.delete(l),l.i(e))}function Q(l,e,t,n){if(l&&l.o){if(ft.has(l))return;ft.add(l),Ye.c.push(()=>{ft.delete(l),n&&(t&&l.d(1),n())}),l.o(e)}else n&&n()}function mt(l,e){const t=e.token={};function n(s,r,i,c){if(e.token!==t)return;e.resolved=c;let u=e.ctx;i!==void 0&&(u=u.slice(),u[i]=c);const f=s&&(e.current=s)(u);let p=!1;e.block&&(e.blocks?e.blocks.forEach((m,v)=>{v!==r&&m&&(we(),Q(m,1,1,()=>{e.blocks[v]===m&&(e.blocks[v]=null)}),Ce())}):e.block.d(1),f.c(),H(f,1),f.m(e.mount(),e.anchor),p=!0),e.block=f,e.blocks&&(e.blocks[r]=f),p&&At()}if(As(l)){const s=Et();if(l.then(r=>{Ve(s),n(e.then,1,e.value,r),Ve(null)},r=>{if(Ve(s),n(e.catch,2,e.error,r),Ve(null),!e.hasCatch)throw r}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,l),!0;e.resolved=l}}function bs(l,e,t){const n=e.slice(),{resolved:s}=l;l.current===l.then&&(n[l.value]=s),l.current===l.catch&&(n[l.error]=s),l.block.p(n,t)}function Fe(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function pe(l){l&&l.c()}function ce(l,e,t){const{fragment:n,after_update:s}=l.$$;n&&n.m(e,t),Ft(()=>{const r=l.$$.on_mount.map(ds).filter(_t);l.$$.on_destroy?l.$$.on_destroy.push(...r):he(r),l.$$.on_mount=[]}),s.forEach(Ft)}function ue(l,e){const t=l.$$;t.fragment!==null&&(Us(t.after_update),he(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Ds(l,e){l.$$.dirty[0]===-1&&(xe.push(l),Ms(),l.$$.dirty.fill(0)),l.$$.dirty[e/31|0]|=1<<e%31}function Ae(l,e,t,n,s,r,i=null,c=[-1]){const u=nt;Ve(l);const f=l.$$={fragment:null,ctx:[],props:r,update:V,not_equal:s,bound:Ut(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Ut(),dirty:c,skip_bound:!1,root:e.target||u.$$.root};i&&i(f.root);let p=!1;if(f.ctx=t?t(l,e.props||{},(m,v,..._)=>{const h=_.length?_[0]:v;return f.ctx&&s(f.ctx[m],f.ctx[m]=h)&&(!f.skip_bound&&f.bound[m]&&f.bound[m](h),p&&Ds(l,m)),v}):[],f.update(),p=!0,he(f.before_update),f.fragment=n?n(f.ctx):!1,e.target){if(e.hydrate){const m=Os(e.target);f.fragment&&f.fragment.l(m),m.forEach(k)}else f.fragment&&f.fragment.c();e.intro&&H(l.$$.fragment),ce(l,e.target,e.anchor),At()}Ve(u)}class Ie{constructor(){gt(this,"$$");gt(this,"$$set")}$destroy(){ue(this,1),this.$destroy=V}$on(e,t){if(!_t(t))return V;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const s=n.indexOf(t);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!Is(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const js="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(js);const $e=[];function Ws(l,e){return{subscribe:ot(l,e).subscribe}}function ot(l,e=V){let t;const n=new Set;function s(c){if(Te(l,c)&&(l=c,t)){const u=!$e.length;for(const f of n)f[1](),$e.push(f,l);if(u){for(let f=0;f<$e.length;f+=2)$e[f][0]($e[f+1]);$e.length=0}}}function r(c){s(c(l))}function i(c,u=V){const f=[c,u];return n.add(f),n.size===1&&(t=e(s,r)||V),c(l),()=>{n.delete(f),n.size===0&&t&&(t(),t=null)}}return{set:s,update:r,subscribe:i}}function hs(l,e,t){const n=!Array.isArray(l),s=n?[l]:l;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return Ws(t,(i,c)=>{let u=!1;const f=[];let p=0,m=V;const v=()=>{if(p)return;m();const h=e(n?f[0]:f,i,c);r?i(h):m=_t(h)?h:V},_=s.map((h,C)=>ps(h,g=>{f[C]=g,p&=~(1<<C),u&&v()},()=>{p|=1<<C}));return u=!0,v(),function(){he(_),m(),u=!1}})}const gs=ot({threshold:0,sensorReading:0,detectionState:!1,uptime:"",wifiRSSI:0,heap:0,psram:0,lastUpdate:null}),st=ot(!1);function Hs(l,e){const t=localStorage.getItem(l),n=t?JSON.parse(t):e,{subscribe:s,set:r,update:i}=ot(n);return{subscribe:s,set:c=>{localStorage.setItem(l,JSON.stringify(c)),r(c)},update:c=>{i(u=>{const f=c(u);return localStorage.setItem(l,JSON.stringify(f)),f})}}}Hs("mousetrap-prefs",{theme:"dark",refreshInterval:5e3});hs(gs,l=>l.detectionState);hs(gs,l=>l.lastUpdate?l.detectionState?"red":"green":"gray");const It=ot(window.location.hash.slice(1)||"/");window.addEventListener("hashchange",()=>{const l=window.location.hash.slice(1)||"/";It.set(l)});function zs(l){window.location.hash=l}function We(l){function e(t){const n=l.getAttribute("href");n&&n.startsWith("#/")&&(t.preventDefault(),zs(n.slice(1)))}return l.addEventListener("click",e),{destroy(){l.removeEventListener("click",e)}}}function Wt(l){let e,t,n,s,r,i,c,u,f,p;return{c(){e=d("div"),t=d("a"),t.textContent="WiFi Settings",n=b(),s=d("a"),s.textContent="Servo Settings",r=b(),i=d("a"),i.textContent="Calibration",c=b(),u=d("a"),u.textContent="Options & Access",a(t,"href","#/wifi"),a(t,"class","svelte-1n65rh9"),z(t,"active",l[0]==="/wifi"),a(s,"href","#/servo"),a(s,"class","svelte-1n65rh9"),z(s,"active",l[0]==="/servo"),a(i,"href","#/calibration"),a(i,"class","svelte-1n65rh9"),z(i,"active",l[0]==="/calibration"),a(u,"href","#/settings"),a(u,"class","svelte-1n65rh9"),z(u,"active",l[0]==="/settings"),a(e,"class","submenu svelte-1n65rh9")},m(m,v){w(m,e,v),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),o(e,c),o(e,u),f||(p=[je(We.call(null,t)),R(t,"click",l[5]),je(We.call(null,s)),R(s,"click",l[5]),je(We.call(null,i)),R(i,"click",l[5]),je(We.call(null,u)),R(u,"click",l[5])],f=!0)},p(m,v){v&1&&z(t,"active",m[0]==="/wifi"),v&1&&z(s,"active",m[0]==="/servo"),v&1&&z(i,"active",m[0]==="/calibration"),v&1&&z(u,"active",m[0]==="/settings")},d(m){m&&k(e),f=!1,he(p)}}}function Ht(l){let e,t,n,s,r,i,c,u;return{c(){e=d("div"),t=d("a"),t.textContent="Status",n=b(),s=d("a"),s.textContent="System Logs",r=b(),i=d("a"),i.textContent="Gallery",a(t,"href","#/status"),a(t,"class","svelte-1n65rh9"),z(t,"active",l[0]==="/status"),a(s,"href","#/logs"),a(s,"class","svelte-1n65rh9"),z(s,"active",l[0]==="/logs"),a(i,"href","#/gallery"),a(i,"class","svelte-1n65rh9"),z(i,"active",l[0]==="/gallery"),a(e,"class","submenu svelte-1n65rh9")},m(f,p){w(f,e,p),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),c||(u=[je(We.call(null,t)),R(t,"click",l[5]),je(We.call(null,s)),R(s,"click",l[5]),je(We.call(null,i)),R(i,"click",l[5])],c=!0)},p(f,p){p&1&&z(t,"active",f[0]==="/status"),p&1&&z(s,"active",f[0]==="/logs"),p&1&&z(i,"active",f[0]==="/gallery")},d(f){f&&k(e),c=!1,he(u)}}}function zt(l){let e,t,n,s,r,i,c,u,f,p;return{c(){e=d("div"),t=d("a"),t.textContent="Claim",n=b(),s=d("a"),s.textContent="Test Alert",r=b(),i=d("a"),i.textContent="Firmware / OTA",c=b(),u=d("a"),u.textContent="Reboot",a(t,"href","/claim"),a(t,"class","svelte-1n65rh9"),a(s,"href","#/test"),a(s,"class","svelte-1n65rh9"),z(s,"active",l[0]==="/test"),a(i,"href","#/firmware"),a(i,"class","svelte-1n65rh9"),z(i,"active",l[0]==="/firmware"),a(u,"href","#/reboot"),a(u,"class","svelte-1n65rh9"),z(u,"active",l[0].startsWith("/reboot")),a(e,"class","submenu svelte-1n65rh9")},m(m,v){w(m,e,v),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),o(e,c),o(e,u),f||(p=[R(t,"click",l[5]),je(We.call(null,s)),R(s,"click",l[5]),je(We.call(null,i)),R(i,"click",l[5]),je(We.call(null,u)),R(u,"click",l[5])],f=!0)},p(m,v){v&1&&z(s,"active",m[0]==="/test"),v&1&&z(i,"active",m[0]==="/firmware"),v&1&&z(u,"active",m[0].startsWith("/reboot"))},d(m){m&&k(e),f=!1,he(p)}}}function Bt(l){let e,t,n;return{c(){e=d("div"),a(e,"class","backdrop svelte-1n65rh9")},m(s,r){w(s,e,r),t||(n=R(e,"click",l[5]),t=!0)},p:V,d(s){s&&k(e),t=!1,n()}}}function Bs(l){let e,t,n,s,r,i,c,u,f,p,m,v,_,h,C,g,y,T,S,q,O,P=l[1]&&Wt(l),I=l[2]&&Ht(l),L=l[3]&&zt(l),E=l[4]&&Bt(l);return{c(){e=d("div"),t=d("a"),t.textContent="Home",n=b(),s=d("a"),r=F(`Settings
    `),i=d("span"),i.textContent="â–¸",c=b(),P&&P.c(),u=b(),f=d("a"),p=F(`Logs & Diagnostics
    `),m=d("span"),m.textContent="â–¸",v=b(),I&&I.c(),_=b(),h=d("a"),C=F(`Maintenance
    `),g=d("span"),g.textContent="â–¸",y=b(),L&&L.c(),T=b(),E&&E.c(),S=Ee(),a(t,"href","#/"),a(t,"class","svelte-1n65rh9"),z(t,"active",l[0]==="/"),a(i,"class","arrow svelte-1n65rh9"),z(i,"expanded",l[1]),a(s,"href","#"),a(s,"class","parent svelte-1n65rh9"),a(m,"class","arrow svelte-1n65rh9"),z(m,"expanded",l[2]),a(f,"href","#"),a(f,"class","parent svelte-1n65rh9"),a(g,"class","arrow svelte-1n65rh9"),z(g,"expanded",l[3]),a(h,"href","#"),a(h,"class","parent svelte-1n65rh9"),a(e,"class","menu svelte-1n65rh9"),z(e,"open",l[4])},m(N,A){w(N,e,A),o(e,t),o(e,n),o(e,s),o(s,r),o(s,i),o(e,c),P&&P.m(e,null),o(e,u),o(e,f),o(f,p),o(f,m),o(e,v),I&&I.m(e,null),o(e,_),o(e,h),o(h,C),o(h,g),o(e,y),L&&L.m(e,null),w(N,T,A),E&&E.m(N,A),w(N,S,A),q||(O=[je(We.call(null,t)),R(t,"click",l[5]),R(s,"click",kt(l[7])),R(f,"click",kt(l[8])),R(h,"click",kt(l[9]))],q=!0)},p(N,[A]){A&1&&z(t,"active",N[0]==="/"),A&2&&z(i,"expanded",N[1]),N[1]?P?P.p(N,A):(P=Wt(N),P.c(),P.m(e,u)):P&&(P.d(1),P=null),A&4&&z(m,"expanded",N[2]),N[2]?I?I.p(N,A):(I=Ht(N),I.c(),I.m(e,_)):I&&(I.d(1),I=null),A&8&&z(g,"expanded",N[3]),N[3]?L?L.p(N,A):(L=zt(N),L.c(),L.m(e,null)):L&&(L.d(1),L=null),A&16&&z(e,"open",N[4]),N[4]?E?E.p(N,A):(E=Bt(N),E.c(),E.m(S.parentNode,S)):E&&(E.d(1),E=null)},i:V,o:V,d(N){N&&(k(e),k(T),k(S)),P&&P.d(),I&&I.d(),L&&L.d(),E&&E.d(N),q=!1,he(O)}}}function Vs(l,e,t){let n,s;dt(l,It,_=>t(0,n=_)),dt(l,st,_=>t(4,s=_));let r=!1,i=!1,c=!1;function u(){st.set(!1)}function f(_){_==="settings"&&t(1,r=!r),_==="logs"&&t(2,i=!i),_==="maintenance"&&t(3,c=!c)}const p=()=>f("settings"),m=()=>f("logs"),v=()=>f("maintenance");return l.$$.update=()=>{if(l.$$.dirty&1){const _=n;t(1,r=_.startsWith("/servo")||_.startsWith("/calibration")||_.startsWith("/settings")||_.startsWith("/wifi")),t(2,i=_.startsWith("/logs")||_.startsWith("/status")||_.startsWith("/gallery")),t(3,c=_.startsWith("/claim")||_.startsWith("/test")||_.startsWith("/firmware")||_.startsWith("/reboot"))}},[n,r,i,c,s,u,f,p,m,v]}class Gs extends Ie{constructor(e){super(),Ae(this,e,Vs,Bs,Te,{})}}function Js(l){let e,t,n,s,r,i,c,u,f;s=new Gs({});const p=l[3].default,m=St(p,l,l[2],null);return{c(){e=d("div"),t=d("div"),t.innerHTML='<div class="bar svelte-1stvkey"></div> <div class="bar svelte-1stvkey"></div> <div class="bar svelte-1stvkey"></div>',n=b(),pe(s.$$.fragment),r=b(),i=d("main"),m&&m.c(),a(t,"class","hamburger svelte-1stvkey"),a(t,"role","button"),a(t,"tabindex","0"),a(t,"aria-label","Toggle navigation menu"),a(i,"class","content svelte-1stvkey"),a(e,"class","layout svelte-1stvkey")},m(v,_){w(v,e,_),o(e,t),o(e,n),ce(s,e,null),o(e,r),o(e,i),m&&m.m(i,null),c=!0,u||(f=[R(window,"keydown",l[1]),R(t,"click",l[0]),R(t,"keydown",l[4])],u=!0)},p(v,[_]){m&&m.p&&(!c||_&4)&&qt(m,p,v,v[2],c?yt(p,v[2],_,null):Tt(v[2]),null)},i(v){c||(H(s.$$.fragment,v),H(m,v),c=!0)},o(v){Q(s.$$.fragment,v),Q(m,v),c=!1},d(v){v&&k(e),ue(s),m&&m.d(v),u=!1,he(f)}}}function Qs(l,e,t){let n;dt(l,st,f=>t(5,n=f));let{$$slots:s={},$$scope:r}=e;function i(){st.update(f=>!f)}function c(f){f.key==="Escape"&&n&&st.set(!1)}const u=f=>f.key==="Enter"&&i();return l.$$set=f=>{"$$scope"in f&&t(2,r=f.$$scope)},[i,c,r,s,u]}class Ks extends Ie{constructor(e){super(),Ae(this,e,Qs,Js,Te,{})}}const Ys=l=>({}),Vt=l=>({});function Gt(l){let e,t;return{c(){e=d("h3"),t=F(l[0]),a(e,"class","card-title svelte-q6oxq0")},m(n,s){w(n,e,s),o(e,t)},p(n,s){s&1&&j(t,n[0])},d(n){n&&k(e)}}}function Zs(l){let e,t,n,s,r,i,c,u=l[0]&&Gt(l);const f=l[2].actions,p=St(f,l,l[1],Vt),m=l[2].default,v=St(m,l,l[1],null);return{c(){e=d("div"),t=d("div"),u&&u.c(),n=b(),s=d("div"),p&&p.c(),r=b(),i=d("div"),v&&v.c(),a(s,"class","card-actions svelte-q6oxq0"),a(t,"class","card-header svelte-q6oxq0"),a(i,"class","card-content svelte-q6oxq0"),a(e,"class","card svelte-q6oxq0")},m(_,h){w(_,e,h),o(e,t),u&&u.m(t,null),o(t,n),o(t,s),p&&p.m(s,null),o(e,r),o(e,i),v&&v.m(i,null),c=!0},p(_,[h]){_[0]?u?u.p(_,h):(u=Gt(_),u.c(),u.m(t,n)):u&&(u.d(1),u=null),p&&p.p&&(!c||h&2)&&qt(p,f,_,_[1],c?yt(f,_[1],h,Ys):Tt(_[1]),Vt),v&&v.p&&(!c||h&2)&&qt(v,m,_,_[1],c?yt(m,_[1],h,null):Tt(_[1]),null)},i(_){c||(H(p,_),H(v,_),c=!0)},o(_){Q(p,_),Q(v,_),c=!1},d(_){_&&k(e),u&&u.d(),p&&p.d(_),v&&v.d(_)}}}function Xs(l,e,t){let{$$slots:n={},$$scope:s}=e,{title:r=""}=e;return l.$$set=i=>{"title"in i&&t(0,r=i.title),"$$scope"in i&&t(1,s=i.$$scope)},[r,s,n]}class qe extends Ie{constructor(e){super(),Ae(this,e,Xs,Zs,Te,{title:0})}}function $s(){const l=window.location.origin;return l.includes("192.168.")||l.includes("localhost")||l.includes("mousetrap.local")?l:(console.log("[API] Captive portal detected, using 192.168.4.1 instead of:",l),"http://192.168.4.1")}const ks=$s();async function ve(l,e={}){try{const t=`${ks}${l}`;console.log(`[API] Fetching: ${t}`);const n={Accept:"application/json",...e.headers};e.body&&["POST","PUT","PATCH"].includes((e.method||"GET").toUpperCase())&&(n["Content-Type"]="application/json");const s=await fetch(t,{...e,headers:n});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=s.headers.get("content-type");return r&&r.includes("application/json")?await s.json():r&&r.includes("image/")?await s.blob():await s.text()}catch(t){throw console.error(`API Error [${l}]:`,t),t}}async function Pt(){try{const[l,e]=await Promise.all([ve("/data"),ve("/systemStatus").catch(()=>null)]);return{threshold:l.threshold||0,sensorReading:l.currentHourAverage||0,detectionState:l.triggered||!1,uptime:(e==null?void 0:e.uptime)||"",heap:(e==null?void 0:e.heapFree)||0,anomalies:l.anomalies||[],calibrationOffset:l.calibrationOffset||0,falseAlarmOffset:l.falseAlarmOffset||0,overrideThreshold:l.overrideThreshold||0}}catch{const e=await ve("/data");return{threshold:e.threshold||0,sensorReading:e.currentHourAverage||0,detectionState:e.triggered||!1,uptime:"",heap:0,anomalies:e.anomalies||[],calibrationOffset:e.calibrationOffset||0,falseAlarmOffset:e.falseAlarmOffset||0,overrideThreshold:e.overrideThreshold||0}}}async function xs(){return ve("/toggleLED")}async function en(){return ve("/api/captures")}function Jt(l){return`${ks}/captures/${l}`}async function tn(l){return ve(`/captures/${l}`,{method:"DELETE"})}async function ln(l){return ve(`/setCalib?calib=${l}`)}async function sn(l){return ve(`/setCalib?overrideTh=${l}`)}async function nn(){return ve("/setCalib?overrideTh=0")}async function rn(){return ve("/recalib")}async function on(){return ve("/falseAlarm")}async function an(){return Promise.resolve({startUS:1500,endUS:1100,disabled:!1})}async function cn(l){const e=new FormData;return e.append("start",l.startUS),e.append("end",l.endUS),l.disabled&&e.append("disableServo","on"),fetch("/setServoSettings",{method:"POST",body:e,headers:{Authorization:"Basic "+btoa("ops:changeme")}}).then(async t=>{if(!t.ok){const n=await t.text();throw new Error(n||`HTTP ${t.status}`)}return t.text()})}async function ws(){return ve("/servo")}async function Cs(){return await ve("/testAlert")}async function un(){return ve("/api/ip-filters")}async function fn(l){return ve("/api/ip-filters",{method:"POST",body:JSON.stringify(l)})}async function dn(){return ve("/api/mqtt-config")}async function pn(l){return ve("/api/mqtt-config",{method:"POST",body:JSON.stringify(l)})}async function mn(){return ve("/api/video-mode")}async function vn(l){return ve("/api/video-mode",{method:"POST",body:JSON.stringify(l)})}async function _n(){return ve("/api/system-logs")}async function bn(){return ve("/api/previous-logs")}async function hn(){return ve("/api/older-logs")}async function gn(){return ve("/api/system-info")}async function kn(){return ve("/reboot",{headers:{Authorization:"Basic "+btoa("ops:changeme")}})}async function wn(){return ve("/sendHeartbeat")}async function Ss(){return ve("/reset")}async function Cn(){return ve("/api/device/claim-status")}async function Sn(){return ve("/api/setup/status")}async function yn(){return ve("/api/setup/status/clear",{method:"POST"})}async function ys(l=!1){const e=l?"/api/wifi/scan?rescan=1":"/api/wifi/scan";console.log(`[WIFI-SCAN] Calling ${e}...`);try{const t=await ve(e);return console.log("[WIFI-SCAN] Got result:",JSON.stringify(t)),t}catch(t){throw console.error("[WIFI-SCAN] Error:",t),t}}async function qn(l){return ve("/api/setup/connect",{method:"POST",body:JSON.stringify(l)})}async function Tn(l){return ve("/api/setup/standalone",{method:"POST",body:JSON.stringify(l)})}async function Ln(l){return ve("/api/wifi/update",{method:"POST",body:JSON.stringify(l)})}const{document:Qt}=vs;function Kt(l,e,t){const n=l.slice();return n[27]=e[t],n}function Yt(l){let e;return{c(){e=d("div"),e.textContent="TRAP TRIGGERED!",a(e,"class","trap-alert svelte-1kjtmub")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Fn(l){let e,t,n,s,r,i,c,u,f,p=l[2]?"On":"Off",m,v,_,h,C,g,y;return{c(){e=d("div"),t=d("img"),s=b(),r=d("div"),i=d("button"),i.textContent="Refresh",c=b(),u=d("button"),f=F("Live "),m=F(p),v=b(),_=d("button"),_.textContent="Toggle LED",h=b(),C=d("button"),C.textContent="Capture",lt(t.src,n=l[0])||a(t,"src",n),a(t,"alt","Camera Feed"),a(t,"class","svelte-1kjtmub"),z(t,"error",l[1]),z(t,"zoomed",l[3]),a(i,"class","btn svelte-1kjtmub"),a(u,"class","btn svelte-1kjtmub"),z(u,"active",l[2]),a(_,"class","btn svelte-1kjtmub"),a(C,"class","btn svelte-1kjtmub"),a(r,"class","camera-controls svelte-1kjtmub"),a(e,"class","camera-container svelte-1kjtmub"),z(e,"zoomed",l[3])},m(T,S){w(T,e,S),o(e,t),o(e,s),o(e,r),o(r,i),o(r,c),o(r,u),o(u,f),o(u,m),o(r,v),o(r,_),o(r,h),o(r,C),g||(y=[R(t,"error",l[14]),R(t,"click",l[15]),R(i,"click",l[7]),R(u,"click",l[8]),R(_,"click",l[9]),R(C,"click",l[13])],g=!0)},p(T,S){S&1&&!lt(t.src,n=T[0])&&a(t,"src",n),S&2&&z(t,"error",T[1]),S&8&&z(t,"zoomed",T[3]),S&4&&p!==(p=T[2]?"On":"Off")&&j(m,p),S&4&&z(u,"active",T[2]),S&8&&z(e,"zoomed",T[3])},d(T){T&&k(e),g=!1,he(y)}}}function En(l){let e,t,n,s,r,i,c,u=l[4].sensorReading+"",f,p,m,v,_,h=l[4].threshold+"",C;return{c(){e=d("div"),t=d("canvas"),n=b(),s=d("div"),r=d("div"),i=F("Current: "),c=d("strong"),f=F(u),p=b(),m=d("div"),v=F("Threshold: "),_=d("strong"),C=F(h),a(e,"class","chart-container svelte-1kjtmub"),a(c,"class","svelte-1kjtmub"),a(_,"class","svelte-1kjtmub"),a(s,"class","sensor-info svelte-1kjtmub")},m(g,y){w(g,e,y),o(e,t),l[16](t),w(g,n,y),w(g,s,y),o(s,r),o(r,i),o(r,c),o(c,f),o(s,p),o(s,m),o(m,v),o(m,_),o(_,C)},p(g,y){y&16&&u!==(u=g[4].sensorReading+"")&&j(f,u),y&16&&h!==(h=g[4].threshold+"")&&j(C,h)},d(g){g&&(k(e),k(n),k(s)),l[16](null)}}}function An(l){let e,t,n,s,r,i=l[4].uptime+"",c,u,f,p,m,v,_=l[4].heap+"",h,C,g,y,T,S,q,O=l[5].message+"",P,I,L,E,N,A,U,B,M,W;return{c(){e=d("div"),t=d("div"),n=d("span"),n.textContent="Uptime:",s=b(),r=d("span"),c=F(i),u=b(),f=d("div"),p=d("span"),p.textContent="Free Heap:",m=b(),v=d("span"),h=F(_),C=F(" bytes"),g=b(),y=d("div"),T=d("span"),T.textContent="Claim Status:",S=b(),q=d("span"),P=F(O),I=b(),L=d("div"),E=d("button"),E.textContent="Reset Alarm",N=b(),A=d("button"),A.textContent="False Alarm",U=b(),B=d("button"),B.textContent="Send Heartbeat",a(t,"class","status-row svelte-1kjtmub"),a(f,"class","status-row svelte-1kjtmub"),a(q,"class","claimed-status"),z(q,"unclaimed",!l[5].claimed),a(y,"class","status-row svelte-1kjtmub"),a(e,"class","status-info svelte-1kjtmub"),a(E,"class","btn svelte-1kjtmub"),a(A,"class","btn svelte-1kjtmub"),a(B,"class","btn svelte-1kjtmub"),a(L,"class","action-buttons svelte-1kjtmub")},m(D,K){w(D,e,K),o(e,t),o(t,n),o(t,s),o(t,r),o(r,c),o(e,u),o(e,f),o(f,p),o(f,m),o(f,v),o(v,h),o(v,C),o(e,g),o(e,y),o(y,T),o(y,S),o(y,q),o(q,P),w(D,I,K),w(D,L,K),o(L,E),o(L,N),o(L,A),o(L,U),o(L,B),M||(W=[R(E,"click",l[10]),R(A,"click",l[11]),R(B,"click",l[12])],M=!0)},p(D,K){K&16&&i!==(i=D[4].uptime+"")&&j(c,i),K&16&&_!==(_=D[4].heap+"")&&j(h,_),K&32&&O!==(O=D[5].message+"")&&j(P,O),K&32&&z(q,"unclaimed",!D[5].claimed)},d(D){D&&(k(e),k(I),k(L)),M=!1,he(W)}}}function In(l){let e;return{c(){e=d("p"),e.textContent="No anomalies detected",a(e,"class","no-data svelte-1kjtmub")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function Pn(l){let e,t=Fe(l[4].anomalies),n=[];for(let s=0;s<t.length;s+=1)n[s]=Zt(Kt(l,t,s));return{c(){e=d("div");for(let s=0;s<n.length;s+=1)n[s].c();a(e,"class","anomalies-list svelte-1kjtmub")},m(s,r){w(s,e,r);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,r){if(r&16){t=Fe(s[4].anomalies);let i;for(i=0;i<t.length;i+=1){const c=Kt(s,t,i);n[i]?n[i].p(c,r):(n[i]=Zt(c),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(s){s&&k(e),Je(n,s)}}}function Zt(l){let e,t,n=l[27].timestamp+"",s,r,i,c=l[27].distance+"",u,f,p;return{c(){e=d("div"),t=d("span"),s=F(n),r=b(),i=d("span"),u=F(c),f=F(" cm"),p=b(),a(t,"class","timestamp svelte-1kjtmub"),a(i,"class","distance svelte-1kjtmub"),a(e,"class","anomaly-item svelte-1kjtmub")},m(m,v){w(m,e,v),o(e,t),o(t,s),o(e,r),o(e,i),o(i,u),o(i,f),o(e,p)},p(m,v){v&16&&n!==(n=m[27].timestamp+"")&&j(s,n),v&16&&c!==(c=m[27].distance+"")&&j(u,c)},d(m){m&&k(e)}}}function On(l){let e;function t(r,i){return r[4].anomalies&&r[4].anomalies.length>0?Pn:In}let n=t(l),s=n(l);return{c(){s.c(),e=Ee()},m(r,i){s.m(r,i),w(r,e,i)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},d(r){r&&k(e),s.d(r)}}}function Nn(l){let e,t,n,s,r=(l[5].deviceName||"MouseTrap")+"",i,c,u,f,p,m,v,_,h,C,g,y,T;Qt.title=e="Dashboard - "+(l[5].deviceName||"MouseTrap");let S=l[4].detectionState&&Yt();return p=new qe({props:{title:"Live Camera Feed",$$slots:{default:[Fn]},$$scope:{ctx:l}}}),_=new qe({props:{title:"Sensor Range",$$slots:{default:[En]},$$scope:{ctx:l}}}),C=new qe({props:{title:"System Status",$$slots:{default:[An]},$$scope:{ctx:l}}}),y=new qe({props:{title:"Anomalous Events",$$slots:{default:[On]},$$scope:{ctx:l}}}),{c(){t=b(),n=d("div"),s=d("h1"),i=F(r),c=b(),S&&S.c(),u=b(),f=d("div"),pe(p.$$.fragment),m=b(),v=d("div"),pe(_.$$.fragment),h=b(),pe(C.$$.fragment),g=b(),pe(y.$$.fragment),a(s,"class","svelte-1kjtmub"),a(f,"class","camera-card-wrapper svelte-1kjtmub"),a(v,"class","grid svelte-1kjtmub"),a(n,"class","dashboard svelte-1kjtmub")},m(q,O){w(q,t,O),w(q,n,O),o(n,s),o(s,i),o(n,c),S&&S.m(n,null),o(n,u),o(n,f),ce(p,f,null),o(n,m),o(n,v),ce(_,v,null),o(v,h),ce(C,v,null),o(v,g),ce(y,v,null),T=!0},p(q,[O]){(!T||O&32)&&e!==(e="Dashboard - "+(q[5].deviceName||"MouseTrap"))&&(Qt.title=e),(!T||O&32)&&r!==(r=(q[5].deviceName||"MouseTrap")+"")&&j(i,r),q[4].detectionState?S||(S=Yt(),S.c(),S.m(n,u)):S&&(S.d(1),S=null);const P={};O&1073741839&&(P.$$scope={dirty:O,ctx:q}),p.$set(P);const I={};O&1073741904&&(I.$$scope={dirty:O,ctx:q}),_.$set(I);const L={};O&1073741872&&(L.$$scope={dirty:O,ctx:q}),C.$set(L);const E={};O&1073741840&&(E.$$scope={dirty:O,ctx:q}),y.$set(E)},i(q){T||(H(p.$$.fragment,q),H(_.$$.fragment,q),H(C.$$.fragment,q),H(y.$$.fragment,q),T=!0)},o(q){Q(p.$$.fragment,q),Q(_.$$.fragment,q),Q(C.$$.fragment,q),Q(y.$$.fragment,q),T=!1},d(q){q&&(k(t),k(n)),S&&S.d(),ue(p),ue(_),ue(C),ue(y)}}}const Xt=20;function Mn(l,e,t){let n="/auto.jpg",s=!1,r=!1,i=!1,c=null,u=null,f={threshold:0,sensorReading:0,detectionState:!1,uptime:"",heap:0,anomalies:[]},p={claimed:!1,message:"Checking...",deviceName:""},m=null,v=null,_=[];async function h(){try{t(0,n=`/auto.jpg?t=${Date.now()}`),t(1,s=!1)}catch(M){console.error("Camera refresh error:",M),t(1,s=!0)}}function C(){try{t(0,n=`/camera?t=${Date.now()}`),t(1,s=!1)}catch(M){console.error("Live frame error:",M),t(1,s=!0)}}function g(){t(2,r=!r),r?(C(),c=setInterval(()=>{C()},100)):(c&&(clearInterval(c),c=null),h())}async function y(){try{await xs()}catch(M){console.error("Toggle LED error:",M)}}async function T(){try{await Ss(),await P()}catch(M){console.error("Reset alarm error:",M)}}async function S(){try{const M=await on();M&&M.newThreshold!==void 0&&t(4,f.threshold=M.newThreshold,f),await P()}catch(M){console.error("False alarm error:",M)}}async function q(){try{await wn()}catch(M){console.error("Send heartbeat error:",M)}}async function O(){try{await Cs(),await h()}catch(M){console.error("Capture screenshot error:",M)}}async function P(){try{const M=await Pt();t(4,f=M),_.push({time:new Date().toLocaleTimeString(),value:M.sensorReading}),_.length>Xt&&(_=_.slice(-Xt)),L()}catch(M){console.error("Status fetch error:",M)}}function I(){if(!v)return;const M=v.getContext("2d");m=new Chart(M,{type:"line",data:{labels:[],datasets:[{label:"Sensor Reading",data:[],borderColor:"#4CAF50",backgroundColor:"rgba(76, 175, 80, 0.1)",tension:.4},{label:"Threshold",data:[],borderColor:"#f44336",backgroundColor:"transparent",borderDash:[5,5],pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{color:"#ddd"},grid:{color:"#333"}},x:{ticks:{color:"#ddd"},grid:{color:"#333"}}},plugins:{legend:{labels:{color:"#ddd"}}}}})}function L(){m&&(m.data.labels=_.map(M=>M.time),m.data.datasets[0].data=_.map(M=>M.value),m.data.datasets[1].data=_.map(()=>f.threshold),m.update())}function E(){t(1,s=!0),setTimeout(()=>{r?C():h()},1e3)}async function N(){if(i)try{(document.fullscreenElement||document.webkitFullscreenElement)&&(document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen&&await document.webkitExitFullscreen()),t(3,i=!1)}catch(M){console.error("Error exiting fullscreen:",M),t(3,i=!1)}else try{const M=document.documentElement;M.requestFullscreen?await M.requestFullscreen():M.webkitRequestFullscreen&&await M.webkitRequestFullscreen(),t(3,i=!0)}catch(M){console.error("Error entering fullscreen:",M),t(3,i=!0)}}function A(){!document.fullscreenElement&&!document.webkitFullscreenElement&&t(3,i=!1)}async function U(){try{const M=await Cn();t(5,p={claimed:M.claimed||!1,deviceName:M.deviceName||"",message:M.claimed?`Claimed to ${M.deviceName||"tenant"}`:M.message||"Device not claimed"})}catch(M){console.error("Claim status fetch error:",M),t(5,p={claimed:!1,deviceName:"",message:"Error loading claim status"})}}Be(()=>{if(typeof Chart<"u")I();else{const M=document.createElement("script");M.src="https://cdn.jsdelivr.net/npm/chart.js",M.onload=()=>I(),document.head.appendChild(M)}P(),U(),u=setInterval(P,5e3),document.addEventListener("fullscreenchange",A),document.addEventListener("webkitfullscreenchange",A)}),it(()=>{c&&clearInterval(c),u&&clearInterval(u),m&&m.destroy(),document.removeEventListener("fullscreenchange",A),document.removeEventListener("webkitfullscreenchange",A)});function B(M){et[M?"unshift":"push"](()=>{v=M,t(6,v)})}return[n,s,r,i,f,p,v,h,g,y,T,S,q,O,E,N,B]}class $t extends Ie{constructor(e){super(),Ae(this,e,Mn,Nn,Te,{})}}function Rn(l){let e,t;return{c(){e=d("div"),t=d("div"),a(t,"class","spinner svelte-1cznhkh"),Ge(t,"width",l[0]+"px"),Ge(t,"height",l[0]+"px"),Ge(t,"border-color",l[1]+" transparent transparent transparent"),a(e,"class","spinner-container svelte-1cznhkh")},m(n,s){w(n,e,s),o(e,t)},p(n,[s]){s&1&&Ge(t,"width",n[0]+"px"),s&1&&Ge(t,"height",n[0]+"px"),s&2&&Ge(t,"border-color",n[1]+" transparent transparent transparent")},i:V,o:V,d(n){n&&k(e)}}}function Un(l,e,t){let{size:n=40}=e,{color:s="#9fdcff"}=e;return l.$$set=r=>{"size"in r&&t(0,n=r.size),"color"in r&&t(1,s=r.color)},[n,s]}class He extends Ie{constructor(e){super(),Ae(this,e,Un,Rn,Te,{size:0,color:1})}}function xt(l){let e,t,n,s,r=l[0].message+"",i,c,u,f,p,m,v=l[0].details&&el(l);return{c(){e=d("div"),t=d("div"),n=d("strong"),n.textContent="âš ï¸ Error:",s=b(),i=F(r),c=b(),v&&v.c(),u=b(),f=d("button"),f.textContent="âœ•",a(t,"class","error-content svelte-1gxsq9q"),a(f,"class","dismiss-btn svelte-1gxsq9q"),a(e,"class","error-banner svelte-1gxsq9q")},m(_,h){w(_,e,h),o(e,t),o(t,n),o(t,s),o(t,i),o(t,c),v&&v.m(t,null),o(e,u),o(e,f),p||(m=R(f,"click",l[1]),p=!0)},p(_,h){h&1&&r!==(r=_[0].message+"")&&j(i,r),_[0].details?v?v.p(_,h):(v=el(_),v.c(),v.m(t,null)):v&&(v.d(1),v=null)},d(_){_&&k(e),v&&v.d(),p=!1,m()}}}function el(l){let e,t=JSON.stringify(l[0].details)+"",n;return{c(){e=d("div"),n=F(t),a(e,"class","error-details svelte-1gxsq9q")},m(s,r){w(s,e,r),o(e,n)},p(s,r){r&1&&t!==(t=JSON.stringify(s[0].details)+"")&&j(n,t)},d(s){s&&k(e)}}}function Dn(l){let e,t=l[0]&&xt(l);return{c(){t&&t.c(),e=Ee()},m(n,s){t&&t.m(n,s),w(n,e,s)},p(n,[s]){n[0]?t?t.p(n,s):(t=xt(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:V,o:V,d(n){n&&k(e),t&&t.d(n)}}}function jn(l,e,t){let{error:n=null}=e;function s(){t(0,n=null)}return l.$$set=r=>{"error"in r&&t(0,n=r.error)},[n,s]}class qs extends Ie{constructor(e){super(),Ae(this,e,jn,Dn,Te,{error:0})}}function tl(l,e,t){const n=l.slice();return n[25]=e[t],n[27]=t,n}function ll(l){let e,t;return e=new qs({props:{message:l[2]}}),{c(){pe(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p(n,s){const r={};s&4&&(r.message=n[2]),e.$set(r)},i(n){t||(H(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Wn(l){let e,t,n=Fe(l[0]),s=[];for(let i=0;i<n.length;i+=1)s[i]=sl(tl(l,n,i));const r=i=>Q(s[i],1,1,()=>{s[i]=null});return{c(){e=d("div");for(let i=0;i<s.length;i+=1)s[i].c();a(e,"class","image-grid svelte-1chdln3")},m(i,c){w(i,e,c);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);t=!0},p(i,c){if(c&769){n=Fe(i[0]);let u;for(u=0;u<n.length;u+=1){const f=tl(i,n,u);s[u]?(s[u].p(f,c),H(s[u],1)):(s[u]=sl(f),s[u].c(),H(s[u],1),s[u].m(e,null))}for(we(),u=n.length;u<s.length;u+=1)r(u);Ce()}},i(i){if(!t){for(let c=0;c<n.length;c+=1)H(s[c]);t=!0}},o(i){s=s.filter(Boolean);for(let c=0;c<s.length;c+=1)Q(s[c]);t=!1},d(i){i&&k(e),Je(s,i)}}}function Hn(l){let e,t;return e=new qe({props:{$$slots:{default:[Kn]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p(n,s){const r={};s&268435456&&(r.$$scope={dirty:s,ctx:n}),e.$set(r)},i(n){t||(H(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function zn(l){let e,t,n;return t=new He({}),{c(){e=d("div"),pe(t.$$.fragment),a(e,"class","loading-container svelte-1chdln3")},m(s,r){w(s,e,r),ce(t,e,null),n=!0},p:V,i(s){n||(H(t.$$.fragment,s),n=!0)},o(s){Q(t.$$.fragment,s),n=!1},d(s){s&&k(e),ue(t)}}}function Bn(l){return{c:V,m:V,p:V,i:V,o:V,d:V}}function Vn(l){let e;function t(r,i){return r[24]?Jn:Gn}let n=t(l),s=n(l);return{c(){s.c(),e=Ee()},m(r,i){s.m(r,i),w(r,e,i)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},i:V,o:V,d(r){r&&k(e),s.d(r)}}}function Gn(l){let e;return{c(){e=d("div"),e.textContent="Failed to load",a(e,"class","thumbnail-error svelte-1chdln3")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function Jn(l){let e,t,n;return{c(){e=d("img"),lt(e.src,t=l[24])||a(e,"src",t),a(e,"alt",n=l[25].name),a(e,"class","thumbnail-image svelte-1chdln3")},m(s,r){w(s,e,r)},p(s,r){r&1&&!lt(e.src,t=s[24])&&a(e,"src",t),r&1&&n!==(n=s[25].name)&&a(e,"alt",n)},d(s){s&&k(e)}}}function Qn(l){let e,t,n;return t=new He({}),{c(){e=d("div"),pe(t.$$.fragment),a(e,"class","thumbnail-loading svelte-1chdln3")},m(s,r){w(s,e,r),ce(t,e,null),n=!0},p:V,i(s){n||(H(t.$$.fragment,s),n=!0)},o(s){Q(t.$$.fragment,s),n=!1},d(s){s&&k(e),ue(t)}}}function sl(l){let e,t,n,s,r,i=l[25].name+"",c,u,f,p=ol(l[25].size)+"",m,v,_,h,C,g={ctx:l,current:null,token:null,hasCatch:!1,pending:Qn,then:Vn,catch:Bn,value:24,blocks:[,,,]};mt(t=l[8](l[25].name),g);function y(){return l[19](l[25],l[27])}return{c(){e=d("div"),g.block.c(),n=b(),s=d("div"),r=d("div"),c=F(i),u=b(),f=d("div"),m=F(p),v=b(),a(r,"class","thumbnail-filename svelte-1chdln3"),a(f,"class","thumbnail-meta svelte-1chdln3"),a(s,"class","thumbnail-info svelte-1chdln3"),a(e,"class","thumbnail-card svelte-1chdln3")},m(T,S){w(T,e,S),g.block.m(e,g.anchor=null),g.mount=()=>e,g.anchor=n,o(e,n),o(e,s),o(s,r),o(r,c),o(s,u),o(s,f),o(f,m),o(e,v),_=!0,h||(C=R(e,"click",y),h=!0)},p(T,S){l=T,g.ctx=l,S&1&&t!==(t=l[8](l[25].name))&&mt(t,g)||bs(g,l,S),(!_||S&1)&&i!==(i=l[25].name+"")&&j(c,i),(!_||S&1)&&p!==(p=ol(l[25].size)+"")&&j(m,p)},i(T){_||(H(g.block),_=!0)},o(T){for(let S=0;S<3;S+=1){const q=g.blocks[S];Q(q)}_=!1},d(T){T&&k(e),g.block.d(),g.token=null,g=null,h=!1,C()}}}function Kn(l){let e;return{c(){e=d("div"),e.innerHTML='<p class="svelte-1chdln3">No captures yet</p> <p class="empty-hint svelte-1chdln3">Captured images will appear here</p>',a(e,"class","empty-state svelte-1chdln3")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function nl(l){let e,t,n,s,r,i=l[3].name+"",c,u,f,p=il(l[3].timestamp)+"",m,v,_,h,C,g,y,T,S,q,O,P,I,L,E=l[4]+1+"",N,A,U=l[0].length+"",B,M,W,D,K,J,Z,ie,be,$,Y,ne,te,G={ctx:l,current:null,token:null,hasCatch:!1,pending:xn,then:Zn,catch:Yn,value:24,blocks:[,,,]};return mt(g=l[8](l[3].name),G),{c(){e=d("div"),t=d("div"),n=d("div"),s=d("div"),r=d("div"),c=F(i),u=b(),f=d("div"),m=F(p),v=b(),_=d("button"),_.textContent="Ã—",h=b(),C=d("div"),G.block.c(),y=b(),T=d("div"),S=d("div"),q=d("button"),O=F("â† Previous"),I=b(),L=d("span"),N=F(E),A=F(" / "),B=F(U),M=b(),W=d("button"),D=F("Next â†’"),J=b(),Z=d("div"),ie=d("button"),ie.textContent="Download",be=b(),$=d("button"),$.textContent="Delete",a(r,"class","modal-filename svelte-1chdln3"),a(f,"class","modal-timestamp svelte-1chdln3"),a(s,"class","modal-title svelte-1chdln3"),a(_,"class","modal-close svelte-1chdln3"),a(n,"class","modal-header svelte-1chdln3"),a(C,"class","modal-body svelte-1chdln3"),a(q,"class","nav-btn svelte-1chdln3"),q.disabled=P=l[4]===0,a(L,"class","image-counter svelte-1chdln3"),a(W,"class","nav-btn svelte-1chdln3"),W.disabled=K=l[4]===l[0].length-1,a(S,"class","modal-nav svelte-1chdln3"),a(ie,"class","action-btn svelte-1chdln3"),a($,"class","action-btn delete-btn svelte-1chdln3"),a(Z,"class","modal-actions svelte-1chdln3"),a(T,"class","modal-footer svelte-1chdln3"),a(t,"class","modal-content svelte-1chdln3"),a(e,"class","modal-backdrop svelte-1chdln3")},m(X,ee){w(X,e,ee),o(e,t),o(t,n),o(n,s),o(s,r),o(r,c),o(s,u),o(s,f),o(f,m),o(n,v),o(n,_),o(t,h),o(t,C),G.block.m(C,G.anchor=null),G.mount=()=>C,G.anchor=null,o(t,y),o(t,T),o(T,S),o(S,q),o(q,O),o(S,I),o(S,L),o(L,N),o(L,A),o(L,B),o(S,M),o(S,W),o(W,D),o(T,J),o(T,Z),o(Z,ie),o(Z,be),o(Z,$),Y=!0,ne||(te=[R(_,"click",l[10]),R(q,"click",l[11]),R(W,"click",l[12]),R(ie,"click",l[20]),R($,"click",l[21]),R(t,"click",_s(l[18])),R(e,"click",l[10])],ne=!0)},p(X,ee){l=X,(!Y||ee&8)&&i!==(i=l[3].name+"")&&j(c,i),(!Y||ee&8)&&p!==(p=il(l[3].timestamp)+"")&&j(m,p),G.ctx=l,ee&8&&g!==(g=l[8](l[3].name))&&mt(g,G)||bs(G,l,ee),(!Y||ee&16&&P!==(P=l[4]===0))&&(q.disabled=P),(!Y||ee&16)&&E!==(E=l[4]+1+"")&&j(N,E),(!Y||ee&1)&&U!==(U=l[0].length+"")&&j(B,U),(!Y||ee&17&&K!==(K=l[4]===l[0].length-1))&&(W.disabled=K)},i(X){Y||(H(G.block),Y=!0)},o(X){for(let ee=0;ee<3;ee+=1){const me=G.blocks[ee];Q(me)}Y=!1},d(X){X&&k(e),G.block.d(),G.token=null,G=null,ne=!1,he(te)}}}function Yn(l){return{c:V,m:V,p:V,i:V,o:V,d:V}}function Zn(l){let e;function t(r,i){return r[24]?$n:Xn}let n=t(l),s=n(l);return{c(){s.c(),e=Ee()},m(r,i){s.m(r,i),w(r,e,i)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},i:V,o:V,d(r){r&&k(e),s.d(r)}}}function Xn(l){let e;return{c(){e=d("div"),e.textContent="Failed to load image",a(e,"class","modal-error svelte-1chdln3")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function $n(l){let e,t,n;return{c(){e=d("img"),lt(e.src,t=l[24])||a(e,"src",t),a(e,"alt",n=l[3].name),a(e,"class","modal-image svelte-1chdln3")},m(s,r){w(s,e,r)},p(s,r){r&8&&!lt(e.src,t=s[24])&&a(e,"src",t),r&8&&n!==(n=s[3].name)&&a(e,"alt",n)},d(s){s&&k(e)}}}function xn(l){let e,t;return e=new He({}),{c(){pe(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p:V,i(n){t||(H(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function rl(l){let e,t,n,s,r,i,c,u,f,p,m,v,_,h,C;return{c(){e=d("div"),t=d("div"),n=d("h3"),n.textContent="Confirm Delete",s=b(),r=d("p"),i=F("Are you sure you want to delete "),c=F(l[6]),u=F("?"),f=b(),p=d("div"),m=d("button"),m.textContent="Cancel",v=b(),_=d("button"),_.textContent="Delete",a(n,"class","svelte-1chdln3"),a(r,"class","svelte-1chdln3"),a(m,"class","confirm-btn cancel-btn svelte-1chdln3"),a(_,"class","confirm-btn delete-confirm-btn svelte-1chdln3"),a(p,"class","confirm-actions svelte-1chdln3"),a(t,"class","confirm-dialog svelte-1chdln3"),a(e,"class","confirm-backdrop svelte-1chdln3")},m(g,y){w(g,e,y),o(e,t),o(t,n),o(t,s),o(t,r),o(r,i),o(r,c),o(r,u),o(t,f),o(t,p),o(p,m),o(p,v),o(p,_),h||(C=[R(m,"click",l[16]),R(_,"click",l[15]),R(t,"click",_s(l[17])),R(e,"click",l[16])],h=!0)},p(g,y){y&64&&j(c,g[6])},d(g){g&&k(e),h=!1,he(C)}}}function er(l){let e,t,n,s,r,i=l[1]?"Loading...":"Refresh",c,u,f,p,m,v,_,h,C,g,y,T=l[2]&&ll(l);const S=[zn,Hn,Wn],q=[];function O(L,E){return L[1]?0:L[0].length===0?1:2}p=O(l),m=q[p]=S[p](l);let P=l[3]&&nl(l),I=l[5]&&rl(l);return{c(){e=d("div"),t=d("div"),n=d("h1"),n.textContent="Image Gallery",s=b(),r=d("button"),c=F(i),u=b(),T&&T.c(),f=b(),m.c(),v=b(),P&&P.c(),_=b(),I&&I.c(),h=Ee(),a(n,"class","svelte-1chdln3"),a(r,"class","refresh-btn svelte-1chdln3"),r.disabled=l[1],a(t,"class","header svelte-1chdln3"),a(e,"class","gallery-container svelte-1chdln3")},m(L,E){w(L,e,E),o(e,t),o(t,n),o(t,s),o(t,r),o(r,c),o(e,u),T&&T.m(e,null),o(e,f),q[p].m(e,null),w(L,v,E),P&&P.m(L,E),w(L,_,E),I&&I.m(L,E),w(L,h,E),C=!0,g||(y=R(r,"click",l[7]),g=!0)},p(L,[E]){(!C||E&2)&&i!==(i=L[1]?"Loading...":"Refresh")&&j(c,i),(!C||E&2)&&(r.disabled=L[1]),L[2]?T?(T.p(L,E),E&4&&H(T,1)):(T=ll(L),T.c(),H(T,1),T.m(e,f)):T&&(we(),Q(T,1,1,()=>{T=null}),Ce());let N=p;p=O(L),p===N?q[p].p(L,E):(we(),Q(q[N],1,1,()=>{q[N]=null}),Ce(),m=q[p],m?m.p(L,E):(m=q[p]=S[p](L),m.c()),H(m,1),m.m(e,null)),L[3]?P?(P.p(L,E),E&8&&H(P,1)):(P=nl(L),P.c(),H(P,1),P.m(_.parentNode,_)):P&&(we(),Q(P,1,1,()=>{P=null}),Ce()),L[5]?I?I.p(L,E):(I=rl(L),I.c(),I.m(h.parentNode,h)):I&&(I.d(1),I=null)},i(L){C||(H(T),H(m),H(P),C=!0)},o(L){Q(T),Q(m),Q(P),C=!1},d(L){L&&(k(e),k(v),k(_),k(h)),T&&T.d(),q[p].d(),P&&P.d(L),I&&I.d(L),g=!1,y()}}}function il(l){return new Date(l).toLocaleString()}function ol(l){return l<1024?l+" B":l<1024*1024?(l/1024).toFixed(1)+" KB":(l/(1024*1024)).toFixed(1)+" MB"}function tr(l,e,t){let n=[],s=!0,r=null,i=null,c=-1,u={},f=!1,p=null;Be(()=>{m(),document.addEventListener("keydown",C)}),it(()=>{document.removeEventListener("keydown",C),Object.values(u).forEach(A=>URL.revokeObjectURL(A))});async function m(){t(1,s=!0),t(2,r=null);try{const A=await en();t(0,n=A.files||[]),n.sort((U,B)=>B.name.localeCompare(U.name))}catch(A){t(2,r=A.message||"Failed to load gallery")}finally{t(1,s=!1)}}async function v(A){if(u[A])return u[A];try{const U=Jt(A);return u[A]=U,U}catch(U){return console.error("Failed to load image:",U),null}}async function _(A,U){t(3,i=A),t(4,c=U),await v(A.name)}function h(){t(3,i=null),t(4,c=-1),t(5,f=!1),t(6,p=null)}function C(A){i&&(A.key==="Escape"?h():A.key==="ArrowLeft"?g():A.key==="ArrowRight"&&y())}function g(){c>0&&(t(4,c--,c),t(3,i=n[c]),v(i.name))}function y(){c<n.length-1&&(t(4,c++,c),t(3,i=n[c]),v(i.name))}async function T(A){try{const U=Jt(A),M=await(await fetch(U)).blob(),W=URL.createObjectURL(M),D=document.createElement("a");D.href=W,D.download=A,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(W)}catch(U){console.error("Failed to download image:",U),alert("Failed to download image")}}function S(A){t(6,p=A),t(5,f=!0)}async function q(){if(p)try{await tn(p),u[p]&&(URL.revokeObjectURL(u[p]),delete u[p]),t(0,n=n.filter(A=>A.name!==p)),i&&i.name===p&&h(),t(5,f=!1),t(6,p=null)}catch(A){console.error("Failed to delete image:",A),alert("Failed to delete image")}}function O(){t(5,f=!1),t(6,p=null)}function P(A){Dt.call(this,l,A)}function I(A){Dt.call(this,l,A)}return[n,s,r,i,c,f,p,m,v,_,h,g,y,T,S,q,O,P,I,(A,U)=>_(A,U),()=>T(i.name),()=>S(i.name)]}class lr extends Ie{constructor(e){super(),Ae(this,e,tr,er,Te,{})}}function al(l){let e,t;return{c(){e=d("div"),t=F(l[5]),a(e,"class","message svelte-1iken05"),z(e,"success",l[6]==="success"),z(e,"error",l[6]==="error")},m(n,s){w(n,e,s),o(e,t)},p(n,s){s&32&&j(t,n[5]),s&64&&z(e,"success",n[6]==="success"),s&64&&z(e,"error",n[6]==="error")},d(n){n&&k(e)}}}function sr(l){let e,t,n,s,r,i,c,u,f,p,m,v,_,h,C,g,y,T,S,q,O,P,I,L,E,N,A,U,B,M,W,D,K,J,Z,ie,be,$,Y,ne,te;return{c(){e=d("div"),t=d("div"),n=d("label"),n.textContent="False-Alarm Offset:",s=b(),r=d("span"),i=F(l[0]),c=F(" mm"),u=b(),f=d("div"),p=d("label"),p.textContent="Current Threshold:",m=b(),v=d("span"),_=F(l[1]),h=F(" mm"),C=b(),g=d("div"),y=d("label"),y.textContent="Calibration Offset:",T=b(),S=d("div"),q=d("input"),O=b(),P=d("span"),I=F(l[2]),L=F(" mm"),E=b(),N=d("div"),A=d("label"),A.textContent="Override Threshold (mm):",U=b(),B=d("input"),M=b(),W=d("div"),D=d("button"),K=F("ðŸ’¾ Save"),J=b(),Z=d("button"),ie=F("ðŸ—‘ï¸ Clear Override"),be=b(),$=d("button"),Y=F("ðŸ”„ Recalibrate"),a(n,"class","svelte-1iken05"),a(r,"class","value svelte-1iken05"),a(t,"class","info-row svelte-1iken05"),a(p,"class","svelte-1iken05"),a(v,"class","value svelte-1iken05"),a(f,"class","info-row svelte-1iken05"),a(y,"for","calib-offset"),a(y,"class","svelte-1iken05"),a(q,"id","calib-offset"),a(q,"type","range"),a(q,"min","-100"),a(q,"max","100"),a(q,"step","1"),a(q,"class","slider svelte-1iken05"),q.disabled=l[4],a(P,"class","slider-value svelte-1iken05"),a(S,"class","slider-row svelte-1iken05"),a(g,"class","control-group svelte-1iken05"),a(A,"for","override-th"),a(A,"class","svelte-1iken05"),a(B,"id","override-th"),a(B,"type","number"),a(B,"placeholder",""),a(B,"min","0"),a(B,"class","input-field svelte-1iken05"),B.disabled=l[4],a(N,"class","control-group svelte-1iken05"),a(D,"class","btn btn-save svelte-1iken05"),D.disabled=l[4],a(Z,"class","btn btn-clear svelte-1iken05"),Z.disabled=l[4],a($,"class","btn btn-recal svelte-1iken05"),$.disabled=l[4],a(W,"class","button-group svelte-1iken05"),a(e,"class","content svelte-1iken05")},m(G,X){w(G,e,X),o(e,t),o(t,n),o(t,s),o(t,r),o(r,i),o(r,c),o(e,u),o(e,f),o(f,p),o(f,m),o(f,v),o(v,_),o(v,h),o(e,C),o(e,g),o(g,y),o(g,T),o(g,S),o(S,q),x(q,l[2]),o(S,O),o(S,P),o(P,I),o(P,L),o(e,E),o(e,N),o(N,A),o(N,U),o(N,B),x(B,l[3]),o(e,M),o(e,W),o(W,D),o(D,K),o(W,J),o(W,Z),o(Z,ie),o(W,be),o(W,$),o($,Y),ne||(te=[R(q,"change",l[10]),R(q,"input",l[10]),R(B,"input",l[11]),R(D,"click",l[7]),R(Z,"click",l[8]),R($,"click",l[9])],ne=!0)},p(G,X){X&1&&j(i,G[0]),X&2&&j(_,G[1]),X&16&&(q.disabled=G[4]),X&4&&x(q,G[2]),X&4&&j(I,G[2]),X&16&&(B.disabled=G[4]),X&8&&ze(B.value)!==G[3]&&x(B,G[3]),X&16&&(D.disabled=G[4]),X&16&&(Z.disabled=G[4]),X&16&&($.disabled=G[4])},d(G){G&&k(e),ne=!1,he(te)}}}function nr(l){let e,t,n,s,r,i,c=l[5]&&al(l);return r=new qe({props:{title:"",$$slots:{default:[sr]},$$scope:{ctx:l}}}),{c(){e=d("div"),t=d("h1"),t.textContent="Calibration Settings",n=b(),c&&c.c(),s=b(),pe(r.$$.fragment),a(t,"class","svelte-1iken05"),a(e,"class","page svelte-1iken05")},m(u,f){w(u,e,f),o(e,t),o(e,n),c&&c.m(e,null),o(e,s),ce(r,e,null),i=!0},p(u,[f]){u[5]?c?c.p(u,f):(c=al(u),c.c(),c.m(e,s)):c&&(c.d(1),c=null);const p={};f&16415&&(p.$$scope={dirty:f,ctx:u}),r.$set(p)},i(u){i||(H(r.$$.fragment,u),i=!0)},o(u){Q(r.$$.fragment,u),i=!1},d(u){u&&k(e),c&&c.d(),ue(r)}}}function rr(l,e,t){let n=0,s=0,r=0,i="",c=!1,u="",f="";Be(()=>{p();const g=localStorage.getItem("calibrationOffset");g!==null&&t(2,r=parseInt(g))});async function p(){try{const g=await Pt();t(1,s=g.threshold||0),t(0,n=g.falseAlarmOffset||0),g.calibrationOffset!==void 0&&(t(2,r=g.calibrationOffset),localStorage.setItem("calibrationOffset",r.toString())),g.overrideThreshold!==void 0&&g.overrideThreshold>0?t(3,i=g.overrideThreshold.toString()):t(3,i="")}catch(g){console.warn("Failed to load status:",g)}}async function m(){t(4,c=!0),t(5,u="");try{await ln(r),localStorage.setItem("calibrationOffset",r.toString()),i&&parseInt(i)>0?(await sn(parseInt(i)),t(5,u="Calibration offset and override threshold saved")):t(5,u="Calibration offset saved"),t(6,f="success"),setTimeout(()=>{t(5,u=""),p()},2e3)}catch(g){t(5,u=`Failed to save: ${g.message||g}`),t(6,f="error"),setTimeout(()=>{t(5,u="")},3e3)}finally{t(4,c=!1)}}async function v(){t(4,c=!0),t(5,u="");try{await nn(),t(3,i=""),t(5,u="Override cleared"),t(6,f="success"),setTimeout(()=>{t(5,u=""),p()},2e3)}catch(g){t(5,u=`Failed to clear override: ${g.message||g}`),t(6,f="error"),setTimeout(()=>{t(5,u="")},3e3)}finally{t(4,c=!1)}}async function _(){t(4,c=!0),t(5,u="");try{await rn(),t(5,u="Re-calibration started"),t(6,f="success"),setTimeout(()=>{t(5,u=""),p()},2e3)}catch(g){t(5,u=`Failed to recalibrate: ${g.message||g}`),t(6,f="error"),setTimeout(()=>{t(5,u="")},3e3)}finally{t(4,c=!1)}}function h(){r=ze(this.value),t(2,r)}function C(){i=ze(this.value),t(3,i)}return[n,s,r,i,c,u,f,m,v,_,h,C]}class ir extends Ie{constructor(e){super(),Ae(this,e,rr,nr,Te,{})}}function cl(l){let e,t;return{c(){e=d("div"),t=F(l[6]),a(e,"class","message svelte-1lrtwwl"),z(e,"success",l[7]==="success"),z(e,"error",l[7]==="error")},m(n,s){w(n,e,s),o(e,t)},p(n,s){s&64&&j(t,n[6]),s&128&&z(e,"success",n[7]==="success"),s&128&&z(e,"error",n[7]==="error")},d(n){n&&k(e)}}}function or(l){let e,t,n,s,r,i,c,u,f,p,m,v,_,h,C,g,y,T,S,q,O,P,I,L,E,N,A,U,B,M,W,D,K,J,Z=l[4]?"Saving...":"Save",ie,be,$,Y=l[5]?"Testing...":"Test Servo",ne,te,G,X;return{c(){e=d("div"),t=d("div"),n=d("label"),n.textContent="Start Position (Âµs):",s=b(),r=d("input"),i=b(),c=d("button"),u=F("Set"),f=b(),p=d("div"),m=d("label"),m.textContent="End Position (Âµs):",v=b(),_=d("input"),h=b(),C=d("button"),g=F("Set"),y=b(),T=d("div"),S=d("input"),q=b(),O=d("label"),O.textContent="Disable Servo",P=b(),I=d("div"),L=d("h3"),L.textContent="Live Control",E=b(),N=d("div"),A=d("input"),U=b(),B=d("div"),M=F(l[3]),W=F(" Âµs"),D=b(),K=d("div"),J=d("button"),ie=F(Z),be=b(),$=d("button"),ne=F(Y),a(n,"for","start-pos"),a(n,"class","svelte-1lrtwwl"),a(r,"id","start-pos"),a(r,"type","number"),a(r,"min","500"),a(r,"max","2500"),a(r,"step","10"),a(r,"class","svelte-1lrtwwl"),a(c,"class","btn btn-set svelte-1lrtwwl"),c.disabled=l[2],a(t,"class","position-row svelte-1lrtwwl"),a(m,"for","end-pos"),a(m,"class","svelte-1lrtwwl"),a(_,"id","end-pos"),a(_,"type","number"),a(_,"min","500"),a(_,"max","2500"),a(_,"step","10"),a(_,"class","svelte-1lrtwwl"),a(C,"class","btn btn-set svelte-1lrtwwl"),C.disabled=l[2],a(p,"class","position-row svelte-1lrtwwl"),a(S,"id","disable-servo"),a(S,"type","checkbox"),a(S,"class","svelte-1lrtwwl"),a(O,"for","disable-servo"),a(O,"class","svelte-1lrtwwl"),a(T,"class","checkbox-row svelte-1lrtwwl"),a(L,"class","svelte-1lrtwwl"),a(A,"type","range"),a(A,"min","500"),a(A,"max","2500"),a(A,"step","10"),A.disabled=l[2],a(A,"class","position-slider svelte-1lrtwwl"),a(B,"class","slider-value svelte-1lrtwwl"),a(N,"class","slider-container svelte-1lrtwwl"),a(I,"class","live-control svelte-1lrtwwl"),a(J,"class","btn btn-save svelte-1lrtwwl"),J.disabled=l[4],a($,"class","btn btn-test svelte-1lrtwwl"),$.disabled=te=l[5]||l[2],a(K,"class","button-group svelte-1lrtwwl"),a(e,"class","settings-content svelte-1lrtwwl")},m(ee,me){w(ee,e,me),o(e,t),o(t,n),o(t,s),o(t,r),x(r,l[0]),o(t,i),o(t,c),o(c,u),o(e,f),o(e,p),o(p,m),o(p,v),o(p,_),x(_,l[1]),o(p,h),o(p,C),o(C,g),o(e,y),o(e,T),o(T,S),S.checked=l[2],o(T,q),o(T,O),o(e,P),o(e,I),o(I,L),o(I,E),o(I,N),o(N,A),x(A,l[3]),o(N,U),o(N,B),o(B,M),o(B,W),o(e,D),o(e,K),o(K,J),o(J,ie),o(K,be),o(K,$),o($,ne),G||(X=[R(r,"input",l[12]),R(c,"click",l[13]),R(_,"input",l[14]),R(C,"click",l[15]),R(S,"change",l[16]),R(A,"change",l[17]),R(A,"input",l[17]),R(A,"input",l[11]),R(J,"click",l[9]),R($,"click",l[10])],G=!0)},p(ee,me){me&1&&ze(r.value)!==ee[0]&&x(r,ee[0]),me&4&&(c.disabled=ee[2]),me&2&&ze(_.value)!==ee[1]&&x(_,ee[1]),me&4&&(C.disabled=ee[2]),me&4&&(S.checked=ee[2]),me&4&&(A.disabled=ee[2]),me&8&&x(A,ee[3]),me&8&&j(M,ee[3]),me&16&&Z!==(Z=ee[4]?"Saving...":"Save")&&j(ie,Z),me&16&&(J.disabled=ee[4]),me&32&&Y!==(Y=ee[5]?"Testing...":"Test Servo")&&j(ne,Y),me&36&&te!==(te=ee[5]||ee[2])&&($.disabled=te)},d(ee){ee&&k(e),G=!1,he(X)}}}function ar(l){let e,t,n,s,r,i,c=l[6]&&cl(l);return r=new qe({props:{title:"",$$slots:{default:[or]},$$scope:{ctx:l}}}),{c(){e=d("div"),t=d("h1"),t.textContent="Servo Settings",n=b(),c&&c.c(),s=b(),pe(r.$$.fragment),a(t,"class","svelte-1lrtwwl"),a(e,"class","page svelte-1lrtwwl")},m(u,f){w(u,e,f),o(e,t),o(e,n),c&&c.m(e,null),o(e,s),ce(r,e,null),i=!0},p(u,[f]){u[6]?c?c.p(u,f):(c=cl(u),c.c(),c.m(e,s)):c&&(c.d(1),c=null);const p={};f&524351&&(p.$$scope={dirty:f,ctx:u}),r.$set(p)},i(u){i||(H(r.$$.fragment,u),i=!0)},o(u){Q(r.$$.fragment,u),i=!1},d(u){u&&k(e),c&&c.d(),ue(r)}}}function cr(l,e,t){let n=1500,s=1100,r=!1,i=1500,c=!1,u=!1,f="",p="";async function m(){try{const P=await an();P.startUS!==void 0&&t(0,n=P.startUS),P.endUS!==void 0&&t(1,s=P.endUS);const I=localStorage.getItem("disableServo");I!==null?t(2,r=I==="true"):P.disabled!==void 0&&t(2,r=P.disabled),t(3,i=n)}catch(P){console.warn("Failed to load servo settings:",P)}}async function v(P,I){if(r){t(6,f="Servo is disabled"),t(7,p="error"),setTimeout(()=>{t(6,f="")},2e3);return}try{await fetch(`/servoSet?val=${P}`),t(6,f=`${I} set to ${P}Âµs`),t(7,p="success"),setTimeout(()=>{t(6,f="")},2e3)}catch{t(6,f=`Failed to set ${I}`),t(7,p="error"),setTimeout(()=>{t(6,f="")},3e3)}}async function _(){t(4,c=!0),t(6,f="");try{await cn({startUS:n,endUS:s,disabled:r}),localStorage.setItem("disableServo",r.toString()),t(6,f="Settings saved successfully"),t(7,p="success"),setTimeout(()=>{t(6,f="")},3e3)}catch(P){t(6,f=`Failed to save: ${P.message}`),t(7,p="error"),setTimeout(()=>{t(6,f="")},3e3)}finally{t(4,c=!1)}}async function h(){if(r){t(6,f="Servo is disabled"),t(7,p="error"),setTimeout(()=>{t(6,f="")},2e3);return}t(5,u=!0),t(6,f="");try{await ws(),t(6,f="Servo triggered"),t(7,p="success"),setTimeout(()=>{t(6,f="")},2e3)}catch(P){t(6,f=`Failed to trigger servo: ${P.message}`),t(7,p="error"),setTimeout(()=>{t(6,f="")},3e3)}finally{t(5,u=!1)}}function C(){if(r){t(6,f="Servo is disabled"),t(7,p="error"),setTimeout(()=>{t(6,f="")},2e3);return}try{fetch(`/servoSet?val=${i}`)}catch(P){console.error("Failed to update live position:",P)}}Be(()=>{m()});function g(){n=ze(this.value),t(0,n)}const y=()=>v(n,"Start position");function T(){s=ze(this.value),t(1,s)}const S=()=>v(s,"End position");function q(){r=this.checked,t(2,r)}function O(){i=ze(this.value),t(3,i)}return[n,s,r,i,c,u,f,p,v,_,h,C,g,y,T,S,q,O]}class ur extends Ie{constructor(e){super(),Ae(this,e,cr,ar,Te,{})}}function fr(l){let e,t,n,s,r,i,c;return t=new qe({props:{title:"IP Filtering",$$slots:{default:[mr]},$$scope:{ctx:l}}}),s=new qe({props:{title:"MQTT Configuration",$$slots:{default:[vr]},$$scope:{ctx:l}}}),i=new qe({props:{title:"Video Mode",$$slots:{default:[_r]},$$scope:{ctx:l}}}),{c(){e=d("div"),pe(t.$$.fragment),n=b(),pe(s.$$.fragment),r=b(),pe(i.$$.fragment),a(e,"class","settings-grid svelte-dlnskf")},m(u,f){w(u,e,f),ce(t,e,null),o(e,n),ce(s,e,null),o(e,r),ce(i,e,null),c=!0},p(u,f){const p={};f[0]&124|f[1]&128&&(p.$$scope={dirty:f,ctx:u}),t.$set(p);const m={};f[0]&130944|f[1]&128&&(m.$$scope={dirty:f,ctx:u}),s.$set(m);const v={};f[0]&917504|f[1]&128&&(v.$$scope={dirty:f,ctx:u}),i.$set(v)},i(u){c||(H(t.$$.fragment,u),H(s.$$.fragment,u),H(i.$$.fragment,u),c=!0)},o(u){Q(t.$$.fragment,u),Q(s.$$.fragment,u),Q(i.$$.fragment,u),c=!1},d(u){u&&k(e),ue(t),ue(s),ue(i)}}}function dr(l){let e,t;return e=new qs({props:{message:l[1],onRetry:l[20]}}),{c(){pe(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p(n,s){const r={};s[0]&2&&(r.message=n[1]),e.$set(r)},i(n){t||(H(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function pr(l){let e,t,n;return t=new He({}),{c(){e=d("div"),pe(t.$$.fragment),a(e,"class","loading-container svelte-dlnskf")},m(s,r){w(s,e,r),ce(t,e,null),n=!0},p:V,i(s){n||(H(t.$$.fragment,s),n=!0)},o(s){Q(t.$$.fragment,s),n=!1},d(s){s&&k(e),ue(t)}}}function ul(l){let e,t,n,s;return{c(){e=d("div"),t=F("Your IP: "),n=d("span"),s=F(l[4]),a(n,"class","client-ip svelte-dlnskf"),a(e,"class","info-text svelte-dlnskf")},m(r,i){w(r,e,i),o(e,t),o(e,n),o(n,s)},p(r,i){i[0]&16&&j(s,r[4])},d(r){r&&k(e)}}}function fl(l){let e,t;return{c(){e=d("div"),t=F(l[5]),a(e,"class","error-text svelte-dlnskf")},m(n,s){w(n,e,s),o(e,t)},p(n,s){s[0]&32&&j(t,n[5])},d(n){n&&k(e)}}}function mr(l){let e,t,n,s,r,i,c,u,f,p,m,v,_,h,C,g,y,T,S=l[6]?"Saving...":"Save IP Filters",q,O,P,I=l[4]&&ul(l),L=l[5]&&fl(l);return{c(){e=d("div"),I&&I.c(),t=b(),n=d("div"),s=d("label"),s.textContent="Whitelist (comma-separated CIDRs)",r=b(),i=d("input"),c=b(),u=d("div"),u.textContent="Leave empty to allow all IPs",f=b(),p=d("div"),m=d("label"),m.textContent="Blacklist (comma-separated CIDRs)",v=b(),_=d("input"),h=b(),C=d("div"),C.textContent="Blocked IPs take precedence over whitelist",g=b(),L&&L.c(),y=b(),T=d("button"),q=F(S),a(s,"for","whitelist"),a(s,"class","svelte-dlnskf"),a(i,"id","whitelist"),a(i,"type","text"),a(i,"placeholder","192.168.1.0/24, 10.0.0.1"),i.disabled=l[6],a(i,"class","svelte-dlnskf"),a(u,"class","help-text svelte-dlnskf"),a(n,"class","form-group svelte-dlnskf"),a(m,"for","blacklist"),a(m,"class","svelte-dlnskf"),a(_,"id","blacklist"),a(_,"type","text"),a(_,"placeholder","192.168.99.0/24, 172.16.0.1"),_.disabled=l[6],a(_,"class","svelte-dlnskf"),a(C,"class","help-text svelte-dlnskf"),a(p,"class","form-group svelte-dlnskf"),a(T,"class","btn-primary svelte-dlnskf"),T.disabled=l[6],a(e,"class","form-section svelte-dlnskf")},m(E,N){w(E,e,N),I&&I.m(e,null),o(e,t),o(e,n),o(n,s),o(n,r),o(n,i),x(i,l[2]),o(n,c),o(n,u),o(e,f),o(e,p),o(p,m),o(p,v),o(p,_),x(_,l[3]),o(p,h),o(p,C),o(e,g),L&&L.m(e,null),o(e,y),o(e,T),o(T,q),O||(P=[R(i,"input",l[25]),R(_,"input",l[26]),R(T,"click",l[21])],O=!0)},p(E,N){E[4]?I?I.p(E,N):(I=ul(E),I.c(),I.m(e,t)):I&&(I.d(1),I=null),N[0]&64&&(i.disabled=E[6]),N[0]&4&&i.value!==E[2]&&x(i,E[2]),N[0]&64&&(_.disabled=E[6]),N[0]&8&&_.value!==E[3]&&x(_,E[3]),E[5]?L?L.p(E,N):(L=fl(E),L.c(),L.m(e,y)):L&&(L.d(1),L=null),N[0]&64&&S!==(S=E[6]?"Saving...":"Save IP Filters")&&j(q,S),N[0]&64&&(T.disabled=E[6])},d(E){E&&k(e),I&&I.d(),L&&L.d(),O=!1,he(P)}}}function dl(l){let e,t;return{c(){e=d("div"),t=F(l[14]),a(e,"class","error-text svelte-dlnskf")},m(n,s){w(n,e,s),o(e,t)},p(n,s){s[0]&16384&&j(t,n[14])},d(n){n&&k(e)}}}function vr(l){let e,t,n,s,r,i,c,u,f,p,m,v,_,h,C,g,y,T,S,q,O,P,I,L,E,N,A,U,B,M,W,D,K,J,Z=l[13]?"Hide":"Show",ie,be,$,Y,ne,te,G,X,ee,me,Le,ge,re=l[15]?"Saving...":"Save MQTT Config",oe,fe,Se,de=l[16]?"Testing...":"Test Connection",le,De,Ze,Qe,ye=l[14]&&dl(l);return{c(){e=d("div"),t=d("div"),n=d("label"),s=d("input"),r=b(),i=d("span"),i.textContent="Enable MQTT",c=b(),u=d("div"),f=d("label"),f.textContent="Broker Address",p=b(),m=d("input"),_=b(),h=d("div"),C=d("label"),C.textContent="Port",g=b(),y=d("input"),S=b(),q=d("div"),O=d("label"),O.textContent="Username",P=b(),I=d("input"),E=b(),N=d("div"),A=d("label"),A.textContent="Password",U=b(),B=d("div"),M=d("input"),K=b(),J=d("button"),ie=F(Z),$=b(),Y=d("div"),ne=d("label"),ne.textContent="Topic Prefix",te=b(),G=d("input"),ee=b(),ye&&ye.c(),me=b(),Le=d("div"),ge=d("button"),oe=F(re),fe=b(),Se=d("button"),le=F(de),a(s,"type","checkbox"),s.disabled=l[15],a(s,"class","svelte-dlnskf"),a(i,"class","svelte-dlnskf"),a(n,"class","svelte-dlnskf"),a(t,"class","form-group checkbox-group svelte-dlnskf"),a(f,"for","mqtt-broker"),a(f,"class","svelte-dlnskf"),a(m,"id","mqtt-broker"),a(m,"type","text"),a(m,"placeholder","mqtt.example.com"),m.disabled=v=l[15]||!l[12],a(m,"class","svelte-dlnskf"),a(u,"class","form-group svelte-dlnskf"),a(C,"for","mqtt-port"),a(C,"class","svelte-dlnskf"),a(y,"id","mqtt-port"),a(y,"type","number"),a(y,"placeholder","1883"),a(y,"min","1"),a(y,"max","65535"),y.disabled=T=l[15]||!l[12],a(y,"class","svelte-dlnskf"),a(h,"class","form-group svelte-dlnskf"),a(O,"for","mqtt-user"),a(O,"class","svelte-dlnskf"),a(I,"id","mqtt-user"),a(I,"type","text"),a(I,"placeholder","Optional"),I.disabled=L=l[15]||!l[12],a(I,"class","svelte-dlnskf"),a(q,"class","form-group svelte-dlnskf"),a(A,"for","mqtt-password"),a(A,"class","svelte-dlnskf"),a(M,"id","mqtt-password"),a(M,"type",W=l[13]?"text":"password"),M.value=l[10],a(M,"placeholder","Optional"),M.disabled=D=l[15]||!l[12],a(M,"class","svelte-dlnskf"),a(J,"type","button"),a(J,"class","toggle-password svelte-dlnskf"),J.disabled=be=!l[12],a(B,"class","password-input-group svelte-dlnskf"),a(N,"class","form-group svelte-dlnskf"),a(ne,"for","mqtt-topic"),a(ne,"class","svelte-dlnskf"),a(G,"id","mqtt-topic"),a(G,"type","text"),a(G,"placeholder","mousetrap"),G.disabled=X=l[15]||!l[12],a(G,"class","svelte-dlnskf"),a(Y,"class","form-group svelte-dlnskf"),a(ge,"class","btn-primary svelte-dlnskf"),ge.disabled=l[15],a(Se,"class","btn-secondary svelte-dlnskf"),Se.disabled=De=l[16]||!l[12]||!l[7],a(Le,"class","button-group svelte-dlnskf"),a(e,"class","form-section svelte-dlnskf")},m(se,_e){w(se,e,_e),o(e,t),o(t,n),o(n,s),s.checked=l[12],o(n,r),o(n,i),o(e,c),o(e,u),o(u,f),o(u,p),o(u,m),x(m,l[7]),o(e,_),o(e,h),o(h,C),o(h,g),o(h,y),x(y,l[8]),o(e,S),o(e,q),o(q,O),o(q,P),o(q,I),x(I,l[9]),o(e,E),o(e,N),o(N,A),o(N,U),o(N,B),o(B,M),o(B,K),o(B,J),o(J,ie),o(e,$),o(e,Y),o(Y,ne),o(Y,te),o(Y,G),x(G,l[11]),o(e,ee),ye&&ye.m(e,null),o(e,me),o(e,Le),o(Le,ge),o(ge,oe),o(Le,fe),o(Le,Se),o(Se,le),Ze||(Qe=[R(s,"change",l[27]),R(m,"input",l[28]),R(y,"input",l[29]),R(I,"input",l[30]),R(M,"input",l[31]),R(J,"click",l[32]),R(G,"input",l[33]),R(ge,"click",l[22]),R(Se,"click",l[23])],Ze=!0)},p(se,_e){_e[0]&32768&&(s.disabled=se[15]),_e[0]&4096&&(s.checked=se[12]),_e[0]&36864&&v!==(v=se[15]||!se[12])&&(m.disabled=v),_e[0]&128&&m.value!==se[7]&&x(m,se[7]),_e[0]&36864&&T!==(T=se[15]||!se[12])&&(y.disabled=T),_e[0]&256&&ze(y.value)!==se[8]&&x(y,se[8]),_e[0]&36864&&L!==(L=se[15]||!se[12])&&(I.disabled=L),_e[0]&512&&I.value!==se[9]&&x(I,se[9]),_e[0]&8192&&W!==(W=se[13]?"text":"password")&&a(M,"type",W),_e[0]&1024&&M.value!==se[10]&&(M.value=se[10]),_e[0]&36864&&D!==(D=se[15]||!se[12])&&(M.disabled=D),_e[0]&8192&&Z!==(Z=se[13]?"Hide":"Show")&&j(ie,Z),_e[0]&4096&&be!==(be=!se[12])&&(J.disabled=be),_e[0]&36864&&X!==(X=se[15]||!se[12])&&(G.disabled=X),_e[0]&2048&&G.value!==se[11]&&x(G,se[11]),se[14]?ye?ye.p(se,_e):(ye=dl(se),ye.c(),ye.m(e,me)):ye&&(ye.d(1),ye=null),_e[0]&32768&&re!==(re=se[15]?"Saving...":"Save MQTT Config")&&j(oe,re),_e[0]&32768&&(ge.disabled=se[15]),_e[0]&65536&&de!==(de=se[16]?"Testing...":"Test Connection")&&j(le,de),_e[0]&69760&&De!==(De=se[16]||!se[12]||!se[7])&&(Se.disabled=De)},d(se){se&&k(e),ye&&ye.d(),Ze=!1,he(Qe)}}}function pl(l){let e,t;return{c(){e=d("div"),t=F(l[19]),a(e,"class","error-text svelte-dlnskf")},m(n,s){w(n,e,s),o(e,t)},p(n,s){s[0]&524288&&j(t,n[19])},d(n){n&&k(e)}}}function _r(l){let e,t,n,s,r,i,c,u,f,p,m,v,_,h,C,g,y,T,S,q,O,P,I,L,E=l[18]?"Applying...":"Apply Video Mode",N,A,U,B,M=l[19]&&pl(l);return A=Ps(l[35][0]),{c(){e=d("div"),t=d("div"),t.textContent="Changing video mode will restart the camera",n=b(),s=d("div"),r=d("label"),r.textContent="Resolution",i=b(),c=d("div"),u=d("label"),f=d("input"),p=b(),m=d("span"),m.textContent="SVGA (800x600)",v=b(),_=d("label"),h=d("input"),C=b(),g=d("span"),g.textContent="VGA (640x480)",y=b(),T=d("label"),S=d("input"),q=b(),O=d("span"),O.textContent="CIF (352x288)",P=b(),M&&M.c(),I=b(),L=d("button"),N=F(E),a(t,"class","warning-text svelte-dlnskf"),a(r,"class","svelte-dlnskf"),a(f,"type","radio"),f.__value="SVGA",x(f,f.__value),f.disabled=l[18],a(f,"class","svelte-dlnskf"),a(m,"class","svelte-dlnskf"),a(u,"class","radio-label svelte-dlnskf"),a(h,"type","radio"),h.__value="VGA",x(h,h.__value),h.disabled=l[18],a(h,"class","svelte-dlnskf"),a(g,"class","svelte-dlnskf"),a(_,"class","radio-label svelte-dlnskf"),a(S,"type","radio"),S.__value="CIF",x(S,S.__value),S.disabled=l[18],a(S,"class","svelte-dlnskf"),a(O,"class","svelte-dlnskf"),a(T,"class","radio-label svelte-dlnskf"),a(c,"class","radio-group svelte-dlnskf"),a(s,"class","form-group svelte-dlnskf"),a(L,"class","btn-primary svelte-dlnskf"),L.disabled=l[18],a(e,"class","form-section svelte-dlnskf"),A.p(f,h,S)},m(W,D){w(W,e,D),o(e,t),o(e,n),o(e,s),o(s,r),o(s,i),o(s,c),o(c,u),o(u,f),f.checked=f.__value===l[17],o(u,p),o(u,m),o(c,v),o(c,_),o(_,h),h.checked=h.__value===l[17],o(_,C),o(_,g),o(c,y),o(c,T),o(T,S),S.checked=S.__value===l[17],o(T,q),o(T,O),o(e,P),M&&M.m(e,null),o(e,I),o(e,L),o(L,N),U||(B=[R(f,"change",l[34]),R(h,"change",l[36]),R(S,"change",l[37]),R(L,"click",l[24])],U=!0)},p(W,D){D[0]&262144&&(f.disabled=W[18]),D[0]&131072&&(f.checked=f.__value===W[17]),D[0]&262144&&(h.disabled=W[18]),D[0]&131072&&(h.checked=h.__value===W[17]),D[0]&262144&&(S.disabled=W[18]),D[0]&131072&&(S.checked=S.__value===W[17]),W[19]?M?M.p(W,D):(M=pl(W),M.c(),M.m(e,I)):M&&(M.d(1),M=null),D[0]&262144&&E!==(E=W[18]?"Applying...":"Apply Video Mode")&&j(N,E),D[0]&262144&&(L.disabled=W[18])},d(W){W&&k(e),M&&M.d(),A.r(),U=!1,he(B)}}}function br(l){let e,t,n,s,r,i;const c=[pr,dr,fr],u=[];function f(p,m){return p[0]?0:p[1]?1:2}return s=f(l),r=u[s]=c[s](l),{c(){e=d("div"),t=d("div"),t.innerHTML='<h1 class="svelte-dlnskf">Settings</h1>',n=b(),r.c(),a(t,"class","header svelte-dlnskf"),a(e,"class","settings-container svelte-dlnskf")},m(p,m){w(p,e,m),o(e,t),o(e,n),u[s].m(e,null),i=!0},p(p,m){let v=s;s=f(p),s===v?u[s].p(p,m):(we(),Q(u[v],1,1,()=>{u[v]=null}),Ce(),r=u[s],r?r.p(p,m):(r=u[s]=c[s](p),r.c()),H(r,1),r.m(e,null))},i(p){i||(H(r),i=!0)},o(p){Q(r),i=!1},d(p){p&&k(e),u[s].d()}}}function ml(l){if(l=l.trim(),!l)return!0;if(!/^(\d{1,3}\.){3}\d{1,3}(\/\d{1,2})?$/.test(l))return!1;const t=l.split("/"),n=t[0].split(".");for(let s of n){const r=parseInt(s);if(r<0||r>255)return!1}if(t[1]){const s=parseInt(t[1]);if(s<0||s>32)return!1}return!0}function hr(l,e,t){let n=!0,s=null,r="",i="",c="",u="",f=!1,p="",m=1883,v="",_="",h="",C=!1,g=!1,y="",T=!1,S=!1,q="SVGA",O=!1,P="";Be(async()=>{await I()});async function I(){t(0,n=!0),t(1,s=null);try{const[te,G,X]=await Promise.all([un(),dn(),mn()]);t(2,r=te.whitelist.join(", ")),t(3,i=te.blacklist.join(", ")),t(4,c=te.clientIP||""),t(7,p=G.broker||""),t(8,m=G.port||1883),t(9,v=G.user||""),t(10,_=G.password||""),t(11,h=G.topic||""),t(12,C=G.enabled||!1),t(17,q=X.mode||"SVGA"),t(0,n=!1)}catch(te){t(1,s=te.message||"Failed to load settings"),t(0,n=!1)}}async function L(){t(5,u="");const te=r.split(",").map(X=>X.trim()).filter(X=>X),G=i.split(",").map(X=>X.trim()).filter(X=>X);for(let X of te)if(!ml(X)){t(5,u=`Invalid CIDR format in whitelist: ${X}`);return}for(let X of G)if(!ml(X)){t(5,u=`Invalid CIDR format in blacklist: ${X}`);return}t(6,f=!0);try{await fn({whitelist:te,blacklist:G}),t(6,f=!1)}catch(X){t(5,u=X.message||"Failed to save IP filters"),t(6,f=!1)}}async function E(){if(t(14,y=""),C&&!p){t(14,y="Broker address is required when MQTT is enabled");return}if(m<1||m>65535){t(14,y="Port must be between 1 and 65535");return}t(15,T=!0);try{await pn({broker:p,port:m,user:v,password:_,topic:h,enabled:C}),t(15,T=!1)}catch(te){t(14,y=te.message||"Failed to save MQTT configuration"),t(15,T=!1)}}async function N(){if(t(14,y=""),!p){t(14,y="Broker address is required");return}t(16,S=!0);try{await new Promise(te=>setTimeout(te,1e3)),t(16,S=!1),alert("MQTT connection test successful")}catch(te){t(14,y=te.message||"Connection test failed"),t(16,S=!1)}}async function A(){if(t(19,P=""),!!confirm("Changing video mode will restart the camera. Continue?")){t(18,O=!0);try{await vn({mode:q}),t(18,O=!1)}catch(G){t(19,P=G.message||"Failed to apply video mode"),t(18,O=!1)}}}const U=[[]];function B(){r=this.value,t(2,r)}function M(){i=this.value,t(3,i)}function W(){C=this.checked,t(12,C)}function D(){p=this.value,t(7,p)}function K(){m=ze(this.value),t(8,m)}function J(){v=this.value,t(9,v)}const Z=te=>t(10,_=te.target.value),ie=()=>t(13,g=!g);function be(){h=this.value,t(11,h)}function $(){q=this.__value,t(17,q)}function Y(){q=this.__value,t(17,q)}function ne(){q=this.__value,t(17,q)}return[n,s,r,i,c,u,f,p,m,v,_,h,C,g,y,T,S,q,O,P,I,L,E,N,A,B,M,W,D,K,J,Z,ie,be,$,U,Y,ne]}class gr extends Ie{constructor(e){super(),Ae(this,e,hr,br,Te,{},null,[-1,-1])}}const{document:kr}=vs;function vl(l,e,t){const n=l.slice();return n[45]=e[t],n}function _l(l,e,t){const n=l.slice();return n[45]=e[t],n}function bl(l,e,t){const n=l.slice();return n[45]=e[t],n}function hl(l){let e,t,n;return{c(){e=d("button"),e.textContent="Clear",a(e,"class","btn-small svelte-16e85dp")},m(s,r){w(s,e,r),t||(n=R(e,"click",l[26]),t=!0)},p:V,d(s){s&&k(e),t=!1,n()}}}function gl(l){let e;function t(r,i){return r[6]?qr:r[9]?yr:r[21].length===0&&r[3]?Sr:r[0].length===0?Cr:wr}let n=t(l),s=n(l);return{c(){e=d("div"),s.c(),a(e,"class","log-content svelte-16e85dp"),z(e,"expanded",l[13])},m(r,i){w(r,e,i),s.m(e,null),l[35](e)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e,null))),i[0]&8192&&z(e,"expanded",r[13])},d(r){r&&k(e),s.d(),l[35](null)}}}function wr(l){let e,t,n,s=Fe(l[21]),r=[];for(let c=0;c<s.length;c+=1)r[c]=kl(bl(l,s,c));let i=l[3]&&l[21].length>0&&wl(l);return{c(){e=d("div");for(let c=0;c<r.length;c+=1)r[c].c();t=b(),i&&i.c(),n=Ee(),a(e,"class","log-list svelte-16e85dp")},m(c,u){w(c,e,u);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(e,null);w(c,t,u),i&&i.m(c,u),w(c,n,u)},p(c,u){if(u[0]&2097152){s=Fe(c[21]);let f;for(f=0;f<s.length;f+=1){const p=bl(c,s,f);r[f]?r[f].p(p,u):(r[f]=kl(p),r[f].c(),r[f].m(e,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}c[3]&&c[21].length>0?i?i.p(c,u):(i=wl(c),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(c){c&&(k(e),k(t),k(n)),Je(r,c),i&&i.d(c)}}}function Cr(l){let e;return{c(){e=d("div"),e.textContent="No system logs available",a(e,"class","no-data svelte-16e85dp")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function Sr(l){let e,t,n,s;return{c(){e=d("div"),t=F('No logs match filter "'),n=F(l[3]),s=F('"'),a(e,"class","no-results svelte-16e85dp")},m(r,i){w(r,e,i),o(e,t),o(e,n),o(e,s)},p(r,i){i[0]&8&&j(n,r[3])},d(r){r&&k(e)}}}function yr(l){let e,t,n;return{c(){e=d("div"),t=F("Error: "),n=F(l[9]),a(e,"class","error svelte-16e85dp")},m(s,r){w(s,e,r),o(e,t),o(e,n)},p(s,r){r[0]&512&&j(n,s[9])},d(s){s&&k(e)}}}function qr(l){let e;return{c(){e=d("div"),e.textContent="Loading system logs...",a(e,"class","loading svelte-16e85dp")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function kl(l){let e,t=l[45]+"",n;return{c(){e=d("div"),n=F(t),a(e,"class","log-line svelte-16e85dp")},m(s,r){w(s,e,r),o(e,n)},p(s,r){r[0]&2097152&&t!==(t=s[45]+"")&&j(n,t)},d(s){s&&k(e)}}}function wl(l){let e,t,n=l[21].length+"",s,r,i=l[0].length+"",c,u;return{c(){e=d("div"),t=F("Showing "),s=F(n),r=F(" of "),c=F(i),u=F(" logs"),a(e,"class","filter-info svelte-16e85dp")},m(f,p){w(f,e,p),o(e,t),o(e,s),o(e,r),o(e,c),o(e,u)},p(f,p){p[0]&2097152&&n!==(n=f[21].length+"")&&j(s,n),p[0]&1&&i!==(i=f[0].length+"")&&j(c,i)},d(f){f&&k(e)}}}function Cl(l){let e,t,n;return{c(){e=d("button"),e.textContent="Clear",a(e,"class","btn-small svelte-16e85dp")},m(s,r){w(s,e,r),t||(n=R(e,"click",l[27]),t=!0)},p:V,d(s){s&&k(e),t=!1,n()}}}function Sl(l){let e;function t(r,i){return r[7]?Ar:r[10]?Er:r[20].length===0&&r[4]?Fr:r[1].length===0?Lr:Tr}let n=t(l),s=n(l);return{c(){e=d("div"),s.c(),a(e,"class","log-content svelte-16e85dp"),z(e,"expanded",l[14])},m(r,i){w(r,e,i),s.m(e,null),l[38](e)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e,null))),i[0]&16384&&z(e,"expanded",r[14])},d(r){r&&k(e),s.d(),l[38](null)}}}function Tr(l){let e,t,n,s=Fe(l[20]),r=[];for(let c=0;c<s.length;c+=1)r[c]=yl(_l(l,s,c));let i=l[4]&&l[20].length>0&&ql(l);return{c(){e=d("div");for(let c=0;c<r.length;c+=1)r[c].c();t=b(),i&&i.c(),n=Ee(),a(e,"class","log-list svelte-16e85dp")},m(c,u){w(c,e,u);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(e,null);w(c,t,u),i&&i.m(c,u),w(c,n,u)},p(c,u){if(u[0]&1048576){s=Fe(c[20]);let f;for(f=0;f<s.length;f+=1){const p=_l(c,s,f);r[f]?r[f].p(p,u):(r[f]=yl(p),r[f].c(),r[f].m(e,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}c[4]&&c[20].length>0?i?i.p(c,u):(i=ql(c),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(c){c&&(k(e),k(t),k(n)),Je(r,c),i&&i.d(c)}}}function Lr(l){let e;return{c(){e=d("div"),e.textContent="No previous logs available",a(e,"class","no-data svelte-16e85dp")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function Fr(l){let e,t,n,s;return{c(){e=d("div"),t=F('No logs match filter "'),n=F(l[4]),s=F('"'),a(e,"class","no-results svelte-16e85dp")},m(r,i){w(r,e,i),o(e,t),o(e,n),o(e,s)},p(r,i){i[0]&16&&j(n,r[4])},d(r){r&&k(e)}}}function Er(l){let e,t,n;return{c(){e=d("div"),t=F("Error: "),n=F(l[10]),a(e,"class","error svelte-16e85dp")},m(s,r){w(s,e,r),o(e,t),o(e,n)},p(s,r){r[0]&1024&&j(n,s[10])},d(s){s&&k(e)}}}function Ar(l){let e;return{c(){e=d("div"),e.textContent="Loading previous logs...",a(e,"class","loading svelte-16e85dp")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function yl(l){let e,t=l[45]+"",n;return{c(){e=d("div"),n=F(t),a(e,"class","log-line svelte-16e85dp")},m(s,r){w(s,e,r),o(e,n)},p(s,r){r[0]&1048576&&t!==(t=s[45]+"")&&j(n,t)},d(s){s&&k(e)}}}function ql(l){let e,t,n=l[20].length+"",s,r,i=l[1].length+"",c,u;return{c(){e=d("div"),t=F("Showing "),s=F(n),r=F(" of "),c=F(i),u=F(" logs"),a(e,"class","filter-info svelte-16e85dp")},m(f,p){w(f,e,p),o(e,t),o(e,s),o(e,r),o(e,c),o(e,u)},p(f,p){p[0]&1048576&&n!==(n=f[20].length+"")&&j(s,n),p[0]&2&&i!==(i=f[1].length+"")&&j(c,i)},d(f){f&&k(e)}}}function Tl(l){let e,t,n;return{c(){e=d("button"),e.textContent="Clear",a(e,"class","btn-small svelte-16e85dp")},m(s,r){w(s,e,r),t||(n=R(e,"click",l[28]),t=!0)},p:V,d(s){s&&k(e),t=!1,n()}}}function Ll(l){let e;function t(r,i){return r[8]?Mr:r[11]?Nr:r[19].length===0&&r[5]?Or:r[2].length===0?Pr:Ir}let n=t(l),s=n(l);return{c(){e=d("div"),s.c(),a(e,"class","log-content svelte-16e85dp"),z(e,"expanded",l[15])},m(r,i){w(r,e,i),s.m(e,null),l[41](e)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e,null))),i[0]&32768&&z(e,"expanded",r[15])},d(r){r&&k(e),s.d(),l[41](null)}}}function Ir(l){let e,t,n,s=Fe(l[19]),r=[];for(let c=0;c<s.length;c+=1)r[c]=Fl(vl(l,s,c));let i=l[5]&&l[19].length>0&&El(l);return{c(){e=d("div");for(let c=0;c<r.length;c+=1)r[c].c();t=b(),i&&i.c(),n=Ee(),a(e,"class","log-list svelte-16e85dp")},m(c,u){w(c,e,u);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(e,null);w(c,t,u),i&&i.m(c,u),w(c,n,u)},p(c,u){if(u[0]&524288){s=Fe(c[19]);let f;for(f=0;f<s.length;f+=1){const p=vl(c,s,f);r[f]?r[f].p(p,u):(r[f]=Fl(p),r[f].c(),r[f].m(e,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}c[5]&&c[19].length>0?i?i.p(c,u):(i=El(c),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(c){c&&(k(e),k(t),k(n)),Je(r,c),i&&i.d(c)}}}function Pr(l){let e;return{c(){e=d("div"),e.textContent="No older logs available (logs from 2 boots ago)",a(e,"class","no-data svelte-16e85dp")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function Or(l){let e,t,n,s;return{c(){e=d("div"),t=F('No logs match filter "'),n=F(l[5]),s=F('"'),a(e,"class","no-results svelte-16e85dp")},m(r,i){w(r,e,i),o(e,t),o(e,n),o(e,s)},p(r,i){i[0]&32&&j(n,r[5])},d(r){r&&k(e)}}}function Nr(l){let e,t,n;return{c(){e=d("div"),t=F("Error: "),n=F(l[11]),a(e,"class","error svelte-16e85dp")},m(s,r){w(s,e,r),o(e,t),o(e,n)},p(s,r){r[0]&2048&&j(n,s[11])},d(s){s&&k(e)}}}function Mr(l){let e;return{c(){e=d("div"),e.textContent="Loading older logs...",a(e,"class","loading svelte-16e85dp")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function Fl(l){let e,t=l[45]+"",n;return{c(){e=d("div"),n=F(t),a(e,"class","log-line svelte-16e85dp")},m(s,r){w(s,e,r),o(e,n)},p(s,r){r[0]&524288&&t!==(t=s[45]+"")&&j(n,t)},d(s){s&&k(e)}}}function El(l){let e,t,n=l[19].length+"",s,r,i=l[2].length+"",c,u;return{c(){e=d("div"),t=F("Showing "),s=F(n),r=F(" of "),c=F(i),u=F(" logs"),a(e,"class","filter-info svelte-16e85dp")},m(f,p){w(f,e,p),o(e,t),o(e,s),o(e,r),o(e,c),o(e,u)},p(f,p){p[0]&524288&&n!==(n=f[19].length+"")&&j(s,n),p[0]&4&&i!==(i=f[2].length+"")&&j(c,i)},d(f){f&&k(e)}}}function Rr(l){let e,t,n,s,r,i,c,u=l[12]?"Auto-refresh On":"Auto-refresh Off",f,p,m,v,_,h,C,g,y,T,S=l[13]?"â–¼":"â–¶",q,O,P,I,L,E,N,A,U,B,M,W,D,K,J,Z,ie=l[14]?"â–¼":"â–¶",be,$,Y,ne,te,G,X,ee,me,Le,ge,re,oe,fe,Se,de,le=l[15]?"â–¼":"â–¶",De,Ze,Qe,ye,se,_e,Ot,bt,Ke,Nt,at,Mt,ht,Rt,Pe=l[3]&&hl(l),Oe=l[13]&&gl(l),Ne=l[4]&&Cl(l),Me=l[14]&&Sl(l),Re=l[5]&&Tl(l),Ue=l[15]&&Ll(l);return{c(){e=b(),t=d("div"),n=d("div"),s=d("h1"),s.textContent="Logs & Diagnostics",r=b(),i=d("div"),c=d("button"),f=F(u),p=F(" ("),m=F(Ts),v=F("s)"),_=b(),h=d("button"),h.textContent="Refresh Now",C=b(),g=d("div"),y=d("div"),T=d("button"),q=F(S),O=b(),P=d("h2"),P.textContent="System Logs",I=b(),L=d("div"),E=d("input"),N=b(),Pe&&Pe.c(),A=b(),U=d("button"),B=F("Export"),W=b(),Oe&&Oe.c(),D=b(),K=d("div"),J=d("div"),Z=d("button"),be=F(ie),$=b(),Y=d("h2"),Y.textContent="Previous System Logs",ne=b(),te=d("div"),G=d("input"),X=b(),Ne&&Ne.c(),ee=b(),me=d("button"),Le=F("Export"),re=b(),Me&&Me.c(),oe=b(),fe=d("div"),Se=d("div"),de=d("button"),De=F(le),Ze=b(),Qe=d("h2"),Qe.textContent="Older Logs (2 boots ago)",ye=b(),se=d("div"),_e=d("input"),Ot=b(),Re&&Re.c(),bt=b(),Ke=d("button"),Nt=F("Export"),Mt=b(),Ue&&Ue.c(),kr.title="Logs & Diagnostics - MouseTrap",a(s,"class","svelte-16e85dp"),a(c,"class","btn svelte-16e85dp"),z(c,"active",l[12]),a(h,"class","btn svelte-16e85dp"),a(i,"class","header-controls svelte-16e85dp"),a(n,"class","header svelte-16e85dp"),a(T,"class","expand-btn svelte-16e85dp"),a(P,"class","svelte-16e85dp"),a(E,"type","text"),a(E,"class","filter-input svelte-16e85dp"),a(E,"placeholder","Filter logs..."),a(U,"class","btn-small svelte-16e85dp"),U.disabled=M=l[0].length===0,a(L,"class","log-controls svelte-16e85dp"),a(y,"class","log-header svelte-16e85dp"),a(g,"class","log-section svelte-16e85dp"),a(Z,"class","expand-btn svelte-16e85dp"),a(Y,"class","svelte-16e85dp"),a(G,"type","text"),a(G,"class","filter-input svelte-16e85dp"),a(G,"placeholder","Filter logs..."),a(me,"class","btn-small svelte-16e85dp"),me.disabled=ge=l[1].length===0,a(te,"class","log-controls svelte-16e85dp"),a(J,"class","log-header svelte-16e85dp"),a(K,"class","log-section svelte-16e85dp"),a(de,"class","expand-btn svelte-16e85dp"),a(Qe,"class","svelte-16e85dp"),a(_e,"type","text"),a(_e,"class","filter-input svelte-16e85dp"),a(_e,"placeholder","Filter logs..."),a(Ke,"class","btn-small svelte-16e85dp"),Ke.disabled=at=l[2].length===0,a(se,"class","log-controls svelte-16e85dp"),a(Se,"class","log-header svelte-16e85dp"),a(fe,"class","log-section svelte-16e85dp"),a(t,"class","logs-container svelte-16e85dp")},m(ae,ke){w(ae,e,ke),w(ae,t,ke),o(t,n),o(n,s),o(n,r),o(n,i),o(i,c),o(c,f),o(c,p),o(c,m),o(c,v),o(i,_),o(i,h),o(t,C),o(t,g),o(g,y),o(y,T),o(T,q),o(y,O),o(y,P),o(y,I),o(y,L),o(L,E),x(E,l[3]),o(L,N),Pe&&Pe.m(L,null),o(L,A),o(L,U),o(U,B),o(g,W),Oe&&Oe.m(g,null),o(t,D),o(t,K),o(K,J),o(J,Z),o(Z,be),o(J,$),o(J,Y),o(J,ne),o(J,te),o(te,G),x(G,l[4]),o(te,X),Ne&&Ne.m(te,null),o(te,ee),o(te,me),o(me,Le),o(K,re),Me&&Me.m(K,null),o(t,oe),o(t,fe),o(fe,Se),o(Se,de),o(de,De),o(Se,Ze),o(Se,Qe),o(Se,ye),o(Se,se),o(se,_e),x(_e,l[5]),o(se,Ot),Re&&Re.m(se,null),o(se,bt),o(se,Ke),o(Ke,Nt),o(fe,Mt),Ue&&Ue.m(fe,null),ht||(Rt=[R(c,"click",l[25]),R(h,"click",l[32]),R(T,"click",l[29]),R(E,"input",l[33]),R(U,"click",l[34]),R(Z,"click",l[30]),R(G,"input",l[36]),R(me,"click",l[37]),R(de,"click",l[31]),R(_e,"input",l[39]),R(Ke,"click",l[40])],ht=!0)},p(ae,ke){ke[0]&4096&&u!==(u=ae[12]?"Auto-refresh On":"Auto-refresh Off")&&j(f,u),ke[0]&4096&&z(c,"active",ae[12]),ke[0]&8192&&S!==(S=ae[13]?"â–¼":"â–¶")&&j(q,S),ke[0]&8&&E.value!==ae[3]&&x(E,ae[3]),ae[3]?Pe?Pe.p(ae,ke):(Pe=hl(ae),Pe.c(),Pe.m(L,A)):Pe&&(Pe.d(1),Pe=null),ke[0]&1&&M!==(M=ae[0].length===0)&&(U.disabled=M),ae[13]?Oe?Oe.p(ae,ke):(Oe=gl(ae),Oe.c(),Oe.m(g,null)):Oe&&(Oe.d(1),Oe=null),ke[0]&16384&&ie!==(ie=ae[14]?"â–¼":"â–¶")&&j(be,ie),ke[0]&16&&G.value!==ae[4]&&x(G,ae[4]),ae[4]?Ne?Ne.p(ae,ke):(Ne=Cl(ae),Ne.c(),Ne.m(te,ee)):Ne&&(Ne.d(1),Ne=null),ke[0]&2&&ge!==(ge=ae[1].length===0)&&(me.disabled=ge),ae[14]?Me?Me.p(ae,ke):(Me=Sl(ae),Me.c(),Me.m(K,null)):Me&&(Me.d(1),Me=null),ke[0]&32768&&le!==(le=ae[15]?"â–¼":"â–¶")&&j(De,le),ke[0]&32&&_e.value!==ae[5]&&x(_e,ae[5]),ae[5]?Re?Re.p(ae,ke):(Re=Tl(ae),Re.c(),Re.m(se,bt)):Re&&(Re.d(1),Re=null),ke[0]&4&&at!==(at=ae[2].length===0)&&(Ke.disabled=at),ae[15]?Ue?Ue.p(ae,ke):(Ue=Ll(ae),Ue.c(),Ue.m(fe,null)):Ue&&(Ue.d(1),Ue=null)},i:V,o:V,d(ae){ae&&(k(e),k(t)),Pe&&Pe.d(),Oe&&Oe.d(),Ne&&Ne.d(),Me&&Me.d(),Re&&Re.d(),Ue&&Ue.d(),ht=!1,he(Rt)}}}let Ts=5;function Ct(l,e){const t=l.join(`
`),n=new Blob([t],{type:"text/plain"}),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=e,r.click(),URL.revokeObjectURL(s)}function Ur(l,e,t){let n,s,r,i=[],c=[],u=[],f=!0,p=!0,m=!0,v=null,_=null,h=null,C=!1,g=null,y="",T="",S="",q=!0,O=!0,P=!1,I,L,E;async function N(re=!0){const oe=(I==null?void 0:I.scrollTop)||0;re&&t(6,f=!0),t(9,v=null);try{t(0,i=await _n())}catch(fe){console.error("Failed to fetch system logs:",fe),t(9,v=fe.message),t(0,i=[])}finally{re&&t(6,f=!1),I&&oe>0&&requestAnimationFrame(()=>{t(16,I.scrollTop=oe,I)})}}async function A(re=!0){const oe=(L==null?void 0:L.scrollTop)||0;re&&t(7,p=!0),t(10,_=null);try{t(1,c=await bn())}catch(fe){console.error("Failed to fetch previous logs:",fe),t(10,_=fe.message),t(1,c=[])}finally{re&&t(7,p=!1),L&&oe>0&&requestAnimationFrame(()=>{t(17,L.scrollTop=oe,L)})}}async function U(re=!0){const oe=(E==null?void 0:E.scrollTop)||0;re&&t(8,m=!0),t(11,h=null);try{t(2,u=await hn())}catch(fe){console.error("Failed to fetch older logs:",fe),t(11,h=fe.message),t(2,u=[])}finally{re&&t(8,m=!1),E&&oe>0&&requestAnimationFrame(()=>{t(18,E.scrollTop=oe,E)})}}function B(){t(12,C=!C),C?M():W()}function M(){W(),g=setInterval(()=>{N(!1),A(!1),U(!1)},Ts*1e3)}function W(){g&&(clearInterval(g),g=null)}function D(){t(3,y="")}function K(){t(4,T="")}function J(){t(5,S="")}function Z(){t(13,q=!q)}function ie(){t(14,O=!O)}function be(){t(15,P=!P)}Be(()=>{N(),A(),U()}),it(()=>{W()});const $=()=>{N(!0),A(!0),U(!0)};function Y(){y=this.value,t(3,y)}const ne=()=>Ct(i,"system-logs.txt");function te(re){et[re?"unshift":"push"](()=>{I=re,t(16,I)})}function G(){T=this.value,t(4,T)}const X=()=>Ct(c,"previous-logs.txt");function ee(re){et[re?"unshift":"push"](()=>{L=re,t(17,L)})}function me(){S=this.value,t(5,S)}const Le=()=>Ct(u,"older-logs.txt");function ge(re){et[re?"unshift":"push"](()=>{E=re,t(18,E)})}return l.$$.update=()=>{l.$$.dirty[0]&9&&t(21,n=i.filter(re=>re.toLowerCase().includes(y.toLowerCase()))),l.$$.dirty[0]&18&&t(20,s=c.filter(re=>re.toLowerCase().includes(T.toLowerCase()))),l.$$.dirty[0]&36&&t(19,r=u.filter(re=>re.toLowerCase().includes(S.toLowerCase())))},[i,c,u,y,T,S,f,p,m,v,_,h,C,q,O,P,I,L,E,r,s,n,N,A,U,B,D,K,J,Z,ie,be,$,Y,ne,te,G,X,ee,me,Le,ge]}class Al extends Ie{constructor(e){super(),Ae(this,e,Ur,Rr,Te,{},null,[-1,-1])}}function Dr(l){let e,t,n,s,r,i,c,u,f,p,m=l[6]&&Il();return n=new qe({props:{$$slots:{default:[Wr]},$$scope:{ctx:l}}}),r=new qe({props:{$$slots:{default:[Hr]},$$scope:{ctx:l}}}),c=new qe({props:{$$slots:{default:[Qr]},$$scope:{ctx:l}}}),f=new qe({props:{$$slots:{default:[Zr]},$$scope:{ctx:l}}}),{c(){m&&m.c(),e=b(),t=d("div"),pe(n.$$.fragment),s=b(),pe(r.$$.fragment),i=b(),pe(c.$$.fragment),u=b(),pe(f.$$.fragment),a(t,"class","cards-grid svelte-qwtv9g")},m(v,_){m&&m.m(v,_),w(v,e,_),w(v,t,_),ce(n,t,null),o(t,s),ce(r,t,null),o(t,i),ce(c,t,null),o(t,u),ce(f,t,null),p=!0},p(v,_){v[6]?m||(m=Il(),m.c(),m.m(e.parentNode,e)):m&&(m.d(1),m=null);const h={};_&65537&&(h.$$scope={dirty:_,ctx:v}),n.$set(h);const C={};_&65552&&(C.$$scope={dirty:_,ctx:v}),r.$set(C);const g={};_&65596&&(g.$$scope={dirty:_,ctx:v}),c.$set(g);const y={};_&65537&&(y.$$scope={dirty:_,ctx:v}),f.$set(y)},i(v){p||(H(n.$$.fragment,v),H(r.$$.fragment,v),H(c.$$.fragment,v),H(f.$$.fragment,v),p=!0)},o(v){Q(n.$$.fragment,v),Q(r.$$.fragment,v),Q(c.$$.fragment,v),Q(f.$$.fragment,v),p=!1},d(v){v&&(k(e),k(t)),m&&m.d(v),ue(n),ue(r),ue(c),ue(f)}}}function jr(l){let e,t,n;return t=new He({}),{c(){e=d("div"),pe(t.$$.fragment),a(e,"class","loading-container svelte-qwtv9g")},m(s,r){w(s,e,r),ce(t,e,null),n=!0},p:V,i(s){n||(H(t.$$.fragment,s),n=!0)},o(s){Q(t.$$.fragment,s),n=!1},d(s){s&&k(e),ue(t)}}}function Il(l){let e;return{c(){e=d("div"),e.textContent="Device is back online!",a(e,"class","online-banner svelte-qwtv9g")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Pl(l){let e,t,n=l[0].buildDate+"",s;return{c(){e=d("div"),t=F("Built: "),s=F(n),a(e,"class","build-date svelte-qwtv9g")},m(r,i){w(r,e,i),o(e,t),o(e,s)},p(r,i){i&1&&n!==(n=r[0].buildDate+"")&&j(s,n)},d(r){r&&k(e)}}}function Ol(l){let e,t,n,s,r=l[0].chipModel+"",i;return{c(){e=d("tr"),t=d("td"),t.textContent="Chip Model",n=b(),s=d("td"),i=F(r),a(t,"class","label svelte-qwtv9g"),a(s,"class","value svelte-qwtv9g"),a(e,"class","svelte-qwtv9g")},m(c,u){w(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=c[0].chipModel+"")&&j(i,r)},d(c){c&&k(e)}}}function Nl(l){let e,t,n,s,r=Wl(l[0].cpuFreq)+"",i;return{c(){e=d("tr"),t=d("td"),t.textContent="CPU Frequency",n=b(),s=d("td"),i=F(r),a(t,"class","label svelte-qwtv9g"),a(s,"class","value svelte-qwtv9g"),a(e,"class","svelte-qwtv9g")},m(c,u){w(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=Wl(c[0].cpuFreq)+"")&&j(i,r)},d(c){c&&k(e)}}}function Ml(l){let e,t,n,s,r=vt(l[0].flashSize)+"",i;return{c(){e=d("tr"),t=d("td"),t.textContent="Flash Size",n=b(),s=d("td"),i=F(r),a(t,"class","label svelte-qwtv9g"),a(s,"class","value svelte-qwtv9g"),a(e,"class","svelte-qwtv9g")},m(c,u){w(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=vt(c[0].flashSize)+"")&&j(i,r)},d(c){c&&k(e)}}}function Rl(l){let e,t,n,s,r=vt(l[0].psramSize)+"",i;return{c(){e=d("tr"),t=d("td"),t.textContent="PSRAM Size",n=b(),s=d("td"),i=F(r),a(t,"class","label svelte-qwtv9g"),a(s,"class","value svelte-qwtv9g"),a(e,"class","svelte-qwtv9g")},m(c,u){w(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=vt(c[0].psramSize)+"")&&j(i,r)},d(c){c&&k(e)}}}function Ul(l){let e,t,n,s,r=l[0].macAddress+"",i;return{c(){e=d("tr"),t=d("td"),t.textContent="MAC Address",n=b(),s=d("td"),i=F(r),a(t,"class","label svelte-qwtv9g"),a(s,"class","value svelte-qwtv9g"),a(e,"class","svelte-qwtv9g")},m(c,u){w(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=c[0].macAddress+"")&&j(i,r)},d(c){c&&k(e)}}}function Wr(l){var O,P,I,L,E,N,A;let e,t,n,s=(((O=l[0])==null?void 0:O.firmwareVersion)||"Unknown")+"",r,i,c,u,f,p,m,v,_,h,C=((P=l[0])==null?void 0:P.buildDate)&&Pl(l),g=((I=l[0])==null?void 0:I.chipModel)&&Ol(l),y=((L=l[0])==null?void 0:L.cpuFreq)&&Nl(l),T=((E=l[0])==null?void 0:E.flashSize)&&Ml(l),S=((N=l[0])==null?void 0:N.psramSize)&&Rl(l),q=((A=l[0])==null?void 0:A.macAddress)&&Ul(l);return{c(){e=d("h2"),e.textContent="ESP32 Sketch",t=b(),n=d("div"),r=F(s),i=b(),C&&C.c(),c=b(),u=d("div"),f=d("table"),p=d("tbody"),g&&g.c(),m=b(),y&&y.c(),v=b(),T&&T.c(),_=b(),S&&S.c(),h=b(),q&&q.c(),a(e,"class","svelte-qwtv9g"),a(n,"class","firmware-version svelte-qwtv9g"),a(f,"class","svelte-qwtv9g"),a(u,"class","device-info svelte-qwtv9g")},m(U,B){w(U,e,B),w(U,t,B),w(U,n,B),o(n,r),w(U,i,B),C&&C.m(U,B),w(U,c,B),w(U,u,B),o(u,f),o(f,p),g&&g.m(p,null),o(p,m),y&&y.m(p,null),o(p,v),T&&T.m(p,null),o(p,_),S&&S.m(p,null),o(p,h),q&&q.m(p,null)},p(U,B){var M,W,D,K,J,Z,ie;B&1&&s!==(s=(((M=U[0])==null?void 0:M.firmwareVersion)||"Unknown")+"")&&j(r,s),(W=U[0])!=null&&W.buildDate?C?C.p(U,B):(C=Pl(U),C.c(),C.m(c.parentNode,c)):C&&(C.d(1),C=null),(D=U[0])!=null&&D.chipModel?g?g.p(U,B):(g=Ol(U),g.c(),g.m(p,m)):g&&(g.d(1),g=null),(K=U[0])!=null&&K.cpuFreq?y?y.p(U,B):(y=Nl(U),y.c(),y.m(p,v)):y&&(y.d(1),y=null),(J=U[0])!=null&&J.flashSize?T?T.p(U,B):(T=Ml(U),T.c(),T.m(p,_)):T&&(T.d(1),T=null),(Z=U[0])!=null&&Z.psramSize?S?S.p(U,B):(S=Rl(U),S.c(),S.m(p,h)):S&&(S.d(1),S=null),(ie=U[0])!=null&&ie.macAddress?q?q.p(U,B):(q=Ul(U),q.c(),q.m(p,null)):q&&(q.d(1),q=null)},d(U){U&&(k(e),k(t),k(n),k(i),k(c),k(u)),C&&C.d(U),g&&g.d(),y&&y.d(),T&&T.d(),S&&S.d(),q&&q.d()}}}function Hr(l){let e,t,n,s,r,i,c,u,f,p;return{c(){e=d("h2"),e.textContent="OTA Update",t=b(),n=d("p"),n.textContent="Upload new firmware via the web-based OTA interface.",s=b(),r=d("button"),i=F("Open OTA Update Interface"),c=b(),u=d("div"),u.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 12H7V7h2v5zm0-6H7V4h2v2z"></path></svg>
          Device will reboot after update`,a(e,"class","svelte-qwtv9g"),a(n,"class","description svelte-qwtv9g"),a(r,"class","ota-button svelte-qwtv9g"),r.disabled=l[4],a(u,"class","warning-text svelte-qwtv9g")},m(m,v){w(m,e,v),w(m,t,v),w(m,n,v),w(m,s,v),w(m,r,v),o(r,i),w(m,c,v),w(m,u,v),f||(p=R(r,"click",$r),f=!0)},p(m,v){v&16&&(r.disabled=m[4])},d(m){m&&(k(e),k(t),k(n),k(s),k(r),k(c),k(u)),f=!1,p()}}}function zr(l){let e,t,n,s,r,i,c;return{c(){e=d("p"),e.textContent="Restart the device to apply configuration changes or recover from errors.",t=b(),n=d("button"),n.textContent="Reboot Device",s=b(),r=d("div"),r.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 12H7V7h2v5zm0-6H7V4h2v2z"></path></svg>
            Device will be unavailable for approximately 30 seconds`,a(e,"class","description svelte-qwtv9g"),a(n,"class","reboot-button svelte-qwtv9g"),a(r,"class","warning-text svelte-qwtv9g")},m(u,f){w(u,e,f),w(u,t,f),w(u,n,f),w(u,s,f),w(u,r,f),i||(c=R(n,"click",l[7]),i=!0)},p:V,i:V,o:V,d(u){u&&(k(e),k(t),k(n),k(s),k(r)),i=!1,c()}}}function Br(l){let e,t,n,s,r,i,c,u=l[3]!==1?"s":"",f,p,m,v,_,h;return{c(){e=d("div"),t=d("p"),t.textContent="Are you sure you want to reboot the device?",n=b(),s=d("div"),r=F("Rebooting in "),i=F(l[3]),c=F(" second"),f=F(u),p=F("..."),m=b(),v=d("button"),v.textContent="Cancel",a(t,"class","confirm-text svelte-qwtv9g"),a(s,"class","countdown svelte-qwtv9g"),a(v,"class","cancel-button svelte-qwtv9g"),a(e,"class","confirm-container svelte-qwtv9g")},m(C,g){w(C,e,g),o(e,t),o(e,n),o(e,s),o(s,r),o(s,i),o(s,c),o(s,f),o(s,p),o(e,m),o(e,v),_||(h=R(v,"click",l[8]),_=!0)},p(C,g){g&8&&j(i,C[3]),g&8&&u!==(u=C[3]!==1?"s":"")&&j(f,u)},i:V,o:V,d(C){C&&k(e),_=!1,h()}}}function Vr(l){let e,t,n,s,r;t=new He({});function i(f,p){return f[5]?Jr:Gr}let c=i(l),u=c(l);return{c(){e=d("div"),pe(t.$$.fragment),n=b(),s=d("div"),u.c(),a(s,"class","rebooting-text svelte-qwtv9g"),a(e,"class","rebooting-container svelte-qwtv9g")},m(f,p){w(f,e,p),ce(t,e,null),o(e,n),o(e,s),u.m(s,null),r=!0},p(f,p){c!==(c=i(f))&&(u.d(1),u=c(f),u&&(u.c(),u.m(s,null)))},i(f){r||(H(t.$$.fragment,f),r=!0)},o(f){Q(t.$$.fragment,f),r=!1},d(f){f&&k(e),ue(t),u.d()}}}function Gr(l){let e;return{c(){e=F("Rebooting device...")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Jr(l){let e;return{c(){e=F("Waiting for device to come back online...")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Qr(l){let e,t,n,s,r,i;const c=[Vr,Br,zr],u=[];function f(p,m){return p[4]?0:p[2]?1:2}return n=f(l),s=u[n]=c[n](l),{c(){e=d("h2"),e.textContent="Device Reboot",t=b(),s.c(),r=Ee(),a(e,"class","svelte-qwtv9g")},m(p,m){w(p,e,m),w(p,t,m),u[n].m(p,m),w(p,r,m),i=!0},p(p,m){let v=n;n=f(p),n===v?u[n].p(p,m):(we(),Q(u[v],1,1,()=>{u[v]=null}),Ce(),s=u[n],s?s.p(p,m):(s=u[n]=c[n](p),s.c()),H(s,1),s.m(r.parentNode,r))},i(p){i||(H(s),i=!0)},o(p){Q(s),i=!1},d(p){p&&(k(e),k(t),k(r)),u[n].d(p)}}}function Kr(l){let e;return{c(){e=d("p"),e.textContent="No version information available",a(e,"class","placeholder-text svelte-qwtv9g")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function Yr(l){let e,t,n,s,r,i=(l[0].firmwareVersion||"Unknown")+"",c,u,f,p,m,v,_=ut(l[0].firmwareUpdateTime)+"",h,C,g,y,T,S,q,O=ut(l[0].filesystemUpdateTime)+"",P,I,L=l[0].filesystemVersion&&Dl(l),E=l[0].sdkVersion&&jl(l);return{c(){e=d("div"),t=d("div"),n=d("div"),n.textContent="Sketch Version:",s=b(),r=d("div"),c=F(i),u=b(),f=d("div"),p=d("div"),p.textContent="Last Firmware Update:",m=b(),v=d("div"),h=F(_),C=b(),L&&L.c(),g=b(),y=d("div"),T=d("div"),T.textContent="Last Filesystem Update:",S=b(),q=d("div"),P=F(O),I=b(),E&&E.c(),a(n,"class","history-label svelte-qwtv9g"),a(r,"class","history-value svelte-qwtv9g"),a(t,"class","history-item svelte-qwtv9g"),a(p,"class","timestamp-label svelte-qwtv9g"),a(v,"class","timestamp-value svelte-qwtv9g"),a(f,"class","timestamp-item svelte-qwtv9g"),a(T,"class","timestamp-label svelte-qwtv9g"),a(q,"class","timestamp-value svelte-qwtv9g"),a(y,"class","timestamp-item svelte-qwtv9g"),a(e,"class","update-history svelte-qwtv9g")},m(N,A){w(N,e,A),o(e,t),o(t,n),o(t,s),o(t,r),o(r,c),o(e,u),o(e,f),o(f,p),o(f,m),o(f,v),o(v,h),o(e,C),L&&L.m(e,null),o(e,g),o(e,y),o(y,T),o(y,S),o(y,q),o(q,P),o(e,I),E&&E.m(e,null)},p(N,A){A&1&&i!==(i=(N[0].firmwareVersion||"Unknown")+"")&&j(c,i),A&1&&_!==(_=ut(N[0].firmwareUpdateTime)+"")&&j(h,_),N[0].filesystemVersion?L?L.p(N,A):(L=Dl(N),L.c(),L.m(e,g)):L&&(L.d(1),L=null),A&1&&O!==(O=ut(N[0].filesystemUpdateTime)+"")&&j(P,O),N[0].sdkVersion?E?E.p(N,A):(E=jl(N),E.c(),E.m(e,null)):E&&(E.d(1),E=null)},d(N){N&&k(e),L&&L.d(),E&&E.d()}}}function Dl(l){let e,t,n,s,r=l[0].filesystemVersion+"",i;return{c(){e=d("div"),t=d("div"),t.textContent="Svelte App Version:",n=b(),s=d("div"),i=F(r),a(t,"class","history-label svelte-qwtv9g"),a(s,"class","history-value svelte-qwtv9g"),a(e,"class","history-item svelte-qwtv9g")},m(c,u){w(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=c[0].filesystemVersion+"")&&j(i,r)},d(c){c&&k(e)}}}function jl(l){let e,t,n,s,r=l[0].sdkVersion+"",i;return{c(){e=d("div"),t=d("div"),t.textContent="ESP32 SDK:",n=b(),s=d("div"),i=F(r),a(t,"class","history-label svelte-qwtv9g"),a(s,"class","history-value svelte-qwtv9g"),a(e,"class","history-item svelte-qwtv9g")},m(c,u){w(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=c[0].sdkVersion+"")&&j(i,r)},d(c){c&&k(e)}}}function Zr(l){let e,t,n;function s(c,u){return c[0]?Yr:Kr}let r=s(l),i=r(l);return{c(){e=d("h2"),e.textContent="Version Information",t=b(),i.c(),n=Ee(),a(e,"class","svelte-qwtv9g")},m(c,u){w(c,e,u),w(c,t,u),i.m(c,u),w(c,n,u)},p(c,u){r===(r=s(c))&&i?i.p(c,u):(i.d(1),i=r(c),i&&(i.c(),i.m(n.parentNode,n)))},d(c){c&&(k(e),k(t),k(n)),i.d(c)}}}function Xr(l){let e,t,n,s,r,i;const c=[jr,Dr],u=[];function f(p,m){return p[1]?0:1}return s=f(l),r=u[s]=c[s](l),{c(){e=d("div"),t=d("h1"),t.textContent="Firmware & Updates",n=b(),r.c(),a(t,"class","svelte-qwtv9g"),a(e,"class","firmware-container svelte-qwtv9g")},m(p,m){w(p,e,m),o(e,t),o(e,n),u[s].m(e,null),i=!0},p(p,[m]){let v=s;s=f(p),s===v?u[s].p(p,m):(we(),Q(u[v],1,1,()=>{u[v]=null}),Ce(),r=u[s],r?r.p(p,m):(r=u[s]=c[s](p),r.c()),H(r,1),r.m(e,null))},i(p){i||(H(r),i=!0)},o(p){Q(r),i=!1},d(p){p&&k(e),u[s].d()}}}function $r(){window.open("/update","_blank")}function vt(l){return l?`${(l/(1024*1024)).toFixed(2)} MB`:"N/A"}function Wl(l){return l?`${l} MHz`:"N/A"}function ut(l){return!l||l===0?"Never":new Date(l*1e3).toLocaleString()}function xr(l,e,t){let n=null,s=!0,r=!1,i=0,c=!1,u=!1,f=!1,p=null,m=null,v=null;Be(async()=>{await _(),v=setInterval(async()=>{!c&&!r&&await _()},3e4)}),it(()=>{p&&clearInterval(p),m&&clearInterval(m),v&&clearInterval(v)});async function _(){t(1,s=!0);try{t(0,n=await gn())}catch(T){console.warn("Failed to load system info:",T),t(0,n=null)}finally{t(1,s=!1)}}function h(){t(2,r=!0),t(3,i=3),p=setInterval(()=>{t(3,i--,i),i<=0&&(clearInterval(p),p=null,g())},1e3)}function C(){t(2,r=!1),p&&(clearInterval(p),p=null),t(3,i=0)}async function g(){t(2,r=!1),t(4,c=!0);try{await kn()}catch{}setTimeout(()=>{t(5,u=!0),y()},5e3)}function y(){m=setInterval(async()=>{try{(await fetch("/status",{method:"GET",cache:"no-cache"})).ok&&(clearInterval(m),m=null,t(5,u=!1),t(4,c=!1),t(6,f=!0),await _(),setTimeout(()=>{t(6,f=!1)},5e3))}catch{}},2e3)}return[n,s,r,i,c,u,f,h,C]}class Hl extends Ie{constructor(e){super(),Ae(this,e,xr,Xr,Te,{})}}function zl(l){let e,t;return{c(){e=d("div"),t=F(l[2]),a(e,"class","message svelte-1gg1mca"),z(e,"success",l[3]==="success"),z(e,"error",l[3]==="error")},m(n,s){w(n,e,s),o(e,t)},p(n,s){s&4&&j(t,n[2]),s&8&&z(e,"success",n[3]==="success"),s&8&&z(e,"error",n[3]==="error")},d(n){n&&k(e)}}}function ei(l){let e,t,n,s,r,i=l[0]?"â³":l[4]?"ðŸ”„":"ðŸ””",c,u,f=l[4]?"Reset Alert":"Test Alert",p,m,v,_=l[1]?"â³":"âš™ï¸",h,C,g,y,T,S=l[2]&&zl(l);return{c(){e=d("div"),t=d("p"),t.textContent="Press a button to simulate an event or just fire the servo.",n=b(),s=d("div"),r=d("button"),c=F(i),u=b(),p=F(f),m=b(),v=d("button"),h=F(_),C=F(" Test Servo"),g=b(),S&&S.c(),a(t,"class","description svelte-1gg1mca"),a(r,"class","btn test-alert-btn svelte-1gg1mca"),r.disabled=l[0],z(r,"alert-active",l[4]),a(v,"class","btn test-servo-btn svelte-1gg1mca"),v.disabled=l[1],a(s,"class","button-group svelte-1gg1mca"),a(e,"class","content svelte-1gg1mca")},m(q,O){w(q,e,O),o(e,t),o(e,n),o(e,s),o(s,r),o(r,c),o(r,u),o(r,p),o(s,m),o(s,v),o(v,h),o(v,C),o(e,g),S&&S.m(e,null),y||(T=[R(r,"click",l[5]),R(v,"click",l[6])],y=!0)},p(q,O){O&17&&i!==(i=q[0]?"â³":q[4]?"ðŸ”„":"ðŸ””")&&j(c,i),O&16&&f!==(f=q[4]?"Reset Alert":"Test Alert")&&j(p,f),O&1&&(r.disabled=q[0]),O&16&&z(r,"alert-active",q[4]),O&2&&_!==(_=q[1]?"â³":"âš™ï¸")&&j(h,_),O&2&&(v.disabled=q[1]),q[2]?S?S.p(q,O):(S=zl(q),S.c(),S.m(e,null)):S&&(S.d(1),S=null)},d(q){q&&k(e),S&&S.d(),y=!1,he(T)}}}function ti(l){let e,t,n,s,r;return s=new qe({props:{title:"",$$slots:{default:[ei]},$$scope:{ctx:l}}}),{c(){e=d("div"),t=d("h1"),t.textContent="Test Alert",n=b(),pe(s.$$.fragment),a(t,"class","svelte-1gg1mca"),a(e,"class","page svelte-1gg1mca")},m(i,c){w(i,e,c),o(e,t),o(e,n),ce(s,e,null),r=!0},p(i,[c]){const u={};c&543&&(u.$$scope={dirty:c,ctx:i}),s.$set(u)},i(i){r||(H(s.$$.fragment,i),r=!0)},o(i){Q(s.$$.fragment,i),r=!1},d(i){i&&k(e),ue(s)}}}function li(l,e,t){let n=!1,s=!1,r="",i="",c=!1,u=null;async function f(){try{const v=await Pt();t(4,c=v.detectionState||!1)}catch(v){console.error("Failed to check alert status:",v)}}async function p(){t(0,n=!0),t(2,r=""),t(3,i="");try{if(c)await Ss(),t(2,r="âœ… Alert reset successfully"),t(3,i="success"),t(4,c=!1);else{const v=await Cs();t(2,r=v||"âœ… Test alert started â€“ check /gallery or /captures"),t(3,i="success"),t(4,c=!0)}}catch(v){t(2,r=`Error: ${v.message||(c?"Failed to reset alert":"Failed to trigger test alert")}`),t(3,i="error")}finally{t(0,n=!1),f()}}async function m(){t(1,s=!0),t(2,r=""),t(3,i="");try{await ws(),t(2,r="Servo triggered"),t(3,i="success")}catch(v){t(2,r=`Error: ${v.message||"Failed to trigger servo"}`),t(3,i="error")}finally{t(1,s=!1)}}return Be(()=>{f(),u=setInterval(f,2e3)}),it(()=>{u&&clearInterval(u)}),[n,s,r,i,c,p,m]}class si extends Ie{constructor(e){super(),Ae(this,e,li,ti,Te,{})}}function Bl(l,e,t){const n=l.slice();return n[49]=e[t],n}function Vl(l,e,t){const n=l.slice();return n[52]=e[t],n}function Gl(l){let e,t;return{c(){e=d("div"),t=d("div"),a(t,"class","progress-fill svelte-lg07hq"),Ge(t,"width",l[7]/(ts-1)*100+"%"),a(e,"class","progress-bar svelte-lg07hq")},m(n,s){w(n,e,s),o(e,t)},p(n,s){s[0]&128&&Ge(t,"width",n[7]/(ts-1)*100+"%")},d(n){n&&k(e)}}}function Jl(l){let e,t,n,s,r,i,c,u,f,p,m,v,_,h,C,g,y,T;function S(E,N){return E[16]?ri:ni}let q=S(l),O=q(l);const P=[ci,ai],I=[];function L(E,N){return E[8]?0:1}return u=L(l),f=I[u]=P[u](l),{c(){e=d("div"),O.c(),t=b(),n=d("h1"),n.textContent="MouseTrap Setup",s=b(),r=d("p"),r.textContent="Let's get your device connected and ready to protect your home.",i=b(),c=d("button"),f.c(),p=b(),m=d("div"),v=d("button"),_=F("Standalone Mode (Local Only)"),h=b(),C=d("p"),C.textContent="Connect to WiFi without cloud registration",a(n,"class","svelte-lg07hq"),a(r,"class","welcome-text svelte-lg07hq"),a(c,"class","btn-primary btn-large svelte-lg07hq"),c.disabled=l[8],a(v,"class","btn-link svelte-lg07hq"),v.disabled=l[8],a(C,"class","standalone-hint svelte-lg07hq"),a(m,"class","standalone-option svelte-lg07hq"),a(e,"class","step welcome-step svelte-lg07hq")},m(E,N){w(E,e,N),O.m(e,null),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),o(e,c),I[u].m(c,null),o(e,p),o(e,m),o(m,v),o(v,_),o(m,h),o(m,C),g=!0,y||(T=[R(c,"click",l[31]),R(v,"click",l[29])],y=!0)},p(E,N){q===(q=S(E))&&O?O.p(E,N):(O.d(1),O=q(E),O&&(O.c(),O.m(e,t)));let A=u;u=L(E),u===A?I[u].p(E,N):(we(),Q(I[A],1,1,()=>{I[A]=null}),Ce(),f=I[u],f?f.p(E,N):(f=I[u]=P[u](E),f.c()),H(f,1),f.m(c,null)),(!g||N[0]&256)&&(c.disabled=E[8]),(!g||N[0]&256)&&(v.disabled=E[8])},i(E){g||(H(f),g=!0)},o(E){Q(f),g=!1},d(E){E&&k(e),O.d(),I[u].d(),y=!1,he(T)}}}function ni(l){let e;return{c(){e=d("div"),e.innerHTML='<span class="mouse-emoji svelte-lg07hq" role="img" aria-label="mouse">ðŸ</span>',a(e,"class","welcome-icon svelte-lg07hq")},m(t,n){w(t,e,n)},p:V,d(t){t&&k(e)}}}function ri(l){let e,t,n,s,r,i,c,u,f,p;function m(h,C){if(h[17]==="invalid_credentials")return oi;if(h[17]==="wifi_failed")return ii}let v=m(l),_=v&&v(l);return{c(){e=d("div"),t=d("div"),t.innerHTML='<span class="error-icon svelte-lg07hq">âš </span> <strong>Previous Setup Failed</strong>',n=b(),s=d("p"),r=F(l[16]),i=b(),_&&_.c(),c=b(),u=d("button"),u.textContent="Dismiss",a(t,"class","error-header svelte-lg07hq"),a(s,"class","error-text svelte-lg07hq"),a(u,"class","btn-dismiss svelte-lg07hq"),a(e,"class","previous-error-box svelte-lg07hq")},m(h,C){w(h,e,C),o(e,t),o(e,n),o(e,s),o(s,r),o(e,i),_&&_.m(e,null),o(e,c),o(e,u),f||(p=R(u,"click",l[23]),f=!0)},p(h,C){C[0]&65536&&j(r,h[16]),v!==(v=m(h))&&(_&&_.d(1),_=v&&v(h),_&&(_.c(),_.m(e,c)))},d(h){h&&k(e),_&&_.d(),f=!1,p()}}}function ii(l){let e;return{c(){e=d("div"),e.innerHTML='<p class="svelte-lg07hq">Check your WiFi password and make sure the network is in range.</p>',a(e,"class","error-help svelte-lg07hq")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function oi(l){let e;return{c(){e=d("div"),e.innerHTML='<p class="svelte-lg07hq">Double-check your email and password, or create a new account.</p> <a href="https://dashboard.mousetrap.com/forgot-password" target="_blank" rel="noopener noreferrer" class="forgot-link svelte-lg07hq">Forgot your password?</a>',a(e,"class","error-help svelte-lg07hq")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ai(l){let e=l[16]?"Try Again":"Get Started",t,n,s;return{c(){t=F(e),n=b(),s=d("span"),s.textContent="â†’",a(s,"class","arrow svelte-lg07hq")},m(r,i){w(r,t,i),w(r,n,i),w(r,s,i)},p(r,i){i[0]&65536&&e!==(e=r[16]?"Try Again":"Get Started")&&j(t,e)},i:V,o:V,d(r){r&&(k(t),k(n),k(s))}}}function ci(l){let e,t,n;return e=new He({props:{size:"small"}}),{c(){pe(e.$$.fragment),t=F(" Loading...")},m(s,r){ce(e,s,r),w(s,t,r),n=!0},p:V,i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){Q(e.$$.fragment,s),n=!1},d(s){s&&k(t),ue(e,s)}}}function Ql(l){let e,t,n,s,r,i,c,u,f,p,m,v,_,h;const C=[di,fi,ui],g=[];function y(O,P){return O[11]?0:O[10]||O[9].length===0?1:2}s=y(l),r=g[s]=C[s](l);const T=[_i,vi],S=[];function q(O,P){return O[18]?0:1}return p=q(l),m=S[p]=T[p](l),{c(){e=d("div"),t=d("h2"),t.textContent="Select your WiFi network",n=b(),r.c(),i=b(),c=d("div"),u=d("button"),u.innerHTML='<span class="arrow svelte-lg07hq">â†</span> Back',f=b(),m.c(),a(t,"class","svelte-lg07hq"),a(u,"class","btn-secondary svelte-lg07hq"),a(c,"class","button-row svelte-lg07hq"),a(e,"class","step wifi-step svelte-lg07hq")},m(O,P){w(O,e,P),o(e,t),o(e,n),g[s].m(e,null),o(e,i),o(e,c),o(c,u),o(c,f),S[p].m(c,null),v=!0,_||(h=R(u,"click",l[39]),_=!0)},p(O,P){let I=s;s=y(O),s===I?g[s].p(O,P):(we(),Q(g[I],1,1,()=>{g[I]=null}),Ce(),r=g[s],r?r.p(O,P):(r=g[s]=C[s](O),r.c()),H(r,1),r.m(e,i));let L=p;p=q(O),p===L?S[p].p(O,P):(we(),Q(S[L],1,1,()=>{S[L]=null}),Ce(),m=S[p],m?m.p(O,P):(m=S[p]=T[p](O),m.c()),H(m,1),m.m(c,null))},i(O){v||(H(r),H(m),v=!0)},o(O){Q(r),Q(m),v=!1},d(O){O&&k(e),g[s].d(),S[p].d(),_=!1,h()}}}function ui(l){let e,t,n,s,r=l[0]==="manual"?"â—‰":"â—‹",i,c,u,f,p,m,v,_,h,C,g,y=l[12]?"Hide":"Show",T,S,q,O=l[2].length+"",P,I,L,E,N=Fe(l[9]),A=[];for(let D=0;D<N.length;D+=1)A[D]=Kl(Vl(l,N,D));let U=l[0]==="manual"&&Yl(l);function B(D,K){return D[12]?mi:pi}let M=B(l),W=M(l);return{c(){e=d("div");for(let D=0;D<A.length;D+=1)A[D].c();t=b(),n=d("button"),s=d("span"),i=F(r),c=b(),u=d("span"),u.textContent="Enter manually...",f=b(),U&&U.c(),p=b(),m=d("div"),v=d("label"),v.textContent="Password",_=b(),h=d("div"),W.c(),C=b(),g=d("button"),T=F(y),S=b(),q=d("p"),P=F(O),I=F("/8 characters minimum"),a(s,"class","network-radio svelte-lg07hq"),a(u,"class","network-name svelte-lg07hq"),a(n,"class","network-item manual-entry svelte-lg07hq"),z(n,"selected",l[0]==="manual"),a(e,"class","network-list svelte-lg07hq"),a(v,"for","wifi-password"),a(v,"class","svelte-lg07hq"),a(g,"type","button"),a(g,"class","toggle-password svelte-lg07hq"),a(h,"class","password-input-group svelte-lg07hq"),a(q,"class","field-hint svelte-lg07hq"),z(q,"valid",l[2].length>=8),a(m,"class","form-group svelte-lg07hq")},m(D,K){w(D,e,K);for(let J=0;J<A.length;J+=1)A[J]&&A[J].m(e,null);o(e,t),o(e,n),o(n,s),o(s,i),o(n,c),o(n,u),w(D,f,K),U&&U.m(D,K),w(D,p,K),w(D,m,K),o(m,v),o(m,_),o(m,h),W.m(h,null),o(h,C),o(h,g),o(g,T),o(m,S),o(m,q),o(q,P),o(q,I),L||(E=[R(n,"click",l[34]),R(g,"click",l[38])],L=!0)},p(D,K){if(K[0]&33554945){N=Fe(D[9]);let J;for(J=0;J<N.length;J+=1){const Z=Vl(D,N,J);A[J]?A[J].p(Z,K):(A[J]=Kl(Z),A[J].c(),A[J].m(e,t))}for(;J<A.length;J+=1)A[J].d(1);A.length=N.length}K[0]&1&&r!==(r=D[0]==="manual"?"â—‰":"â—‹")&&j(i,r),K[0]&1&&z(n,"selected",D[0]==="manual"),D[0]==="manual"?U?U.p(D,K):(U=Yl(D),U.c(),U.m(p.parentNode,p)):U&&(U.d(1),U=null),M===(M=B(D))&&W?W.p(D,K):(W.d(1),W=M(D),W&&(W.c(),W.m(h,C))),K[0]&4096&&y!==(y=D[12]?"Hide":"Show")&&j(T,y),K[0]&4&&O!==(O=D[2].length+"")&&j(P,O),K[0]&4&&z(q,"valid",D[2].length>=8)},i:V,o:V,d(D){D&&(k(e),k(f),k(p),k(m)),Je(A,D),U&&U.d(D),W.d(),L=!1,he(E)}}}function fi(l){let e,t,n=(l[10]||"No networks found")+"",s,r,i,c,u,f,p;return{c(){e=d("div"),t=d("p"),s=F(n),r=b(),i=d("button"),i.textContent="Retry Scan",c=b(),u=d("p"),u.textContent="Tap Retry to scan again. This may take 10-15 seconds.",a(t,"class","svelte-lg07hq"),a(i,"class","btn-primary svelte-lg07hq"),a(u,"class","hint svelte-lg07hq"),a(e,"class","error-box svelte-lg07hq")},m(m,v){w(m,e,v),o(e,t),o(t,s),o(e,r),o(e,i),o(e,c),o(e,u),f||(p=R(i,"click",l[32]),f=!0)},p(m,v){v[0]&1024&&n!==(n=(m[10]||"No networks found")+"")&&j(s,n)},i:V,o:V,d(m){m&&k(e),f=!1,p()}}}function di(l){let e,t,n,s,r;return t=new He({}),{c(){e=d("div"),pe(t.$$.fragment),n=b(),s=d("p"),s.textContent="Scanning for networks...",a(e,"class","loading-container svelte-lg07hq")},m(i,c){w(i,e,c),ce(t,e,null),o(e,n),o(e,s),r=!0},p:V,i(i){r||(H(t.$$.fragment,i),r=!0)},o(i){Q(t.$$.fragment,i),r=!1},d(i){i&&k(e),ue(t)}}}function Kl(l){let e,t,n=l[0]===l[52].ssid?"â—‰":"â—‹",s,r,i,c=l[52].ssid+"",u,f,p,m,v,_,h=ss(ls(l[52].rssi))+"",C,g,y;function T(){return l[33](l[52])}return{c(){e=d("button"),t=d("span"),s=F(n),r=b(),i=d("span"),u=F(c),f=b(),p=d("span"),m=d("span"),m.textContent="ðŸ“¶",v=b(),_=d("span"),C=F(h),a(t,"class","network-radio svelte-lg07hq"),a(i,"class","network-name svelte-lg07hq"),a(m,"class","signal-label svelte-lg07hq"),a(_,"class","signal-bars svelte-lg07hq"),a(p,"class","signal-icon svelte-lg07hq"),a(p,"title","Signal strength"),a(e,"class","network-item svelte-lg07hq"),z(e,"selected",l[0]===l[52].ssid)},m(S,q){w(S,e,q),o(e,t),o(t,s),o(e,r),o(e,i),o(i,u),o(e,f),o(e,p),o(p,m),o(p,v),o(p,_),o(_,C),g||(y=R(e,"click",T),g=!0)},p(S,q){l=S,q[0]&513&&n!==(n=l[0]===l[52].ssid?"â—‰":"â—‹")&&j(s,n),q[0]&512&&c!==(c=l[52].ssid+"")&&j(u,c),q[0]&512&&h!==(h=ss(ls(l[52].rssi))+"")&&j(C,h),q[0]&513&&z(e,"selected",l[0]===l[52].ssid)},d(S){S&&k(e),g=!1,y()}}}function Yl(l){let e,t,n,s,r,i;return{c(){e=d("div"),t=d("label"),t.textContent="Network Name (SSID)",n=b(),s=d("input"),a(t,"for","manual-ssid"),a(t,"class","svelte-lg07hq"),a(s,"id","manual-ssid"),a(s,"type","text"),a(s,"placeholder","Enter network name"),a(s,"autocomplete","off"),a(s,"class","svelte-lg07hq"),a(e,"class","form-group svelte-lg07hq")},m(c,u){w(c,e,u),o(e,t),o(e,n),o(e,s),x(s,l[1]),r||(i=R(s,"input",l[35]),r=!0)},p(c,u){u[0]&2&&s.value!==c[1]&&x(s,c[1])},d(c){c&&k(e),r=!1,i()}}}function pi(l){let e,t,n;return{c(){e=d("input"),a(e,"id","wifi-password"),a(e,"type","password"),a(e,"placeholder","Enter WiFi password"),a(e,"autocomplete","off"),a(e,"class","svelte-lg07hq")},m(s,r){w(s,e,r),x(e,l[2]),t||(n=R(e,"input",l[37]),t=!0)},p(s,r){r[0]&4&&e.value!==s[2]&&x(e,s[2])},d(s){s&&k(e),t=!1,n()}}}function mi(l){let e,t,n;return{c(){e=d("input"),a(e,"id","wifi-password"),a(e,"type","text"),a(e,"placeholder","Enter WiFi password"),a(e,"autocomplete","off"),a(e,"class","svelte-lg07hq")},m(s,r){w(s,e,r),x(e,l[2]),t||(n=R(e,"input",l[36]),t=!0)},p(s,r){r[0]&4&&e.value!==s[2]&&x(e,s[2])},d(s){s&&k(e),t=!1,n()}}}function vi(l){let e,t,n,s,r,i;return{c(){e=d("button"),t=F("Next "),n=d("span"),n.textContent="â†’",a(n,"class","arrow svelte-lg07hq"),a(e,"class","btn-primary svelte-lg07hq"),e.disabled=s=!l[22]},m(c,u){w(c,e,u),o(e,t),o(e,n),r||(i=R(e,"click",l[40]),r=!0)},p(c,u){u[0]&4194304&&s!==(s=!c[22])&&(e.disabled=s)},i:V,o:V,d(c){c&&k(e),r=!1,i()}}}function _i(l){let e,t,n,s,r,i,c;const u=[hi,bi],f=[];function p(m,v){return m[19]?0:1}return t=p(l),n=f[t]=u[t](l),{c(){e=d("button"),n.c(),a(e,"class","btn-primary svelte-lg07hq"),e.disabled=s=!l[22]||l[19]},m(m,v){w(m,e,v),f[t].m(e,null),r=!0,i||(c=R(e,"click",l[30]),i=!0)},p(m,v){let _=t;t=p(m),t!==_&&(we(),Q(f[_],1,1,()=>{f[_]=null}),Ce(),n=f[t],n||(n=f[t]=u[t](m),n.c()),H(n,1),n.m(e,null)),(!r||v[0]&4718592&&s!==(s=!m[22]||m[19]))&&(e.disabled=s)},i(m){r||(H(n),r=!0)},o(m){Q(n),r=!1},d(m){m&&k(e),f[t].d(),i=!1,c()}}}function bi(l){let e;return{c(){e=F("Enable Standalone Mode")},m(t,n){w(t,e,n)},i:V,o:V,d(t){t&&k(e)}}}function hi(l){let e,t,n;return e=new He({props:{size:"small"}}),{c(){pe(e.$$.fragment),t=F(" Enabling...")},m(s,r){ce(e,s,r),w(s,t,r),n=!0},i(s){n||(H(e.$$.fragment,s),n=!0)},o(s){Q(e.$$.fragment,s),n=!1},d(s){s&&k(t),ue(e,s)}}}function Zl(l){let e,t,n,s,r,i,c,u=l[3]?"Create your account":"Sign in",f,p,m,v,_,h,C,g,y,T,S,q,O,P=l[13]?"Hide":"Show",I,L,E,N=l[5].length+"",A,U,B,M,W,D,K,J,Z,ie,be,$,Y=l[3]?"Create & Activate":"Sign In & Activate",ne,te,G,X,ee,me;function Le(oe,fe){return oe[13]?ki:gi}let ge=Le(l),re=ge(l);return{c(){e=d("div"),t=d("div"),n=d("button"),n.textContent="Sign In",s=b(),r=d("button"),r.textContent="Create Account",i=b(),c=d("h2"),f=F(u),p=b(),m=d("div"),v=d("label"),v.textContent="Email",_=b(),h=d("input"),C=b(),g=d("div"),y=d("label"),y.textContent="Password",T=b(),S=d("div"),re.c(),q=b(),O=d("button"),I=F(P),L=b(),E=d("p"),A=F(N),U=F("/8 characters minimum"),B=b(),M=d("div"),W=d("label"),W.textContent="Name this device",D=b(),K=d("input"),J=b(),Z=d("div"),ie=d("button"),ie.innerHTML='<span class="arrow svelte-lg07hq">â†</span> Back',be=b(),$=d("button"),ne=F(Y),te=b(),G=d("span"),G.textContent="â†’",a(n,"class","tab-btn svelte-lg07hq"),z(n,"active",!l[3]),a(r,"class","tab-btn svelte-lg07hq"),z(r,"active",l[3]),a(t,"class","account-tabs svelte-lg07hq"),a(c,"class","svelte-lg07hq"),a(v,"for","email"),a(v,"class","svelte-lg07hq"),a(h,"id","email"),a(h,"type","email"),a(h,"placeholder","you@example.com"),a(h,"autocomplete","email"),a(h,"class","svelte-lg07hq"),a(m,"class","form-group svelte-lg07hq"),a(y,"for","account-password"),a(y,"class","svelte-lg07hq"),a(O,"type","button"),a(O,"class","toggle-password svelte-lg07hq"),a(S,"class","password-input-group svelte-lg07hq"),a(E,"class","field-hint svelte-lg07hq"),z(E,"valid",l[5].length>=8),a(g,"class","form-group svelte-lg07hq"),a(W,"for","device-name"),a(W,"class","svelte-lg07hq"),a(K,"id","device-name"),a(K,"type","text"),a(K,"placeholder","Kitchen"),a(K,"autocomplete","off"),a(K,"class","svelte-lg07hq"),a(M,"class","form-group svelte-lg07hq"),a(ie,"class","btn-secondary svelte-lg07hq"),a(G,"class","arrow svelte-lg07hq"),a($,"class","btn-primary svelte-lg07hq"),$.disabled=X=!l[21],a(Z,"class","button-row svelte-lg07hq"),a(e,"class","step account-step svelte-lg07hq")},m(oe,fe){w(oe,e,fe),o(e,t),o(t,n),o(t,s),o(t,r),o(e,i),o(e,c),o(c,f),o(e,p),o(e,m),o(m,v),o(m,_),o(m,h),x(h,l[4]),o(e,C),o(e,g),o(g,y),o(g,T),o(g,S),re.m(S,null),o(S,q),o(S,O),o(O,I),o(g,L),o(g,E),o(E,A),o(E,U),o(e,B),o(e,M),o(M,W),o(M,D),o(M,K),x(K,l[6]),o(e,J),o(e,Z),o(Z,ie),o(Z,be),o(Z,$),o($,ne),o($,te),o($,G),ee||(me=[R(n,"click",l[41]),R(r,"click",l[42]),R(h,"input",l[43]),R(O,"click",l[46]),R(K,"input",l[47]),R(ie,"click",l[48]),R($,"click",l[27])],ee=!0)},p(oe,fe){fe[0]&8&&z(n,"active",!oe[3]),fe[0]&8&&z(r,"active",oe[3]),fe[0]&8&&u!==(u=oe[3]?"Create your account":"Sign in")&&j(f,u),fe[0]&16&&h.value!==oe[4]&&x(h,oe[4]),ge===(ge=Le(oe))&&re?re.p(oe,fe):(re.d(1),re=ge(oe),re&&(re.c(),re.m(S,q))),fe[0]&8192&&P!==(P=oe[13]?"Hide":"Show")&&j(I,P),fe[0]&32&&N!==(N=oe[5].length+"")&&j(A,N),fe[0]&32&&z(E,"valid",oe[5].length>=8),fe[0]&64&&K.value!==oe[6]&&x(K,oe[6]),fe[0]&8&&Y!==(Y=oe[3]?"Create & Activate":"Sign In & Activate")&&j(ne,Y),fe[0]&2097152&&X!==(X=!oe[21])&&($.disabled=X)},d(oe){oe&&k(e),re.d(),ee=!1,he(me)}}}function gi(l){let e,t,n,s,r;return{c(){e=d("input"),a(e,"id","account-password"),a(e,"type","password"),a(e,"placeholder",t=l[3]?"Create a password":"Enter your password"),a(e,"autocomplete",n=l[3]?"new-password":"current-password"),a(e,"class","svelte-lg07hq")},m(i,c){w(i,e,c),x(e,l[5]),s||(r=R(e,"input",l[45]),s=!0)},p(i,c){c[0]&8&&t!==(t=i[3]?"Create a password":"Enter your password")&&a(e,"placeholder",t),c[0]&8&&n!==(n=i[3]?"new-password":"current-password")&&a(e,"autocomplete",n),c[0]&32&&e.value!==i[5]&&x(e,i[5])},d(i){i&&k(e),s=!1,r()}}}function ki(l){let e,t,n,s,r;return{c(){e=d("input"),a(e,"id","account-password"),a(e,"type","text"),a(e,"placeholder",t=l[3]?"Create a password":"Enter your password"),a(e,"autocomplete",n=l[3]?"new-password":"current-password"),a(e,"class","svelte-lg07hq")},m(i,c){w(i,e,c),x(e,l[5]),s||(r=R(e,"input",l[44]),s=!0)},p(i,c){c[0]&8&&t!==(t=i[3]?"Create a password":"Enter your password")&&a(e,"placeholder",t),c[0]&8&&n!==(n=i[3]?"new-password":"current-password")&&a(e,"autocomplete",n),c[0]&32&&e.value!==i[5]&&x(e,i[5])},d(i){i&&k(e),s=!1,r()}}}function Xl(l){let e,t,n,s,r=Fe(l[20]),i=[];for(let c=0;c<r.length;c+=1)i[c]=xl(Bl(l,r,c));return{c(){e=d("div"),t=d("h2"),t.textContent="Setting up your device...",n=b(),s=d("div");for(let c=0;c<i.length;c+=1)i[c].c();a(t,"class","svelte-lg07hq"),a(s,"class","progress-list svelte-lg07hq"),a(e,"class","step progress-step svelte-lg07hq")},m(c,u){w(c,e,u),o(e,t),o(e,n),o(e,s);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(s,null)},p(c,u){if(u[0]&1048576){r=Fe(c[20]);let f;for(f=0;f<r.length;f+=1){const p=Bl(c,r,f);i[f]?i[f].p(p,u):(i[f]=xl(p),i[f].c(),i[f].m(s,null))}for(;f<i.length;f+=1)i[f].d(1);i.length=r.length}},d(c){c&&k(e),Je(i,c)}}}function $l(l){let e;return{c(){e=d("span"),a(e,"class","progress-spinner svelte-lg07hq")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function xl(l){let e,t,n=ns(l[49].status)+"",s,r,i,c=l[49].label+"",u,f,p,m=l[49].status==="in_progress"&&$l();return{c(){e=d("div"),t=d("span"),s=F(n),r=b(),i=d("span"),u=F(c),f=b(),m&&m.c(),p=b(),a(t,"class","progress-icon svelte-lg07hq"),a(i,"class","progress-label svelte-lg07hq"),a(e,"class","progress-item svelte-lg07hq"),z(e,"completed",l[49].status==="completed"),z(e,"in-progress",l[49].status==="in_progress"),z(e,"failed",l[49].status==="failed")},m(v,_){w(v,e,_),o(e,t),o(t,s),o(e,r),o(e,i),o(i,u),o(e,f),m&&m.m(e,null),o(e,p)},p(v,_){_[0]&1048576&&n!==(n=ns(v[49].status)+"")&&j(s,n),_[0]&1048576&&c!==(c=v[49].label+"")&&j(u,c),v[49].status==="in_progress"?m||(m=$l(),m.c(),m.m(e,p)):m&&(m.d(1),m=null),_[0]&1048576&&z(e,"completed",v[49].status==="completed"),_[0]&1048576&&z(e,"in-progress",v[49].status==="in_progress"),_[0]&1048576&&z(e,"failed",v[49].status==="failed")},d(v){v&&k(e),m&&m.d()}}}function es(l){let e;function t(r,i){return r[14]?Ci:wi}let n=t(l),s=n(l);return{c(){s.c(),e=Ee()},m(r,i){s.m(r,i),w(r,e,i)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},d(r){r&&k(e),s.d(r)}}}function wi(l){let e,t,n,s,r,i,c,u,f,p,m;return{c(){e=d("div"),t=d("div"),t.innerHTML='<span role="img" aria-label="error">âŒ</span>',n=b(),s=d("h2"),s.textContent="Setup Failed",r=b(),i=d("p"),c=F(l[15]),u=b(),f=d("button"),f.textContent="Try Again",a(t,"class","result-icon error svelte-lg07hq"),a(s,"class","svelte-lg07hq"),a(i,"class","error-message svelte-lg07hq"),a(f,"class","btn-primary btn-large svelte-lg07hq"),a(e,"class","step error-step svelte-lg07hq")},m(v,_){w(v,e,_),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),o(i,c),o(e,u),o(e,f),p||(m=R(f,"click",l[28]),p=!0)},p(v,_){_[0]&32768&&j(c,v[15])},d(v){v&&k(e),p=!1,m()}}}function Ci(l){let e;function t(r,i){return r[18]?yi:Si}let n=t(l),s=n(l);return{c(){e=d("div"),s.c(),a(e,"class","step success-step svelte-lg07hq")},m(r,i){w(r,e,i),s.m(e,null)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e,null)))},d(r){r&&k(e),s.d()}}}function Si(l){let e,t,n,s,r,i,c,u,f,p,m,v;return{c(){e=d("div"),e.innerHTML='<span role="img" aria-label="in progress">â³</span>',t=b(),n=d("h2"),n.textContent="Setup In Progress",s=b(),r=d("p"),i=F('Your device "'),c=F(l[6]),u=F('" is connecting to your WiFi and registering with the server.'),f=b(),p=d("div"),p.innerHTML='<p class="svelte-lg07hq">Check your dashboard to confirm the device appears:</p> <a href="https://dashboard.mousetrap.com" class="dashboard-link svelte-lg07hq" target="_blank" rel="noopener noreferrer">https://dashboard.mousetrap.com</a>',m=b(),v=d("p"),v.innerHTML=`The device will disconnect from this network to complete setup.<br/>
              If registration fails, the device will restart in setup mode.`,a(e,"class","result-icon in-progress svelte-lg07hq"),a(n,"class","svelte-lg07hq"),a(r,"class","result-text svelte-lg07hq"),a(p,"class","dashboard-link-box svelte-lg07hq"),a(v,"class","auto-close-text svelte-lg07hq")},m(_,h){w(_,e,h),w(_,t,h),w(_,n,h),w(_,s,h),w(_,r,h),o(r,i),o(r,c),o(r,u),w(_,f,h),w(_,p,h),w(_,m,h),w(_,v,h)},p(_,h){h[0]&64&&j(c,_[6])},d(_){_&&(k(e),k(t),k(n),k(s),k(r),k(f),k(p),k(m),k(v))}}}function yi(l){let e,t,n,s,r,i,c,u,f;return{c(){e=d("div"),e.innerHTML='<span role="img" aria-label="success">âœ…</span>',t=b(),n=d("h2"),n.textContent="Standalone Mode Enabled",s=b(),r=d("p"),r.textContent="Device will reboot and connect to WiFi without cloud registration.",i=b(),c=d("div"),c.innerHTML='<p class="svelte-lg07hq">After reboot, access the device at:</p> <p class="dashboard-link svelte-lg07hq">http://192.168.4.1</p> <p class="hint-text svelte-lg07hq">(Connect to the MouseTrap WiFi network first)</p>',u=b(),f=d("p"),f.innerHTML=`Device is rebooting...<br/>
              You can view system logs at /app/#/logs`,a(e,"class","result-icon success svelte-lg07hq"),a(n,"class","svelte-lg07hq"),a(r,"class","result-text svelte-lg07hq"),a(c,"class","dashboard-link-box svelte-lg07hq"),a(f,"class","auto-close-text svelte-lg07hq")},m(p,m){w(p,e,m),w(p,t,m),w(p,n,m),w(p,s,m),w(p,r,m),w(p,i,m),w(p,c,m),w(p,u,m),w(p,f,m)},p:V,d(p){p&&(k(e),k(t),k(n),k(s),k(r),k(i),k(c),k(u),k(f))}}}function qi(l){let e,t,n,s,r,i,c,u,f=l[7]<5&&Gl(l),p=l[7]===1&&Jl(l),m=l[7]===2&&Ql(l),v=l[7]===3&&Zl(l),_=l[7]===4&&Xl(l),h=l[7]===5&&es(l);return{c(){e=d("div"),t=d("div"),f&&f.c(),n=b(),p&&p.c(),s=b(),m&&m.c(),r=b(),v&&v.c(),i=b(),_&&_.c(),c=b(),h&&h.c(),a(t,"class","setup-card svelte-lg07hq"),a(e,"class","setup-container svelte-lg07hq")},m(C,g){w(C,e,g),o(e,t),f&&f.m(t,null),o(t,n),p&&p.m(t,null),o(t,s),m&&m.m(t,null),o(t,r),v&&v.m(t,null),o(t,i),_&&_.m(t,null),o(t,c),h&&h.m(t,null),u=!0},p(C,g){C[7]<5?f?f.p(C,g):(f=Gl(C),f.c(),f.m(t,n)):f&&(f.d(1),f=null),C[7]===1?p?(p.p(C,g),g[0]&128&&H(p,1)):(p=Jl(C),p.c(),H(p,1),p.m(t,s)):p&&(we(),Q(p,1,1,()=>{p=null}),Ce()),C[7]===2?m?(m.p(C,g),g[0]&128&&H(m,1)):(m=Ql(C),m.c(),H(m,1),m.m(t,r)):m&&(we(),Q(m,1,1,()=>{m=null}),Ce()),C[7]===3?v?v.p(C,g):(v=Zl(C),v.c(),v.m(t,i)):v&&(v.d(1),v=null),C[7]===4?_?_.p(C,g):(_=Xl(C),_.c(),_.m(t,c)):_&&(_.d(1),_=null),C[7]===5?h?h.p(C,g):(h=es(C),h.c(),h.m(t,null)):h&&(h.d(1),h=null)},i(C){u||(H(p),H(m),u=!0)},o(C){Q(p),Q(m),u=!1},d(C){C&&k(e),f&&f.d(),p&&p.d(),m&&m.d(),v&&v.d(),_&&_.d(),h&&h.d()}}}const ts=5;function ls(l){return l>=-50?4:l>=-60?3:l>=-70?2:1}function ss(l){const e="â–ˆ",t="â–‘";let n="";for(let s=0;s<4;s++)n+=s<l?e:t;return n}function ns(l){switch(l){case"completed":return"âœ“";case"in_progress":return"â³";case"failed":return"âœ—";default:return"â—‹"}}function Ti(l,e,t){let n,s,r,i=1,c=!1,u=[],f=null,p=!1,m=null,v="",_="",h=!1,C=!1,g="",y="",T=!1,S="",q=!1,O=null,P=null,I=null,L=!1,E=!1;Be(async()=>{try{const de=await Sn();de.attempted&&!de.success&&(t(16,P=de.errorMessage),t(17,I=de.errorCode),console.log("[SETUP] Previous error found:",de.errorCode,de.errorMessage))}catch(de){console.log("[SETUP] Could not check setup status:",de.message)}});async function N(){try{await yn()}catch(de){console.log("[SETUP] Could not clear setup status:",de.message)}t(16,P=null),t(17,I=null)}async function A(de=!1){console.log("[SETUP] loadNetworks called, forceRescan="+de),t(11,p=!0),t(10,f=null),t(9,u=[]);try{console.log("[SETUP] About to call scanWiFiNetworks...");const le=await ys(de);console.log("[SETUP] scanWiFiNetworks returned:",JSON.stringify(le)),t(9,u=le.networks||[]),console.log("[SETUP] Networks set to:",u.length,"items"),u.length===0&&t(10,f="No networks found. Tap Retry to scan again.")}catch(le){console.error("[SETUP] Scan error:",le),console.error("[SETUP] Error details:",le.message,le.stack),t(10,f="Scan failed: "+(le.message||"Unknown error")),t(9,u=[])}finally{console.log("[SETUP] loadNetworks finished, setting networkLoading=false"),t(11,p=!1)}}function U(de){t(0,m=de),de!=="manual"&&t(1,v="")}async function B(de){t(8,c=!0);try{de===2&&await A(),t(7,i=de)}finally{t(8,c=!1)}}async function M(){t(7,i=4),t(14,q=!1),t(15,O=null);const de=m==="manual"?v:m;t(20,n=n.map(le=>le.id==="wifi"?{...le,status:"in_progress"}:le));try{await qn({ssid:de,password:_,email:g,accountPassword:y,deviceName:S,isNewAccount:C}),t(20,n=n.map(le=>le.id==="wifi"?{...le,status:"completed"}:le)),t(20,n=n.map(le=>le.id==="account"?{...le,status:"in_progress"}:le)),await new Promise(le=>setTimeout(le,1500)),t(20,n=n.map(le=>le.id==="account"?{...le,status:"completed"}:le)),t(20,n=n.map(le=>le.id==="activate"?{...le,status:"in_progress"}:le)),await new Promise(le=>setTimeout(le,2e3)),t(20,n=n.map(le=>le.id==="activate"?{...le,status:"completed"}:le)),t(14,q=!0),t(7,i=5)}catch(le){t(15,O=le.message||"Setup failed. Please try again."),t(20,n=n.map(De=>De.status==="in_progress"?{...De,status:"failed"}:De)),t(7,i=5)}}function W(){t(7,i=1),t(0,m=null),t(1,v=""),t(2,_=""),t(4,g=""),t(5,y=""),t(6,S=""),t(14,q=!1),t(15,O=null),t(20,n=[{id:"wifi",label:"Connecting to WiFi",status:"pending"},{id:"account",label:"Creating your account",status:"pending"},{id:"activate",label:"Activating device",status:"pending"}])}async function D(){t(18,L=!0),await B(2)}async function K(){t(19,E=!0),t(15,O=null);const de=m==="manual"?v:m;try{await Tn({ssid:de,password:_}),t(14,q=!0),t(7,i=5)}catch(le){t(15,O=le.message||"Failed to enable standalone mode"),t(7,i=5),t(14,q=!1)}finally{t(19,E=!1)}}const J=()=>{t(18,L=!1),N(),B(2)},Z=()=>{console.log("[SETUP] Retry clicked!"),A(!0)},ie=de=>U(de.ssid),be=()=>U("manual");function $(){v=this.value,t(1,v)}function Y(){_=this.value,t(2,_)}function ne(){_=this.value,t(2,_)}const te=()=>t(12,h=!h),G=()=>{t(7,i=1),t(18,L=!1)},X=()=>t(7,i=3),ee=()=>t(3,C=!1),me=()=>t(3,C=!0);function Le(){g=this.value,t(4,g)}function ge(){y=this.value,t(5,y)}function re(){y=this.value,t(5,y)}const oe=()=>t(13,T=!T);function fe(){S=this.value,t(6,S)}const Se=()=>t(7,i=2);return l.$$.update=()=>{l.$$.dirty[0]&8&&t(20,n=[{id:"wifi",label:"Connecting to WiFi",status:"pending"},{id:"account",label:C?"Creating account":"Signing in",status:"pending"},{id:"activate",label:"Activating device",status:"pending"}]),l.$$.dirty[0]&7&&t(22,s=(m||v.trim())&&(m!=="manual"||v.trim())&&_.length>=8),l.$$.dirty[0]&112&&t(21,r=g.trim()&&y.length>=8&&S.trim())},[m,v,_,C,g,y,S,i,c,u,f,p,h,T,q,O,P,I,L,E,n,r,s,N,A,U,B,M,W,D,K,J,Z,ie,be,$,Y,ne,te,G,X,ee,me,Le,ge,re,oe,fe,Se]}class Li extends Ie{constructor(e){super(),Ae(this,e,Ti,qi,Te,{},null,[-1,-1])}}function rs(l,e,t){const n=l.slice();return n[19]=e[t],n}function Fi(l){let e,t,n,s;return e=new qe({props:{title:"Update WiFi Network",$$slots:{default:[Ri]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment),t=b(),n=d("div"),n.innerHTML='<a href="/" class="svelte-1p30553">â† Back to Dashboard</a>',a(n,"class","back-link svelte-1p30553")},m(r,i){ce(e,r,i),w(r,t,i),w(r,n,i),s=!0},p(r,i){const c={};i&4195310&&(c.$$scope={dirty:i,ctx:r}),e.$set(c)},i(r){s||(H(e.$$.fragment,r),s=!0)},o(r){Q(e.$$.fragment,r),s=!1},d(r){r&&(k(t),k(n)),ue(e,r)}}}function Ei(l){let e,t;return e=new qe({props:{$$slots:{default:[Ui]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p(n,s){const r={};s&4194320&&(r.$$scope={dirty:s,ctx:n}),e.$set(r)},i(n){t||(H(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Ai(l){let e,t,n,s,r;return t=new He({}),{c(){e=d("div"),pe(t.$$.fragment),n=b(),s=d("p"),s.textContent="Scanning for networks...",a(e,"class","loading-container svelte-1p30553")},m(i,c){w(i,e,c),ce(t,e,null),o(e,n),o(e,s),r=!0},p:V,i(i){r||(H(t.$$.fragment,i),r=!0)},o(i){Q(t.$$.fragment,i),r=!1},d(i){i&&k(e),ue(t)}}}function is(l){let e,t;return{c(){e=d("div"),t=F(l[3]),a(e,"class","error-text svelte-1p30553")},m(n,s){w(n,e,s),o(e,t)},p(n,s){s&8&&j(t,n[3])},d(n){n&&k(e)}}}function os(l){let e,t,n,s,r,i=l[1]?"Scanning...":"Rescan",c,u,f,p,m,v,_;const h=[Oi,Pi,Ii],C=[];function g(y,T){return y[1]?0:y[8].length===0?1:2}return f=g(l),p=C[f]=h[f](l),{c(){e=d("div"),t=d("div"),n=d("span"),n.textContent="Available Networks",s=b(),r=d("button"),c=F(i),u=b(),p.c(),a(r,"type","button"),a(r,"class","btn-link svelte-1p30553"),r.disabled=l[1],a(t,"class","network-list-header svelte-1p30553"),a(e,"class","network-list svelte-1p30553")},m(y,T){w(y,e,T),o(e,t),o(t,n),o(t,s),o(t,r),o(r,c),o(e,u),C[f].m(e,null),m=!0,v||(_=R(r,"click",l[10]),v=!0)},p(y,T){(!m||T&2)&&i!==(i=y[1]?"Scanning...":"Rescan")&&j(c,i),(!m||T&2)&&(r.disabled=y[1]);let S=f;f=g(y),f===S?C[f].p(y,T):(we(),Q(C[S],1,1,()=>{C[S]=null}),Ce(),p=C[f],p?p.p(y,T):(p=C[f]=h[f](y),p.c()),H(p,1),p.m(e,null))},i(y){m||(H(p),m=!0)},o(y){Q(p),m=!1},d(y){y&&k(e),C[f].d(),v=!1,_()}}}function Ii(l){let e,t=Fe(l[8]),n=[];for(let s=0;s<t.length;s+=1)n[s]=cs(rs(l,t,s));return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=Ee()},m(s,r){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(s,r);w(s,e,r)},p(s,r){if(r&2336){t=Fe(s[8]);let i;for(i=0;i<t.length;i+=1){const c=rs(s,t,i);n[i]?n[i].p(c,r):(n[i]=cs(c),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},i:V,o:V,d(s){s&&k(e),Je(n,s)}}}function Pi(l){let e;return{c(){e=d("div"),e.textContent="No networks found. Try rescanning or enter SSID manually.",a(e,"class","no-networks svelte-1p30553")},m(t,n){w(t,e,n)},p:V,i:V,o:V,d(t){t&&k(e)}}}function Oi(l){let e,t,n,s,r;return t=new He({props:{size:"small"}}),{c(){e=d("div"),pe(t.$$.fragment),n=b(),s=d("span"),s.textContent="Scanning...",a(e,"class","scanning svelte-1p30553")},m(i,c){w(i,e,c),ce(t,e,null),o(e,n),o(e,s),r=!0},p:V,i(i){r||(H(t.$$.fragment,i),r=!0)},o(i){Q(t.$$.fragment,i),r=!1},d(i){i&&k(e),ue(t)}}}function as(l){let e;return{c(){e=d("span"),e.textContent="ðŸ”’",a(e,"class","lock svelte-1p30553")},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function cs(l){let e,t,n=l[19].ssid+"",s,r,i,c,u=us(l[19].rssi)+"",f,p,m,v,_,h=l[19].secure&&as();function C(){return l[15](l[19])}return{c(){e=d("button"),t=d("span"),s=F(n),r=b(),i=d("span"),c=d("span"),f=F(u),p=b(),h&&h.c(),m=b(),a(t,"class","network-name svelte-1p30553"),a(c,"class","signal svelte-1p30553"),a(i,"class","network-info svelte-1p30553"),a(e,"type","button"),a(e,"class","network-item svelte-1p30553"),z(e,"selected",l[5]===l[19].ssid)},m(g,y){w(g,e,y),o(e,t),o(t,s),o(e,r),o(e,i),o(i,c),o(c,f),o(i,p),h&&h.m(i,null),o(e,m),v||(_=R(e,"click",C),v=!0)},p(g,y){l=g,y&256&&n!==(n=l[19].ssid+"")&&j(s,n),y&256&&u!==(u=us(l[19].rssi)+"")&&j(f,u),l[19].secure?h||(h=as(),h.c(),h.m(i,null)):h&&(h.d(1),h=null),y&288&&z(e,"selected",l[5]===l[19].ssid)},d(g){g&&k(e),h&&h.d(),v=!1,_()}}}function Ni(l){let e,t,n;return{c(){e=d("input"),a(e,"id","password"),a(e,"type","password"),a(e,"placeholder","Enter WiFi password"),e.disabled=l[2],a(e,"class","svelte-1p30553")},m(s,r){w(s,e,r),x(e,l[6]),t||(n=R(e,"input",l[17]),t=!0)},p(s,r){r&4&&(e.disabled=s[2]),r&64&&e.value!==s[6]&&x(e,s[6])},d(s){s&&k(e),t=!1,n()}}}function Mi(l){let e,t,n;return{c(){e=d("input"),a(e,"id","password"),a(e,"type","text"),a(e,"placeholder","Enter WiFi password"),e.disabled=l[2],a(e,"class","svelte-1p30553")},m(s,r){w(s,e,r),x(e,l[6]),t||(n=R(e,"input",l[16]),t=!0)},p(s,r){r&4&&(e.disabled=s[2]),r&64&&e.value!==s[6]&&x(e,s[6])},d(s){s&&k(e),t=!1,n()}}}function Ri(l){let e,t,n,s,r,i,c,u,f,p=l[9]?"Hide":"Browse",m,v,_,h,C,g,y,T,S,q=l[7]?"Hide":"Show",O,P,I,L,E,N,A,U=l[2]?"Saving...":"Update WiFi Settings",B,M,W,D,K,J=l[3]&&is(l),Z=l[9]&&os(l);function ie(Y,ne){return Y[7]?Mi:Ni}let be=ie(l),$=be(l);return{c(){e=d("div"),J&&J.c(),t=b(),n=d("div"),s=d("label"),s.textContent="WiFi Network (SSID)",r=b(),i=d("div"),c=d("input"),u=b(),f=d("button"),m=F(p),v=b(),Z&&Z.c(),_=b(),h=d("div"),C=d("label"),C.textContent="Password",g=b(),y=d("div"),$.c(),T=b(),S=d("button"),O=F(q),P=b(),I=d("div"),I.textContent="Minimum 8 characters",L=b(),E=d("div"),E.textContent=`The device will restart after saving. You may need to reconnect
          to the new network to continue using the device.`,N=b(),A=d("button"),B=F(U),a(s,"for","ssid"),a(s,"class","svelte-1p30553"),a(c,"id","ssid"),a(c,"type","text"),a(c,"placeholder","Enter network name"),c.disabled=l[2],a(c,"class","svelte-1p30553"),a(f,"type","button"),a(f,"class","btn-secondary scan-btn svelte-1p30553"),f.disabled=l[2],a(i,"class","ssid-input-group svelte-1p30553"),a(n,"class","form-group svelte-1p30553"),a(C,"for","password"),a(C,"class","svelte-1p30553"),a(S,"type","button"),a(S,"class","toggle-password svelte-1p30553"),a(y,"class","password-input-group svelte-1p30553"),a(I,"class","help-text svelte-1p30553"),a(h,"class","form-group svelte-1p30553"),a(E,"class","warning-text svelte-1p30553"),a(A,"type","button"),a(A,"class","btn-primary svelte-1p30553"),A.disabled=M=l[2]||!l[5].trim()||l[6].length<8,a(e,"class","form-section svelte-1p30553")},m(Y,ne){w(Y,e,ne),J&&J.m(e,null),o(e,t),o(e,n),o(n,s),o(n,r),o(n,i),o(i,c),x(c,l[5]),o(i,u),o(i,f),o(f,m),o(e,v),Z&&Z.m(e,null),o(e,_),o(e,h),o(h,C),o(h,g),o(h,y),$.m(y,null),o(y,T),o(y,S),o(S,O),o(h,P),o(h,I),o(e,L),o(e,E),o(e,N),o(e,A),o(A,B),W=!0,D||(K=[R(c,"input",l[13]),R(f,"click",l[14]),R(S,"click",l[18]),R(A,"click",l[12])],D=!0)},p(Y,ne){Y[3]?J?J.p(Y,ne):(J=is(Y),J.c(),J.m(e,t)):J&&(J.d(1),J=null),(!W||ne&4)&&(c.disabled=Y[2]),ne&32&&c.value!==Y[5]&&x(c,Y[5]),(!W||ne&512)&&p!==(p=Y[9]?"Hide":"Browse")&&j(m,p),(!W||ne&4)&&(f.disabled=Y[2]),Y[9]?Z?(Z.p(Y,ne),ne&512&&H(Z,1)):(Z=os(Y),Z.c(),H(Z,1),Z.m(e,_)):Z&&(we(),Q(Z,1,1,()=>{Z=null}),Ce()),be===(be=ie(Y))&&$?$.p(Y,ne):($.d(1),$=be(Y),$&&($.c(),$.m(y,T))),(!W||ne&128)&&q!==(q=Y[7]?"Hide":"Show")&&j(O,q),(!W||ne&4)&&U!==(U=Y[2]?"Saving...":"Update WiFi Settings")&&j(B,U),(!W||ne&100&&M!==(M=Y[2]||!Y[5].trim()||Y[6].length<8))&&(A.disabled=M)},i(Y){W||(H(Z),W=!0)},o(Y){Q(Z),W=!1},d(Y){Y&&k(e),J&&J.d(),Z&&Z.d(),$.d(),D=!1,he(K)}}}function Ui(l){let e,t,n,s,r,i,c,u,f;return{c(){e=d("div"),t=d("div"),t.textContent="âœ“",n=b(),s=d("h2"),s.textContent="Success!",r=b(),i=d("p"),c=F(l[4]),u=b(),f=d("p"),f.textContent=`The device is restarting. Once it connects to your WiFi network,
          you can access it at its new IP address.`,a(t,"class","success-icon svelte-1p30553"),a(s,"class","svelte-1p30553"),a(i,"class","svelte-1p30553"),a(f,"class","reconnect-info svelte-1p30553"),a(e,"class","success-message svelte-1p30553")},m(p,m){w(p,e,m),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),o(i,c),o(e,u),o(e,f)},p(p,m){m&16&&j(c,p[4])},d(p){p&&k(e)}}}function Di(l){let e,t,n,s,r,i;const c=[Ai,Ei,Fi],u=[];function f(p,m){return p[0]?0:p[4]?1:2}return s=f(l),r=u[s]=c[s](l),{c(){e=d("div"),t=d("div"),t.innerHTML='<h1 class="svelte-1p30553">WiFi Settings</h1> <p class="subtitle svelte-1p30553">Update your WiFi connection without losing device registration</p>',n=b(),r.c(),a(t,"class","header svelte-1p30553"),a(e,"class","wifi-container svelte-1p30553")},m(p,m){w(p,e,m),o(e,t),o(e,n),u[s].m(e,null),i=!0},p(p,[m]){let v=s;s=f(p),s===v?u[s].p(p,m):(we(),Q(u[v],1,1,()=>{u[v]=null}),Ce(),r=u[s],r?r.p(p,m):(r=u[s]=c[s](p),r.c()),H(r,1),r.m(e,null))},i(p){i||(H(r),i=!0)},o(p){Q(r),i=!1},d(p){p&&k(e),u[s].d()}}}function us(l){return l>=-50?"â–ˆâ–ˆâ–ˆâ–ˆ":l>=-60?"â–ˆâ–ˆâ–ˆâ–‘":l>=-70?"â–ˆâ–ˆâ–‘â–‘":"â–ˆâ–‘â–‘â–‘"}function ji(l,e,t){let n=!0,s=!1,r=!1,i=null,c=null,u="",f="",p=!1,m=[],v=!1;Be(async()=>{await _(),t(0,n=!1)});async function _(){t(1,s=!0),t(3,i=null);try{const P=await ys(!0);t(8,m=P.networks||[]),console.log("[WIFI] Found networks:",m)}catch(P){console.error("[WIFI] Scan error:",P),t(8,m=[])}t(1,s=!1)}function h(P){t(5,u=P.ssid),t(9,v=!1)}async function C(){if(t(3,i=null),t(4,c=null),!u.trim()){t(3,i="Please enter or select a WiFi network");return}if(f.length<8){t(3,i="Password must be at least 8 characters");return}t(2,r=!0);try{await Ln({ssid:u.trim(),password:f}),t(4,c="WiFi credentials saved. Device is restarting...")}catch(P){const I=P.message||"";if(I.includes("Failed to fetch")||I.includes("NetworkError")||I.includes("network")||I.includes("Load failed"))t(4,c="WiFi credentials saved. Device is restarting...");else{t(3,i=P.message||"Failed to update WiFi settings"),t(2,r=!1);return}}t(2,r=!1)}function g(){u=this.value,t(5,u)}const y=()=>t(9,v=!v),T=P=>h(P);function S(){f=this.value,t(6,f)}function q(){f=this.value,t(6,f)}return[n,s,r,i,c,u,f,p,m,v,_,h,C,g,y,T,S,q,()=>t(7,p=!p)]}class Wi extends Ie{constructor(e){super(),Ae(this,e,ji,Di,Te,{})}}function Hi(l){let e,t;return e=new Ks({props:{$$slots:{default:[Bi]},$$scope:{ctx:l}}}),{c(){pe(e.$$.fragment)},m(n,s){ce(e,n,s),t=!0},p(n,s){const r={};s&18&&(r.$$scope={dirty:s,ctx:n}),e.$set(r)},i(n){t||(H(e.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function zi(l){let e,t,n;var s=l[1];function r(i,c){return{}}return s&&(e=pt(s,r())),{c(){e&&pe(e.$$.fragment),t=Ee()},m(i,c){e&&ce(e,i,c),w(i,t,c),n=!0},p(i,c){if(c&2&&s!==(s=i[1])){if(e){we();const u=e;Q(u.$$.fragment,1,0,()=>{ue(u,1)}),Ce()}s?(e=pt(s,r()),pe(e.$$.fragment),H(e.$$.fragment,1),ce(e,t.parentNode,t)):e=null}},i(i){n||(e&&H(e.$$.fragment,i),n=!0)},o(i){e&&Q(e.$$.fragment,i),n=!1},d(i){i&&k(t),e&&ue(e,i)}}}function Bi(l){let e,t,n;var s=l[1];function r(i,c){return{}}return s&&(e=pt(s,r())),{c(){e&&pe(e.$$.fragment),t=Ee()},m(i,c){e&&ce(e,i,c),w(i,t,c),n=!0},p(i,c){if(c&2&&s!==(s=i[1])){if(e){we();const u=e;Q(u.$$.fragment,1,0,()=>{ue(u,1)}),Ce()}s?(e=pt(s,r()),pe(e.$$.fragment),H(e.$$.fragment,1),ce(e,t.parentNode,t)):e=null}},i(i){n||(e&&H(e.$$.fragment,i),n=!0)},o(i){e&&Q(e.$$.fragment,i),n=!1},d(i){i&&k(t),e&&ue(e,i)}}}function Vi(l){let e,t,n,s;const r=[zi,Hi],i=[];function c(u,f){return u[0]?0:1}return e=c(l),t=i[e]=r[e](l),{c(){t.c(),n=Ee()},m(u,f){i[e].m(u,f),w(u,n,f),s=!0},p(u,[f]){let p=e;e=c(u),e===p?i[e].p(u,f):(we(),Q(i[p],1,1,()=>{i[p]=null}),Ce(),t=i[e],t?t.p(u,f):(t=i[e]=r[e](u),t.c()),H(t,1),t.m(n.parentNode,n))},i(u){s||(H(t),s=!0)},o(u){Q(t),s=!1},d(u){u&&k(n),i[e].d(u)}}}function Gi(l,e,t){let n,s,r;dt(l,It,c=>t(2,r=c));function i(c){const u=c.startsWith("/")?c:"/"+c;return u==="/"||u===""?$t:u==="/gallery"?lr:u==="/calibration"?ir:u==="/servo"?ur:u==="/settings"?gr:u==="/logs"||u==="/status"?Al:u==="/firmware"||u.startsWith("/reboot")?Hl:u==="/test"?si:u==="/setup"?Li:u==="/wifi"?Wi:$t}return l.$$.update=()=>{l.$$.dirty&4&&t(1,n=i(r)),l.$$.dirty&4&&t(0,s=r==="/setup"||r==="setup")},[s,n,r]}class Ji extends Ie{constructor(e){super(),Ae(this,e,Gi,Vi,Te,{})}}const rt=(...l)=>console.log("[JS]",...l);function fs(l){rt("app-main: FATAL",l);const e=document.getElementById("app");e&&e.childElementCount===0&&(e.innerHTML=`
      <div style="font: 14px system-ui, sans-serif; color:#ddd; background:#111; padding:16px; line-height:1.35">
        <div style="font-weight:600; margin-bottom:8px; color:#ff6b6b">âš ï¸ App failed to load</div>
        <div style="opacity:.85; margin-bottom:8px">Check console for full stack. Error:</div>
        <pre style="white-space:pre-wrap; background:#181818; border:1px solid #ff6b6b; padding:12px; border-radius:6px; overflow:auto; color:#ffcccc">
${String(l&&(l.stack||l.message)||l)}
        </pre>
      </div>`)}window.addEventListener("error",l=>rt("global-error:",l.message||l.error));window.addEventListener("unhandledrejection",l=>rt("unhandled-rejection:",l.reason));(function(){rt("app-main: start");const e=document.getElementById("app");if(!e){fs("Missing #app container in HTML");return}try{const t=new Ji({target:e});window.__MOUSETRAP_APP={ok:!0,mountedAt:Date.now(),app:t},rt("app-main: mounted OK")}catch(t){window.__MOUSETRAP_APP={ok:!1,error:t,when:Date.now()},fs(t)}})();
