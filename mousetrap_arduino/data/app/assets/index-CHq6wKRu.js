var Es=Object.defineProperty;var Ls=(l,e,t)=>e in l?Es(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var kt=(l,e,t)=>Ls(l,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function z(){}function As(l,e){for(const t in e)l[t]=e[t];return l}function qs(l){return!!l&&(typeof l=="object"||typeof l=="function")&&typeof l.then=="function"}function ds(l){return l()}function Ut(){return Object.create(null)}function be(l){l.forEach(ds)}function gt(l){return typeof l=="function"}function Te(l,e){return l!=l?e==e:l!==e||l&&typeof l=="object"||typeof l=="function"}let ft;function nt(l,e){return l===e?!0:(ft||(ft=document.createElement("a")),ft.href=e,l===ft.href)}function Ps(l){return Object.keys(l).length===0}function ps(l,...e){if(l==null){for(const n of e)n(void 0);return z}const t=l.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function mt(l,e,t){l.$$.on_destroy.push(ps(e,t))}function Ct(l,e,t,n){if(l){const s=ms(l,e,t,n);return l[0](s)}}function ms(l,e,t,n){return l[1]&&n?As(t.ctx.slice(),l[1](n(e))):t.ctx}function Tt(l,e,t,n){if(l[2]&&n){const s=l[2](n(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const r=[],i=Math.max(e.dirty.length,s.length);for(let c=0;c<i;c+=1)r[c]=e.dirty[c]|s[c];return r}return e.dirty|s}return e.dirty}function Ft(l,e,t,n,s,r){if(s){const i=ms(e,t,n,r);l.p(i,s)}}function Et(l){if(l.ctx.length>32){const e=[],t=l.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function We(l){return l&&gt(l.destroy)?l.destroy:z}const _s=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function o(l,e){l.appendChild(e)}function S(l,e,t){l.insertBefore(e,t||null)}function w(l){l.parentNode&&l.parentNode.removeChild(l)}function Ze(l,e){for(let t=0;t<l.length;t+=1)l[t]&&l[t].d(e)}function d(l){return document.createElement(l)}function A(l){return document.createTextNode(l)}function v(){return A(" ")}function Le(){return A("")}function M(l,e,t,n){return l.addEventListener(e,t,n),()=>l.removeEventListener(e,t,n)}function wt(l){return function(e){return e.preventDefault(),l.call(this,e)}}function bs(l){return function(e){return e.stopPropagation(),l.call(this,e)}}function a(l,e,t){t==null?l.removeAttribute(e):l.getAttribute(e)!==t&&l.setAttribute(e,t)}function Is(l){let e;return{p(...t){e=t,e.forEach(n=>l.push(n))},r(){e.forEach(t=>l.splice(l.indexOf(t),1))}}}function Ve(l){return l===""?null:+l}function Os(l){return Array.from(l.childNodes)}function j(l,e){e=""+e,l.data!==e&&(l.data=e)}function ee(l,e){l.value=e??""}function Ye(l,e,t,n){t==null?l.style.removeProperty(e):l.style.setProperty(e,t,"")}function V(l,e,t){l.classList.toggle(e,!!t)}function _t(l,e){return new l(e)}let it;function Qe(l){it=l}function qt(){if(!it)throw new Error("Function called outside component initialization");return it}function Ge(l){qt().$$.on_mount.push(l)}function at(l){qt().$$.on_destroy.push(l)}function Dt(l,e){const t=l.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const tt=[],lt=[];let st=[];const jt=[],Ns=Promise.resolve();let Lt=!1;function Rs(){Lt||(Lt=!0,Ns.then(Pt))}function At(l){st.push(l)}const St=new Set;let xe=0;function Pt(){if(xe!==0)return;const l=it;do{try{for(;xe<tt.length;){const e=tt[xe];xe++,Qe(e),Ms(e.$$)}}catch(e){throw tt.length=0,xe=0,e}for(Qe(null),tt.length=0,xe=0;lt.length;)lt.pop()();for(let e=0;e<st.length;e+=1){const t=st[e];St.has(t)||(St.add(t),t())}st.length=0}while(tt.length);for(;jt.length;)jt.pop()();Lt=!1,St.clear(),Qe(l)}function Ms(l){if(l.fragment!==null){l.update(),be(l.before_update);const e=l.dirty;l.dirty=[-1],l.fragment&&l.fragment.p(l.ctx,e),l.after_update.forEach(At)}}function Us(l){const e=[],t=[];st.forEach(n=>l.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),st=e}const pt=new Set;let $e;function ve(){$e={r:0,c:[],p:$e}}function ge(){$e.r||be($e.c),$e=$e.p}function W(l,e){l&&l.i&&(pt.delete(l),l.i(e))}function B(l,e,t,n){if(l&&l.o){if(pt.has(l))return;pt.add(l),$e.c.push(()=>{pt.delete(l),n&&(t&&l.d(1),n())}),l.o(e)}else n&&n()}function bt(l,e){const t=e.token={};function n(s,r,i,c){if(e.token!==t)return;e.resolved=c;let u=e.ctx;i!==void 0&&(u=u.slice(),u[i]=c);const f=s&&(e.current=s)(u);let p=!1;e.block&&(e.blocks?e.blocks.forEach((m,_)=>{_!==r&&m&&(ve(),B(m,1,1,()=>{e.blocks[_]===m&&(e.blocks[_]=null)}),ge())}):e.block.d(1),f.c(),W(f,1),f.m(e.mount(),e.anchor),p=!0),e.block=f,e.blocks&&(e.blocks[r]=f),p&&Pt()}if(qs(l)){const s=qt();if(l.then(r=>{Qe(s),n(e.then,1,e.value,r),Qe(null)},r=>{if(Qe(s),n(e.catch,2,e.error,r),Qe(null),!e.hasCatch)throw r}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,l),!0;e.resolved=l}}function vs(l,e,t){const n=e.slice(),{resolved:s}=l;l.current===l.then&&(n[l.value]=s),l.current===l.catch&&(n[l.error]=s),l.block.p(n,t)}function Ee(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function fe(l){l&&l.c()}function ae(l,e,t){const{fragment:n,after_update:s}=l.$$;n&&n.m(e,t),At(()=>{const r=l.$$.on_mount.map(ds).filter(gt);l.$$.on_destroy?l.$$.on_destroy.push(...r):be(r),l.$$.on_mount=[]}),s.forEach(At)}function ce(l,e){const t=l.$$;t.fragment!==null&&(Us(t.after_update),be(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Ds(l,e){l.$$.dirty[0]===-1&&(tt.push(l),Rs(),l.$$.dirty.fill(0)),l.$$.dirty[e/31|0]|=1<<e%31}function Ae(l,e,t,n,s,r,i=null,c=[-1]){const u=it;Qe(l);const f=l.$$={fragment:null,ctx:[],props:r,update:z,not_equal:s,bound:Ut(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Ut(),dirty:c,skip_bound:!1,root:e.target||u.$$.root};i&&i(f.root);let p=!1;if(f.ctx=t?t(l,e.props||{},(m,_,...b)=>{const g=b.length?b[0]:_;return f.ctx&&s(f.ctx[m],f.ctx[m]=g)&&(!f.skip_bound&&f.bound[m]&&f.bound[m](g),p&&Ds(l,m)),_}):[],f.update(),p=!0,be(f.before_update),f.fragment=n?n(f.ctx):!1,e.target){if(e.hydrate){const m=Os(e.target);f.fragment&&f.fragment.l(m),m.forEach(w)}else f.fragment&&f.fragment.c();e.intro&&W(l.$$.fragment),ae(l,e.target,e.anchor),Pt()}Qe(u)}class qe{constructor(){kt(this,"$$");kt(this,"$$set")}$destroy(){ce(this,1),this.$destroy=z}$on(e,t){if(!gt(t))return z;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const s=n.indexOf(t);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!Ps(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const js="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(js);const et=[];function Ws(l,e){return{subscribe:ct(l,e).subscribe}}function ct(l,e=z){let t;const n=new Set;function s(c){if(Te(l,c)&&(l=c,t)){const u=!et.length;for(const f of n)f[1](),et.push(f,l);if(u){for(let f=0;f<et.length;f+=2)et[f][0](et[f+1]);et.length=0}}}function r(c){s(c(l))}function i(c,u=z){const f=[c,u];return n.add(f),n.size===1&&(t=e(s,r)||z),c(l),()=>{n.delete(f),n.size===0&&t&&(t(),t=null)}}return{set:s,update:r,subscribe:i}}function gs(l,e,t){const n=!Array.isArray(l),s=n?[l]:l;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return Ws(t,(i,c)=>{let u=!1;const f=[];let p=0,m=z;const _=()=>{if(p)return;m();const g=e(n?f[0]:f,i,c);r?i(g):m=gt(g)?g:z},b=s.map((g,k)=>ps(g,h=>{f[k]=h,p&=~(1<<k),u&&_()},()=>{p|=1<<k}));return u=!0,_(),function(){be(b),m(),u=!1}})}const hs=ct({threshold:0,sensorReading:0,detectionState:!1,uptime:"",wifiRSSI:0,heap:0,psram:0,lastUpdate:null}),rt=ct(!1);function Hs(l,e){const t=localStorage.getItem(l),n=t?JSON.parse(t):e,{subscribe:s,set:r,update:i}=ct(n);return{subscribe:s,set:c=>{localStorage.setItem(l,JSON.stringify(c)),r(c)},update:c=>{i(u=>{const f=c(u);return localStorage.setItem(l,JSON.stringify(f)),f})}}}Hs("mousetrap-prefs",{theme:"dark",refreshInterval:5e3});gs(hs,l=>l.detectionState);gs(hs,l=>l.lastUpdate?l.detectionState?"red":"green":"gray");const It=ct(window.location.hash.slice(1)||"/");window.addEventListener("hashchange",()=>{const l=window.location.hash.slice(1)||"/";It.set(l)});function zs(l){window.location.hash=l}function He(l){function e(t){const n=l.getAttribute("href");n&&n.startsWith("#/")&&(t.preventDefault(),zs(n.slice(1)))}return l.addEventListener("click",e),{destroy(){l.removeEventListener("click",e)}}}function Wt(l){let e,t,n,s,r,i,c,u,f,p;return{c(){e=d("div"),t=d("a"),t.textContent="WiFi Settings",n=v(),s=d("a"),s.textContent="Servo Settings",r=v(),i=d("a"),i.textContent="Calibration",c=v(),u=d("a"),u.textContent="Options & Access",a(t,"href","#/wifi"),a(t,"class","svelte-1n65rh9"),V(t,"active",l[0]==="/wifi"),a(s,"href","#/servo"),a(s,"class","svelte-1n65rh9"),V(s,"active",l[0]==="/servo"),a(i,"href","#/calibration"),a(i,"class","svelte-1n65rh9"),V(i,"active",l[0]==="/calibration"),a(u,"href","#/settings"),a(u,"class","svelte-1n65rh9"),V(u,"active",l[0]==="/settings"),a(e,"class","submenu svelte-1n65rh9")},m(m,_){S(m,e,_),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),o(e,c),o(e,u),f||(p=[We(He.call(null,t)),M(t,"click",l[5]),We(He.call(null,s)),M(s,"click",l[5]),We(He.call(null,i)),M(i,"click",l[5]),We(He.call(null,u)),M(u,"click",l[5])],f=!0)},p(m,_){_&1&&V(t,"active",m[0]==="/wifi"),_&1&&V(s,"active",m[0]==="/servo"),_&1&&V(i,"active",m[0]==="/calibration"),_&1&&V(u,"active",m[0]==="/settings")},d(m){m&&w(e),f=!1,be(p)}}}function Ht(l){let e,t,n,s,r,i,c,u;return{c(){e=d("div"),t=d("a"),t.textContent="Status",n=v(),s=d("a"),s.textContent="System Logs",r=v(),i=d("a"),i.textContent="Gallery",a(t,"href","#/status"),a(t,"class","svelte-1n65rh9"),V(t,"active",l[0]==="/status"),a(s,"href","#/logs"),a(s,"class","svelte-1n65rh9"),V(s,"active",l[0]==="/logs"),a(i,"href","#/gallery"),a(i,"class","svelte-1n65rh9"),V(i,"active",l[0]==="/gallery"),a(e,"class","submenu svelte-1n65rh9")},m(f,p){S(f,e,p),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),c||(u=[We(He.call(null,t)),M(t,"click",l[5]),We(He.call(null,s)),M(s,"click",l[5]),We(He.call(null,i)),M(i,"click",l[5])],c=!0)},p(f,p){p&1&&V(t,"active",f[0]==="/status"),p&1&&V(s,"active",f[0]==="/logs"),p&1&&V(i,"active",f[0]==="/gallery")},d(f){f&&w(e),c=!1,be(u)}}}function zt(l){let e,t,n,s,r,i,c,u,f,p;return{c(){e=d("div"),t=d("a"),t.textContent="Claim",n=v(),s=d("a"),s.textContent="Test Alert",r=v(),i=d("a"),i.textContent="Firmware / OTA",c=v(),u=d("a"),u.textContent="Reboot",a(t,"href","/claim"),a(t,"class","svelte-1n65rh9"),a(s,"href","#/test"),a(s,"class","svelte-1n65rh9"),V(s,"active",l[0]==="/test"),a(i,"href","#/firmware"),a(i,"class","svelte-1n65rh9"),V(i,"active",l[0]==="/firmware"),a(u,"href","#/reboot"),a(u,"class","svelte-1n65rh9"),V(u,"active",l[0].startsWith("/reboot")),a(e,"class","submenu svelte-1n65rh9")},m(m,_){S(m,e,_),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),o(e,c),o(e,u),f||(p=[M(t,"click",l[5]),We(He.call(null,s)),M(s,"click",l[5]),We(He.call(null,i)),M(i,"click",l[5]),We(He.call(null,u)),M(u,"click",l[5])],f=!0)},p(m,_){_&1&&V(s,"active",m[0]==="/test"),_&1&&V(i,"active",m[0]==="/firmware"),_&1&&V(u,"active",m[0].startsWith("/reboot"))},d(m){m&&w(e),f=!1,be(p)}}}function Bt(l){let e,t,n;return{c(){e=d("div"),a(e,"class","backdrop svelte-1n65rh9")},m(s,r){S(s,e,r),t||(n=M(e,"click",l[5]),t=!0)},p:z,d(s){s&&w(e),t=!1,n()}}}function Bs(l){let e,t,n,s,r,i,c,u,f,p,m,_,b,g,k,h,y,E,C,T,P,O=l[1]&&Wt(l),L=l[2]&&Ht(l),F=l[3]&&zt(l),q=l[4]&&Bt(l);return{c(){e=d("div"),t=d("a"),t.textContent="Home",n=v(),s=d("a"),r=A(`Settings
    `),i=d("span"),i.textContent="â–¸",c=v(),O&&O.c(),u=v(),f=d("a"),p=A(`Logs & Diagnostics
    `),m=d("span"),m.textContent="â–¸",_=v(),L&&L.c(),b=v(),g=d("a"),k=A(`Maintenance
    `),h=d("span"),h.textContent="â–¸",y=v(),F&&F.c(),E=v(),q&&q.c(),C=Le(),a(t,"href","#/"),a(t,"class","svelte-1n65rh9"),V(t,"active",l[0]==="/"),a(i,"class","arrow svelte-1n65rh9"),V(i,"expanded",l[1]),a(s,"href","#"),a(s,"class","parent svelte-1n65rh9"),a(m,"class","arrow svelte-1n65rh9"),V(m,"expanded",l[2]),a(f,"href","#"),a(f,"class","parent svelte-1n65rh9"),a(h,"class","arrow svelte-1n65rh9"),V(h,"expanded",l[3]),a(g,"href","#"),a(g,"class","parent svelte-1n65rh9"),a(e,"class","menu svelte-1n65rh9"),V(e,"open",l[4])},m(R,I){S(R,e,I),o(e,t),o(e,n),o(e,s),o(s,r),o(s,i),o(e,c),O&&O.m(e,null),o(e,u),o(e,f),o(f,p),o(f,m),o(e,_),L&&L.m(e,null),o(e,b),o(e,g),o(g,k),o(g,h),o(e,y),F&&F.m(e,null),S(R,E,I),q&&q.m(R,I),S(R,C,I),T||(P=[We(He.call(null,t)),M(t,"click",l[5]),M(s,"click",wt(l[7])),M(f,"click",wt(l[8])),M(g,"click",wt(l[9]))],T=!0)},p(R,[I]){I&1&&V(t,"active",R[0]==="/"),I&2&&V(i,"expanded",R[1]),R[1]?O?O.p(R,I):(O=Wt(R),O.c(),O.m(e,u)):O&&(O.d(1),O=null),I&4&&V(m,"expanded",R[2]),R[2]?L?L.p(R,I):(L=Ht(R),L.c(),L.m(e,b)):L&&(L.d(1),L=null),I&8&&V(h,"expanded",R[3]),R[3]?F?F.p(R,I):(F=zt(R),F.c(),F.m(e,null)):F&&(F.d(1),F=null),I&16&&V(e,"open",R[4]),R[4]?q?q.p(R,I):(q=Bt(R),q.c(),q.m(C.parentNode,C)):q&&(q.d(1),q=null)},i:z,o:z,d(R){R&&(w(e),w(E),w(C)),O&&O.d(),L&&L.d(),F&&F.d(),q&&q.d(R),T=!1,be(P)}}}function Vs(l,e,t){let n,s;mt(l,It,b=>t(0,n=b)),mt(l,rt,b=>t(4,s=b));let r=!1,i=!1,c=!1;function u(){rt.set(!1)}function f(b){b==="settings"&&t(1,r=!r),b==="logs"&&t(2,i=!i),b==="maintenance"&&t(3,c=!c)}const p=()=>f("settings"),m=()=>f("logs"),_=()=>f("maintenance");return l.$$.update=()=>{if(l.$$.dirty&1){const b=n;t(1,r=b.startsWith("/servo")||b.startsWith("/calibration")||b.startsWith("/settings")||b.startsWith("/wifi")),t(2,i=b.startsWith("/logs")||b.startsWith("/status")||b.startsWith("/gallery")),t(3,c=b.startsWith("/claim")||b.startsWith("/test")||b.startsWith("/firmware")||b.startsWith("/reboot"))}},[n,r,i,c,s,u,f,p,m,_]}class Gs extends qe{constructor(e){super(),Ae(this,e,Vs,Bs,Te,{})}}function Js(l){let e,t,n,s,r,i,c,u,f;s=new Gs({});const p=l[3].default,m=Ct(p,l,l[2],null);return{c(){e=d("div"),t=d("div"),t.innerHTML='<div class="bar svelte-1stvkey"></div> <div class="bar svelte-1stvkey"></div> <div class="bar svelte-1stvkey"></div>',n=v(),fe(s.$$.fragment),r=v(),i=d("main"),m&&m.c(),a(t,"class","hamburger svelte-1stvkey"),a(t,"role","button"),a(t,"tabindex","0"),a(t,"aria-label","Toggle navigation menu"),a(i,"class","content svelte-1stvkey"),a(e,"class","layout svelte-1stvkey")},m(_,b){S(_,e,b),o(e,t),o(e,n),ae(s,e,null),o(e,r),o(e,i),m&&m.m(i,null),c=!0,u||(f=[M(window,"keydown",l[1]),M(t,"click",l[0]),M(t,"keydown",l[4])],u=!0)},p(_,[b]){m&&m.p&&(!c||b&4)&&Ft(m,p,_,_[2],c?Tt(p,_[2],b,null):Et(_[2]),null)},i(_){c||(W(s.$$.fragment,_),W(m,_),c=!0)},o(_){B(s.$$.fragment,_),B(m,_),c=!1},d(_){_&&w(e),ce(s),m&&m.d(_),u=!1,be(f)}}}function Qs(l,e,t){let n;mt(l,rt,f=>t(5,n=f));let{$$slots:s={},$$scope:r}=e;function i(){rt.update(f=>!f)}function c(f){f.key==="Escape"&&n&&rt.set(!1)}const u=f=>f.key==="Enter"&&i();return l.$$set=f=>{"$$scope"in f&&t(2,r=f.$$scope)},[i,c,r,s,u]}class Ks extends qe{constructor(e){super(),Ae(this,e,Qs,Js,Te,{})}}const Ys=l=>({}),Vt=l=>({});function Gt(l){let e,t;return{c(){e=d("h3"),t=A(l[0]),a(e,"class","card-title svelte-q6oxq0")},m(n,s){S(n,e,s),o(e,t)},p(n,s){s&1&&j(t,n[0])},d(n){n&&w(e)}}}function Zs(l){let e,t,n,s,r,i,c,u=l[0]&&Gt(l);const f=l[2].actions,p=Ct(f,l,l[1],Vt),m=l[2].default,_=Ct(m,l,l[1],null);return{c(){e=d("div"),t=d("div"),u&&u.c(),n=v(),s=d("div"),p&&p.c(),r=v(),i=d("div"),_&&_.c(),a(s,"class","card-actions svelte-q6oxq0"),a(t,"class","card-header svelte-q6oxq0"),a(i,"class","card-content svelte-q6oxq0"),a(e,"class","card svelte-q6oxq0")},m(b,g){S(b,e,g),o(e,t),u&&u.m(t,null),o(t,n),o(t,s),p&&p.m(s,null),o(e,r),o(e,i),_&&_.m(i,null),c=!0},p(b,[g]){b[0]?u?u.p(b,g):(u=Gt(b),u.c(),u.m(t,n)):u&&(u.d(1),u=null),p&&p.p&&(!c||g&2)&&Ft(p,f,b,b[1],c?Tt(f,b[1],g,Ys):Et(b[1]),Vt),_&&_.p&&(!c||g&2)&&Ft(_,m,b,b[1],c?Tt(m,b[1],g,null):Et(b[1]),null)},i(b){c||(W(p,b),W(_,b),c=!0)},o(b){B(p,b),B(_,b),c=!1},d(b){b&&w(e),u&&u.d(),p&&p.d(b),_&&_.d(b)}}}function Xs(l,e,t){let{$$slots:n={},$$scope:s}=e,{title:r=""}=e;return l.$$set=i=>{"title"in i&&t(0,r=i.title),"$$scope"in i&&t(1,s=i.$$scope)},[r,s,n]}class Ce extends qe{constructor(e){super(),Ae(this,e,Xs,Zs,Te,{title:0})}}function $s(){const l=window.location.origin;return l.includes("192.168.")||l.includes("localhost")||l.includes("mousetrap.local")?l:(console.log("[API] Captive portal detected, using 192.168.4.1 instead of:",l),"http://192.168.4.1")}const ks=$s();async function pe(l,e={}){try{const t=`${ks}${l}`;console.log(`[API] Fetching: ${t}`);const n={Accept:"application/json",...e.headers};e.body&&["POST","PUT","PATCH"].includes((e.method||"GET").toUpperCase())&&(n["Content-Type"]="application/json");const s=await fetch(t,{...e,headers:n});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=s.headers.get("content-type");return r&&r.includes("application/json")?await s.json():r&&r.includes("image/")?await s.blob():await s.text()}catch(t){throw console.error(`API Error [${l}]:`,t),t}}async function Ot(){try{const[l,e]=await Promise.all([pe("/data"),pe("/systemStatus").catch(()=>null)]);return{threshold:l.threshold||0,sensorReading:l.currentHourAverage||0,detectionState:l.triggered||!1,uptime:(e==null?void 0:e.uptime)||"",heap:(e==null?void 0:e.heapFree)||0,anomalies:l.anomalies||[],calibrationOffset:l.calibrationOffset||0,falseAlarmOffset:l.falseAlarmOffset||0,overrideThreshold:l.overrideThreshold||0}}catch{const e=await pe("/data");return{threshold:e.threshold||0,sensorReading:e.currentHourAverage||0,detectionState:e.triggered||!1,uptime:"",heap:0,anomalies:e.anomalies||[],calibrationOffset:e.calibrationOffset||0,falseAlarmOffset:e.falseAlarmOffset||0,overrideThreshold:e.overrideThreshold||0}}}async function xs(){return pe("/toggleLED")}async function en(){return pe("/api/captures")}function Jt(l){return`${ks}/captures/${l}`}async function tn(l){return pe(`/captures/${l}`,{method:"DELETE"})}async function ln(l){return pe(`/setCalib?calib=${l}`)}async function sn(l){return pe(`/setCalib?overrideTh=${l}`)}async function nn(){return pe("/setCalib?overrideTh=0")}async function rn(){return pe("/recalib")}async function on(){return pe("/falseAlarm")}async function an(){return Promise.resolve({startUS:1500,endUS:1100,disabled:!1})}async function cn(l){const e=new FormData;return e.append("start",l.startUS),e.append("end",l.endUS),l.disabled&&e.append("disableServo","on"),fetch("/setServoSettings",{method:"POST",body:e,headers:{Authorization:"Basic "+btoa("ops:changeme")}}).then(async t=>{if(!t.ok){const n=await t.text();throw new Error(n||`HTTP ${t.status}`)}return t.text()})}async function ws(){return pe("/servo")}async function Ss(){return await pe("/testAlert")}async function un(){return pe("/api/ip-filters")}async function fn(l){return pe("/api/ip-filters",{method:"POST",body:JSON.stringify(l)})}async function dn(){return pe("/api/mqtt-config")}async function pn(l){return pe("/api/mqtt-config",{method:"POST",body:JSON.stringify(l)})}async function mn(){return pe("/api/video-mode")}async function _n(l){return pe("/api/video-mode",{method:"POST",body:JSON.stringify(l)})}async function bn(){return pe("/api/system-logs")}async function vn(){return pe("/api/previous-logs")}async function gn(){return pe("/api/older-logs")}async function hn(){return pe("/api/system-info")}async function kn(){return pe("/reboot",{headers:{Authorization:"Basic "+btoa("ops:changeme")}})}async function wn(){return pe("/sendHeartbeat")}async function ys(){return pe("/reset")}async function Sn(){return pe("/api/device/claim-status")}async function yn(){return pe("/api/setup/status")}async function Cn(){return pe("/api/setup/status/clear",{method:"POST"})}async function Tn(){return pe("/api/setup/progress")}async function Fn(){return pe("/api/setup/reset",{method:"POST"})}async function En(){return pe("/api/setup/reboot",{method:"POST"})}async function Cs(l=!1){const e=l?"/api/wifi/scan?rescan=1":"/api/wifi/scan";console.log(`[WIFI-SCAN] Calling ${e}...`);try{const t=await pe(e);return console.log("[WIFI-SCAN] Got result:",JSON.stringify(t)),t}catch(t){throw console.error("[WIFI-SCAN] Error:",t),t}}async function Ln(l){return pe("/api/setup/connect",{method:"POST",body:JSON.stringify(l)})}async function An(l){return pe("/api/setup/standalone",{method:"POST",body:JSON.stringify(l)})}async function qn(l){return pe("/api/wifi/update",{method:"POST",body:JSON.stringify(l)})}const{document:Qt}=_s;function Kt(l,e,t){const n=l.slice();return n[27]=e[t],n}function Yt(l){let e;return{c(){e=d("div"),e.textContent="TRAP TRIGGERED!",a(e,"class","trap-alert svelte-1kjtmub")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function Pn(l){let e,t,n,s,r,i,c,u,f,p=l[2]?"On":"Off",m,_,b,g,k,h,y;return{c(){e=d("div"),t=d("img"),s=v(),r=d("div"),i=d("button"),i.textContent="Refresh",c=v(),u=d("button"),f=A("Live "),m=A(p),_=v(),b=d("button"),b.textContent="Toggle LED",g=v(),k=d("button"),k.textContent="Capture",nt(t.src,n=l[0])||a(t,"src",n),a(t,"alt","Camera Feed"),a(t,"class","svelte-1kjtmub"),V(t,"error",l[1]),V(t,"zoomed",l[3]),a(i,"class","btn svelte-1kjtmub"),a(u,"class","btn svelte-1kjtmub"),V(u,"active",l[2]),a(b,"class","btn svelte-1kjtmub"),a(k,"class","btn svelte-1kjtmub"),a(r,"class","camera-controls svelte-1kjtmub"),a(e,"class","camera-container svelte-1kjtmub"),V(e,"zoomed",l[3])},m(E,C){S(E,e,C),o(e,t),o(e,s),o(e,r),o(r,i),o(r,c),o(r,u),o(u,f),o(u,m),o(r,_),o(r,b),o(r,g),o(r,k),h||(y=[M(t,"error",l[14]),M(t,"click",l[15]),M(i,"click",l[7]),M(u,"click",l[8]),M(b,"click",l[9]),M(k,"click",l[13])],h=!0)},p(E,C){C&1&&!nt(t.src,n=E[0])&&a(t,"src",n),C&2&&V(t,"error",E[1]),C&8&&V(t,"zoomed",E[3]),C&4&&p!==(p=E[2]?"On":"Off")&&j(m,p),C&4&&V(u,"active",E[2]),C&8&&V(e,"zoomed",E[3])},d(E){E&&w(e),h=!1,be(y)}}}function In(l){let e,t,n,s,r,i,c,u=l[4].sensorReading+"",f,p,m,_,b,g=l[4].threshold+"",k;return{c(){e=d("div"),t=d("canvas"),n=v(),s=d("div"),r=d("div"),i=A("Current: "),c=d("strong"),f=A(u),p=v(),m=d("div"),_=A("Threshold: "),b=d("strong"),k=A(g),a(e,"class","chart-container svelte-1kjtmub"),a(c,"class","svelte-1kjtmub"),a(b,"class","svelte-1kjtmub"),a(s,"class","sensor-info svelte-1kjtmub")},m(h,y){S(h,e,y),o(e,t),l[16](t),S(h,n,y),S(h,s,y),o(s,r),o(r,i),o(r,c),o(c,f),o(s,p),o(s,m),o(m,_),o(m,b),o(b,k)},p(h,y){y&16&&u!==(u=h[4].sensorReading+"")&&j(f,u),y&16&&g!==(g=h[4].threshold+"")&&j(k,g)},d(h){h&&(w(e),w(n),w(s)),l[16](null)}}}function On(l){let e,t,n,s,r,i=l[4].uptime+"",c,u,f,p,m,_,b=l[4].heap+"",g,k,h,y,E,C,T,P=l[5].message+"",O,L,F,q,R,I,U,G,N,H;return{c(){e=d("div"),t=d("div"),n=d("span"),n.textContent="Uptime:",s=v(),r=d("span"),c=A(i),u=v(),f=d("div"),p=d("span"),p.textContent="Free Heap:",m=v(),_=d("span"),g=A(b),k=A(" bytes"),h=v(),y=d("div"),E=d("span"),E.textContent="Claim Status:",C=v(),T=d("span"),O=A(P),L=v(),F=d("div"),q=d("button"),q.textContent="Reset Alarm",R=v(),I=d("button"),I.textContent="False Alarm",U=v(),G=d("button"),G.textContent="Send Heartbeat",a(t,"class","status-row svelte-1kjtmub"),a(f,"class","status-row svelte-1kjtmub"),a(T,"class","claimed-status"),V(T,"unclaimed",!l[5].claimed),a(y,"class","status-row svelte-1kjtmub"),a(e,"class","status-info svelte-1kjtmub"),a(q,"class","btn svelte-1kjtmub"),a(I,"class","btn svelte-1kjtmub"),a(G,"class","btn svelte-1kjtmub"),a(F,"class","action-buttons svelte-1kjtmub")},m(D,Q){S(D,e,Q),o(e,t),o(t,n),o(t,s),o(t,r),o(r,c),o(e,u),o(e,f),o(f,p),o(f,m),o(f,_),o(_,g),o(_,k),o(e,h),o(e,y),o(y,E),o(y,C),o(y,T),o(T,O),S(D,L,Q),S(D,F,Q),o(F,q),o(F,R),o(F,I),o(F,U),o(F,G),N||(H=[M(q,"click",l[10]),M(I,"click",l[11]),M(G,"click",l[12])],N=!0)},p(D,Q){Q&16&&i!==(i=D[4].uptime+"")&&j(c,i),Q&16&&b!==(b=D[4].heap+"")&&j(g,b),Q&32&&P!==(P=D[5].message+"")&&j(O,P),Q&32&&V(T,"unclaimed",!D[5].claimed)},d(D){D&&(w(e),w(L),w(F)),N=!1,be(H)}}}function Nn(l){let e;return{c(){e=d("p"),e.textContent="No anomalies detected",a(e,"class","no-data svelte-1kjtmub")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function Rn(l){let e,t=Ee(l[4].anomalies),n=[];for(let s=0;s<t.length;s+=1)n[s]=Zt(Kt(l,t,s));return{c(){e=d("div");for(let s=0;s<n.length;s+=1)n[s].c();a(e,"class","anomalies-list svelte-1kjtmub")},m(s,r){S(s,e,r);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,r){if(r&16){t=Ee(s[4].anomalies);let i;for(i=0;i<t.length;i+=1){const c=Kt(s,t,i);n[i]?n[i].p(c,r):(n[i]=Zt(c),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(s){s&&w(e),Ze(n,s)}}}function Zt(l){let e,t,n=l[27].timestamp+"",s,r,i,c=l[27].distance+"",u,f,p;return{c(){e=d("div"),t=d("span"),s=A(n),r=v(),i=d("span"),u=A(c),f=A(" cm"),p=v(),a(t,"class","timestamp svelte-1kjtmub"),a(i,"class","distance svelte-1kjtmub"),a(e,"class","anomaly-item svelte-1kjtmub")},m(m,_){S(m,e,_),o(e,t),o(t,s),o(e,r),o(e,i),o(i,u),o(i,f),o(e,p)},p(m,_){_&16&&n!==(n=m[27].timestamp+"")&&j(s,n),_&16&&c!==(c=m[27].distance+"")&&j(u,c)},d(m){m&&w(e)}}}function Mn(l){let e;function t(r,i){return r[4].anomalies&&r[4].anomalies.length>0?Rn:Nn}let n=t(l),s=n(l);return{c(){s.c(),e=Le()},m(r,i){s.m(r,i),S(r,e,i)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},d(r){r&&w(e),s.d(r)}}}function Un(l){let e,t,n,s,r=(l[5].deviceName||"MouseTrap")+"",i,c,u,f,p,m,_,b,g,k,h,y,E;Qt.title=e="Dashboard - "+(l[5].deviceName||"MouseTrap");let C=l[4].detectionState&&Yt();return p=new Ce({props:{title:"Live Camera Feed",$$slots:{default:[Pn]},$$scope:{ctx:l}}}),b=new Ce({props:{title:"Sensor Range",$$slots:{default:[In]},$$scope:{ctx:l}}}),k=new Ce({props:{title:"System Status",$$slots:{default:[On]},$$scope:{ctx:l}}}),y=new Ce({props:{title:"Anomalous Events",$$slots:{default:[Mn]},$$scope:{ctx:l}}}),{c(){t=v(),n=d("div"),s=d("h1"),i=A(r),c=v(),C&&C.c(),u=v(),f=d("div"),fe(p.$$.fragment),m=v(),_=d("div"),fe(b.$$.fragment),g=v(),fe(k.$$.fragment),h=v(),fe(y.$$.fragment),a(s,"class","svelte-1kjtmub"),a(f,"class","camera-card-wrapper svelte-1kjtmub"),a(_,"class","grid svelte-1kjtmub"),a(n,"class","dashboard svelte-1kjtmub")},m(T,P){S(T,t,P),S(T,n,P),o(n,s),o(s,i),o(n,c),C&&C.m(n,null),o(n,u),o(n,f),ae(p,f,null),o(n,m),o(n,_),ae(b,_,null),o(_,g),ae(k,_,null),o(_,h),ae(y,_,null),E=!0},p(T,[P]){(!E||P&32)&&e!==(e="Dashboard - "+(T[5].deviceName||"MouseTrap"))&&(Qt.title=e),(!E||P&32)&&r!==(r=(T[5].deviceName||"MouseTrap")+"")&&j(i,r),T[4].detectionState?C||(C=Yt(),C.c(),C.m(n,u)):C&&(C.d(1),C=null);const O={};P&1073741839&&(O.$$scope={dirty:P,ctx:T}),p.$set(O);const L={};P&1073741904&&(L.$$scope={dirty:P,ctx:T}),b.$set(L);const F={};P&1073741872&&(F.$$scope={dirty:P,ctx:T}),k.$set(F);const q={};P&1073741840&&(q.$$scope={dirty:P,ctx:T}),y.$set(q)},i(T){E||(W(p.$$.fragment,T),W(b.$$.fragment,T),W(k.$$.fragment,T),W(y.$$.fragment,T),E=!0)},o(T){B(p.$$.fragment,T),B(b.$$.fragment,T),B(k.$$.fragment,T),B(y.$$.fragment,T),E=!1},d(T){T&&(w(t),w(n)),C&&C.d(),ce(p),ce(b),ce(k),ce(y)}}}const Xt=20;function Dn(l,e,t){let n="/auto.jpg",s=!1,r=!1,i=!1,c=null,u=null,f={threshold:0,sensorReading:0,detectionState:!1,uptime:"",heap:0,anomalies:[]},p={claimed:!1,message:"Checking...",deviceName:""},m=null,_=null,b=[];async function g(){try{t(0,n=`/auto.jpg?t=${Date.now()}`),t(1,s=!1)}catch(N){console.error("Camera refresh error:",N),t(1,s=!0)}}function k(){try{t(0,n=`/camera?t=${Date.now()}`),t(1,s=!1)}catch(N){console.error("Live frame error:",N),t(1,s=!0)}}function h(){t(2,r=!r),r?(k(),c=setInterval(()=>{k()},100)):(c&&(clearInterval(c),c=null),g())}async function y(){try{await xs()}catch(N){console.error("Toggle LED error:",N)}}async function E(){try{await ys(),await O()}catch(N){console.error("Reset alarm error:",N)}}async function C(){try{const N=await on();N&&N.newThreshold!==void 0&&t(4,f.threshold=N.newThreshold,f),await O()}catch(N){console.error("False alarm error:",N)}}async function T(){try{await wn()}catch(N){console.error("Send heartbeat error:",N)}}async function P(){try{await Ss(),await g()}catch(N){console.error("Capture screenshot error:",N)}}async function O(){try{const N=await Ot();t(4,f=N),b.push({time:new Date().toLocaleTimeString(),value:N.sensorReading}),b.length>Xt&&(b=b.slice(-Xt)),F()}catch(N){console.error("Status fetch error:",N)}}function L(){if(!_)return;const N=_.getContext("2d");m=new Chart(N,{type:"line",data:{labels:[],datasets:[{label:"Sensor Reading",data:[],borderColor:"#4CAF50",backgroundColor:"rgba(76, 175, 80, 0.1)",tension:.4},{label:"Threshold",data:[],borderColor:"#f44336",backgroundColor:"transparent",borderDash:[5,5],pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{color:"#ddd"},grid:{color:"#333"}},x:{ticks:{color:"#ddd"},grid:{color:"#333"}}},plugins:{legend:{labels:{color:"#ddd"}}}}})}function F(){m&&(m.data.labels=b.map(N=>N.time),m.data.datasets[0].data=b.map(N=>N.value),m.data.datasets[1].data=b.map(()=>f.threshold),m.update())}function q(){t(1,s=!0),setTimeout(()=>{r?k():g()},1e3)}async function R(){if(i)try{(document.fullscreenElement||document.webkitFullscreenElement)&&(document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen&&await document.webkitExitFullscreen()),t(3,i=!1)}catch(N){console.error("Error exiting fullscreen:",N),t(3,i=!1)}else try{const N=document.documentElement;N.requestFullscreen?await N.requestFullscreen():N.webkitRequestFullscreen&&await N.webkitRequestFullscreen(),t(3,i=!0)}catch(N){console.error("Error entering fullscreen:",N),t(3,i=!0)}}function I(){!document.fullscreenElement&&!document.webkitFullscreenElement&&t(3,i=!1)}async function U(){try{const N=await Sn();t(5,p={claimed:N.claimed||!1,deviceName:N.deviceName||"",message:N.claimed?`Claimed to ${N.deviceName||"tenant"}`:N.message||"Device not claimed"})}catch(N){console.error("Claim status fetch error:",N),t(5,p={claimed:!1,deviceName:"",message:"Error loading claim status"})}}Ge(()=>{if(typeof Chart<"u")L();else{const N=document.createElement("script");N.src="https://cdn.jsdelivr.net/npm/chart.js",N.onload=()=>L(),document.head.appendChild(N)}O(),U(),u=setInterval(O,5e3),document.addEventListener("fullscreenchange",I),document.addEventListener("webkitfullscreenchange",I)}),at(()=>{c&&clearInterval(c),u&&clearInterval(u),m&&m.destroy(),document.removeEventListener("fullscreenchange",I),document.removeEventListener("webkitfullscreenchange",I)});function G(N){lt[N?"unshift":"push"](()=>{_=N,t(6,_)})}return[n,s,r,i,f,p,_,g,h,y,E,C,T,P,q,R,G]}class $t extends qe{constructor(e){super(),Ae(this,e,Dn,Un,Te,{})}}function jn(l){let e,t;return{c(){e=d("div"),t=d("div"),a(t,"class","spinner svelte-1cznhkh"),Ye(t,"width",l[0]+"px"),Ye(t,"height",l[0]+"px"),Ye(t,"border-color",l[1]+" transparent transparent transparent"),a(e,"class","spinner-container svelte-1cznhkh")},m(n,s){S(n,e,s),o(e,t)},p(n,[s]){s&1&&Ye(t,"width",n[0]+"px"),s&1&&Ye(t,"height",n[0]+"px"),s&2&&Ye(t,"border-color",n[1]+" transparent transparent transparent")},i:z,o:z,d(n){n&&w(e)}}}function Wn(l,e,t){let{size:n=40}=e,{color:s="#9fdcff"}=e;return l.$$set=r=>{"size"in r&&t(0,n=r.size),"color"in r&&t(1,s=r.color)},[n,s]}class De extends qe{constructor(e){super(),Ae(this,e,Wn,jn,Te,{size:0,color:1})}}function xt(l){let e,t,n,s,r=l[0].message+"",i,c,u,f,p,m,_=l[0].details&&el(l);return{c(){e=d("div"),t=d("div"),n=d("strong"),n.textContent="âš ï¸ Error:",s=v(),i=A(r),c=v(),_&&_.c(),u=v(),f=d("button"),f.textContent="âœ•",a(t,"class","error-content svelte-1gxsq9q"),a(f,"class","dismiss-btn svelte-1gxsq9q"),a(e,"class","error-banner svelte-1gxsq9q")},m(b,g){S(b,e,g),o(e,t),o(t,n),o(t,s),o(t,i),o(t,c),_&&_.m(t,null),o(e,u),o(e,f),p||(m=M(f,"click",l[1]),p=!0)},p(b,g){g&1&&r!==(r=b[0].message+"")&&j(i,r),b[0].details?_?_.p(b,g):(_=el(b),_.c(),_.m(t,null)):_&&(_.d(1),_=null)},d(b){b&&w(e),_&&_.d(),p=!1,m()}}}function el(l){let e,t=JSON.stringify(l[0].details)+"",n;return{c(){e=d("div"),n=A(t),a(e,"class","error-details svelte-1gxsq9q")},m(s,r){S(s,e,r),o(e,n)},p(s,r){r&1&&t!==(t=JSON.stringify(s[0].details)+"")&&j(n,t)},d(s){s&&w(e)}}}function Hn(l){let e,t=l[0]&&xt(l);return{c(){t&&t.c(),e=Le()},m(n,s){t&&t.m(n,s),S(n,e,s)},p(n,[s]){n[0]?t?t.p(n,s):(t=xt(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:z,o:z,d(n){n&&w(e),t&&t.d(n)}}}function zn(l,e,t){let{error:n=null}=e;function s(){t(0,n=null)}return l.$$set=r=>{"error"in r&&t(0,n=r.error)},[n,s]}class Ts extends qe{constructor(e){super(),Ae(this,e,zn,Hn,Te,{error:0})}}function tl(l,e,t){const n=l.slice();return n[25]=e[t],n[27]=t,n}function ll(l){let e,t;return e=new Ts({props:{message:l[2]}}),{c(){fe(e.$$.fragment)},m(n,s){ae(e,n,s),t=!0},p(n,s){const r={};s&4&&(r.message=n[2]),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function Bn(l){let e,t,n=Ee(l[0]),s=[];for(let i=0;i<n.length;i+=1)s[i]=sl(tl(l,n,i));const r=i=>B(s[i],1,1,()=>{s[i]=null});return{c(){e=d("div");for(let i=0;i<s.length;i+=1)s[i].c();a(e,"class","image-grid svelte-1chdln3")},m(i,c){S(i,e,c);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);t=!0},p(i,c){if(c&769){n=Ee(i[0]);let u;for(u=0;u<n.length;u+=1){const f=tl(i,n,u);s[u]?(s[u].p(f,c),W(s[u],1)):(s[u]=sl(f),s[u].c(),W(s[u],1),s[u].m(e,null))}for(ve(),u=n.length;u<s.length;u+=1)r(u);ge()}},i(i){if(!t){for(let c=0;c<n.length;c+=1)W(s[c]);t=!0}},o(i){s=s.filter(Boolean);for(let c=0;c<s.length;c+=1)B(s[c]);t=!1},d(i){i&&w(e),Ze(s,i)}}}function Vn(l){let e,t;return e=new Ce({props:{$$slots:{default:[Xn]},$$scope:{ctx:l}}}),{c(){fe(e.$$.fragment)},m(n,s){ae(e,n,s),t=!0},p(n,s){const r={};s&268435456&&(r.$$scope={dirty:s,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function Gn(l){let e,t,n;return t=new De({}),{c(){e=d("div"),fe(t.$$.fragment),a(e,"class","loading-container svelte-1chdln3")},m(s,r){S(s,e,r),ae(t,e,null),n=!0},p:z,i(s){n||(W(t.$$.fragment,s),n=!0)},o(s){B(t.$$.fragment,s),n=!1},d(s){s&&w(e),ce(t)}}}function Jn(l){return{c:z,m:z,p:z,i:z,o:z,d:z}}function Qn(l){let e;function t(r,i){return r[24]?Yn:Kn}let n=t(l),s=n(l);return{c(){s.c(),e=Le()},m(r,i){s.m(r,i),S(r,e,i)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},i:z,o:z,d(r){r&&w(e),s.d(r)}}}function Kn(l){let e;return{c(){e=d("div"),e.textContent="Failed to load",a(e,"class","thumbnail-error svelte-1chdln3")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function Yn(l){let e,t,n;return{c(){e=d("img"),nt(e.src,t=l[24])||a(e,"src",t),a(e,"alt",n=l[25].name),a(e,"class","thumbnail-image svelte-1chdln3")},m(s,r){S(s,e,r)},p(s,r){r&1&&!nt(e.src,t=s[24])&&a(e,"src",t),r&1&&n!==(n=s[25].name)&&a(e,"alt",n)},d(s){s&&w(e)}}}function Zn(l){let e,t,n;return t=new De({}),{c(){e=d("div"),fe(t.$$.fragment),a(e,"class","thumbnail-loading svelte-1chdln3")},m(s,r){S(s,e,r),ae(t,e,null),n=!0},p:z,i(s){n||(W(t.$$.fragment,s),n=!0)},o(s){B(t.$$.fragment,s),n=!1},d(s){s&&w(e),ce(t)}}}function sl(l){let e,t,n,s,r,i=l[25].name+"",c,u,f,p=ol(l[25].size)+"",m,_,b,g,k,h={ctx:l,current:null,token:null,hasCatch:!1,pending:Zn,then:Qn,catch:Jn,value:24,blocks:[,,,]};bt(t=l[8](l[25].name),h);function y(){return l[19](l[25],l[27])}return{c(){e=d("div"),h.block.c(),n=v(),s=d("div"),r=d("div"),c=A(i),u=v(),f=d("div"),m=A(p),_=v(),a(r,"class","thumbnail-filename svelte-1chdln3"),a(f,"class","thumbnail-meta svelte-1chdln3"),a(s,"class","thumbnail-info svelte-1chdln3"),a(e,"class","thumbnail-card svelte-1chdln3")},m(E,C){S(E,e,C),h.block.m(e,h.anchor=null),h.mount=()=>e,h.anchor=n,o(e,n),o(e,s),o(s,r),o(r,c),o(s,u),o(s,f),o(f,m),o(e,_),b=!0,g||(k=M(e,"click",y),g=!0)},p(E,C){l=E,h.ctx=l,C&1&&t!==(t=l[8](l[25].name))&&bt(t,h)||vs(h,l,C),(!b||C&1)&&i!==(i=l[25].name+"")&&j(c,i),(!b||C&1)&&p!==(p=ol(l[25].size)+"")&&j(m,p)},i(E){b||(W(h.block),b=!0)},o(E){for(let C=0;C<3;C+=1){const T=h.blocks[C];B(T)}b=!1},d(E){E&&w(e),h.block.d(),h.token=null,h=null,g=!1,k()}}}function Xn(l){let e;return{c(){e=d("div"),e.innerHTML='<p class="svelte-1chdln3">No captures yet</p> <p class="empty-hint svelte-1chdln3">Captured images will appear here</p>',a(e,"class","empty-state svelte-1chdln3")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function nl(l){let e,t,n,s,r,i=l[3].name+"",c,u,f,p=il(l[3].timestamp)+"",m,_,b,g,k,h,y,E,C,T,P,O,L,F,q=l[4]+1+"",R,I,U=l[0].length+"",G,N,H,D,Q,K,Z,ie,_e,x,X,ne,se,J={ctx:l,current:null,token:null,hasCatch:!1,pending:lr,then:xn,catch:$n,value:24,blocks:[,,,]};return bt(h=l[8](l[3].name),J),{c(){e=d("div"),t=d("div"),n=d("div"),s=d("div"),r=d("div"),c=A(i),u=v(),f=d("div"),m=A(p),_=v(),b=d("button"),b.textContent="Ã—",g=v(),k=d("div"),J.block.c(),y=v(),E=d("div"),C=d("div"),T=d("button"),P=A("â† Previous"),L=v(),F=d("span"),R=A(q),I=A(" / "),G=A(U),N=v(),H=d("button"),D=A("Next â†’"),K=v(),Z=d("div"),ie=d("button"),ie.textContent="Download",_e=v(),x=d("button"),x.textContent="Delete",a(r,"class","modal-filename svelte-1chdln3"),a(f,"class","modal-timestamp svelte-1chdln3"),a(s,"class","modal-title svelte-1chdln3"),a(b,"class","modal-close svelte-1chdln3"),a(n,"class","modal-header svelte-1chdln3"),a(k,"class","modal-body svelte-1chdln3"),a(T,"class","nav-btn svelte-1chdln3"),T.disabled=O=l[4]===0,a(F,"class","image-counter svelte-1chdln3"),a(H,"class","nav-btn svelte-1chdln3"),H.disabled=Q=l[4]===l[0].length-1,a(C,"class","modal-nav svelte-1chdln3"),a(ie,"class","action-btn svelte-1chdln3"),a(x,"class","action-btn delete-btn svelte-1chdln3"),a(Z,"class","modal-actions svelte-1chdln3"),a(E,"class","modal-footer svelte-1chdln3"),a(t,"class","modal-content svelte-1chdln3"),a(e,"class","modal-backdrop svelte-1chdln3")},m($,le){S($,e,le),o(e,t),o(t,n),o(n,s),o(s,r),o(r,c),o(s,u),o(s,f),o(f,m),o(n,_),o(n,b),o(t,g),o(t,k),J.block.m(k,J.anchor=null),J.mount=()=>k,J.anchor=null,o(t,y),o(t,E),o(E,C),o(C,T),o(T,P),o(C,L),o(C,F),o(F,R),o(F,I),o(F,G),o(C,N),o(C,H),o(H,D),o(E,K),o(E,Z),o(Z,ie),o(Z,_e),o(Z,x),X=!0,ne||(se=[M(b,"click",l[10]),M(T,"click",l[11]),M(H,"click",l[12]),M(ie,"click",l[20]),M(x,"click",l[21]),M(t,"click",bs(l[18])),M(e,"click",l[10])],ne=!0)},p($,le){l=$,(!X||le&8)&&i!==(i=l[3].name+"")&&j(c,i),(!X||le&8)&&p!==(p=il(l[3].timestamp)+"")&&j(m,p),J.ctx=l,le&8&&h!==(h=l[8](l[3].name))&&bt(h,J)||vs(J,l,le),(!X||le&16&&O!==(O=l[4]===0))&&(T.disabled=O),(!X||le&16)&&q!==(q=l[4]+1+"")&&j(R,q),(!X||le&1)&&U!==(U=l[0].length+"")&&j(G,U),(!X||le&17&&Q!==(Q=l[4]===l[0].length-1))&&(H.disabled=Q)},i($){X||(W(J.block),X=!0)},o($){for(let le=0;le<3;le+=1){const me=J.blocks[le];B(me)}X=!1},d($){$&&w(e),J.block.d(),J.token=null,J=null,ne=!1,be(se)}}}function $n(l){return{c:z,m:z,p:z,i:z,o:z,d:z}}function xn(l){let e;function t(r,i){return r[24]?tr:er}let n=t(l),s=n(l);return{c(){s.c(),e=Le()},m(r,i){s.m(r,i),S(r,e,i)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e.parentNode,e)))},i:z,o:z,d(r){r&&w(e),s.d(r)}}}function er(l){let e;return{c(){e=d("div"),e.textContent="Failed to load image",a(e,"class","modal-error svelte-1chdln3")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function tr(l){let e,t,n;return{c(){e=d("img"),nt(e.src,t=l[24])||a(e,"src",t),a(e,"alt",n=l[3].name),a(e,"class","modal-image svelte-1chdln3")},m(s,r){S(s,e,r)},p(s,r){r&8&&!nt(e.src,t=s[24])&&a(e,"src",t),r&8&&n!==(n=s[3].name)&&a(e,"alt",n)},d(s){s&&w(e)}}}function lr(l){let e,t;return e=new De({}),{c(){fe(e.$$.fragment)},m(n,s){ae(e,n,s),t=!0},p:z,i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function rl(l){let e,t,n,s,r,i,c,u,f,p,m,_,b,g,k;return{c(){e=d("div"),t=d("div"),n=d("h3"),n.textContent="Confirm Delete",s=v(),r=d("p"),i=A("Are you sure you want to delete "),c=A(l[6]),u=A("?"),f=v(),p=d("div"),m=d("button"),m.textContent="Cancel",_=v(),b=d("button"),b.textContent="Delete",a(n,"class","svelte-1chdln3"),a(r,"class","svelte-1chdln3"),a(m,"class","confirm-btn cancel-btn svelte-1chdln3"),a(b,"class","confirm-btn delete-confirm-btn svelte-1chdln3"),a(p,"class","confirm-actions svelte-1chdln3"),a(t,"class","confirm-dialog svelte-1chdln3"),a(e,"class","confirm-backdrop svelte-1chdln3")},m(h,y){S(h,e,y),o(e,t),o(t,n),o(t,s),o(t,r),o(r,i),o(r,c),o(r,u),o(t,f),o(t,p),o(p,m),o(p,_),o(p,b),g||(k=[M(m,"click",l[16]),M(b,"click",l[15]),M(t,"click",bs(l[17])),M(e,"click",l[16])],g=!0)},p(h,y){y&64&&j(c,h[6])},d(h){h&&w(e),g=!1,be(k)}}}function sr(l){let e,t,n,s,r,i=l[1]?"Loading...":"Refresh",c,u,f,p,m,_,b,g,k,h,y,E=l[2]&&ll(l);const C=[Gn,Vn,Bn],T=[];function P(F,q){return F[1]?0:F[0].length===0?1:2}p=P(l),m=T[p]=C[p](l);let O=l[3]&&nl(l),L=l[5]&&rl(l);return{c(){e=d("div"),t=d("div"),n=d("h1"),n.textContent="Image Gallery",s=v(),r=d("button"),c=A(i),u=v(),E&&E.c(),f=v(),m.c(),_=v(),O&&O.c(),b=v(),L&&L.c(),g=Le(),a(n,"class","svelte-1chdln3"),a(r,"class","refresh-btn svelte-1chdln3"),r.disabled=l[1],a(t,"class","header svelte-1chdln3"),a(e,"class","gallery-container svelte-1chdln3")},m(F,q){S(F,e,q),o(e,t),o(t,n),o(t,s),o(t,r),o(r,c),o(e,u),E&&E.m(e,null),o(e,f),T[p].m(e,null),S(F,_,q),O&&O.m(F,q),S(F,b,q),L&&L.m(F,q),S(F,g,q),k=!0,h||(y=M(r,"click",l[7]),h=!0)},p(F,[q]){(!k||q&2)&&i!==(i=F[1]?"Loading...":"Refresh")&&j(c,i),(!k||q&2)&&(r.disabled=F[1]),F[2]?E?(E.p(F,q),q&4&&W(E,1)):(E=ll(F),E.c(),W(E,1),E.m(e,f)):E&&(ve(),B(E,1,1,()=>{E=null}),ge());let R=p;p=P(F),p===R?T[p].p(F,q):(ve(),B(T[R],1,1,()=>{T[R]=null}),ge(),m=T[p],m?m.p(F,q):(m=T[p]=C[p](F),m.c()),W(m,1),m.m(e,null)),F[3]?O?(O.p(F,q),q&8&&W(O,1)):(O=nl(F),O.c(),W(O,1),O.m(b.parentNode,b)):O&&(ve(),B(O,1,1,()=>{O=null}),ge()),F[5]?L?L.p(F,q):(L=rl(F),L.c(),L.m(g.parentNode,g)):L&&(L.d(1),L=null)},i(F){k||(W(E),W(m),W(O),k=!0)},o(F){B(E),B(m),B(O),k=!1},d(F){F&&(w(e),w(_),w(b),w(g)),E&&E.d(),T[p].d(),O&&O.d(F),L&&L.d(F),h=!1,y()}}}function il(l){return new Date(l).toLocaleString()}function ol(l){return l<1024?l+" B":l<1024*1024?(l/1024).toFixed(1)+" KB":(l/(1024*1024)).toFixed(1)+" MB"}function nr(l,e,t){let n=[],s=!0,r=null,i=null,c=-1,u={},f=!1,p=null;Ge(()=>{m(),document.addEventListener("keydown",k)}),at(()=>{document.removeEventListener("keydown",k),Object.values(u).forEach(I=>URL.revokeObjectURL(I))});async function m(){t(1,s=!0),t(2,r=null);try{const I=await en();t(0,n=I.files||[]),n.sort((U,G)=>G.name.localeCompare(U.name))}catch(I){t(2,r=I.message||"Failed to load gallery")}finally{t(1,s=!1)}}async function _(I){if(u[I])return u[I];try{const U=Jt(I);return u[I]=U,U}catch(U){return console.error("Failed to load image:",U),null}}async function b(I,U){t(3,i=I),t(4,c=U),await _(I.name)}function g(){t(3,i=null),t(4,c=-1),t(5,f=!1),t(6,p=null)}function k(I){i&&(I.key==="Escape"?g():I.key==="ArrowLeft"?h():I.key==="ArrowRight"&&y())}function h(){c>0&&(t(4,c--,c),t(3,i=n[c]),_(i.name))}function y(){c<n.length-1&&(t(4,c++,c),t(3,i=n[c]),_(i.name))}async function E(I){try{const U=Jt(I),N=await(await fetch(U)).blob(),H=URL.createObjectURL(N),D=document.createElement("a");D.href=H,D.download=I,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(H)}catch(U){console.error("Failed to download image:",U),alert("Failed to download image")}}function C(I){t(6,p=I),t(5,f=!0)}async function T(){if(p)try{await tn(p),u[p]&&(URL.revokeObjectURL(u[p]),delete u[p]),t(0,n=n.filter(I=>I.name!==p)),i&&i.name===p&&g(),t(5,f=!1),t(6,p=null)}catch(I){console.error("Failed to delete image:",I),alert("Failed to delete image")}}function P(){t(5,f=!1),t(6,p=null)}function O(I){Dt.call(this,l,I)}function L(I){Dt.call(this,l,I)}return[n,s,r,i,c,f,p,m,_,b,g,h,y,E,C,T,P,O,L,(I,U)=>b(I,U),()=>E(i.name),()=>C(i.name)]}class rr extends qe{constructor(e){super(),Ae(this,e,nr,sr,Te,{})}}function al(l){let e,t;return{c(){e=d("div"),t=A(l[5]),a(e,"class","message svelte-1iken05"),V(e,"success",l[6]==="success"),V(e,"error",l[6]==="error")},m(n,s){S(n,e,s),o(e,t)},p(n,s){s&32&&j(t,n[5]),s&64&&V(e,"success",n[6]==="success"),s&64&&V(e,"error",n[6]==="error")},d(n){n&&w(e)}}}function ir(l){let e,t,n,s,r,i,c,u,f,p,m,_,b,g,k,h,y,E,C,T,P,O,L,F,q,R,I,U,G,N,H,D,Q,K,Z,ie,_e,x,X,ne,se;return{c(){e=d("div"),t=d("div"),n=d("label"),n.textContent="False-Alarm Offset:",s=v(),r=d("span"),i=A(l[0]),c=A(" mm"),u=v(),f=d("div"),p=d("label"),p.textContent="Current Threshold:",m=v(),_=d("span"),b=A(l[1]),g=A(" mm"),k=v(),h=d("div"),y=d("label"),y.textContent="Calibration Offset:",E=v(),C=d("div"),T=d("input"),P=v(),O=d("span"),L=A(l[2]),F=A(" mm"),q=v(),R=d("div"),I=d("label"),I.textContent="Override Threshold (mm):",U=v(),G=d("input"),N=v(),H=d("div"),D=d("button"),Q=A("ðŸ’¾ Save"),K=v(),Z=d("button"),ie=A("ðŸ—‘ï¸ Clear Override"),_e=v(),x=d("button"),X=A("ðŸ”„ Recalibrate"),a(n,"class","svelte-1iken05"),a(r,"class","value svelte-1iken05"),a(t,"class","info-row svelte-1iken05"),a(p,"class","svelte-1iken05"),a(_,"class","value svelte-1iken05"),a(f,"class","info-row svelte-1iken05"),a(y,"for","calib-offset"),a(y,"class","svelte-1iken05"),a(T,"id","calib-offset"),a(T,"type","range"),a(T,"min","-100"),a(T,"max","100"),a(T,"step","1"),a(T,"class","slider svelte-1iken05"),T.disabled=l[4],a(O,"class","slider-value svelte-1iken05"),a(C,"class","slider-row svelte-1iken05"),a(h,"class","control-group svelte-1iken05"),a(I,"for","override-th"),a(I,"class","svelte-1iken05"),a(G,"id","override-th"),a(G,"type","number"),a(G,"placeholder",""),a(G,"min","0"),a(G,"class","input-field svelte-1iken05"),G.disabled=l[4],a(R,"class","control-group svelte-1iken05"),a(D,"class","btn btn-save svelte-1iken05"),D.disabled=l[4],a(Z,"class","btn btn-clear svelte-1iken05"),Z.disabled=l[4],a(x,"class","btn btn-recal svelte-1iken05"),x.disabled=l[4],a(H,"class","button-group svelte-1iken05"),a(e,"class","content svelte-1iken05")},m(J,$){S(J,e,$),o(e,t),o(t,n),o(t,s),o(t,r),o(r,i),o(r,c),o(e,u),o(e,f),o(f,p),o(f,m),o(f,_),o(_,b),o(_,g),o(e,k),o(e,h),o(h,y),o(h,E),o(h,C),o(C,T),ee(T,l[2]),o(C,P),o(C,O),o(O,L),o(O,F),o(e,q),o(e,R),o(R,I),o(R,U),o(R,G),ee(G,l[3]),o(e,N),o(e,H),o(H,D),o(D,Q),o(H,K),o(H,Z),o(Z,ie),o(H,_e),o(H,x),o(x,X),ne||(se=[M(T,"change",l[10]),M(T,"input",l[10]),M(G,"input",l[11]),M(D,"click",l[7]),M(Z,"click",l[8]),M(x,"click",l[9])],ne=!0)},p(J,$){$&1&&j(i,J[0]),$&2&&j(b,J[1]),$&16&&(T.disabled=J[4]),$&4&&ee(T,J[2]),$&4&&j(L,J[2]),$&16&&(G.disabled=J[4]),$&8&&Ve(G.value)!==J[3]&&ee(G,J[3]),$&16&&(D.disabled=J[4]),$&16&&(Z.disabled=J[4]),$&16&&(x.disabled=J[4])},d(J){J&&w(e),ne=!1,be(se)}}}function or(l){let e,t,n,s,r,i,c=l[5]&&al(l);return r=new Ce({props:{title:"",$$slots:{default:[ir]},$$scope:{ctx:l}}}),{c(){e=d("div"),t=d("h1"),t.textContent="Calibration Settings",n=v(),c&&c.c(),s=v(),fe(r.$$.fragment),a(t,"class","svelte-1iken05"),a(e,"class","page svelte-1iken05")},m(u,f){S(u,e,f),o(e,t),o(e,n),c&&c.m(e,null),o(e,s),ae(r,e,null),i=!0},p(u,[f]){u[5]?c?c.p(u,f):(c=al(u),c.c(),c.m(e,s)):c&&(c.d(1),c=null);const p={};f&16415&&(p.$$scope={dirty:f,ctx:u}),r.$set(p)},i(u){i||(W(r.$$.fragment,u),i=!0)},o(u){B(r.$$.fragment,u),i=!1},d(u){u&&w(e),c&&c.d(),ce(r)}}}function ar(l,e,t){let n=0,s=0,r=0,i="",c=!1,u="",f="";Ge(()=>{p();const h=localStorage.getItem("calibrationOffset");h!==null&&t(2,r=parseInt(h))});async function p(){try{const h=await Ot();t(1,s=h.threshold||0),t(0,n=h.falseAlarmOffset||0),h.calibrationOffset!==void 0&&(t(2,r=h.calibrationOffset),localStorage.setItem("calibrationOffset",r.toString())),h.overrideThreshold!==void 0&&h.overrideThreshold>0?t(3,i=h.overrideThreshold.toString()):t(3,i="")}catch(h){console.warn("Failed to load status:",h)}}async function m(){t(4,c=!0),t(5,u="");try{await ln(r),localStorage.setItem("calibrationOffset",r.toString()),i&&parseInt(i)>0?(await sn(parseInt(i)),t(5,u="Calibration offset and override threshold saved")):t(5,u="Calibration offset saved"),t(6,f="success"),setTimeout(()=>{t(5,u=""),p()},2e3)}catch(h){t(5,u=`Failed to save: ${h.message||h}`),t(6,f="error"),setTimeout(()=>{t(5,u="")},3e3)}finally{t(4,c=!1)}}async function _(){t(4,c=!0),t(5,u="");try{await nn(),t(3,i=""),t(5,u="Override cleared"),t(6,f="success"),setTimeout(()=>{t(5,u=""),p()},2e3)}catch(h){t(5,u=`Failed to clear override: ${h.message||h}`),t(6,f="error"),setTimeout(()=>{t(5,u="")},3e3)}finally{t(4,c=!1)}}async function b(){t(4,c=!0),t(5,u="");try{await rn(),t(5,u="Re-calibration started"),t(6,f="success"),setTimeout(()=>{t(5,u=""),p()},2e3)}catch(h){t(5,u=`Failed to recalibrate: ${h.message||h}`),t(6,f="error"),setTimeout(()=>{t(5,u="")},3e3)}finally{t(4,c=!1)}}function g(){r=Ve(this.value),t(2,r)}function k(){i=Ve(this.value),t(3,i)}return[n,s,r,i,c,u,f,m,_,b,g,k]}class cr extends qe{constructor(e){super(),Ae(this,e,ar,or,Te,{})}}function cl(l){let e,t;return{c(){e=d("div"),t=A(l[6]),a(e,"class","message svelte-1lrtwwl"),V(e,"success",l[7]==="success"),V(e,"error",l[7]==="error")},m(n,s){S(n,e,s),o(e,t)},p(n,s){s&64&&j(t,n[6]),s&128&&V(e,"success",n[7]==="success"),s&128&&V(e,"error",n[7]==="error")},d(n){n&&w(e)}}}function ur(l){let e,t,n,s,r,i,c,u,f,p,m,_,b,g,k,h,y,E,C,T,P,O,L,F,q,R,I,U,G,N,H,D,Q,K,Z=l[4]?"Saving...":"Save",ie,_e,x,X=l[5]?"Testing...":"Test Servo",ne,se,J,$;return{c(){e=d("div"),t=d("div"),n=d("label"),n.textContent="Start Position (Âµs):",s=v(),r=d("input"),i=v(),c=d("button"),u=A("Set"),f=v(),p=d("div"),m=d("label"),m.textContent="End Position (Âµs):",_=v(),b=d("input"),g=v(),k=d("button"),h=A("Set"),y=v(),E=d("div"),C=d("input"),T=v(),P=d("label"),P.textContent="Disable Servo",O=v(),L=d("div"),F=d("h3"),F.textContent="Live Control",q=v(),R=d("div"),I=d("input"),U=v(),G=d("div"),N=A(l[3]),H=A(" Âµs"),D=v(),Q=d("div"),K=d("button"),ie=A(Z),_e=v(),x=d("button"),ne=A(X),a(n,"for","start-pos"),a(n,"class","svelte-1lrtwwl"),a(r,"id","start-pos"),a(r,"type","number"),a(r,"min","500"),a(r,"max","2500"),a(r,"step","10"),a(r,"class","svelte-1lrtwwl"),a(c,"class","btn btn-set svelte-1lrtwwl"),c.disabled=l[2],a(t,"class","position-row svelte-1lrtwwl"),a(m,"for","end-pos"),a(m,"class","svelte-1lrtwwl"),a(b,"id","end-pos"),a(b,"type","number"),a(b,"min","500"),a(b,"max","2500"),a(b,"step","10"),a(b,"class","svelte-1lrtwwl"),a(k,"class","btn btn-set svelte-1lrtwwl"),k.disabled=l[2],a(p,"class","position-row svelte-1lrtwwl"),a(C,"id","disable-servo"),a(C,"type","checkbox"),a(C,"class","svelte-1lrtwwl"),a(P,"for","disable-servo"),a(P,"class","svelte-1lrtwwl"),a(E,"class","checkbox-row svelte-1lrtwwl"),a(F,"class","svelte-1lrtwwl"),a(I,"type","range"),a(I,"min","500"),a(I,"max","2500"),a(I,"step","10"),I.disabled=l[2],a(I,"class","position-slider svelte-1lrtwwl"),a(G,"class","slider-value svelte-1lrtwwl"),a(R,"class","slider-container svelte-1lrtwwl"),a(L,"class","live-control svelte-1lrtwwl"),a(K,"class","btn btn-save svelte-1lrtwwl"),K.disabled=l[4],a(x,"class","btn btn-test svelte-1lrtwwl"),x.disabled=se=l[5]||l[2],a(Q,"class","button-group svelte-1lrtwwl"),a(e,"class","settings-content svelte-1lrtwwl")},m(le,me){S(le,e,me),o(e,t),o(t,n),o(t,s),o(t,r),ee(r,l[0]),o(t,i),o(t,c),o(c,u),o(e,f),o(e,p),o(p,m),o(p,_),o(p,b),ee(b,l[1]),o(p,g),o(p,k),o(k,h),o(e,y),o(e,E),o(E,C),C.checked=l[2],o(E,T),o(E,P),o(e,O),o(e,L),o(L,F),o(L,q),o(L,R),o(R,I),ee(I,l[3]),o(R,U),o(R,G),o(G,N),o(G,H),o(e,D),o(e,Q),o(Q,K),o(K,ie),o(Q,_e),o(Q,x),o(x,ne),J||($=[M(r,"input",l[12]),M(c,"click",l[13]),M(b,"input",l[14]),M(k,"click",l[15]),M(C,"change",l[16]),M(I,"change",l[17]),M(I,"input",l[17]),M(I,"input",l[11]),M(K,"click",l[9]),M(x,"click",l[10])],J=!0)},p(le,me){me&1&&Ve(r.value)!==le[0]&&ee(r,le[0]),me&4&&(c.disabled=le[2]),me&2&&Ve(b.value)!==le[1]&&ee(b,le[1]),me&4&&(k.disabled=le[2]),me&4&&(C.checked=le[2]),me&4&&(I.disabled=le[2]),me&8&&ee(I,le[3]),me&8&&j(N,le[3]),me&16&&Z!==(Z=le[4]?"Saving...":"Save")&&j(ie,Z),me&16&&(K.disabled=le[4]),me&32&&X!==(X=le[5]?"Testing...":"Test Servo")&&j(ne,X),me&36&&se!==(se=le[5]||le[2])&&(x.disabled=se)},d(le){le&&w(e),J=!1,be($)}}}function fr(l){let e,t,n,s,r,i,c=l[6]&&cl(l);return r=new Ce({props:{title:"",$$slots:{default:[ur]},$$scope:{ctx:l}}}),{c(){e=d("div"),t=d("h1"),t.textContent="Servo Settings",n=v(),c&&c.c(),s=v(),fe(r.$$.fragment),a(t,"class","svelte-1lrtwwl"),a(e,"class","page svelte-1lrtwwl")},m(u,f){S(u,e,f),o(e,t),o(e,n),c&&c.m(e,null),o(e,s),ae(r,e,null),i=!0},p(u,[f]){u[6]?c?c.p(u,f):(c=cl(u),c.c(),c.m(e,s)):c&&(c.d(1),c=null);const p={};f&524351&&(p.$$scope={dirty:f,ctx:u}),r.$set(p)},i(u){i||(W(r.$$.fragment,u),i=!0)},o(u){B(r.$$.fragment,u),i=!1},d(u){u&&w(e),c&&c.d(),ce(r)}}}function dr(l,e,t){let n=1500,s=1100,r=!1,i=1500,c=!1,u=!1,f="",p="";async function m(){try{const O=await an();O.startUS!==void 0&&t(0,n=O.startUS),O.endUS!==void 0&&t(1,s=O.endUS);const L=localStorage.getItem("disableServo");L!==null?t(2,r=L==="true"):O.disabled!==void 0&&t(2,r=O.disabled),t(3,i=n)}catch(O){console.warn("Failed to load servo settings:",O)}}async function _(O,L){if(r){t(6,f="Servo is disabled"),t(7,p="error"),setTimeout(()=>{t(6,f="")},2e3);return}try{await fetch(`/servoSet?val=${O}`),t(6,f=`${L} set to ${O}Âµs`),t(7,p="success"),setTimeout(()=>{t(6,f="")},2e3)}catch{t(6,f=`Failed to set ${L}`),t(7,p="error"),setTimeout(()=>{t(6,f="")},3e3)}}async function b(){t(4,c=!0),t(6,f="");try{await cn({startUS:n,endUS:s,disabled:r}),localStorage.setItem("disableServo",r.toString()),t(6,f="Settings saved successfully"),t(7,p="success"),setTimeout(()=>{t(6,f="")},3e3)}catch(O){t(6,f=`Failed to save: ${O.message}`),t(7,p="error"),setTimeout(()=>{t(6,f="")},3e3)}finally{t(4,c=!1)}}async function g(){if(r){t(6,f="Servo is disabled"),t(7,p="error"),setTimeout(()=>{t(6,f="")},2e3);return}t(5,u=!0),t(6,f="");try{await ws(),t(6,f="Servo triggered"),t(7,p="success"),setTimeout(()=>{t(6,f="")},2e3)}catch(O){t(6,f=`Failed to trigger servo: ${O.message}`),t(7,p="error"),setTimeout(()=>{t(6,f="")},3e3)}finally{t(5,u=!1)}}function k(){if(r){t(6,f="Servo is disabled"),t(7,p="error"),setTimeout(()=>{t(6,f="")},2e3);return}try{fetch(`/servoSet?val=${i}`)}catch(O){console.error("Failed to update live position:",O)}}Ge(()=>{m()});function h(){n=Ve(this.value),t(0,n)}const y=()=>_(n,"Start position");function E(){s=Ve(this.value),t(1,s)}const C=()=>_(s,"End position");function T(){r=this.checked,t(2,r)}function P(){i=Ve(this.value),t(3,i)}return[n,s,r,i,c,u,f,p,_,b,g,k,h,y,E,C,T,P]}class pr extends qe{constructor(e){super(),Ae(this,e,dr,fr,Te,{})}}function mr(l){let e,t,n,s,r,i,c;return t=new Ce({props:{title:"IP Filtering",$$slots:{default:[vr]},$$scope:{ctx:l}}}),s=new Ce({props:{title:"MQTT Configuration",$$slots:{default:[gr]},$$scope:{ctx:l}}}),i=new Ce({props:{title:"Video Mode",$$slots:{default:[hr]},$$scope:{ctx:l}}}),{c(){e=d("div"),fe(t.$$.fragment),n=v(),fe(s.$$.fragment),r=v(),fe(i.$$.fragment),a(e,"class","settings-grid svelte-dlnskf")},m(u,f){S(u,e,f),ae(t,e,null),o(e,n),ae(s,e,null),o(e,r),ae(i,e,null),c=!0},p(u,f){const p={};f[0]&124|f[1]&128&&(p.$$scope={dirty:f,ctx:u}),t.$set(p);const m={};f[0]&130944|f[1]&128&&(m.$$scope={dirty:f,ctx:u}),s.$set(m);const _={};f[0]&917504|f[1]&128&&(_.$$scope={dirty:f,ctx:u}),i.$set(_)},i(u){c||(W(t.$$.fragment,u),W(s.$$.fragment,u),W(i.$$.fragment,u),c=!0)},o(u){B(t.$$.fragment,u),B(s.$$.fragment,u),B(i.$$.fragment,u),c=!1},d(u){u&&w(e),ce(t),ce(s),ce(i)}}}function _r(l){let e,t;return e=new Ts({props:{message:l[1],onRetry:l[20]}}),{c(){fe(e.$$.fragment)},m(n,s){ae(e,n,s),t=!0},p(n,s){const r={};s[0]&2&&(r.message=n[1]),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function br(l){let e,t,n;return t=new De({}),{c(){e=d("div"),fe(t.$$.fragment),a(e,"class","loading-container svelte-dlnskf")},m(s,r){S(s,e,r),ae(t,e,null),n=!0},p:z,i(s){n||(W(t.$$.fragment,s),n=!0)},o(s){B(t.$$.fragment,s),n=!1},d(s){s&&w(e),ce(t)}}}function ul(l){let e,t,n,s;return{c(){e=d("div"),t=A("Your IP: "),n=d("span"),s=A(l[4]),a(n,"class","client-ip svelte-dlnskf"),a(e,"class","info-text svelte-dlnskf")},m(r,i){S(r,e,i),o(e,t),o(e,n),o(n,s)},p(r,i){i[0]&16&&j(s,r[4])},d(r){r&&w(e)}}}function fl(l){let e,t;return{c(){e=d("div"),t=A(l[5]),a(e,"class","error-text svelte-dlnskf")},m(n,s){S(n,e,s),o(e,t)},p(n,s){s[0]&32&&j(t,n[5])},d(n){n&&w(e)}}}function vr(l){let e,t,n,s,r,i,c,u,f,p,m,_,b,g,k,h,y,E,C=l[6]?"Saving...":"Save IP Filters",T,P,O,L=l[4]&&ul(l),F=l[5]&&fl(l);return{c(){e=d("div"),L&&L.c(),t=v(),n=d("div"),s=d("label"),s.textContent="Whitelist (comma-separated CIDRs)",r=v(),i=d("input"),c=v(),u=d("div"),u.textContent="Leave empty to allow all IPs",f=v(),p=d("div"),m=d("label"),m.textContent="Blacklist (comma-separated CIDRs)",_=v(),b=d("input"),g=v(),k=d("div"),k.textContent="Blocked IPs take precedence over whitelist",h=v(),F&&F.c(),y=v(),E=d("button"),T=A(C),a(s,"for","whitelist"),a(s,"class","svelte-dlnskf"),a(i,"id","whitelist"),a(i,"type","text"),a(i,"placeholder","192.168.1.0/24, 10.0.0.1"),i.disabled=l[6],a(i,"class","svelte-dlnskf"),a(u,"class","help-text svelte-dlnskf"),a(n,"class","form-group svelte-dlnskf"),a(m,"for","blacklist"),a(m,"class","svelte-dlnskf"),a(b,"id","blacklist"),a(b,"type","text"),a(b,"placeholder","192.168.99.0/24, 172.16.0.1"),b.disabled=l[6],a(b,"class","svelte-dlnskf"),a(k,"class","help-text svelte-dlnskf"),a(p,"class","form-group svelte-dlnskf"),a(E,"class","btn-primary svelte-dlnskf"),E.disabled=l[6],a(e,"class","form-section svelte-dlnskf")},m(q,R){S(q,e,R),L&&L.m(e,null),o(e,t),o(e,n),o(n,s),o(n,r),o(n,i),ee(i,l[2]),o(n,c),o(n,u),o(e,f),o(e,p),o(p,m),o(p,_),o(p,b),ee(b,l[3]),o(p,g),o(p,k),o(e,h),F&&F.m(e,null),o(e,y),o(e,E),o(E,T),P||(O=[M(i,"input",l[25]),M(b,"input",l[26]),M(E,"click",l[21])],P=!0)},p(q,R){q[4]?L?L.p(q,R):(L=ul(q),L.c(),L.m(e,t)):L&&(L.d(1),L=null),R[0]&64&&(i.disabled=q[6]),R[0]&4&&i.value!==q[2]&&ee(i,q[2]),R[0]&64&&(b.disabled=q[6]),R[0]&8&&b.value!==q[3]&&ee(b,q[3]),q[5]?F?F.p(q,R):(F=fl(q),F.c(),F.m(e,y)):F&&(F.d(1),F=null),R[0]&64&&C!==(C=q[6]?"Saving...":"Save IP Filters")&&j(T,C),R[0]&64&&(E.disabled=q[6])},d(q){q&&w(e),L&&L.d(),F&&F.d(),P=!1,be(O)}}}function dl(l){let e,t;return{c(){e=d("div"),t=A(l[14]),a(e,"class","error-text svelte-dlnskf")},m(n,s){S(n,e,s),o(e,t)},p(n,s){s[0]&16384&&j(t,n[14])},d(n){n&&w(e)}}}function gr(l){let e,t,n,s,r,i,c,u,f,p,m,_,b,g,k,h,y,E,C,T,P,O,L,F,q,R,I,U,G,N,H,D,Q,K,Z=l[13]?"Hide":"Show",ie,_e,x,X,ne,se,J,$,le,me,Fe,he,re=l[15]?"Saving...":"Save MQTT Config",oe,de,Se,Ue=l[16]?"Testing...":"Test Connection",ze,Be,Ke,Je,we=l[14]&&dl(l);return{c(){e=d("div"),t=d("div"),n=d("label"),s=d("input"),r=v(),i=d("span"),i.textContent="Enable MQTT",c=v(),u=d("div"),f=d("label"),f.textContent="Broker Address",p=v(),m=d("input"),b=v(),g=d("div"),k=d("label"),k.textContent="Port",h=v(),y=d("input"),C=v(),T=d("div"),P=d("label"),P.textContent="Username",O=v(),L=d("input"),q=v(),R=d("div"),I=d("label"),I.textContent="Password",U=v(),G=d("div"),N=d("input"),Q=v(),K=d("button"),ie=A(Z),x=v(),X=d("div"),ne=d("label"),ne.textContent="Topic Prefix",se=v(),J=d("input"),le=v(),we&&we.c(),me=v(),Fe=d("div"),he=d("button"),oe=A(re),de=v(),Se=d("button"),ze=A(Ue),a(s,"type","checkbox"),s.disabled=l[15],a(s,"class","svelte-dlnskf"),a(i,"class","svelte-dlnskf"),a(n,"class","svelte-dlnskf"),a(t,"class","form-group checkbox-group svelte-dlnskf"),a(f,"for","mqtt-broker"),a(f,"class","svelte-dlnskf"),a(m,"id","mqtt-broker"),a(m,"type","text"),a(m,"placeholder","mqtt.example.com"),m.disabled=_=l[15]||!l[12],a(m,"class","svelte-dlnskf"),a(u,"class","form-group svelte-dlnskf"),a(k,"for","mqtt-port"),a(k,"class","svelte-dlnskf"),a(y,"id","mqtt-port"),a(y,"type","number"),a(y,"placeholder","1883"),a(y,"min","1"),a(y,"max","65535"),y.disabled=E=l[15]||!l[12],a(y,"class","svelte-dlnskf"),a(g,"class","form-group svelte-dlnskf"),a(P,"for","mqtt-user"),a(P,"class","svelte-dlnskf"),a(L,"id","mqtt-user"),a(L,"type","text"),a(L,"placeholder","Optional"),L.disabled=F=l[15]||!l[12],a(L,"class","svelte-dlnskf"),a(T,"class","form-group svelte-dlnskf"),a(I,"for","mqtt-password"),a(I,"class","svelte-dlnskf"),a(N,"id","mqtt-password"),a(N,"type",H=l[13]?"text":"password"),N.value=l[10],a(N,"placeholder","Optional"),N.disabled=D=l[15]||!l[12],a(N,"class","svelte-dlnskf"),a(K,"type","button"),a(K,"class","toggle-password svelte-dlnskf"),K.disabled=_e=!l[12],a(G,"class","password-input-group svelte-dlnskf"),a(R,"class","form-group svelte-dlnskf"),a(ne,"for","mqtt-topic"),a(ne,"class","svelte-dlnskf"),a(J,"id","mqtt-topic"),a(J,"type","text"),a(J,"placeholder","mousetrap"),J.disabled=$=l[15]||!l[12],a(J,"class","svelte-dlnskf"),a(X,"class","form-group svelte-dlnskf"),a(he,"class","btn-primary svelte-dlnskf"),he.disabled=l[15],a(Se,"class","btn-secondary svelte-dlnskf"),Se.disabled=Be=l[16]||!l[12]||!l[7],a(Fe,"class","button-group svelte-dlnskf"),a(e,"class","form-section svelte-dlnskf")},m(te,Y){S(te,e,Y),o(e,t),o(t,n),o(n,s),s.checked=l[12],o(n,r),o(n,i),o(e,c),o(e,u),o(u,f),o(u,p),o(u,m),ee(m,l[7]),o(e,b),o(e,g),o(g,k),o(g,h),o(g,y),ee(y,l[8]),o(e,C),o(e,T),o(T,P),o(T,O),o(T,L),ee(L,l[9]),o(e,q),o(e,R),o(R,I),o(R,U),o(R,G),o(G,N),o(G,Q),o(G,K),o(K,ie),o(e,x),o(e,X),o(X,ne),o(X,se),o(X,J),ee(J,l[11]),o(e,le),we&&we.m(e,null),o(e,me),o(e,Fe),o(Fe,he),o(he,oe),o(Fe,de),o(Fe,Se),o(Se,ze),Ke||(Je=[M(s,"change",l[27]),M(m,"input",l[28]),M(y,"input",l[29]),M(L,"input",l[30]),M(N,"input",l[31]),M(K,"click",l[32]),M(J,"input",l[33]),M(he,"click",l[22]),M(Se,"click",l[23])],Ke=!0)},p(te,Y){Y[0]&32768&&(s.disabled=te[15]),Y[0]&4096&&(s.checked=te[12]),Y[0]&36864&&_!==(_=te[15]||!te[12])&&(m.disabled=_),Y[0]&128&&m.value!==te[7]&&ee(m,te[7]),Y[0]&36864&&E!==(E=te[15]||!te[12])&&(y.disabled=E),Y[0]&256&&Ve(y.value)!==te[8]&&ee(y,te[8]),Y[0]&36864&&F!==(F=te[15]||!te[12])&&(L.disabled=F),Y[0]&512&&L.value!==te[9]&&ee(L,te[9]),Y[0]&8192&&H!==(H=te[13]?"text":"password")&&a(N,"type",H),Y[0]&1024&&N.value!==te[10]&&(N.value=te[10]),Y[0]&36864&&D!==(D=te[15]||!te[12])&&(N.disabled=D),Y[0]&8192&&Z!==(Z=te[13]?"Hide":"Show")&&j(ie,Z),Y[0]&4096&&_e!==(_e=!te[12])&&(K.disabled=_e),Y[0]&36864&&$!==($=te[15]||!te[12])&&(J.disabled=$),Y[0]&2048&&J.value!==te[11]&&ee(J,te[11]),te[14]?we?we.p(te,Y):(we=dl(te),we.c(),we.m(e,me)):we&&(we.d(1),we=null),Y[0]&32768&&re!==(re=te[15]?"Saving...":"Save MQTT Config")&&j(oe,re),Y[0]&32768&&(he.disabled=te[15]),Y[0]&65536&&Ue!==(Ue=te[16]?"Testing...":"Test Connection")&&j(ze,Ue),Y[0]&69760&&Be!==(Be=te[16]||!te[12]||!te[7])&&(Se.disabled=Be)},d(te){te&&w(e),we&&we.d(),Ke=!1,be(Je)}}}function pl(l){let e,t;return{c(){e=d("div"),t=A(l[19]),a(e,"class","error-text svelte-dlnskf")},m(n,s){S(n,e,s),o(e,t)},p(n,s){s[0]&524288&&j(t,n[19])},d(n){n&&w(e)}}}function hr(l){let e,t,n,s,r,i,c,u,f,p,m,_,b,g,k,h,y,E,C,T,P,O,L,F,q=l[18]?"Applying...":"Apply Video Mode",R,I,U,G,N=l[19]&&pl(l);return I=Is(l[35][0]),{c(){e=d("div"),t=d("div"),t.textContent="Changing video mode will restart the camera",n=v(),s=d("div"),r=d("label"),r.textContent="Resolution",i=v(),c=d("div"),u=d("label"),f=d("input"),p=v(),m=d("span"),m.textContent="SVGA (800x600)",_=v(),b=d("label"),g=d("input"),k=v(),h=d("span"),h.textContent="VGA (640x480)",y=v(),E=d("label"),C=d("input"),T=v(),P=d("span"),P.textContent="CIF (352x288)",O=v(),N&&N.c(),L=v(),F=d("button"),R=A(q),a(t,"class","warning-text svelte-dlnskf"),a(r,"class","svelte-dlnskf"),a(f,"type","radio"),f.__value="SVGA",ee(f,f.__value),f.disabled=l[18],a(f,"class","svelte-dlnskf"),a(m,"class","svelte-dlnskf"),a(u,"class","radio-label svelte-dlnskf"),a(g,"type","radio"),g.__value="VGA",ee(g,g.__value),g.disabled=l[18],a(g,"class","svelte-dlnskf"),a(h,"class","svelte-dlnskf"),a(b,"class","radio-label svelte-dlnskf"),a(C,"type","radio"),C.__value="CIF",ee(C,C.__value),C.disabled=l[18],a(C,"class","svelte-dlnskf"),a(P,"class","svelte-dlnskf"),a(E,"class","radio-label svelte-dlnskf"),a(c,"class","radio-group svelte-dlnskf"),a(s,"class","form-group svelte-dlnskf"),a(F,"class","btn-primary svelte-dlnskf"),F.disabled=l[18],a(e,"class","form-section svelte-dlnskf"),I.p(f,g,C)},m(H,D){S(H,e,D),o(e,t),o(e,n),o(e,s),o(s,r),o(s,i),o(s,c),o(c,u),o(u,f),f.checked=f.__value===l[17],o(u,p),o(u,m),o(c,_),o(c,b),o(b,g),g.checked=g.__value===l[17],o(b,k),o(b,h),o(c,y),o(c,E),o(E,C),C.checked=C.__value===l[17],o(E,T),o(E,P),o(e,O),N&&N.m(e,null),o(e,L),o(e,F),o(F,R),U||(G=[M(f,"change",l[34]),M(g,"change",l[36]),M(C,"change",l[37]),M(F,"click",l[24])],U=!0)},p(H,D){D[0]&262144&&(f.disabled=H[18]),D[0]&131072&&(f.checked=f.__value===H[17]),D[0]&262144&&(g.disabled=H[18]),D[0]&131072&&(g.checked=g.__value===H[17]),D[0]&262144&&(C.disabled=H[18]),D[0]&131072&&(C.checked=C.__value===H[17]),H[19]?N?N.p(H,D):(N=pl(H),N.c(),N.m(e,L)):N&&(N.d(1),N=null),D[0]&262144&&q!==(q=H[18]?"Applying...":"Apply Video Mode")&&j(R,q),D[0]&262144&&(F.disabled=H[18])},d(H){H&&w(e),N&&N.d(),I.r(),U=!1,be(G)}}}function kr(l){let e,t,n,s,r,i;const c=[br,_r,mr],u=[];function f(p,m){return p[0]?0:p[1]?1:2}return s=f(l),r=u[s]=c[s](l),{c(){e=d("div"),t=d("div"),t.innerHTML='<h1 class="svelte-dlnskf">Settings</h1>',n=v(),r.c(),a(t,"class","header svelte-dlnskf"),a(e,"class","settings-container svelte-dlnskf")},m(p,m){S(p,e,m),o(e,t),o(e,n),u[s].m(e,null),i=!0},p(p,m){let _=s;s=f(p),s===_?u[s].p(p,m):(ve(),B(u[_],1,1,()=>{u[_]=null}),ge(),r=u[s],r?r.p(p,m):(r=u[s]=c[s](p),r.c()),W(r,1),r.m(e,null))},i(p){i||(W(r),i=!0)},o(p){B(r),i=!1},d(p){p&&w(e),u[s].d()}}}function ml(l){if(l=l.trim(),!l)return!0;if(!/^(\d{1,3}\.){3}\d{1,3}(\/\d{1,2})?$/.test(l))return!1;const t=l.split("/"),n=t[0].split(".");for(let s of n){const r=parseInt(s);if(r<0||r>255)return!1}if(t[1]){const s=parseInt(t[1]);if(s<0||s>32)return!1}return!0}function wr(l,e,t){let n=!0,s=null,r="",i="",c="",u="",f=!1,p="",m=1883,_="",b="",g="",k=!1,h=!1,y="",E=!1,C=!1,T="SVGA",P=!1,O="";Ge(async()=>{await L()});async function L(){t(0,n=!0),t(1,s=null);try{const[se,J,$]=await Promise.all([un(),dn(),mn()]);t(2,r=se.whitelist.join(", ")),t(3,i=se.blacklist.join(", ")),t(4,c=se.clientIP||""),t(7,p=J.broker||""),t(8,m=J.port||1883),t(9,_=J.user||""),t(10,b=J.password||""),t(11,g=J.topic||""),t(12,k=J.enabled||!1),t(17,T=$.mode||"SVGA"),t(0,n=!1)}catch(se){t(1,s=se.message||"Failed to load settings"),t(0,n=!1)}}async function F(){t(5,u="");const se=r.split(",").map($=>$.trim()).filter($=>$),J=i.split(",").map($=>$.trim()).filter($=>$);for(let $ of se)if(!ml($)){t(5,u=`Invalid CIDR format in whitelist: ${$}`);return}for(let $ of J)if(!ml($)){t(5,u=`Invalid CIDR format in blacklist: ${$}`);return}t(6,f=!0);try{await fn({whitelist:se,blacklist:J}),t(6,f=!1)}catch($){t(5,u=$.message||"Failed to save IP filters"),t(6,f=!1)}}async function q(){if(t(14,y=""),k&&!p){t(14,y="Broker address is required when MQTT is enabled");return}if(m<1||m>65535){t(14,y="Port must be between 1 and 65535");return}t(15,E=!0);try{await pn({broker:p,port:m,user:_,password:b,topic:g,enabled:k}),t(15,E=!1)}catch(se){t(14,y=se.message||"Failed to save MQTT configuration"),t(15,E=!1)}}async function R(){if(t(14,y=""),!p){t(14,y="Broker address is required");return}t(16,C=!0);try{await new Promise(se=>setTimeout(se,1e3)),t(16,C=!1),alert("MQTT connection test successful")}catch(se){t(14,y=se.message||"Connection test failed"),t(16,C=!1)}}async function I(){if(t(19,O=""),!!confirm("Changing video mode will restart the camera. Continue?")){t(18,P=!0);try{await _n({mode:T}),t(18,P=!1)}catch(J){t(19,O=J.message||"Failed to apply video mode"),t(18,P=!1)}}}const U=[[]];function G(){r=this.value,t(2,r)}function N(){i=this.value,t(3,i)}function H(){k=this.checked,t(12,k)}function D(){p=this.value,t(7,p)}function Q(){m=Ve(this.value),t(8,m)}function K(){_=this.value,t(9,_)}const Z=se=>t(10,b=se.target.value),ie=()=>t(13,h=!h);function _e(){g=this.value,t(11,g)}function x(){T=this.__value,t(17,T)}function X(){T=this.__value,t(17,T)}function ne(){T=this.__value,t(17,T)}return[n,s,r,i,c,u,f,p,m,_,b,g,k,h,y,E,C,T,P,O,L,F,q,R,I,G,N,H,D,Q,K,Z,ie,_e,x,U,X,ne]}class Sr extends qe{constructor(e){super(),Ae(this,e,wr,kr,Te,{},null,[-1,-1])}}const{document:yr}=_s;function _l(l,e,t){const n=l.slice();return n[45]=e[t],n}function bl(l,e,t){const n=l.slice();return n[45]=e[t],n}function vl(l,e,t){const n=l.slice();return n[45]=e[t],n}function gl(l){let e,t,n;return{c(){e=d("button"),e.textContent="Clear",a(e,"class","btn-small svelte-16e85dp")},m(s,r){S(s,e,r),t||(n=M(e,"click",l[26]),t=!0)},p:z,d(s){s&&w(e),t=!1,n()}}}function hl(l){let e;function t(r,i){return r[6]?Lr:r[9]?Er:r[21].length===0&&r[3]?Fr:r[0].length===0?Tr:Cr}let n=t(l),s=n(l);return{c(){e=d("div"),s.c(),a(e,"class","log-content svelte-16e85dp"),V(e,"expanded",l[13])},m(r,i){S(r,e,i),s.m(e,null),l[35](e)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e,null))),i[0]&8192&&V(e,"expanded",r[13])},d(r){r&&w(e),s.d(),l[35](null)}}}function Cr(l){let e,t,n,s=Ee(l[21]),r=[];for(let c=0;c<s.length;c+=1)r[c]=kl(vl(l,s,c));let i=l[3]&&l[21].length>0&&wl(l);return{c(){e=d("div");for(let c=0;c<r.length;c+=1)r[c].c();t=v(),i&&i.c(),n=Le(),a(e,"class","log-list svelte-16e85dp")},m(c,u){S(c,e,u);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(e,null);S(c,t,u),i&&i.m(c,u),S(c,n,u)},p(c,u){if(u[0]&2097152){s=Ee(c[21]);let f;for(f=0;f<s.length;f+=1){const p=vl(c,s,f);r[f]?r[f].p(p,u):(r[f]=kl(p),r[f].c(),r[f].m(e,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}c[3]&&c[21].length>0?i?i.p(c,u):(i=wl(c),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(c){c&&(w(e),w(t),w(n)),Ze(r,c),i&&i.d(c)}}}function Tr(l){let e;return{c(){e=d("div"),e.textContent="No system logs available",a(e,"class","no-data svelte-16e85dp")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function Fr(l){let e,t,n,s;return{c(){e=d("div"),t=A('No logs match filter "'),n=A(l[3]),s=A('"'),a(e,"class","no-results svelte-16e85dp")},m(r,i){S(r,e,i),o(e,t),o(e,n),o(e,s)},p(r,i){i[0]&8&&j(n,r[3])},d(r){r&&w(e)}}}function Er(l){let e,t,n;return{c(){e=d("div"),t=A("Error: "),n=A(l[9]),a(e,"class","error svelte-16e85dp")},m(s,r){S(s,e,r),o(e,t),o(e,n)},p(s,r){r[0]&512&&j(n,s[9])},d(s){s&&w(e)}}}function Lr(l){let e;return{c(){e=d("div"),e.textContent="Loading system logs...",a(e,"class","loading svelte-16e85dp")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function kl(l){let e,t=l[45]+"",n;return{c(){e=d("div"),n=A(t),a(e,"class","log-line svelte-16e85dp")},m(s,r){S(s,e,r),o(e,n)},p(s,r){r[0]&2097152&&t!==(t=s[45]+"")&&j(n,t)},d(s){s&&w(e)}}}function wl(l){let e,t,n=l[21].length+"",s,r,i=l[0].length+"",c,u;return{c(){e=d("div"),t=A("Showing "),s=A(n),r=A(" of "),c=A(i),u=A(" logs"),a(e,"class","filter-info svelte-16e85dp")},m(f,p){S(f,e,p),o(e,t),o(e,s),o(e,r),o(e,c),o(e,u)},p(f,p){p[0]&2097152&&n!==(n=f[21].length+"")&&j(s,n),p[0]&1&&i!==(i=f[0].length+"")&&j(c,i)},d(f){f&&w(e)}}}function Sl(l){let e,t,n;return{c(){e=d("button"),e.textContent="Clear",a(e,"class","btn-small svelte-16e85dp")},m(s,r){S(s,e,r),t||(n=M(e,"click",l[27]),t=!0)},p:z,d(s){s&&w(e),t=!1,n()}}}function yl(l){let e;function t(r,i){return r[7]?Or:r[10]?Ir:r[20].length===0&&r[4]?Pr:r[1].length===0?qr:Ar}let n=t(l),s=n(l);return{c(){e=d("div"),s.c(),a(e,"class","log-content svelte-16e85dp"),V(e,"expanded",l[14])},m(r,i){S(r,e,i),s.m(e,null),l[38](e)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e,null))),i[0]&16384&&V(e,"expanded",r[14])},d(r){r&&w(e),s.d(),l[38](null)}}}function Ar(l){let e,t,n,s=Ee(l[20]),r=[];for(let c=0;c<s.length;c+=1)r[c]=Cl(bl(l,s,c));let i=l[4]&&l[20].length>0&&Tl(l);return{c(){e=d("div");for(let c=0;c<r.length;c+=1)r[c].c();t=v(),i&&i.c(),n=Le(),a(e,"class","log-list svelte-16e85dp")},m(c,u){S(c,e,u);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(e,null);S(c,t,u),i&&i.m(c,u),S(c,n,u)},p(c,u){if(u[0]&1048576){s=Ee(c[20]);let f;for(f=0;f<s.length;f+=1){const p=bl(c,s,f);r[f]?r[f].p(p,u):(r[f]=Cl(p),r[f].c(),r[f].m(e,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}c[4]&&c[20].length>0?i?i.p(c,u):(i=Tl(c),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(c){c&&(w(e),w(t),w(n)),Ze(r,c),i&&i.d(c)}}}function qr(l){let e;return{c(){e=d("div"),e.textContent="No previous logs available",a(e,"class","no-data svelte-16e85dp")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function Pr(l){let e,t,n,s;return{c(){e=d("div"),t=A('No logs match filter "'),n=A(l[4]),s=A('"'),a(e,"class","no-results svelte-16e85dp")},m(r,i){S(r,e,i),o(e,t),o(e,n),o(e,s)},p(r,i){i[0]&16&&j(n,r[4])},d(r){r&&w(e)}}}function Ir(l){let e,t,n;return{c(){e=d("div"),t=A("Error: "),n=A(l[10]),a(e,"class","error svelte-16e85dp")},m(s,r){S(s,e,r),o(e,t),o(e,n)},p(s,r){r[0]&1024&&j(n,s[10])},d(s){s&&w(e)}}}function Or(l){let e;return{c(){e=d("div"),e.textContent="Loading previous logs...",a(e,"class","loading svelte-16e85dp")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function Cl(l){let e,t=l[45]+"",n;return{c(){e=d("div"),n=A(t),a(e,"class","log-line svelte-16e85dp")},m(s,r){S(s,e,r),o(e,n)},p(s,r){r[0]&1048576&&t!==(t=s[45]+"")&&j(n,t)},d(s){s&&w(e)}}}function Tl(l){let e,t,n=l[20].length+"",s,r,i=l[1].length+"",c,u;return{c(){e=d("div"),t=A("Showing "),s=A(n),r=A(" of "),c=A(i),u=A(" logs"),a(e,"class","filter-info svelte-16e85dp")},m(f,p){S(f,e,p),o(e,t),o(e,s),o(e,r),o(e,c),o(e,u)},p(f,p){p[0]&1048576&&n!==(n=f[20].length+"")&&j(s,n),p[0]&2&&i!==(i=f[1].length+"")&&j(c,i)},d(f){f&&w(e)}}}function Fl(l){let e,t,n;return{c(){e=d("button"),e.textContent="Clear",a(e,"class","btn-small svelte-16e85dp")},m(s,r){S(s,e,r),t||(n=M(e,"click",l[28]),t=!0)},p:z,d(s){s&&w(e),t=!1,n()}}}function El(l){let e;function t(r,i){return r[8]?Dr:r[11]?Ur:r[19].length===0&&r[5]?Mr:r[2].length===0?Rr:Nr}let n=t(l),s=n(l);return{c(){e=d("div"),s.c(),a(e,"class","log-content svelte-16e85dp"),V(e,"expanded",l[15])},m(r,i){S(r,e,i),s.m(e,null),l[41](e)},p(r,i){n===(n=t(r))&&s?s.p(r,i):(s.d(1),s=n(r),s&&(s.c(),s.m(e,null))),i[0]&32768&&V(e,"expanded",r[15])},d(r){r&&w(e),s.d(),l[41](null)}}}function Nr(l){let e,t,n,s=Ee(l[19]),r=[];for(let c=0;c<s.length;c+=1)r[c]=Ll(_l(l,s,c));let i=l[5]&&l[19].length>0&&Al(l);return{c(){e=d("div");for(let c=0;c<r.length;c+=1)r[c].c();t=v(),i&&i.c(),n=Le(),a(e,"class","log-list svelte-16e85dp")},m(c,u){S(c,e,u);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(e,null);S(c,t,u),i&&i.m(c,u),S(c,n,u)},p(c,u){if(u[0]&524288){s=Ee(c[19]);let f;for(f=0;f<s.length;f+=1){const p=_l(c,s,f);r[f]?r[f].p(p,u):(r[f]=Ll(p),r[f].c(),r[f].m(e,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}c[5]&&c[19].length>0?i?i.p(c,u):(i=Al(c),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(c){c&&(w(e),w(t),w(n)),Ze(r,c),i&&i.d(c)}}}function Rr(l){let e;return{c(){e=d("div"),e.textContent="No older logs available (logs from 2 boots ago)",a(e,"class","no-data svelte-16e85dp")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function Mr(l){let e,t,n,s;return{c(){e=d("div"),t=A('No logs match filter "'),n=A(l[5]),s=A('"'),a(e,"class","no-results svelte-16e85dp")},m(r,i){S(r,e,i),o(e,t),o(e,n),o(e,s)},p(r,i){i[0]&32&&j(n,r[5])},d(r){r&&w(e)}}}function Ur(l){let e,t,n;return{c(){e=d("div"),t=A("Error: "),n=A(l[11]),a(e,"class","error svelte-16e85dp")},m(s,r){S(s,e,r),o(e,t),o(e,n)},p(s,r){r[0]&2048&&j(n,s[11])},d(s){s&&w(e)}}}function Dr(l){let e;return{c(){e=d("div"),e.textContent="Loading older logs...",a(e,"class","loading svelte-16e85dp")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function Ll(l){let e,t=l[45]+"",n;return{c(){e=d("div"),n=A(t),a(e,"class","log-line svelte-16e85dp")},m(s,r){S(s,e,r),o(e,n)},p(s,r){r[0]&524288&&t!==(t=s[45]+"")&&j(n,t)},d(s){s&&w(e)}}}function Al(l){let e,t,n=l[19].length+"",s,r,i=l[2].length+"",c,u;return{c(){e=d("div"),t=A("Showing "),s=A(n),r=A(" of "),c=A(i),u=A(" logs"),a(e,"class","filter-info svelte-16e85dp")},m(f,p){S(f,e,p),o(e,t),o(e,s),o(e,r),o(e,c),o(e,u)},p(f,p){p[0]&524288&&n!==(n=f[19].length+"")&&j(s,n),p[0]&4&&i!==(i=f[2].length+"")&&j(c,i)},d(f){f&&w(e)}}}function jr(l){let e,t,n,s,r,i,c,u=l[12]?"Auto-refresh On":"Auto-refresh Off",f,p,m,_,b,g,k,h,y,E,C=l[13]?"â–¼":"â–¶",T,P,O,L,F,q,R,I,U,G,N,H,D,Q,K,Z,ie=l[14]?"â–¼":"â–¶",_e,x,X,ne,se,J,$,le,me,Fe,he,re,oe,de,Se,Ue,ze=l[15]?"â–¼":"â–¶",Be,Ke,Je,we,te,Y,ye,je,Xe,Nt,ut,Rt,ht,Mt,Pe=l[3]&&gl(l),Ie=l[13]&&hl(l),Oe=l[4]&&Sl(l),Ne=l[14]&&yl(l),Re=l[5]&&Fl(l),Me=l[15]&&El(l);return{c(){e=v(),t=d("div"),n=d("div"),s=d("h1"),s.textContent="Logs & Diagnostics",r=v(),i=d("div"),c=d("button"),f=A(u),p=A(" ("),m=A(Fs),_=A("s)"),b=v(),g=d("button"),g.textContent="Refresh Now",k=v(),h=d("div"),y=d("div"),E=d("button"),T=A(C),P=v(),O=d("h2"),O.textContent="System Logs",L=v(),F=d("div"),q=d("input"),R=v(),Pe&&Pe.c(),I=v(),U=d("button"),G=A("Export"),H=v(),Ie&&Ie.c(),D=v(),Q=d("div"),K=d("div"),Z=d("button"),_e=A(ie),x=v(),X=d("h2"),X.textContent="Previous System Logs",ne=v(),se=d("div"),J=d("input"),$=v(),Oe&&Oe.c(),le=v(),me=d("button"),Fe=A("Export"),re=v(),Ne&&Ne.c(),oe=v(),de=d("div"),Se=d("div"),Ue=d("button"),Be=A(ze),Ke=v(),Je=d("h2"),Je.textContent="Older Logs (2 boots ago)",we=v(),te=d("div"),Y=d("input"),ye=v(),Re&&Re.c(),je=v(),Xe=d("button"),Nt=A("Export"),Rt=v(),Me&&Me.c(),yr.title="Logs & Diagnostics - MouseTrap",a(s,"class","svelte-16e85dp"),a(c,"class","btn svelte-16e85dp"),V(c,"active",l[12]),a(g,"class","btn svelte-16e85dp"),a(i,"class","header-controls svelte-16e85dp"),a(n,"class","header svelte-16e85dp"),a(E,"class","expand-btn svelte-16e85dp"),a(O,"class","svelte-16e85dp"),a(q,"type","text"),a(q,"class","filter-input svelte-16e85dp"),a(q,"placeholder","Filter logs..."),a(U,"class","btn-small svelte-16e85dp"),U.disabled=N=l[0].length===0,a(F,"class","log-controls svelte-16e85dp"),a(y,"class","log-header svelte-16e85dp"),a(h,"class","log-section svelte-16e85dp"),a(Z,"class","expand-btn svelte-16e85dp"),a(X,"class","svelte-16e85dp"),a(J,"type","text"),a(J,"class","filter-input svelte-16e85dp"),a(J,"placeholder","Filter logs..."),a(me,"class","btn-small svelte-16e85dp"),me.disabled=he=l[1].length===0,a(se,"class","log-controls svelte-16e85dp"),a(K,"class","log-header svelte-16e85dp"),a(Q,"class","log-section svelte-16e85dp"),a(Ue,"class","expand-btn svelte-16e85dp"),a(Je,"class","svelte-16e85dp"),a(Y,"type","text"),a(Y,"class","filter-input svelte-16e85dp"),a(Y,"placeholder","Filter logs..."),a(Xe,"class","btn-small svelte-16e85dp"),Xe.disabled=ut=l[2].length===0,a(te,"class","log-controls svelte-16e85dp"),a(Se,"class","log-header svelte-16e85dp"),a(de,"class","log-section svelte-16e85dp"),a(t,"class","logs-container svelte-16e85dp")},m(ue,ke){S(ue,e,ke),S(ue,t,ke),o(t,n),o(n,s),o(n,r),o(n,i),o(i,c),o(c,f),o(c,p),o(c,m),o(c,_),o(i,b),o(i,g),o(t,k),o(t,h),o(h,y),o(y,E),o(E,T),o(y,P),o(y,O),o(y,L),o(y,F),o(F,q),ee(q,l[3]),o(F,R),Pe&&Pe.m(F,null),o(F,I),o(F,U),o(U,G),o(h,H),Ie&&Ie.m(h,null),o(t,D),o(t,Q),o(Q,K),o(K,Z),o(Z,_e),o(K,x),o(K,X),o(K,ne),o(K,se),o(se,J),ee(J,l[4]),o(se,$),Oe&&Oe.m(se,null),o(se,le),o(se,me),o(me,Fe),o(Q,re),Ne&&Ne.m(Q,null),o(t,oe),o(t,de),o(de,Se),o(Se,Ue),o(Ue,Be),o(Se,Ke),o(Se,Je),o(Se,we),o(Se,te),o(te,Y),ee(Y,l[5]),o(te,ye),Re&&Re.m(te,null),o(te,je),o(te,Xe),o(Xe,Nt),o(de,Rt),Me&&Me.m(de,null),ht||(Mt=[M(c,"click",l[25]),M(g,"click",l[32]),M(E,"click",l[29]),M(q,"input",l[33]),M(U,"click",l[34]),M(Z,"click",l[30]),M(J,"input",l[36]),M(me,"click",l[37]),M(Ue,"click",l[31]),M(Y,"input",l[39]),M(Xe,"click",l[40])],ht=!0)},p(ue,ke){ke[0]&4096&&u!==(u=ue[12]?"Auto-refresh On":"Auto-refresh Off")&&j(f,u),ke[0]&4096&&V(c,"active",ue[12]),ke[0]&8192&&C!==(C=ue[13]?"â–¼":"â–¶")&&j(T,C),ke[0]&8&&q.value!==ue[3]&&ee(q,ue[3]),ue[3]?Pe?Pe.p(ue,ke):(Pe=gl(ue),Pe.c(),Pe.m(F,I)):Pe&&(Pe.d(1),Pe=null),ke[0]&1&&N!==(N=ue[0].length===0)&&(U.disabled=N),ue[13]?Ie?Ie.p(ue,ke):(Ie=hl(ue),Ie.c(),Ie.m(h,null)):Ie&&(Ie.d(1),Ie=null),ke[0]&16384&&ie!==(ie=ue[14]?"â–¼":"â–¶")&&j(_e,ie),ke[0]&16&&J.value!==ue[4]&&ee(J,ue[4]),ue[4]?Oe?Oe.p(ue,ke):(Oe=Sl(ue),Oe.c(),Oe.m(se,le)):Oe&&(Oe.d(1),Oe=null),ke[0]&2&&he!==(he=ue[1].length===0)&&(me.disabled=he),ue[14]?Ne?Ne.p(ue,ke):(Ne=yl(ue),Ne.c(),Ne.m(Q,null)):Ne&&(Ne.d(1),Ne=null),ke[0]&32768&&ze!==(ze=ue[15]?"â–¼":"â–¶")&&j(Be,ze),ke[0]&32&&Y.value!==ue[5]&&ee(Y,ue[5]),ue[5]?Re?Re.p(ue,ke):(Re=Fl(ue),Re.c(),Re.m(te,je)):Re&&(Re.d(1),Re=null),ke[0]&4&&ut!==(ut=ue[2].length===0)&&(Xe.disabled=ut),ue[15]?Me?Me.p(ue,ke):(Me=El(ue),Me.c(),Me.m(de,null)):Me&&(Me.d(1),Me=null)},i:z,o:z,d(ue){ue&&(w(e),w(t)),Pe&&Pe.d(),Ie&&Ie.d(),Oe&&Oe.d(),Ne&&Ne.d(),Re&&Re.d(),Me&&Me.d(),ht=!1,be(Mt)}}}let Fs=5;function yt(l,e){const t=l.join(`
`),n=new Blob([t],{type:"text/plain"}),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=e,r.click(),URL.revokeObjectURL(s)}function Wr(l,e,t){let n,s,r,i=[],c=[],u=[],f=!0,p=!0,m=!0,_=null,b=null,g=null,k=!1,h=null,y="",E="",C="",T=!0,P=!0,O=!1,L,F,q;async function R(re=!0){const oe=(L==null?void 0:L.scrollTop)||0;re&&t(6,f=!0),t(9,_=null);try{t(0,i=await bn())}catch(de){console.error("Failed to fetch system logs:",de),t(9,_=de.message),t(0,i=[])}finally{re&&t(6,f=!1),L&&oe>0&&requestAnimationFrame(()=>{t(16,L.scrollTop=oe,L)})}}async function I(re=!0){const oe=(F==null?void 0:F.scrollTop)||0;re&&t(7,p=!0),t(10,b=null);try{t(1,c=await vn())}catch(de){console.error("Failed to fetch previous logs:",de),t(10,b=de.message),t(1,c=[])}finally{re&&t(7,p=!1),F&&oe>0&&requestAnimationFrame(()=>{t(17,F.scrollTop=oe,F)})}}async function U(re=!0){const oe=(q==null?void 0:q.scrollTop)||0;re&&t(8,m=!0),t(11,g=null);try{t(2,u=await gn())}catch(de){console.error("Failed to fetch older logs:",de),t(11,g=de.message),t(2,u=[])}finally{re&&t(8,m=!1),q&&oe>0&&requestAnimationFrame(()=>{t(18,q.scrollTop=oe,q)})}}function G(){t(12,k=!k),k?N():H()}function N(){H(),h=setInterval(()=>{R(!1),I(!1),U(!1)},Fs*1e3)}function H(){h&&(clearInterval(h),h=null)}function D(){t(3,y="")}function Q(){t(4,E="")}function K(){t(5,C="")}function Z(){t(13,T=!T)}function ie(){t(14,P=!P)}function _e(){t(15,O=!O)}Ge(()=>{R(),I(),U()}),at(()=>{H()});const x=()=>{R(!0),I(!0),U(!0)};function X(){y=this.value,t(3,y)}const ne=()=>yt(i,"system-logs.txt");function se(re){lt[re?"unshift":"push"](()=>{L=re,t(16,L)})}function J(){E=this.value,t(4,E)}const $=()=>yt(c,"previous-logs.txt");function le(re){lt[re?"unshift":"push"](()=>{F=re,t(17,F)})}function me(){C=this.value,t(5,C)}const Fe=()=>yt(u,"older-logs.txt");function he(re){lt[re?"unshift":"push"](()=>{q=re,t(18,q)})}return l.$$.update=()=>{l.$$.dirty[0]&9&&t(21,n=i.filter(re=>re.toLowerCase().includes(y.toLowerCase()))),l.$$.dirty[0]&18&&t(20,s=c.filter(re=>re.toLowerCase().includes(E.toLowerCase()))),l.$$.dirty[0]&36&&t(19,r=u.filter(re=>re.toLowerCase().includes(C.toLowerCase())))},[i,c,u,y,E,C,f,p,m,_,b,g,k,T,P,O,L,F,q,r,s,n,R,I,U,G,D,Q,K,Z,ie,_e,x,X,ne,se,J,$,le,me,Fe,he]}class ql extends qe{constructor(e){super(),Ae(this,e,Wr,jr,Te,{},null,[-1,-1])}}function Hr(l){let e,t,n,s,r,i,c,u,f,p,m=l[6]&&Pl();return n=new Ce({props:{$$slots:{default:[Br]},$$scope:{ctx:l}}}),r=new Ce({props:{$$slots:{default:[Vr]},$$scope:{ctx:l}}}),c=new Ce({props:{$$slots:{default:[Zr]},$$scope:{ctx:l}}}),f=new Ce({props:{$$slots:{default:[xr]},$$scope:{ctx:l}}}),{c(){m&&m.c(),e=v(),t=d("div"),fe(n.$$.fragment),s=v(),fe(r.$$.fragment),i=v(),fe(c.$$.fragment),u=v(),fe(f.$$.fragment),a(t,"class","cards-grid svelte-qwtv9g")},m(_,b){m&&m.m(_,b),S(_,e,b),S(_,t,b),ae(n,t,null),o(t,s),ae(r,t,null),o(t,i),ae(c,t,null),o(t,u),ae(f,t,null),p=!0},p(_,b){_[6]?m||(m=Pl(),m.c(),m.m(e.parentNode,e)):m&&(m.d(1),m=null);const g={};b&65537&&(g.$$scope={dirty:b,ctx:_}),n.$set(g);const k={};b&65552&&(k.$$scope={dirty:b,ctx:_}),r.$set(k);const h={};b&65596&&(h.$$scope={dirty:b,ctx:_}),c.$set(h);const y={};b&65537&&(y.$$scope={dirty:b,ctx:_}),f.$set(y)},i(_){p||(W(n.$$.fragment,_),W(r.$$.fragment,_),W(c.$$.fragment,_),W(f.$$.fragment,_),p=!0)},o(_){B(n.$$.fragment,_),B(r.$$.fragment,_),B(c.$$.fragment,_),B(f.$$.fragment,_),p=!1},d(_){_&&(w(e),w(t)),m&&m.d(_),ce(n),ce(r),ce(c),ce(f)}}}function zr(l){let e,t,n;return t=new De({}),{c(){e=d("div"),fe(t.$$.fragment),a(e,"class","loading-container svelte-qwtv9g")},m(s,r){S(s,e,r),ae(t,e,null),n=!0},p:z,i(s){n||(W(t.$$.fragment,s),n=!0)},o(s){B(t.$$.fragment,s),n=!1},d(s){s&&w(e),ce(t)}}}function Pl(l){let e;return{c(){e=d("div"),e.textContent="Device is back online!",a(e,"class","online-banner svelte-qwtv9g")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function Il(l){let e,t,n=l[0].buildDate+"",s;return{c(){e=d("div"),t=A("Built: "),s=A(n),a(e,"class","build-date svelte-qwtv9g")},m(r,i){S(r,e,i),o(e,t),o(e,s)},p(r,i){i&1&&n!==(n=r[0].buildDate+"")&&j(s,n)},d(r){r&&w(e)}}}function Ol(l){let e,t,n,s,r=l[0].chipModel+"",i;return{c(){e=d("tr"),t=d("td"),t.textContent="Chip Model",n=v(),s=d("td"),i=A(r),a(t,"class","label svelte-qwtv9g"),a(s,"class","value svelte-qwtv9g"),a(e,"class","svelte-qwtv9g")},m(c,u){S(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=c[0].chipModel+"")&&j(i,r)},d(c){c&&w(e)}}}function Nl(l){let e,t,n,s,r=Wl(l[0].cpuFreq)+"",i;return{c(){e=d("tr"),t=d("td"),t.textContent="CPU Frequency",n=v(),s=d("td"),i=A(r),a(t,"class","label svelte-qwtv9g"),a(s,"class","value svelte-qwtv9g"),a(e,"class","svelte-qwtv9g")},m(c,u){S(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=Wl(c[0].cpuFreq)+"")&&j(i,r)},d(c){c&&w(e)}}}function Rl(l){let e,t,n,s,r=vt(l[0].flashSize)+"",i;return{c(){e=d("tr"),t=d("td"),t.textContent="Flash Size",n=v(),s=d("td"),i=A(r),a(t,"class","label svelte-qwtv9g"),a(s,"class","value svelte-qwtv9g"),a(e,"class","svelte-qwtv9g")},m(c,u){S(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=vt(c[0].flashSize)+"")&&j(i,r)},d(c){c&&w(e)}}}function Ml(l){let e,t,n,s,r=vt(l[0].psramSize)+"",i;return{c(){e=d("tr"),t=d("td"),t.textContent="PSRAM Size",n=v(),s=d("td"),i=A(r),a(t,"class","label svelte-qwtv9g"),a(s,"class","value svelte-qwtv9g"),a(e,"class","svelte-qwtv9g")},m(c,u){S(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=vt(c[0].psramSize)+"")&&j(i,r)},d(c){c&&w(e)}}}function Ul(l){let e,t,n,s,r=l[0].macAddress+"",i;return{c(){e=d("tr"),t=d("td"),t.textContent="MAC Address",n=v(),s=d("td"),i=A(r),a(t,"class","label svelte-qwtv9g"),a(s,"class","value svelte-qwtv9g"),a(e,"class","svelte-qwtv9g")},m(c,u){S(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=c[0].macAddress+"")&&j(i,r)},d(c){c&&w(e)}}}function Br(l){var P,O,L,F,q,R,I;let e,t,n,s=(((P=l[0])==null?void 0:P.firmwareVersion)||"Unknown")+"",r,i,c,u,f,p,m,_,b,g,k=((O=l[0])==null?void 0:O.buildDate)&&Il(l),h=((L=l[0])==null?void 0:L.chipModel)&&Ol(l),y=((F=l[0])==null?void 0:F.cpuFreq)&&Nl(l),E=((q=l[0])==null?void 0:q.flashSize)&&Rl(l),C=((R=l[0])==null?void 0:R.psramSize)&&Ml(l),T=((I=l[0])==null?void 0:I.macAddress)&&Ul(l);return{c(){e=d("h2"),e.textContent="ESP32 Sketch",t=v(),n=d("div"),r=A(s),i=v(),k&&k.c(),c=v(),u=d("div"),f=d("table"),p=d("tbody"),h&&h.c(),m=v(),y&&y.c(),_=v(),E&&E.c(),b=v(),C&&C.c(),g=v(),T&&T.c(),a(e,"class","svelte-qwtv9g"),a(n,"class","firmware-version svelte-qwtv9g"),a(f,"class","svelte-qwtv9g"),a(u,"class","device-info svelte-qwtv9g")},m(U,G){S(U,e,G),S(U,t,G),S(U,n,G),o(n,r),S(U,i,G),k&&k.m(U,G),S(U,c,G),S(U,u,G),o(u,f),o(f,p),h&&h.m(p,null),o(p,m),y&&y.m(p,null),o(p,_),E&&E.m(p,null),o(p,b),C&&C.m(p,null),o(p,g),T&&T.m(p,null)},p(U,G){var N,H,D,Q,K,Z,ie;G&1&&s!==(s=(((N=U[0])==null?void 0:N.firmwareVersion)||"Unknown")+"")&&j(r,s),(H=U[0])!=null&&H.buildDate?k?k.p(U,G):(k=Il(U),k.c(),k.m(c.parentNode,c)):k&&(k.d(1),k=null),(D=U[0])!=null&&D.chipModel?h?h.p(U,G):(h=Ol(U),h.c(),h.m(p,m)):h&&(h.d(1),h=null),(Q=U[0])!=null&&Q.cpuFreq?y?y.p(U,G):(y=Nl(U),y.c(),y.m(p,_)):y&&(y.d(1),y=null),(K=U[0])!=null&&K.flashSize?E?E.p(U,G):(E=Rl(U),E.c(),E.m(p,b)):E&&(E.d(1),E=null),(Z=U[0])!=null&&Z.psramSize?C?C.p(U,G):(C=Ml(U),C.c(),C.m(p,g)):C&&(C.d(1),C=null),(ie=U[0])!=null&&ie.macAddress?T?T.p(U,G):(T=Ul(U),T.c(),T.m(p,null)):T&&(T.d(1),T=null)},d(U){U&&(w(e),w(t),w(n),w(i),w(c),w(u)),k&&k.d(U),h&&h.d(),y&&y.d(),E&&E.d(),C&&C.d(),T&&T.d()}}}function Vr(l){let e,t,n,s,r,i,c,u,f,p;return{c(){e=d("h2"),e.textContent="OTA Update",t=v(),n=d("p"),n.textContent="Upload new firmware via the web-based OTA interface.",s=v(),r=d("button"),i=A("Open OTA Update Interface"),c=v(),u=d("div"),u.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 12H7V7h2v5zm0-6H7V4h2v2z"></path></svg>
          Device will reboot after update`,a(e,"class","svelte-qwtv9g"),a(n,"class","description svelte-qwtv9g"),a(r,"class","ota-button svelte-qwtv9g"),r.disabled=l[4],a(u,"class","warning-text svelte-qwtv9g")},m(m,_){S(m,e,_),S(m,t,_),S(m,n,_),S(m,s,_),S(m,r,_),o(r,i),S(m,c,_),S(m,u,_),f||(p=M(r,"click",ti),f=!0)},p(m,_){_&16&&(r.disabled=m[4])},d(m){m&&(w(e),w(t),w(n),w(s),w(r),w(c),w(u)),f=!1,p()}}}function Gr(l){let e,t,n,s,r,i,c;return{c(){e=d("p"),e.textContent="Restart the device to apply configuration changes or recover from errors.",t=v(),n=d("button"),n.textContent="Reboot Device",s=v(),r=d("div"),r.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 12H7V7h2v5zm0-6H7V4h2v2z"></path></svg>
            Device will be unavailable for approximately 30 seconds`,a(e,"class","description svelte-qwtv9g"),a(n,"class","reboot-button svelte-qwtv9g"),a(r,"class","warning-text svelte-qwtv9g")},m(u,f){S(u,e,f),S(u,t,f),S(u,n,f),S(u,s,f),S(u,r,f),i||(c=M(n,"click",l[7]),i=!0)},p:z,i:z,o:z,d(u){u&&(w(e),w(t),w(n),w(s),w(r)),i=!1,c()}}}function Jr(l){let e,t,n,s,r,i,c,u=l[3]!==1?"s":"",f,p,m,_,b,g;return{c(){e=d("div"),t=d("p"),t.textContent="Are you sure you want to reboot the device?",n=v(),s=d("div"),r=A("Rebooting in "),i=A(l[3]),c=A(" second"),f=A(u),p=A("..."),m=v(),_=d("button"),_.textContent="Cancel",a(t,"class","confirm-text svelte-qwtv9g"),a(s,"class","countdown svelte-qwtv9g"),a(_,"class","cancel-button svelte-qwtv9g"),a(e,"class","confirm-container svelte-qwtv9g")},m(k,h){S(k,e,h),o(e,t),o(e,n),o(e,s),o(s,r),o(s,i),o(s,c),o(s,f),o(s,p),o(e,m),o(e,_),b||(g=M(_,"click",l[8]),b=!0)},p(k,h){h&8&&j(i,k[3]),h&8&&u!==(u=k[3]!==1?"s":"")&&j(f,u)},i:z,o:z,d(k){k&&w(e),b=!1,g()}}}function Qr(l){let e,t,n,s,r;t=new De({});function i(f,p){return f[5]?Yr:Kr}let c=i(l),u=c(l);return{c(){e=d("div"),fe(t.$$.fragment),n=v(),s=d("div"),u.c(),a(s,"class","rebooting-text svelte-qwtv9g"),a(e,"class","rebooting-container svelte-qwtv9g")},m(f,p){S(f,e,p),ae(t,e,null),o(e,n),o(e,s),u.m(s,null),r=!0},p(f,p){c!==(c=i(f))&&(u.d(1),u=c(f),u&&(u.c(),u.m(s,null)))},i(f){r||(W(t.$$.fragment,f),r=!0)},o(f){B(t.$$.fragment,f),r=!1},d(f){f&&w(e),ce(t),u.d()}}}function Kr(l){let e;return{c(){e=A("Rebooting device...")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function Yr(l){let e;return{c(){e=A("Waiting for device to come back online...")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function Zr(l){let e,t,n,s,r,i;const c=[Qr,Jr,Gr],u=[];function f(p,m){return p[4]?0:p[2]?1:2}return n=f(l),s=u[n]=c[n](l),{c(){e=d("h2"),e.textContent="Device Reboot",t=v(),s.c(),r=Le(),a(e,"class","svelte-qwtv9g")},m(p,m){S(p,e,m),S(p,t,m),u[n].m(p,m),S(p,r,m),i=!0},p(p,m){let _=n;n=f(p),n===_?u[n].p(p,m):(ve(),B(u[_],1,1,()=>{u[_]=null}),ge(),s=u[n],s?s.p(p,m):(s=u[n]=c[n](p),s.c()),W(s,1),s.m(r.parentNode,r))},i(p){i||(W(s),i=!0)},o(p){B(s),i=!1},d(p){p&&(w(e),w(t),w(r)),u[n].d(p)}}}function Xr(l){let e;return{c(){e=d("p"),e.textContent="No version information available",a(e,"class","placeholder-text svelte-qwtv9g")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function $r(l){let e,t,n,s,r,i=(l[0].firmwareVersion||"Unknown")+"",c,u,f,p,m,_,b=dt(l[0].firmwareUpdateTime)+"",g,k,h,y,E,C,T,P=dt(l[0].filesystemUpdateTime)+"",O,L,F=l[0].filesystemVersion&&Dl(l),q=l[0].sdkVersion&&jl(l);return{c(){e=d("div"),t=d("div"),n=d("div"),n.textContent="Sketch Version:",s=v(),r=d("div"),c=A(i),u=v(),f=d("div"),p=d("div"),p.textContent="Last Firmware Update:",m=v(),_=d("div"),g=A(b),k=v(),F&&F.c(),h=v(),y=d("div"),E=d("div"),E.textContent="Last Filesystem Update:",C=v(),T=d("div"),O=A(P),L=v(),q&&q.c(),a(n,"class","history-label svelte-qwtv9g"),a(r,"class","history-value svelte-qwtv9g"),a(t,"class","history-item svelte-qwtv9g"),a(p,"class","timestamp-label svelte-qwtv9g"),a(_,"class","timestamp-value svelte-qwtv9g"),a(f,"class","timestamp-item svelte-qwtv9g"),a(E,"class","timestamp-label svelte-qwtv9g"),a(T,"class","timestamp-value svelte-qwtv9g"),a(y,"class","timestamp-item svelte-qwtv9g"),a(e,"class","update-history svelte-qwtv9g")},m(R,I){S(R,e,I),o(e,t),o(t,n),o(t,s),o(t,r),o(r,c),o(e,u),o(e,f),o(f,p),o(f,m),o(f,_),o(_,g),o(e,k),F&&F.m(e,null),o(e,h),o(e,y),o(y,E),o(y,C),o(y,T),o(T,O),o(e,L),q&&q.m(e,null)},p(R,I){I&1&&i!==(i=(R[0].firmwareVersion||"Unknown")+"")&&j(c,i),I&1&&b!==(b=dt(R[0].firmwareUpdateTime)+"")&&j(g,b),R[0].filesystemVersion?F?F.p(R,I):(F=Dl(R),F.c(),F.m(e,h)):F&&(F.d(1),F=null),I&1&&P!==(P=dt(R[0].filesystemUpdateTime)+"")&&j(O,P),R[0].sdkVersion?q?q.p(R,I):(q=jl(R),q.c(),q.m(e,null)):q&&(q.d(1),q=null)},d(R){R&&w(e),F&&F.d(),q&&q.d()}}}function Dl(l){let e,t,n,s,r=l[0].filesystemVersion+"",i;return{c(){e=d("div"),t=d("div"),t.textContent="Svelte App Version:",n=v(),s=d("div"),i=A(r),a(t,"class","history-label svelte-qwtv9g"),a(s,"class","history-value svelte-qwtv9g"),a(e,"class","history-item svelte-qwtv9g")},m(c,u){S(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=c[0].filesystemVersion+"")&&j(i,r)},d(c){c&&w(e)}}}function jl(l){let e,t,n,s,r=l[0].sdkVersion+"",i;return{c(){e=d("div"),t=d("div"),t.textContent="ESP32 SDK:",n=v(),s=d("div"),i=A(r),a(t,"class","history-label svelte-qwtv9g"),a(s,"class","history-value svelte-qwtv9g"),a(e,"class","history-item svelte-qwtv9g")},m(c,u){S(c,e,u),o(e,t),o(e,n),o(e,s),o(s,i)},p(c,u){u&1&&r!==(r=c[0].sdkVersion+"")&&j(i,r)},d(c){c&&w(e)}}}function xr(l){let e,t,n;function s(c,u){return c[0]?$r:Xr}let r=s(l),i=r(l);return{c(){e=d("h2"),e.textContent="Version Information",t=v(),i.c(),n=Le(),a(e,"class","svelte-qwtv9g")},m(c,u){S(c,e,u),S(c,t,u),i.m(c,u),S(c,n,u)},p(c,u){r===(r=s(c))&&i?i.p(c,u):(i.d(1),i=r(c),i&&(i.c(),i.m(n.parentNode,n)))},d(c){c&&(w(e),w(t),w(n)),i.d(c)}}}function ei(l){let e,t,n,s,r,i;const c=[zr,Hr],u=[];function f(p,m){return p[1]?0:1}return s=f(l),r=u[s]=c[s](l),{c(){e=d("div"),t=d("h1"),t.textContent="Firmware & Updates",n=v(),r.c(),a(t,"class","svelte-qwtv9g"),a(e,"class","firmware-container svelte-qwtv9g")},m(p,m){S(p,e,m),o(e,t),o(e,n),u[s].m(e,null),i=!0},p(p,[m]){let _=s;s=f(p),s===_?u[s].p(p,m):(ve(),B(u[_],1,1,()=>{u[_]=null}),ge(),r=u[s],r?r.p(p,m):(r=u[s]=c[s](p),r.c()),W(r,1),r.m(e,null))},i(p){i||(W(r),i=!0)},o(p){B(r),i=!1},d(p){p&&w(e),u[s].d()}}}function ti(){window.open("/update","_blank")}function vt(l){return l?`${(l/(1024*1024)).toFixed(2)} MB`:"N/A"}function Wl(l){return l?`${l} MHz`:"N/A"}function dt(l){return!l||l===0?"Never":new Date(l*1e3).toLocaleString()}function li(l,e,t){let n=null,s=!0,r=!1,i=0,c=!1,u=!1,f=!1,p=null,m=null,_=null;Ge(async()=>{await b(),_=setInterval(async()=>{!c&&!r&&await b()},3e4)}),at(()=>{p&&clearInterval(p),m&&clearInterval(m),_&&clearInterval(_)});async function b(){t(1,s=!0);try{t(0,n=await hn())}catch(E){console.warn("Failed to load system info:",E),t(0,n=null)}finally{t(1,s=!1)}}function g(){t(2,r=!0),t(3,i=3),p=setInterval(()=>{t(3,i--,i),i<=0&&(clearInterval(p),p=null,h())},1e3)}function k(){t(2,r=!1),p&&(clearInterval(p),p=null),t(3,i=0)}async function h(){t(2,r=!1),t(4,c=!0);try{await kn()}catch{}setTimeout(()=>{t(5,u=!0),y()},5e3)}function y(){m=setInterval(async()=>{try{(await fetch("/status",{method:"GET",cache:"no-cache"})).ok&&(clearInterval(m),m=null,t(5,u=!1),t(4,c=!1),t(6,f=!0),await b(),setTimeout(()=>{t(6,f=!1)},5e3))}catch{}},2e3)}return[n,s,r,i,c,u,f,g,k]}class Hl extends qe{constructor(e){super(),Ae(this,e,li,ei,Te,{})}}function zl(l){let e,t;return{c(){e=d("div"),t=A(l[2]),a(e,"class","message svelte-1gg1mca"),V(e,"success",l[3]==="success"),V(e,"error",l[3]==="error")},m(n,s){S(n,e,s),o(e,t)},p(n,s){s&4&&j(t,n[2]),s&8&&V(e,"success",n[3]==="success"),s&8&&V(e,"error",n[3]==="error")},d(n){n&&w(e)}}}function si(l){let e,t,n,s,r,i=l[0]?"â³":l[4]?"ðŸ”„":"ðŸ””",c,u,f=l[4]?"Reset Alert":"Test Alert",p,m,_,b=l[1]?"â³":"âš™ï¸",g,k,h,y,E,C=l[2]&&zl(l);return{c(){e=d("div"),t=d("p"),t.textContent="Press a button to simulate an event or just fire the servo.",n=v(),s=d("div"),r=d("button"),c=A(i),u=v(),p=A(f),m=v(),_=d("button"),g=A(b),k=A(" Test Servo"),h=v(),C&&C.c(),a(t,"class","description svelte-1gg1mca"),a(r,"class","btn test-alert-btn svelte-1gg1mca"),r.disabled=l[0],V(r,"alert-active",l[4]),a(_,"class","btn test-servo-btn svelte-1gg1mca"),_.disabled=l[1],a(s,"class","button-group svelte-1gg1mca"),a(e,"class","content svelte-1gg1mca")},m(T,P){S(T,e,P),o(e,t),o(e,n),o(e,s),o(s,r),o(r,c),o(r,u),o(r,p),o(s,m),o(s,_),o(_,g),o(_,k),o(e,h),C&&C.m(e,null),y||(E=[M(r,"click",l[5]),M(_,"click",l[6])],y=!0)},p(T,P){P&17&&i!==(i=T[0]?"â³":T[4]?"ðŸ”„":"ðŸ””")&&j(c,i),P&16&&f!==(f=T[4]?"Reset Alert":"Test Alert")&&j(p,f),P&1&&(r.disabled=T[0]),P&16&&V(r,"alert-active",T[4]),P&2&&b!==(b=T[1]?"â³":"âš™ï¸")&&j(g,b),P&2&&(_.disabled=T[1]),T[2]?C?C.p(T,P):(C=zl(T),C.c(),C.m(e,null)):C&&(C.d(1),C=null)},d(T){T&&w(e),C&&C.d(),y=!1,be(E)}}}function ni(l){let e,t,n,s,r;return s=new Ce({props:{title:"",$$slots:{default:[si]},$$scope:{ctx:l}}}),{c(){e=d("div"),t=d("h1"),t.textContent="Test Alert",n=v(),fe(s.$$.fragment),a(t,"class","svelte-1gg1mca"),a(e,"class","page svelte-1gg1mca")},m(i,c){S(i,e,c),o(e,t),o(e,n),ae(s,e,null),r=!0},p(i,[c]){const u={};c&543&&(u.$$scope={dirty:c,ctx:i}),s.$set(u)},i(i){r||(W(s.$$.fragment,i),r=!0)},o(i){B(s.$$.fragment,i),r=!1},d(i){i&&w(e),ce(s)}}}function ri(l,e,t){let n=!1,s=!1,r="",i="",c=!1,u=null;async function f(){try{const _=await Ot();t(4,c=_.detectionState||!1)}catch(_){console.error("Failed to check alert status:",_)}}async function p(){t(0,n=!0),t(2,r=""),t(3,i="");try{if(c)await ys(),t(2,r="âœ… Alert reset successfully"),t(3,i="success"),t(4,c=!1);else{const _=await Ss();t(2,r=_||"âœ… Test alert started â€“ check /gallery or /captures"),t(3,i="success"),t(4,c=!0)}}catch(_){t(2,r=`Error: ${_.message||(c?"Failed to reset alert":"Failed to trigger test alert")}`),t(3,i="error")}finally{t(0,n=!1),f()}}async function m(){t(1,s=!0),t(2,r=""),t(3,i="");try{await ws(),t(2,r="Servo triggered"),t(3,i="success")}catch(_){t(2,r=`Error: ${_.message||"Failed to trigger servo"}`),t(3,i="error")}finally{t(1,s=!1)}}return Ge(()=>{f(),u=setInterval(f,2e3)}),at(()=>{u&&clearInterval(u)}),[n,s,r,i,c,p,m]}class ii extends qe{constructor(e){super(),Ae(this,e,ri,ni,Te,{})}}function Bl(l,e,t){const n=l.slice();return n[57]=e[t],n}function Vl(l,e,t){const n=l.slice();return n[60]=e[t],n}function Gl(l){let e,t;return{c(){e=d("div"),t=d("div"),a(t,"class","progress-fill svelte-10bt1sc"),Ye(t,"width",l[7]/(ts-1)*100+"%"),a(e,"class","progress-bar svelte-10bt1sc")},m(n,s){S(n,e,s),o(e,t)},p(n,s){s[0]&128&&Ye(t,"width",n[7]/(ts-1)*100+"%")},d(n){n&&w(e)}}}function Jl(l){let e,t,n,s,r,i,c,u,f,p,m,_,b,g,k,h,y,E;function C(q,R){return q[16]?ai:oi}let T=C(l),P=T(l);const O=[di,fi],L=[];function F(q,R){return q[8]?0:1}return u=F(l),f=L[u]=O[u](l),{c(){e=d("div"),P.c(),t=v(),n=d("h1"),n.textContent="MouseTrap Setup",s=v(),r=d("p"),r.textContent="Let's get your device connected and ready to protect your home.",i=v(),c=d("button"),f.c(),p=v(),m=d("div"),_=d("button"),b=A("Standalone Mode (Local Only)"),g=v(),k=d("p"),k.textContent="Connect to WiFi without cloud registration",a(n,"class","svelte-10bt1sc"),a(r,"class","welcome-text svelte-10bt1sc"),a(c,"class","btn-primary btn-large svelte-10bt1sc"),c.disabled=l[8],a(_,"class","btn-link svelte-10bt1sc"),_.disabled=l[8],a(k,"class","standalone-hint svelte-10bt1sc"),a(m,"class","standalone-option svelte-10bt1sc"),a(e,"class","step welcome-step svelte-10bt1sc")},m(q,R){S(q,e,R),P.m(e,null),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),o(e,c),L[u].m(c,null),o(e,p),o(e,m),o(m,_),o(_,b),o(m,g),o(m,k),h=!0,y||(E=[M(c,"click",l[34]),M(_,"click",l[32])],y=!0)},p(q,R){T===(T=C(q))&&P?P.p(q,R):(P.d(1),P=T(q),P&&(P.c(),P.m(e,t)));let I=u;u=F(q),u===I?L[u].p(q,R):(ve(),B(L[I],1,1,()=>{L[I]=null}),ge(),f=L[u],f?f.p(q,R):(f=L[u]=O[u](q),f.c()),W(f,1),f.m(c,null)),(!h||R[0]&256)&&(c.disabled=q[8]),(!h||R[0]&256)&&(_.disabled=q[8])},i(q){h||(W(f),h=!0)},o(q){B(f),h=!1},d(q){q&&w(e),P.d(),L[u].d(),y=!1,be(E)}}}function oi(l){let e;return{c(){e=d("div"),e.innerHTML='<span class="mouse-emoji svelte-10bt1sc" role="img" aria-label="mouse">ðŸ</span>',a(e,"class","welcome-icon svelte-10bt1sc")},m(t,n){S(t,e,n)},p:z,d(t){t&&w(e)}}}function ai(l){let e,t,n,s,r,i,c,u,f,p;function m(g,k){if(g[17]==="invalid_credentials")return ui;if(g[17]==="wifi_failed")return ci}let _=m(l),b=_&&_(l);return{c(){e=d("div"),t=d("div"),t.innerHTML='<span class="error-icon svelte-10bt1sc">âš </span> <strong>Previous Setup Failed</strong>',n=v(),s=d("p"),r=A(l[16]),i=v(),b&&b.c(),c=v(),u=d("button"),u.textContent="Dismiss",a(t,"class","error-header svelte-10bt1sc"),a(s,"class","error-text svelte-10bt1sc"),a(u,"class","btn-dismiss svelte-10bt1sc"),a(e,"class","previous-error-box svelte-10bt1sc")},m(g,k){S(g,e,k),o(e,t),o(e,n),o(e,s),o(s,r),o(e,i),b&&b.m(e,null),o(e,c),o(e,u),f||(p=M(u,"click",l[25]),f=!0)},p(g,k){k[0]&65536&&j(r,g[16]),_!==(_=m(g))&&(b&&b.d(1),b=_&&_(g),b&&(b.c(),b.m(e,c)))},d(g){g&&w(e),b&&b.d(),f=!1,p()}}}function ci(l){let e;return{c(){e=d("div"),e.innerHTML='<p class="svelte-10bt1sc">Check your WiFi password and make sure the network is in range.</p>',a(e,"class","error-help svelte-10bt1sc")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function ui(l){let e;return{c(){e=d("div"),e.innerHTML='<p class="svelte-10bt1sc">Double-check your email and password, or create a new account.</p> <a href="https://dashboard.mousetrap.com/forgot-password" target="_blank" rel="noopener noreferrer" class="forgot-link svelte-10bt1sc">Forgot your password?</a>',a(e,"class","error-help svelte-10bt1sc")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function fi(l){let e=l[16]?"Try Again":"Get Started",t,n,s;return{c(){t=A(e),n=v(),s=d("span"),s.textContent="â†’",a(s,"class","arrow svelte-10bt1sc")},m(r,i){S(r,t,i),S(r,n,i),S(r,s,i)},p(r,i){i[0]&65536&&e!==(e=r[16]?"Try Again":"Get Started")&&j(t,e)},i:z,o:z,d(r){r&&(w(t),w(n),w(s))}}}function di(l){let e,t,n;return e=new De({props:{size:"small"}}),{c(){fe(e.$$.fragment),t=A(" Loading...")},m(s,r){ae(e,s,r),S(s,t,r),n=!0},p:z,i(s){n||(W(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){s&&w(t),ce(e,s)}}}function Ql(l){let e,t,n,s,r,i,c,u,f,p,m,_,b,g;const k=[_i,mi,pi],h=[];function y(P,O){return P[11]?0:P[10]||P[9].length===0?1:2}s=y(l),r=h[s]=k[s](l);const E=[hi,gi],C=[];function T(P,O){return P[18]?0:1}return p=T(l),m=C[p]=E[p](l),{c(){e=d("div"),t=d("h2"),t.textContent="Select your WiFi network",n=v(),r.c(),i=v(),c=d("div"),u=d("button"),u.innerHTML='<span class="arrow svelte-10bt1sc">â†</span> Back',f=v(),m.c(),a(t,"class","svelte-10bt1sc"),a(u,"class","btn-secondary svelte-10bt1sc"),a(c,"class","button-row svelte-10bt1sc"),a(e,"class","step wifi-step svelte-10bt1sc")},m(P,O){S(P,e,O),o(e,t),o(e,n),h[s].m(e,null),o(e,i),o(e,c),o(c,u),o(c,f),C[p].m(c,null),_=!0,b||(g=M(u,"click",l[42]),b=!0)},p(P,O){let L=s;s=y(P),s===L?h[s].p(P,O):(ve(),B(h[L],1,1,()=>{h[L]=null}),ge(),r=h[s],r?r.p(P,O):(r=h[s]=k[s](P),r.c()),W(r,1),r.m(e,i));let F=p;p=T(P),p===F?C[p].p(P,O):(ve(),B(C[F],1,1,()=>{C[F]=null}),ge(),m=C[p],m?m.p(P,O):(m=C[p]=E[p](P),m.c()),W(m,1),m.m(c,null))},i(P){_||(W(r),W(m),_=!0)},o(P){B(r),B(m),_=!1},d(P){P&&w(e),h[s].d(),C[p].d(),b=!1,g()}}}function pi(l){let e,t,n,s,r=l[0]==="manual"?"â—‰":"â—‹",i,c,u,f,p,m,_,b,g,k,h,y=l[12]?"Hide":"Show",E,C,T,P=l[2].length+"",O,L,F,q,R=Ee(l[9]),I=[];for(let D=0;D<R.length;D+=1)I[D]=Kl(Vl(l,R,D));let U=l[0]==="manual"&&Yl(l);function G(D,Q){return D[12]?vi:bi}let N=G(l),H=N(l);return{c(){e=d("div");for(let D=0;D<I.length;D+=1)I[D].c();t=v(),n=d("button"),s=d("span"),i=A(r),c=v(),u=d("span"),u.textContent="Enter manually...",f=v(),U&&U.c(),p=v(),m=d("div"),_=d("label"),_.textContent="Password",b=v(),g=d("div"),H.c(),k=v(),h=d("button"),E=A(y),C=v(),T=d("p"),O=A(P),L=A("/8 characters minimum"),a(s,"class","network-radio svelte-10bt1sc"),a(u,"class","network-name svelte-10bt1sc"),a(n,"class","network-item manual-entry svelte-10bt1sc"),V(n,"selected",l[0]==="manual"),a(e,"class","network-list svelte-10bt1sc"),a(_,"for","wifi-password"),a(_,"class","svelte-10bt1sc"),a(h,"type","button"),a(h,"class","toggle-password svelte-10bt1sc"),a(g,"class","password-input-group svelte-10bt1sc"),a(T,"class","field-hint svelte-10bt1sc"),V(T,"valid",l[2].length>=8),a(m,"class","form-group svelte-10bt1sc")},m(D,Q){S(D,e,Q);for(let K=0;K<I.length;K+=1)I[K]&&I[K].m(e,null);o(e,t),o(e,n),o(n,s),o(s,i),o(n,c),o(n,u),S(D,f,Q),U&&U.m(D,Q),S(D,p,Q),S(D,m,Q),o(m,_),o(m,b),o(m,g),H.m(g,null),o(g,k),o(g,h),o(h,E),o(m,C),o(m,T),o(T,O),o(T,L),F||(q=[M(n,"click",l[37]),M(h,"click",l[41])],F=!0)},p(D,Q){if(Q[0]&134218241){R=Ee(D[9]);let K;for(K=0;K<R.length;K+=1){const Z=Vl(D,R,K);I[K]?I[K].p(Z,Q):(I[K]=Kl(Z),I[K].c(),I[K].m(e,t))}for(;K<I.length;K+=1)I[K].d(1);I.length=R.length}Q[0]&1&&r!==(r=D[0]==="manual"?"â—‰":"â—‹")&&j(i,r),Q[0]&1&&V(n,"selected",D[0]==="manual"),D[0]==="manual"?U?U.p(D,Q):(U=Yl(D),U.c(),U.m(p.parentNode,p)):U&&(U.d(1),U=null),N===(N=G(D))&&H?H.p(D,Q):(H.d(1),H=N(D),H&&(H.c(),H.m(g,k))),Q[0]&4096&&y!==(y=D[12]?"Hide":"Show")&&j(E,y),Q[0]&4&&P!==(P=D[2].length+"")&&j(O,P),Q[0]&4&&V(T,"valid",D[2].length>=8)},i:z,o:z,d(D){D&&(w(e),w(f),w(p),w(m)),Ze(I,D),U&&U.d(D),H.d(),F=!1,be(q)}}}function mi(l){let e,t,n=(l[10]||"No networks found")+"",s,r,i,c,u,f,p;return{c(){e=d("div"),t=d("p"),s=A(n),r=v(),i=d("button"),i.textContent="Retry Scan",c=v(),u=d("p"),u.textContent="Tap Retry to scan again. This may take 10-15 seconds.",a(t,"class","svelte-10bt1sc"),a(i,"class","btn-primary svelte-10bt1sc"),a(u,"class","hint svelte-10bt1sc"),a(e,"class","error-box svelte-10bt1sc")},m(m,_){S(m,e,_),o(e,t),o(t,s),o(e,r),o(e,i),o(e,c),o(e,u),f||(p=M(i,"click",l[35]),f=!0)},p(m,_){_[0]&1024&&n!==(n=(m[10]||"No networks found")+"")&&j(s,n)},i:z,o:z,d(m){m&&w(e),f=!1,p()}}}function _i(l){let e,t,n,s,r;return t=new De({}),{c(){e=d("div"),fe(t.$$.fragment),n=v(),s=d("p"),s.textContent="Scanning for networks...",a(e,"class","loading-container svelte-10bt1sc")},m(i,c){S(i,e,c),ae(t,e,null),o(e,n),o(e,s),r=!0},p:z,i(i){r||(W(t.$$.fragment,i),r=!0)},o(i){B(t.$$.fragment,i),r=!1},d(i){i&&w(e),ce(t)}}}function Kl(l){let e,t,n=l[0]===l[60].ssid?"â—‰":"â—‹",s,r,i,c=l[60].ssid+"",u,f,p,m,_,b,g=ss(ls(l[60].rssi))+"",k,h,y;function E(){return l[36](l[60])}return{c(){e=d("button"),t=d("span"),s=A(n),r=v(),i=d("span"),u=A(c),f=v(),p=d("span"),m=d("span"),m.textContent="ðŸ“¶",_=v(),b=d("span"),k=A(g),a(t,"class","network-radio svelte-10bt1sc"),a(i,"class","network-name svelte-10bt1sc"),a(m,"class","signal-label svelte-10bt1sc"),a(b,"class","signal-bars svelte-10bt1sc"),a(p,"class","signal-icon svelte-10bt1sc"),a(p,"title","Signal strength"),a(e,"class","network-item svelte-10bt1sc"),V(e,"selected",l[0]===l[60].ssid)},m(C,T){S(C,e,T),o(e,t),o(t,s),o(e,r),o(e,i),o(i,u),o(e,f),o(e,p),o(p,m),o(p,_),o(p,b),o(b,k),h||(y=M(e,"click",E),h=!0)},p(C,T){l=C,T[0]&513&&n!==(n=l[0]===l[60].ssid?"â—‰":"â—‹")&&j(s,n),T[0]&512&&c!==(c=l[60].ssid+"")&&j(u,c),T[0]&512&&g!==(g=ss(ls(l[60].rssi))+"")&&j(k,g),T[0]&513&&V(e,"selected",l[0]===l[60].ssid)},d(C){C&&w(e),h=!1,y()}}}function Yl(l){let e,t,n,s,r,i;return{c(){e=d("div"),t=d("label"),t.textContent="Network Name (SSID)",n=v(),s=d("input"),a(t,"for","manual-ssid"),a(t,"class","svelte-10bt1sc"),a(s,"id","manual-ssid"),a(s,"type","text"),a(s,"placeholder","Enter network name"),a(s,"autocomplete","off"),a(s,"class","svelte-10bt1sc"),a(e,"class","form-group svelte-10bt1sc")},m(c,u){S(c,e,u),o(e,t),o(e,n),o(e,s),ee(s,l[1]),r||(i=M(s,"input",l[38]),r=!0)},p(c,u){u[0]&2&&s.value!==c[1]&&ee(s,c[1])},d(c){c&&w(e),r=!1,i()}}}function bi(l){let e,t,n;return{c(){e=d("input"),a(e,"id","wifi-password"),a(e,"type","password"),a(e,"placeholder","Enter WiFi password"),a(e,"autocomplete","off"),a(e,"class","svelte-10bt1sc")},m(s,r){S(s,e,r),ee(e,l[2]),t||(n=M(e,"input",l[40]),t=!0)},p(s,r){r[0]&4&&e.value!==s[2]&&ee(e,s[2])},d(s){s&&w(e),t=!1,n()}}}function vi(l){let e,t,n;return{c(){e=d("input"),a(e,"id","wifi-password"),a(e,"type","text"),a(e,"placeholder","Enter WiFi password"),a(e,"autocomplete","off"),a(e,"class","svelte-10bt1sc")},m(s,r){S(s,e,r),ee(e,l[2]),t||(n=M(e,"input",l[39]),t=!0)},p(s,r){r[0]&4&&e.value!==s[2]&&ee(e,s[2])},d(s){s&&w(e),t=!1,n()}}}function gi(l){let e,t,n,s,r,i;return{c(){e=d("button"),t=A("Next "),n=d("span"),n.textContent="â†’",a(n,"class","arrow svelte-10bt1sc"),a(e,"class","btn-primary svelte-10bt1sc"),e.disabled=s=!l[24]},m(c,u){S(c,e,u),o(e,t),o(e,n),r||(i=M(e,"click",l[43]),r=!0)},p(c,u){u[0]&16777216&&s!==(s=!c[24])&&(e.disabled=s)},i:z,o:z,d(c){c&&w(e),r=!1,i()}}}function hi(l){let e,t,n,s,r,i,c;const u=[wi,ki],f=[];function p(m,_){return m[19]?0:1}return t=p(l),n=f[t]=u[t](l),{c(){e=d("button"),n.c(),a(e,"class","btn-primary svelte-10bt1sc"),e.disabled=s=!l[24]||l[19]},m(m,_){S(m,e,_),f[t].m(e,null),r=!0,i||(c=M(e,"click",l[33]),i=!0)},p(m,_){let b=t;t=p(m),t!==b&&(ve(),B(f[b],1,1,()=>{f[b]=null}),ge(),n=f[t],n||(n=f[t]=u[t](m),n.c()),W(n,1),n.m(e,null)),(!r||_[0]&17301504&&s!==(s=!m[24]||m[19]))&&(e.disabled=s)},i(m){r||(W(n),r=!0)},o(m){B(n),r=!1},d(m){m&&w(e),f[t].d(),i=!1,c()}}}function ki(l){let e;return{c(){e=A("Enable Standalone Mode")},m(t,n){S(t,e,n)},i:z,o:z,d(t){t&&w(e)}}}function wi(l){let e,t,n;return e=new De({props:{size:"small"}}),{c(){fe(e.$$.fragment),t=A(" Enabling...")},m(s,r){ae(e,s,r),S(s,t,r),n=!0},i(s){n||(W(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){s&&w(t),ce(e,s)}}}function Zl(l){let e,t,n,s,r,i,c,u=l[3]?"Create your account":"Sign in",f,p,m,_,b,g,k,h,y,E,C,T,P,O=l[13]?"Hide":"Show",L,F,q,R=l[5].length+"",I,U,G,N,H,D,Q,K,Z,ie,_e,x,X=l[3]?"Create & Activate":"Sign In & Activate",ne,se,J,$,le,me;function Fe(oe,de){return oe[13]?yi:Si}let he=Fe(l),re=he(l);return{c(){e=d("div"),t=d("div"),n=d("button"),n.textContent="Sign In",s=v(),r=d("button"),r.textContent="Create Account",i=v(),c=d("h2"),f=A(u),p=v(),m=d("div"),_=d("label"),_.textContent="Email",b=v(),g=d("input"),k=v(),h=d("div"),y=d("label"),y.textContent="Password",E=v(),C=d("div"),re.c(),T=v(),P=d("button"),L=A(O),F=v(),q=d("p"),I=A(R),U=A("/8 characters minimum"),G=v(),N=d("div"),H=d("label"),H.textContent="Name this device",D=v(),Q=d("input"),K=v(),Z=d("div"),ie=d("button"),ie.innerHTML='<span class="arrow svelte-10bt1sc">â†</span> Back',_e=v(),x=d("button"),ne=A(X),se=v(),J=d("span"),J.textContent="â†’",a(n,"class","tab-btn svelte-10bt1sc"),V(n,"active",!l[3]),a(r,"class","tab-btn svelte-10bt1sc"),V(r,"active",l[3]),a(t,"class","account-tabs svelte-10bt1sc"),a(c,"class","svelte-10bt1sc"),a(_,"for","email"),a(_,"class","svelte-10bt1sc"),a(g,"id","email"),a(g,"type","email"),a(g,"placeholder","you@example.com"),a(g,"autocomplete","email"),a(g,"class","svelte-10bt1sc"),a(m,"class","form-group svelte-10bt1sc"),a(y,"for","account-password"),a(y,"class","svelte-10bt1sc"),a(P,"type","button"),a(P,"class","toggle-password svelte-10bt1sc"),a(C,"class","password-input-group svelte-10bt1sc"),a(q,"class","field-hint svelte-10bt1sc"),V(q,"valid",l[5].length>=8),a(h,"class","form-group svelte-10bt1sc"),a(H,"for","device-name"),a(H,"class","svelte-10bt1sc"),a(Q,"id","device-name"),a(Q,"type","text"),a(Q,"placeholder","Kitchen"),a(Q,"autocomplete","off"),a(Q,"class","svelte-10bt1sc"),a(N,"class","form-group svelte-10bt1sc"),a(ie,"class","btn-secondary svelte-10bt1sc"),a(J,"class","arrow svelte-10bt1sc"),a(x,"class","btn-primary svelte-10bt1sc"),x.disabled=$=!l[23],a(Z,"class","button-row svelte-10bt1sc"),a(e,"class","step account-step svelte-10bt1sc")},m(oe,de){S(oe,e,de),o(e,t),o(t,n),o(t,s),o(t,r),o(e,i),o(e,c),o(c,f),o(e,p),o(e,m),o(m,_),o(m,b),o(m,g),ee(g,l[4]),o(e,k),o(e,h),o(h,y),o(h,E),o(h,C),re.m(C,null),o(C,T),o(C,P),o(P,L),o(h,F),o(h,q),o(q,I),o(q,U),o(e,G),o(e,N),o(N,H),o(N,D),o(N,Q),ee(Q,l[6]),o(e,K),o(e,Z),o(Z,ie),o(Z,_e),o(Z,x),o(x,ne),o(x,se),o(x,J),le||(me=[M(n,"click",l[44]),M(r,"click",l[45]),M(g,"input",l[46]),M(P,"click",l[49]),M(Q,"input",l[50]),M(ie,"click",l[51]),M(x,"click",l[29])],le=!0)},p(oe,de){de[0]&8&&V(n,"active",!oe[3]),de[0]&8&&V(r,"active",oe[3]),de[0]&8&&u!==(u=oe[3]?"Create your account":"Sign in")&&j(f,u),de[0]&16&&g.value!==oe[4]&&ee(g,oe[4]),he===(he=Fe(oe))&&re?re.p(oe,de):(re.d(1),re=he(oe),re&&(re.c(),re.m(C,T))),de[0]&8192&&O!==(O=oe[13]?"Hide":"Show")&&j(L,O),de[0]&32&&R!==(R=oe[5].length+"")&&j(I,R),de[0]&32&&V(q,"valid",oe[5].length>=8),de[0]&64&&Q.value!==oe[6]&&ee(Q,oe[6]),de[0]&8&&X!==(X=oe[3]?"Create & Activate":"Sign In & Activate")&&j(ne,X),de[0]&8388608&&$!==($=!oe[23])&&(x.disabled=$)},d(oe){oe&&w(e),re.d(),le=!1,be(me)}}}function Si(l){let e,t,n,s,r;return{c(){e=d("input"),a(e,"id","account-password"),a(e,"type","password"),a(e,"placeholder",t=l[3]?"Create a password":"Enter your password"),a(e,"autocomplete",n=l[3]?"new-password":"current-password"),a(e,"class","svelte-10bt1sc")},m(i,c){S(i,e,c),ee(e,l[5]),s||(r=M(e,"input",l[48]),s=!0)},p(i,c){c[0]&8&&t!==(t=i[3]?"Create a password":"Enter your password")&&a(e,"placeholder",t),c[0]&8&&n!==(n=i[3]?"new-password":"current-password")&&a(e,"autocomplete",n),c[0]&32&&e.value!==i[5]&&ee(e,i[5])},d(i){i&&w(e),s=!1,r()}}}function yi(l){let e,t,n,s,r;return{c(){e=d("input"),a(e,"id","account-password"),a(e,"type","text"),a(e,"placeholder",t=l[3]?"Create a password":"Enter your password"),a(e,"autocomplete",n=l[3]?"new-password":"current-password"),a(e,"class","svelte-10bt1sc")},m(i,c){S(i,e,c),ee(e,l[5]),s||(r=M(e,"input",l[47]),s=!0)},p(i,c){c[0]&8&&t!==(t=i[3]?"Create a password":"Enter your password")&&a(e,"placeholder",t),c[0]&8&&n!==(n=i[3]?"new-password":"current-password")&&a(e,"autocomplete",n),c[0]&32&&e.value!==i[5]&&ee(e,i[5])},d(i){i&&w(e),s=!1,r()}}}function Xl(l){let e,t,n,s,r=Ee(l[22]),i=[];for(let c=0;c<r.length;c+=1)i[c]=xl(Bl(l,r,c));return{c(){e=d("div"),t=d("h2"),t.textContent="Setting up your device...",n=v(),s=d("div");for(let c=0;c<i.length;c+=1)i[c].c();a(t,"class","svelte-10bt1sc"),a(s,"class","progress-list svelte-10bt1sc"),a(e,"class","step progress-step svelte-10bt1sc")},m(c,u){S(c,e,u),o(e,t),o(e,n),o(e,s);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(s,null)},p(c,u){if(u[0]&4194304){r=Ee(c[22]);let f;for(f=0;f<r.length;f+=1){const p=Bl(c,r,f);i[f]?i[f].p(p,u):(i[f]=xl(p),i[f].c(),i[f].m(s,null))}for(;f<i.length;f+=1)i[f].d(1);i.length=r.length}},d(c){c&&w(e),Ze(i,c)}}}function $l(l){let e;return{c(){e=d("span"),a(e,"class","progress-spinner svelte-10bt1sc")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function xl(l){let e,t,n=ns(l[57].status)+"",s,r,i,c=l[57].label+"",u,f,p,m=l[57].status==="in_progress"&&$l();return{c(){e=d("div"),t=d("span"),s=A(n),r=v(),i=d("span"),u=A(c),f=v(),m&&m.c(),p=v(),a(t,"class","progress-icon svelte-10bt1sc"),a(i,"class","progress-label svelte-10bt1sc"),a(e,"class","progress-item svelte-10bt1sc"),V(e,"completed",l[57].status==="completed"),V(e,"in-progress",l[57].status==="in_progress"),V(e,"failed",l[57].status==="failed")},m(_,b){S(_,e,b),o(e,t),o(t,s),o(e,r),o(e,i),o(i,u),o(e,f),m&&m.m(e,null),o(e,p)},p(_,b){b[0]&4194304&&n!==(n=ns(_[57].status)+"")&&j(s,n),b[0]&4194304&&c!==(c=_[57].label+"")&&j(u,c),_[57].status==="in_progress"?m||(m=$l(),m.c(),m.m(e,p)):m&&(m.d(1),m=null),b[0]&4194304&&V(e,"completed",_[57].status==="completed"),b[0]&4194304&&V(e,"in-progress",_[57].status==="in_progress"),b[0]&4194304&&V(e,"failed",_[57].status==="failed")},d(_){_&&w(e),m&&m.d()}}}function es(l){let e,t,n,s;const r=[Ti,Ci],i=[];function c(u,f){return u[14]?0:1}return e=c(l),t=i[e]=r[e](l),{c(){t.c(),n=Le()},m(u,f){i[e].m(u,f),S(u,n,f),s=!0},p(u,f){let p=e;e=c(u),e===p?i[e].p(u,f):(ve(),B(i[p],1,1,()=>{i[p]=null}),ge(),t=i[e],t?t.p(u,f):(t=i[e]=r[e](u),t.c()),W(t,1),t.m(n.parentNode,n))},i(u){s||(W(t),s=!0)},o(u){B(t),s=!1},d(u){u&&w(n),i[e].d(u)}}}function Ci(l){let e,t,n,s,r,i,c,u,f,p,m,_;function b(h,y){if(h[20]==="invalid_credentials")return Li;if(h[20]==="wifi_failed")return Ei;if(h[20]==="connection_error")return Fi}let g=b(l),k=g&&g(l);return{c(){e=d("div"),t=d("div"),t.innerHTML='<span role="img" aria-label="error">âŒ</span>',n=v(),s=d("h2"),s.textContent="Setup Failed",r=v(),i=d("p"),c=A(l[15]),u=v(),k&&k.c(),f=v(),p=d("button"),p.textContent="Try Again",a(t,"class","result-icon error svelte-10bt1sc"),a(s,"class","svelte-10bt1sc"),a(i,"class","error-message svelte-10bt1sc"),a(p,"class","btn-primary btn-large svelte-10bt1sc"),a(e,"class","step error-step svelte-10bt1sc")},m(h,y){S(h,e,y),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),o(i,c),o(e,u),k&&k.m(e,null),o(e,f),o(e,p),m||(_=M(p,"click",l[31]),m=!0)},p(h,y){y[0]&32768&&j(c,h[15]),g!==(g=b(h))&&(k&&k.d(1),k=g&&g(h),k&&(k.c(),k.m(e,f)))},i:z,o:z,d(h){h&&w(e),k&&k.d(),m=!1,_()}}}function Ti(l){let e,t,n,s;const r=[qi,Ai],i=[];function c(u,f){return u[18]?0:1}return t=c(l),n=i[t]=r[t](l),{c(){e=d("div"),n.c(),a(e,"class","step success-step svelte-10bt1sc")},m(u,f){S(u,e,f),i[t].m(e,null),s=!0},p(u,f){let p=t;t=c(u),t===p?i[t].p(u,f):(ve(),B(i[p],1,1,()=>{i[p]=null}),ge(),n=i[t],n?n.p(u,f):(n=i[t]=r[t](u),n.c()),W(n,1),n.m(e,null))},i(u){s||(W(n),s=!0)},o(u){B(n),s=!1},d(u){u&&w(e),i[t].d()}}}function Fi(l){let e;return{c(){e=d("div"),e.innerHTML='<p class="svelte-10bt1sc">Make sure your WiFi has internet access and the server is reachable.</p>',a(e,"class","error-help-box svelte-10bt1sc")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function Ei(l){let e;return{c(){e=d("div"),e.innerHTML='<p class="svelte-10bt1sc">Check your WiFi password and make sure the network is in range.</p>',a(e,"class","error-help-box svelte-10bt1sc")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function Li(l){let e;return{c(){e=d("div"),e.innerHTML='<p class="svelte-10bt1sc">Double-check your email and password, or create a new account.</p> <a href="https://dashboard.mousetrap.com/forgot-password" target="_blank" rel="noopener noreferrer" class="forgot-link svelte-10bt1sc">Forgot your password?</a>',a(e,"class","error-help-box svelte-10bt1sc")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function Ai(l){let e,t,n,s,r,i,c,u,f,p,m,_,b,g,k,h,y,E,C;const T=[Ii,Pi],P=[];function O(L,F){return L[21]?0:1}return b=O(l),g=P[b]=T[b](l),{c(){e=d("div"),e.innerHTML='<span role="img" aria-label="success">âœ…</span>',t=v(),n=d("h2"),n.textContent="Setup Complete!",s=v(),r=d("p"),i=A('Your device "'),c=A(l[6]),u=A('" has been registered successfully.'),f=v(),p=d("div"),p.innerHTML='<p class="svelte-10bt1sc">Access your dashboard at:</p> <a href="https://dashboard.mousetrap.com" class="dashboard-link svelte-10bt1sc" target="_blank" rel="noopener noreferrer">https://dashboard.mousetrap.com</a>',m=v(),_=d("button"),g.c(),k=v(),h=d("p"),h.textContent="The device will reboot and connect to your home WiFi.",a(e,"class","result-icon success svelte-10bt1sc"),a(n,"class","svelte-10bt1sc"),a(r,"class","result-text svelte-10bt1sc"),a(p,"class","dashboard-link-box svelte-10bt1sc"),a(_,"class","btn-primary btn-large svelte-10bt1sc"),_.disabled=l[21],a(h,"class","auto-close-text svelte-10bt1sc")},m(L,F){S(L,e,F),S(L,t,F),S(L,n,F),S(L,s,F),S(L,r,F),o(r,i),o(r,c),o(r,u),S(L,f,F),S(L,p,F),S(L,m,F),S(L,_,F),P[b].m(_,null),S(L,k,F),S(L,h,F),y=!0,E||(C=M(_,"click",l[30]),E=!0)},p(L,F){(!y||F[0]&64)&&j(c,L[6]);let q=b;b=O(L),b!==q&&(ve(),B(P[q],1,1,()=>{P[q]=null}),ge(),g=P[b],g||(g=P[b]=T[b](L),g.c()),W(g,1),g.m(_,null)),(!y||F[0]&2097152)&&(_.disabled=L[21])},i(L){y||(W(g),y=!0)},o(L){B(g),y=!1},d(L){L&&(w(e),w(t),w(n),w(s),w(r),w(f),w(p),w(m),w(_),w(k),w(h)),P[b].d(),E=!1,C()}}}function qi(l){let e,t,n,s,r,i,c,u,f;return{c(){e=d("div"),e.innerHTML='<span role="img" aria-label="success">âœ…</span>',t=v(),n=d("h2"),n.textContent="Standalone Mode Enabled",s=v(),r=d("p"),r.textContent="Device will reboot and connect to WiFi without cloud registration.",i=v(),c=d("div"),c.innerHTML='<p class="svelte-10bt1sc">After reboot, access the device at:</p> <p class="dashboard-link svelte-10bt1sc">http://192.168.4.1</p> <p class="hint-text svelte-10bt1sc">(Connect to the MouseTrap WiFi network first)</p>',u=v(),f=d("p"),f.innerHTML=`Device is rebooting...<br/>
              You can view system logs at /app/#/logs`,a(e,"class","result-icon success svelte-10bt1sc"),a(n,"class","svelte-10bt1sc"),a(r,"class","result-text svelte-10bt1sc"),a(c,"class","dashboard-link-box svelte-10bt1sc"),a(f,"class","auto-close-text svelte-10bt1sc")},m(p,m){S(p,e,m),S(p,t,m),S(p,n,m),S(p,s,m),S(p,r,m),S(p,i,m),S(p,c,m),S(p,u,m),S(p,f,m)},p:z,i:z,o:z,d(p){p&&(w(e),w(t),w(n),w(s),w(r),w(i),w(c),w(u),w(f))}}}function Pi(l){let e;return{c(){e=A("Finish Setup")},m(t,n){S(t,e,n)},i:z,o:z,d(t){t&&w(e)}}}function Ii(l){let e,t,n;return e=new De({props:{size:"small"}}),{c(){fe(e.$$.fragment),t=A(" Rebooting...")},m(s,r){ae(e,s,r),S(s,t,r),n=!0},i(s){n||(W(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){s&&w(t),ce(e,s)}}}function Oi(l){let e,t,n,s,r,i,c,u,f=l[7]<5&&Gl(l),p=l[7]===1&&Jl(l),m=l[7]===2&&Ql(l),_=l[7]===3&&Zl(l),b=l[7]===4&&Xl(l),g=l[7]===5&&es(l);return{c(){e=d("div"),t=d("div"),f&&f.c(),n=v(),p&&p.c(),s=v(),m&&m.c(),r=v(),_&&_.c(),i=v(),b&&b.c(),c=v(),g&&g.c(),a(t,"class","setup-card svelte-10bt1sc"),a(e,"class","setup-container svelte-10bt1sc")},m(k,h){S(k,e,h),o(e,t),f&&f.m(t,null),o(t,n),p&&p.m(t,null),o(t,s),m&&m.m(t,null),o(t,r),_&&_.m(t,null),o(t,i),b&&b.m(t,null),o(t,c),g&&g.m(t,null),u=!0},p(k,h){k[7]<5?f?f.p(k,h):(f=Gl(k),f.c(),f.m(t,n)):f&&(f.d(1),f=null),k[7]===1?p?(p.p(k,h),h[0]&128&&W(p,1)):(p=Jl(k),p.c(),W(p,1),p.m(t,s)):p&&(ve(),B(p,1,1,()=>{p=null}),ge()),k[7]===2?m?(m.p(k,h),h[0]&128&&W(m,1)):(m=Ql(k),m.c(),W(m,1),m.m(t,r)):m&&(ve(),B(m,1,1,()=>{m=null}),ge()),k[7]===3?_?_.p(k,h):(_=Zl(k),_.c(),_.m(t,i)):_&&(_.d(1),_=null),k[7]===4?b?b.p(k,h):(b=Xl(k),b.c(),b.m(t,c)):b&&(b.d(1),b=null),k[7]===5?g?(g.p(k,h),h[0]&128&&W(g,1)):(g=es(k),g.c(),W(g,1),g.m(t,null)):g&&(ve(),B(g,1,1,()=>{g=null}),ge())},i(k){u||(W(p),W(m),W(g),u=!0)},o(k){B(p),B(m),B(g),u=!1},d(k){k&&w(e),f&&f.d(),p&&p.d(),m&&m.d(),_&&_.d(),b&&b.d(),g&&g.d()}}}const ts=5;function ls(l){return l>=-50?4:l>=-60?3:l>=-70?2:1}function ss(l){const e="â–ˆ",t="â–‘";let n="";for(let s=0;s<4;s++)n+=s<l?e:t;return n}function Ni(l){switch(l){case"wifi_failed":return{wifi:"failed",account:"pending",activate:"pending"};case"ntp_failed":case"invalid_credentials":case"server_rejected":return{wifi:"completed",account:"failed",activate:"pending"};case"connection_error":case"server_error":case"registration_failed":return{wifi:"completed",account:"completed",activate:"failed"};default:return{wifi:"completed",account:"completed",activate:"failed"}}}function ns(l){switch(l){case"completed":return"âœ“";case"in_progress":return"â³";case"failed":return"âœ—";default:return"â—‹"}}function Ri(l,e,t){let n,s,r,i=1,c=!1,u=[],f=null,p=!1,m=null,_="",b="",g=!1,k=!1,h="",y="",E=!1,C="",T=!1,P=null,O=null,L=null,F=!1,q=!1;Ge(async()=>{try{const Y=await yn();Y.attempted&&!Y.success&&(t(16,O=Y.errorMessage),t(17,L=Y.errorCode),console.log("[SETUP] Previous error found:",Y.errorCode,Y.errorMessage))}catch(Y){console.log("[SETUP] Could not check setup status:",Y.message)}});async function R(){try{await Cn()}catch(Y){console.log("[SETUP] Could not clear setup status:",Y.message)}t(16,O=null),t(17,L=null)}async function I(Y=!1){console.log("[SETUP] loadNetworks called, forceRescan="+Y),t(11,p=!0),t(10,f=null),t(9,u=[]);try{console.log("[SETUP] About to call scanWiFiNetworks...");const ye=await Cs(Y);console.log("[SETUP] scanWiFiNetworks returned:",JSON.stringify(ye)),t(9,u=ye.networks||[]),console.log("[SETUP] Networks set to:",u.length,"items"),u.length===0&&t(10,f="No networks found. Tap Retry to scan again.")}catch(ye){console.error("[SETUP] Scan error:",ye),console.error("[SETUP] Error details:",ye.message,ye.stack),t(10,f="Scan failed: "+(ye.message||"Unknown error")),t(9,u=[])}finally{console.log("[SETUP] loadNetworks finished, setting networkLoading=false"),t(11,p=!1)}}function U(Y){t(0,m=Y),Y!=="manual"&&t(1,_="")}async function G(Y){t(8,c=!0);try{Y===2&&await I(),t(7,i=Y)}finally{t(8,c=!1)}}let N=null;async function H(){t(7,i=4),t(14,T=!1),t(15,P=null);const Y=m==="manual"?_:m;t(22,n=[{id:"wifi",label:"Connecting to WiFi",status:"in_progress"},{id:"account",label:k?"Creating account":"Signing in",status:"pending"},{id:"activate",label:"Activating device",status:"pending"}]);try{await Ln({ssid:Y,password:b,email:h,accountPassword:y,deviceName:C,isNewAccount:k}),D()}catch(ye){t(15,P=ye.message||"Failed to start setup. Please try again."),t(22,n=n.map(je=>je.status==="in_progress"?{...je,status:"failed"}:je)),t(7,i=5)}}function D(){N=setInterval(async()=>{try{const Y=await Tn();console.log("[SETUP] Progress:",Y.state,Y.step),K(Y),Y.state==="complete"?(Q(),t(14,T=!0),t(7,i=5)):Y.state==="failed"&&(Q(),t(15,P=Y.error||"Setup failed"),t(20,Z=Y.errorCode),t(7,i=5))}catch(Y){console.log("[SETUP] Poll error (device may be switching modes):",Y.message)}},500)}function Q(){N&&(clearInterval(N),N=null)}function K(Y){const ye={idle:{wifi:"pending",account:"pending",activate:"pending"},connecting_wifi:{wifi:"in_progress",account:"pending",activate:"pending"},syncing_time:{wifi:"completed",account:"in_progress",activate:"pending"},registering:{wifi:"completed",account:"in_progress",activate:"pending"},saving:{wifi:"completed",account:"completed",activate:"in_progress"},complete:{wifi:"completed",account:"completed",activate:"completed"},failed:Ni(Y.errorCode)},je=ye[Y.state]||ye.idle;t(22,n=[{id:"wifi",label:"Connecting to WiFi",status:je.wifi},{id:"account",label:k?"Creating account":"Signing in",status:je.account},{id:"activate",label:"Activating device",status:je.activate}])}let Z=null,ie=!1;async function _e(){t(21,ie=!0);try{await En()}catch{console.log("[SETUP] Reboot request sent (connection may be lost)")}}async function x(){try{await Fn()}catch(Y){console.log("[SETUP] Could not reset state:",Y.message)}t(15,P=null),t(20,Z=null),t(7,i=3)}async function X(){t(18,F=!0),await G(2)}async function ne(){t(19,q=!0),t(15,P=null);const Y=m==="manual"?_:m;try{await An({ssid:Y,password:b}),t(14,T=!0),t(7,i=5)}catch(ye){t(15,P=ye.message||"Failed to enable standalone mode"),t(7,i=5),t(14,T=!1)}finally{t(19,q=!1)}}const se=()=>{t(18,F=!1),R(),G(2)},J=()=>{console.log("[SETUP] Retry clicked!"),I(!0)},$=Y=>U(Y.ssid),le=()=>U("manual");function me(){_=this.value,t(1,_)}function Fe(){b=this.value,t(2,b)}function he(){b=this.value,t(2,b)}const re=()=>t(12,g=!g),oe=()=>{t(7,i=1),t(18,F=!1)},de=()=>t(7,i=3),Se=()=>t(3,k=!1),Ue=()=>t(3,k=!0);function ze(){h=this.value,t(4,h)}function Be(){y=this.value,t(5,y)}function Ke(){y=this.value,t(5,y)}const Je=()=>t(13,E=!E);function we(){C=this.value,t(6,C)}const te=()=>t(7,i=2);return l.$$.update=()=>{l.$$.dirty[0]&8&&t(22,n=[{id:"wifi",label:"Connecting to WiFi",status:"pending"},{id:"account",label:k?"Creating account":"Signing in",status:"pending"},{id:"activate",label:"Activating device",status:"pending"}]),l.$$.dirty[0]&7&&t(24,s=(m||_.trim())&&(m!=="manual"||_.trim())&&b.length>=8),l.$$.dirty[0]&112&&t(23,r=h.trim()&&y.length>=8&&C.trim())},[m,_,b,k,h,y,C,i,c,u,f,p,g,E,T,P,O,L,F,q,Z,ie,n,r,s,R,I,U,G,H,_e,x,X,ne,se,J,$,le,me,Fe,he,re,oe,de,Se,Ue,ze,Be,Ke,Je,we,te]}class Mi extends qe{constructor(e){super(),Ae(this,e,Ri,Oi,Te,{},null,[-1,-1,-1])}}function rs(l,e,t){const n=l.slice();return n[19]=e[t],n}function Ui(l){let e,t,n,s;return e=new Ce({props:{title:"Update WiFi Network",$$slots:{default:[Gi]},$$scope:{ctx:l}}}),{c(){fe(e.$$.fragment),t=v(),n=d("div"),n.innerHTML='<a href="/" class="svelte-1p30553">â† Back to Dashboard</a>',a(n,"class","back-link svelte-1p30553")},m(r,i){ae(e,r,i),S(r,t,i),S(r,n,i),s=!0},p(r,i){const c={};i&4195310&&(c.$$scope={dirty:i,ctx:r}),e.$set(c)},i(r){s||(W(e.$$.fragment,r),s=!0)},o(r){B(e.$$.fragment,r),s=!1},d(r){r&&(w(t),w(n)),ce(e,r)}}}function Di(l){let e,t;return e=new Ce({props:{$$slots:{default:[Ji]},$$scope:{ctx:l}}}),{c(){fe(e.$$.fragment)},m(n,s){ae(e,n,s),t=!0},p(n,s){const r={};s&4194320&&(r.$$scope={dirty:s,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function ji(l){let e,t,n,s,r;return t=new De({}),{c(){e=d("div"),fe(t.$$.fragment),n=v(),s=d("p"),s.textContent="Scanning for networks...",a(e,"class","loading-container svelte-1p30553")},m(i,c){S(i,e,c),ae(t,e,null),o(e,n),o(e,s),r=!0},p:z,i(i){r||(W(t.$$.fragment,i),r=!0)},o(i){B(t.$$.fragment,i),r=!1},d(i){i&&w(e),ce(t)}}}function is(l){let e,t;return{c(){e=d("div"),t=A(l[3]),a(e,"class","error-text svelte-1p30553")},m(n,s){S(n,e,s),o(e,t)},p(n,s){s&8&&j(t,n[3])},d(n){n&&w(e)}}}function os(l){let e,t,n,s,r,i=l[1]?"Scanning...":"Rescan",c,u,f,p,m,_,b;const g=[zi,Hi,Wi],k=[];function h(y,E){return y[1]?0:y[8].length===0?1:2}return f=h(l),p=k[f]=g[f](l),{c(){e=d("div"),t=d("div"),n=d("span"),n.textContent="Available Networks",s=v(),r=d("button"),c=A(i),u=v(),p.c(),a(r,"type","button"),a(r,"class","btn-link svelte-1p30553"),r.disabled=l[1],a(t,"class","network-list-header svelte-1p30553"),a(e,"class","network-list svelte-1p30553")},m(y,E){S(y,e,E),o(e,t),o(t,n),o(t,s),o(t,r),o(r,c),o(e,u),k[f].m(e,null),m=!0,_||(b=M(r,"click",l[10]),_=!0)},p(y,E){(!m||E&2)&&i!==(i=y[1]?"Scanning...":"Rescan")&&j(c,i),(!m||E&2)&&(r.disabled=y[1]);let C=f;f=h(y),f===C?k[f].p(y,E):(ve(),B(k[C],1,1,()=>{k[C]=null}),ge(),p=k[f],p?p.p(y,E):(p=k[f]=g[f](y),p.c()),W(p,1),p.m(e,null))},i(y){m||(W(p),m=!0)},o(y){B(p),m=!1},d(y){y&&w(e),k[f].d(),_=!1,b()}}}function Wi(l){let e,t=Ee(l[8]),n=[];for(let s=0;s<t.length;s+=1)n[s]=cs(rs(l,t,s));return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=Le()},m(s,r){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(s,r);S(s,e,r)},p(s,r){if(r&2336){t=Ee(s[8]);let i;for(i=0;i<t.length;i+=1){const c=rs(s,t,i);n[i]?n[i].p(c,r):(n[i]=cs(c),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},i:z,o:z,d(s){s&&w(e),Ze(n,s)}}}function Hi(l){let e;return{c(){e=d("div"),e.textContent="No networks found. Try rescanning or enter SSID manually.",a(e,"class","no-networks svelte-1p30553")},m(t,n){S(t,e,n)},p:z,i:z,o:z,d(t){t&&w(e)}}}function zi(l){let e,t,n,s,r;return t=new De({props:{size:"small"}}),{c(){e=d("div"),fe(t.$$.fragment),n=v(),s=d("span"),s.textContent="Scanning...",a(e,"class","scanning svelte-1p30553")},m(i,c){S(i,e,c),ae(t,e,null),o(e,n),o(e,s),r=!0},p:z,i(i){r||(W(t.$$.fragment,i),r=!0)},o(i){B(t.$$.fragment,i),r=!1},d(i){i&&w(e),ce(t)}}}function as(l){let e;return{c(){e=d("span"),e.textContent="ðŸ”’",a(e,"class","lock svelte-1p30553")},m(t,n){S(t,e,n)},d(t){t&&w(e)}}}function cs(l){let e,t,n=l[19].ssid+"",s,r,i,c,u=us(l[19].rssi)+"",f,p,m,_,b,g=l[19].secure&&as();function k(){return l[15](l[19])}return{c(){e=d("button"),t=d("span"),s=A(n),r=v(),i=d("span"),c=d("span"),f=A(u),p=v(),g&&g.c(),m=v(),a(t,"class","network-name svelte-1p30553"),a(c,"class","signal svelte-1p30553"),a(i,"class","network-info svelte-1p30553"),a(e,"type","button"),a(e,"class","network-item svelte-1p30553"),V(e,"selected",l[5]===l[19].ssid)},m(h,y){S(h,e,y),o(e,t),o(t,s),o(e,r),o(e,i),o(i,c),o(c,f),o(i,p),g&&g.m(i,null),o(e,m),_||(b=M(e,"click",k),_=!0)},p(h,y){l=h,y&256&&n!==(n=l[19].ssid+"")&&j(s,n),y&256&&u!==(u=us(l[19].rssi)+"")&&j(f,u),l[19].secure?g||(g=as(),g.c(),g.m(i,null)):g&&(g.d(1),g=null),y&288&&V(e,"selected",l[5]===l[19].ssid)},d(h){h&&w(e),g&&g.d(),_=!1,b()}}}function Bi(l){let e,t,n;return{c(){e=d("input"),a(e,"id","password"),a(e,"type","password"),a(e,"placeholder","Enter WiFi password"),e.disabled=l[2],a(e,"class","svelte-1p30553")},m(s,r){S(s,e,r),ee(e,l[6]),t||(n=M(e,"input",l[17]),t=!0)},p(s,r){r&4&&(e.disabled=s[2]),r&64&&e.value!==s[6]&&ee(e,s[6])},d(s){s&&w(e),t=!1,n()}}}function Vi(l){let e,t,n;return{c(){e=d("input"),a(e,"id","password"),a(e,"type","text"),a(e,"placeholder","Enter WiFi password"),e.disabled=l[2],a(e,"class","svelte-1p30553")},m(s,r){S(s,e,r),ee(e,l[6]),t||(n=M(e,"input",l[16]),t=!0)},p(s,r){r&4&&(e.disabled=s[2]),r&64&&e.value!==s[6]&&ee(e,s[6])},d(s){s&&w(e),t=!1,n()}}}function Gi(l){let e,t,n,s,r,i,c,u,f,p=l[9]?"Hide":"Browse",m,_,b,g,k,h,y,E,C,T=l[7]?"Hide":"Show",P,O,L,F,q,R,I,U=l[2]?"Saving...":"Update WiFi Settings",G,N,H,D,Q,K=l[3]&&is(l),Z=l[9]&&os(l);function ie(X,ne){return X[7]?Vi:Bi}let _e=ie(l),x=_e(l);return{c(){e=d("div"),K&&K.c(),t=v(),n=d("div"),s=d("label"),s.textContent="WiFi Network (SSID)",r=v(),i=d("div"),c=d("input"),u=v(),f=d("button"),m=A(p),_=v(),Z&&Z.c(),b=v(),g=d("div"),k=d("label"),k.textContent="Password",h=v(),y=d("div"),x.c(),E=v(),C=d("button"),P=A(T),O=v(),L=d("div"),L.textContent="Minimum 8 characters",F=v(),q=d("div"),q.textContent=`The device will restart after saving. You may need to reconnect
          to the new network to continue using the device.`,R=v(),I=d("button"),G=A(U),a(s,"for","ssid"),a(s,"class","svelte-1p30553"),a(c,"id","ssid"),a(c,"type","text"),a(c,"placeholder","Enter network name"),c.disabled=l[2],a(c,"class","svelte-1p30553"),a(f,"type","button"),a(f,"class","btn-secondary scan-btn svelte-1p30553"),f.disabled=l[2],a(i,"class","ssid-input-group svelte-1p30553"),a(n,"class","form-group svelte-1p30553"),a(k,"for","password"),a(k,"class","svelte-1p30553"),a(C,"type","button"),a(C,"class","toggle-password svelte-1p30553"),a(y,"class","password-input-group svelte-1p30553"),a(L,"class","help-text svelte-1p30553"),a(g,"class","form-group svelte-1p30553"),a(q,"class","warning-text svelte-1p30553"),a(I,"type","button"),a(I,"class","btn-primary svelte-1p30553"),I.disabled=N=l[2]||!l[5].trim()||l[6].length<8,a(e,"class","form-section svelte-1p30553")},m(X,ne){S(X,e,ne),K&&K.m(e,null),o(e,t),o(e,n),o(n,s),o(n,r),o(n,i),o(i,c),ee(c,l[5]),o(i,u),o(i,f),o(f,m),o(e,_),Z&&Z.m(e,null),o(e,b),o(e,g),o(g,k),o(g,h),o(g,y),x.m(y,null),o(y,E),o(y,C),o(C,P),o(g,O),o(g,L),o(e,F),o(e,q),o(e,R),o(e,I),o(I,G),H=!0,D||(Q=[M(c,"input",l[13]),M(f,"click",l[14]),M(C,"click",l[18]),M(I,"click",l[12])],D=!0)},p(X,ne){X[3]?K?K.p(X,ne):(K=is(X),K.c(),K.m(e,t)):K&&(K.d(1),K=null),(!H||ne&4)&&(c.disabled=X[2]),ne&32&&c.value!==X[5]&&ee(c,X[5]),(!H||ne&512)&&p!==(p=X[9]?"Hide":"Browse")&&j(m,p),(!H||ne&4)&&(f.disabled=X[2]),X[9]?Z?(Z.p(X,ne),ne&512&&W(Z,1)):(Z=os(X),Z.c(),W(Z,1),Z.m(e,b)):Z&&(ve(),B(Z,1,1,()=>{Z=null}),ge()),_e===(_e=ie(X))&&x?x.p(X,ne):(x.d(1),x=_e(X),x&&(x.c(),x.m(y,E))),(!H||ne&128)&&T!==(T=X[7]?"Hide":"Show")&&j(P,T),(!H||ne&4)&&U!==(U=X[2]?"Saving...":"Update WiFi Settings")&&j(G,U),(!H||ne&100&&N!==(N=X[2]||!X[5].trim()||X[6].length<8))&&(I.disabled=N)},i(X){H||(W(Z),H=!0)},o(X){B(Z),H=!1},d(X){X&&w(e),K&&K.d(),Z&&Z.d(),x.d(),D=!1,be(Q)}}}function Ji(l){let e,t,n,s,r,i,c,u,f;return{c(){e=d("div"),t=d("div"),t.textContent="âœ“",n=v(),s=d("h2"),s.textContent="Success!",r=v(),i=d("p"),c=A(l[4]),u=v(),f=d("p"),f.textContent=`The device is restarting. Once it connects to your WiFi network,
          you can access it at its new IP address.`,a(t,"class","success-icon svelte-1p30553"),a(s,"class","svelte-1p30553"),a(i,"class","svelte-1p30553"),a(f,"class","reconnect-info svelte-1p30553"),a(e,"class","success-message svelte-1p30553")},m(p,m){S(p,e,m),o(e,t),o(e,n),o(e,s),o(e,r),o(e,i),o(i,c),o(e,u),o(e,f)},p(p,m){m&16&&j(c,p[4])},d(p){p&&w(e)}}}function Qi(l){let e,t,n,s,r,i;const c=[ji,Di,Ui],u=[];function f(p,m){return p[0]?0:p[4]?1:2}return s=f(l),r=u[s]=c[s](l),{c(){e=d("div"),t=d("div"),t.innerHTML='<h1 class="svelte-1p30553">WiFi Settings</h1> <p class="subtitle svelte-1p30553">Update your WiFi connection without losing device registration</p>',n=v(),r.c(),a(t,"class","header svelte-1p30553"),a(e,"class","wifi-container svelte-1p30553")},m(p,m){S(p,e,m),o(e,t),o(e,n),u[s].m(e,null),i=!0},p(p,[m]){let _=s;s=f(p),s===_?u[s].p(p,m):(ve(),B(u[_],1,1,()=>{u[_]=null}),ge(),r=u[s],r?r.p(p,m):(r=u[s]=c[s](p),r.c()),W(r,1),r.m(e,null))},i(p){i||(W(r),i=!0)},o(p){B(r),i=!1},d(p){p&&w(e),u[s].d()}}}function us(l){return l>=-50?"â–ˆâ–ˆâ–ˆâ–ˆ":l>=-60?"â–ˆâ–ˆâ–ˆâ–‘":l>=-70?"â–ˆâ–ˆâ–‘â–‘":"â–ˆâ–‘â–‘â–‘"}function Ki(l,e,t){let n=!0,s=!1,r=!1,i=null,c=null,u="",f="",p=!1,m=[],_=!1;Ge(async()=>{await b(),t(0,n=!1)});async function b(){t(1,s=!0),t(3,i=null);try{const O=await Cs(!0);t(8,m=O.networks||[]),console.log("[WIFI] Found networks:",m)}catch(O){console.error("[WIFI] Scan error:",O),t(8,m=[])}t(1,s=!1)}function g(O){t(5,u=O.ssid),t(9,_=!1)}async function k(){if(t(3,i=null),t(4,c=null),!u.trim()){t(3,i="Please enter or select a WiFi network");return}if(f.length<8){t(3,i="Password must be at least 8 characters");return}t(2,r=!0);try{await qn({ssid:u.trim(),password:f}),t(4,c="WiFi credentials saved. Device is restarting...")}catch(O){const L=O.message||"";if(L.includes("Failed to fetch")||L.includes("NetworkError")||L.includes("network")||L.includes("Load failed"))t(4,c="WiFi credentials saved. Device is restarting...");else{t(3,i=O.message||"Failed to update WiFi settings"),t(2,r=!1);return}}t(2,r=!1)}function h(){u=this.value,t(5,u)}const y=()=>t(9,_=!_),E=O=>g(O);function C(){f=this.value,t(6,f)}function T(){f=this.value,t(6,f)}return[n,s,r,i,c,u,f,p,m,_,b,g,k,h,y,E,C,T,()=>t(7,p=!p)]}class Yi extends qe{constructor(e){super(),Ae(this,e,Ki,Qi,Te,{})}}function Zi(l){let e,t;return e=new Ks({props:{$$slots:{default:[$i]},$$scope:{ctx:l}}}),{c(){fe(e.$$.fragment)},m(n,s){ae(e,n,s),t=!0},p(n,s){const r={};s&18&&(r.$$scope={dirty:s,ctx:n}),e.$set(r)},i(n){t||(W(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function Xi(l){let e,t,n;var s=l[1];function r(i,c){return{}}return s&&(e=_t(s,r())),{c(){e&&fe(e.$$.fragment),t=Le()},m(i,c){e&&ae(e,i,c),S(i,t,c),n=!0},p(i,c){if(c&2&&s!==(s=i[1])){if(e){ve();const u=e;B(u.$$.fragment,1,0,()=>{ce(u,1)}),ge()}s?(e=_t(s,r()),fe(e.$$.fragment),W(e.$$.fragment,1),ae(e,t.parentNode,t)):e=null}},i(i){n||(e&&W(e.$$.fragment,i),n=!0)},o(i){e&&B(e.$$.fragment,i),n=!1},d(i){i&&w(t),e&&ce(e,i)}}}function $i(l){let e,t,n;var s=l[1];function r(i,c){return{}}return s&&(e=_t(s,r())),{c(){e&&fe(e.$$.fragment),t=Le()},m(i,c){e&&ae(e,i,c),S(i,t,c),n=!0},p(i,c){if(c&2&&s!==(s=i[1])){if(e){ve();const u=e;B(u.$$.fragment,1,0,()=>{ce(u,1)}),ge()}s?(e=_t(s,r()),fe(e.$$.fragment),W(e.$$.fragment,1),ae(e,t.parentNode,t)):e=null}},i(i){n||(e&&W(e.$$.fragment,i),n=!0)},o(i){e&&B(e.$$.fragment,i),n=!1},d(i){i&&w(t),e&&ce(e,i)}}}function xi(l){let e,t,n,s;const r=[Xi,Zi],i=[];function c(u,f){return u[0]?0:1}return e=c(l),t=i[e]=r[e](l),{c(){t.c(),n=Le()},m(u,f){i[e].m(u,f),S(u,n,f),s=!0},p(u,[f]){let p=e;e=c(u),e===p?i[e].p(u,f):(ve(),B(i[p],1,1,()=>{i[p]=null}),ge(),t=i[e],t?t.p(u,f):(t=i[e]=r[e](u),t.c()),W(t,1),t.m(n.parentNode,n))},i(u){s||(W(t),s=!0)},o(u){B(t),s=!1},d(u){u&&w(n),i[e].d(u)}}}function eo(l,e,t){let n,s,r;mt(l,It,c=>t(2,r=c));function i(c){const u=c.startsWith("/")?c:"/"+c;return u==="/"||u===""?$t:u==="/gallery"?rr:u==="/calibration"?cr:u==="/servo"?pr:u==="/settings"?Sr:u==="/logs"||u==="/status"?ql:u==="/firmware"||u.startsWith("/reboot")?Hl:u==="/test"?ii:u==="/setup"?Mi:u==="/wifi"?Yi:$t}return l.$$.update=()=>{l.$$.dirty&4&&t(1,n=i(r)),l.$$.dirty&4&&t(0,s=r==="/setup"||r==="setup")},[s,n,r]}class to extends qe{constructor(e){super(),Ae(this,e,eo,xi,Te,{})}}const ot=(...l)=>console.log("[JS]",...l);function fs(l){ot("app-main: FATAL",l);const e=document.getElementById("app");e&&e.childElementCount===0&&(e.innerHTML=`
      <div style="font: 14px system-ui, sans-serif; color:#ddd; background:#111; padding:16px; line-height:1.35">
        <div style="font-weight:600; margin-bottom:8px; color:#ff6b6b">âš ï¸ App failed to load</div>
        <div style="opacity:.85; margin-bottom:8px">Check console for full stack. Error:</div>
        <pre style="white-space:pre-wrap; background:#181818; border:1px solid #ff6b6b; padding:12px; border-radius:6px; overflow:auto; color:#ffcccc">
${String(l&&(l.stack||l.message)||l)}
        </pre>
      </div>`)}window.addEventListener("error",l=>ot("global-error:",l.message||l.error));window.addEventListener("unhandledrejection",l=>ot("unhandled-rejection:",l.reason));(function(){ot("app-main: start");const e=document.getElementById("app");if(!e){fs("Missing #app container in HTML");return}try{const t=new to({target:e});window.__MOUSETRAP_APP={ok:!0,mountedAt:Date.now(),app:t},ot("app-main: mounted OK")}catch(t){window.__MOUSETRAP_APP={ok:!1,error:t,when:Date.now()},fs(t)}})();
